(window["webpackJsonpmobilelibraries-website"]=window["webpackJsonpmobilelibraries-website"]||[]).push([[0],{146:function(e){e.exports=JSON.parse('{"api":"https://api.mobilelibraries.org/api"}')},408:function(e,t,a){e.exports=a(729)},729:function(e,t,a){"use strict";a.r(t);a(409),a(418);var n=a(0),o=a.n(n),r=a(20),i=a.n(r),l=a(21),s=a(17),c=a(28),u=a(29),p=a(30),m=a(15),d=a(792),g=a(382),h=a.n(g),f=a(383),b=a.n(f),_=a(384),y=a(791),v=a(6),E=a(779),O=a(319),S=a(318),k=a(355),j=a(315),F=a(317),w=a(95),x=a(243),C=a.n(x),M=a(154),R=a.n(M),N=a(244),B=a.n(N),P=a(744),z=a(778),I=a(184),D=a(316),T=a(356),A=a(129),G=a(362),L=a.n(G),W=a(361),Z=a.n(W),H=a(360),Q=a.n(H),J=a(363),U=a.n(J),q=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={postcode:a.props.postcode,anchor:null},a.openSettingsMenu=function(e){return a.setState({anchor:e.currentTarget})},a.closeSettingsMenu=function(){return a.setState({anchor:null})},a.setSearchDistance=function(e){a.closeSettingsMenu(),a.props.setDistance(e)},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.search_type,r=t.postcodeSearch,i=t.toggleGPS;return o.a.createElement("div",{className:a.search},o.a.createElement(P.a,{placeholder:"Postcode",classes:{root:a.inputRoot,input:a.inputInput},value:this.state.postcode,onChange:function(t){return e.setState({postcode:t.target.value})}}),o.a.createElement(T.a,{title:"Search by postcode"},o.a.createElement(j.a,{className:a.iconButton,onClick:function(){return r(e.state.postcode)}},o.a.createElement(Q.a,null))),o.a.createElement(T.a,{title:"Track my location"},o.a.createElement(j.a,{className:a.iconButton,color:"secondary",onClick:function(){i()}},"gps"===n?o.a.createElement(Z.a,null):o.a.createElement(L.a,null))),o.a.createElement(T.a,{title:"Change search settings"},o.a.createElement(j.a,{className:a.iconButton,color:"secondary",onClick:function(t){e.openSettingsMenu(t)}},o.a.createElement(U.a,null))),o.a.createElement(I.a,{id:"mnu-settings",anchorEl:this.state.anchor,keepMounted:!0,open:Boolean(this.state.anchor),onClose:function(){return e.closeSettingsMenu()}},o.a.createElement(z.a,{disableSticky:!0},"Search distance"),o.a.createElement(D.a,{onClick:function(){return e.setSearchDistance(1609)}},"1 mile"),o.a.createElement(D.a,{onClick:function(){return e.setSearchDistance(3219)}},"2 mile"),o.a.createElement(D.a,{onClick:function(){return e.setSearchDistance(4828)}},"3 mile"),o.a.createElement(D.a,{onClick:function(){return e.setSearchDistance(8047)}},"5 miles")))}}]),t}(o.a.Component),V=Object(v.a)(function(e){return{iconButton:{padding:10},inputRoot:{color:"inherit"},inputInput:{paddingTop:e.spacing(),paddingRight:e.spacing(),paddingBottom:e.spacing(),paddingLeft:e.spacing(2),width:80},search:{position:"relative",border:"1px solid #e5e5e5",borderRadius:e.shape.borderRadius,backgroundColor:Object(A.fade)(e.palette.common.white,.8),"&:hover":{backgroundColor:Object(A.fade)(e.palette.common.white,.9)},marginLeft:0,marginRight:e.spacing(),display:"flex"}}})(q),$=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.loading,n=t.classes,r=t.search_type,i=t.postcode,l=t.distance,s=t.toggleGPS,c=t.postcodeSearch,u=t.setDistance,p=t.page;return o.a.createElement(E.a,{position:"fixed",color:"inherit",elevation:0,className:"map"===p?n.appBarTransparent:n.appBar},o.a.createElement(F.a,null,"map"!==p?o.a.createElement(k.a,{xsDown:!0},o.a.createElement(w.a,{variant:"h6",noWrap:!0},"Mobiles")):null,o.a.createElement("div",{className:n.grow}),a?o.a.createElement(S.a,{className:n.progress,color:"secondary",size:30}):null,o.a.createElement(V,{postcode:i,distance:l,search_type:r,toggleGPS:s,setDistance:u,postcodeSearch:c}),o.a.createElement(k.a,{smDown:!0},o.a.createElement(o.a.Fragment,null,o.a.createElement(O.a,{color:"secondary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("mobiles")}},o.a.createElement(C.a,{className:n.leftIcon}),"Dashboard"),o.a.createElement(O.a,{color:"secondary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("stops")}},o.a.createElement(R.a,{className:n.leftIcon}),"Stops"),o.a.createElement(O.a,{color:"secondary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("map")}},o.a.createElement(B.a,{className:n.leftIcon}),"Map"))),o.a.createElement(k.a,{mdUp:!0},o.a.createElement(o.a.Fragment,null,o.a.createElement(j.a,{onClick:function(){return e.props.setPage("mobiles")}},o.a.createElement(C.a,null)),o.a.createElement(j.a,{onClick:function(){return e.props.setPage("stops")}},o.a.createElement(R.a,null)),o.a.createElement(j.a,{onClick:function(){return e.props.setPage("map")}},o.a.createElement(B.a,null))))))}}]),t}(n.Component),K=Object(v.a)(function(e){return{appBar:{zIndex:e.zIndex.drawer+1,borderBottom:"1px solid #F5F5F5"},appBarTransparent:{zIndex:e.zIndex.drawer+1,backgroundColor:"rgba(250, 250, 250, 0.5)",borderBottom:"1px solid #F5F5F5"},grow:{flexGrow:1},hide:{display:"none"},leftIcon:{marginRight:e.spacing(1)},progress:{margin:e.spacing(1)}}},{withTheme:!0})($),X=a(780),Y=a(329),ee=a(781),te=a(783),ae=a(782),ne=a(358),oe=a(364),re=a.n(oe),ie=a(191),le=a.n(ie),se=a(365),ce=a.n(se),ue=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={organisation_menu_anchor:null,mobile_menu_anchor:null,route_menu_anchor:null},a.openOrganisationMenu=function(e){a.setState({organisation_menu_anchor:e})},a.closeOrganisationMenu=function(){a.setState({organisation_menu_anchor:null})},a.chooseOrganisation=function(e){a.props.setOrganisationFilter(e),a.closeOrganisationMenu()},a.openMobileMenu=function(e){a.setState({mobile_menu_anchor:e})},a.closeMobileMenu=function(){a.setState({mobile_menu_anchor:null})},a.chooseMobile=function(e){a.props.setMobileFilter(e),a.closeMobileMenu()},a.openRouteMenu=function(e){a.setState({route_menu_anchor:e})},a.closeRouteMenu=function(){a.setState({route_menu_anchor:null})},a.chooseRoute=function(e){a.props.setRouteFilter(e),a.closeRouteMenu()},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.organisations,r=t.organisation_lookup,i=t.organisation_filter,l=t.clearOrganisationFilter,s=t.mobiles,c=t.mobile_lookup,u=t.mobile_filter,p=t.clearMobileFilter,m=t.routes,d=t.route_lookup,g=t.route_filter,h=t.clearRouteFilter,f=o.a.createElement("span",{className:a.bullet},"\u2022");return o.a.createElement(X.a,{className:a.grid,container:!0,spacing:3},o.a.createElement(X.a,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2},o.a.createElement(ee.a,{className:a.card,elevation:0},o.a.createElement(ae.a,null,o.a.createElement(w.a,{className:a.title,color:"textSecondary",gutterBottom:!0},n.length+" library services",f,s.length+" mobile libraries",f,m.length+" routes")),o.a.createElement(te.a,null,0===i.length?o.a.createElement(T.a,{title:"Choose library service"},o.a.createElement(O.a,{size:"small",color:"primary",className:a.button,onClick:function(t){return e.openOrganisationMenu(t.currentTarget)}},o.a.createElement(re.a,{className:a.leftIcon}),"Service")):o.a.createElement(ne.a,{size:"small",color:"secondary",onDelete:l,label:r[i[0]].name}),i.length>0?0===u.length?o.a.createElement(T.a,{title:"Choose mobile library"},o.a.createElement(O.a,{size:"small",color:"primary",className:a.button,onClick:function(t){return e.openMobileMenu(t.currentTarget)}},o.a.createElement(le.a,{className:a.leftIcon}),"Mobile")):o.a.createElement(ne.a,{size:"small",color:"secondary",onDelete:function(e){return p()},label:c[u[0]].name}):null,u.length>0?0===g.length?o.a.createElement(T.a,{title:"Choose route"},o.a.createElement(O.a,{size:"small",color:"primary",className:a.button,onClick:function(t){return e.openRouteMenu(t.currentTarget)}},o.a.createElement(ce.a,{className:a.leftIcon}),"Route")):o.a.createElement(ne.a,{size:"small",color:"secondary",onDelete:function(e){return h()},label:d[g[0]].name}):null))),o.a.createElement(I.a,{id:"menu-library-service",anchorEl:this.state.organisation_menu_anchor,keepMounted:!0,open:Boolean(this.state.organisation_menu_anchor),onClose:function(){return e.closeOrganisationMenu()}},n.sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return o.a.createElement(D.a,{key:"mnu_itm_org_"+t.id,onClick:function(){return e.chooseOrganisation(t.id)}},t.name)})),o.a.createElement(I.a,{id:"menu-mobile-library",anchorEl:this.state.mobile_menu_anchor,keepMounted:!0,open:Boolean(this.state.mobile_menu_anchor),onClose:function(){return e.closeMobileMenu()}},s.filter(function(e){var t=!0;return i.length>0&&-1===i.indexOf(e.organisation_id)&&(t=!1),t}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return o.a.createElement(D.a,{key:"mnu_itm_mob_"+t.id,onClick:function(){return e.chooseMobile(t.id)}},t.name)})),o.a.createElement(I.a,{id:"menu-route",anchorEl:this.state.route_menu_anchor,keepMounted:!0,open:Boolean(this.state.route_menu_anchor),onClose:function(){return e.closeRouteMenu()}},m.filter(function(e){var t=!0;return u.length>0&&-1===u.indexOf(e.mobile_id)&&(t=!1),t}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return o.a.createElement(D.a,{key:"mnu_itm_route_"+t.id,onClick:function(){return e.chooseRoute(t.id)}},t.name)})))}}]),t}(n.Component),pe=Object(v.a)(function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},card:{position:"relative",minWidth:275,border:"1px solid #F5F5F5"},grid:{marginBottom:10},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500}}},{withTheme:!0})(ue),me=a(784),de=a(69),ge=a.n(de),he=a(203),fe=a.n(he),be=a(31),_e=a.n(be),ye=a(146);function ve(e,t){var a={label:"Not out today"},n={label:"Arriving at %s %s"},o={label:"At %s for %s"},r={label:"Arriving at %s %s"},i={label:"Finished for the day"};if(t&&!t.current_stop_id&&!t.previous_stop_id&&t.next_stop_id&&!_e()(t.next_stop_arrival).isSame(_e()(),"day"))return a.label;if(t&&!t.current_stop_id&&!t.previous_stop_id&&t.next_stop_id&&_e()(t.next_stop_arrival).isSame(_e()(),"day")){var l=_e()(t.next_stop_arrival).fromNow();return fe.a.format(n.label,t.next_stop_name,l)}if(t&&t.current_stop_id){var s=_e()(t.current_stop_departure).fromNow(!0);return fe.a.format(o.label,t.current_stop_name,s)}if(t&&!t.current_stop_id&&t.previous_stop_id&&t.next_stop_id&&_e()(t.previous_stop_departure).isSame(_e()(),"day")&&_e()(t.next_stop_arrival).isSame(_e()(),"day")){var c=_e()(t.next_stop_arrival).fromNow();return fe.a.format(r.label,t.next_stop_name,c)}return t&&t.previous_stop_id&&t.next_stop_id&&_e()(t.previous_stop_departure).isSame(_e()(),"day")&&!_e()(t.next_stop_arrival).isSame(_e()(),"day")?i.label:null}var Ee=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.mobile,r=t.organisation,i=ve(0,t.location),l=o.a.createElement("span",{className:a.bullet},"\u2022");return o.a.createElement(ee.a,{className:a.card,elevation:0},o.a.createElement(ae.a,null,o.a.createElement(w.a,{className:a.title,color:"textSecondary",gutterBottom:!0},n.number_routes+" route"+(n.number_routes>1?"s":""),l,n.number_stops+" stop"+(n.number_stops>1?"s":"")),o.a.createElement(w.a,{variant:"h6",component:"h2"},(r?r.name+" ":"")+n.name),i?o.a.createElement(w.a,null,i):o.a.createElement(S.a,{className:a.progress,color:"secondary",size:30})),o.a.createElement(me.a,{variant:"middle"}),o.a.createElement(te.a,null,o.a.createElement(T.a,{title:"Mobile library stops"},o.a.createElement(O.a,{size:"small",color:"primary",className:a.button,onClick:function(){return e.props.viewStopsByMobile(r.id,n.id)}},o.a.createElement(R.a,{className:a.leftIcon}),"Stops")),o.a.createElement(me.a,{className:a.verticalDivider})))}}]),t}(n.Component),Oe=Object(v.a)(function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},card:{minWidth:275,border:"1px solid #F5F5F5"},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500,align:"right"},verticalDivider:{width:1,height:28,margin:8},progress:{margin:e.spacing(2)}}},{withTheme:!0})(Ee),Se=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.organisations,r=t.organisation_lookup,i=t.organisation_filter,l=t.setOrganisationFilter,s=t.clearOrganisationFilter,c=t.viewStopsByOrganisation,u=t.mobiles,p=t.mobile_lookup,m=t.mobile_location_lookup,d=t.mobile_filter,g=t.setMobileFilter,h=t.clearMobileFilter,f=t.routes,b=t.route_lookup,_=t.route_filter,y=t.setRouteFilter,v=t.clearRouteFilter;return o.a.createElement("div",{className:a.root},o.a.createElement(pe,{displayStopLink:!0,organisations:n,organisation_lookup:r,organisation_filter:i,setOrganisationFilter:l,clearOrganisationFilter:s,viewStopsByOrganisation:c,mobiles:u,mobile_lookup:p,mobile_filter:d,setMobileFilter:g,clearMobileFilter:h,routes:f,route_lookup:b,route_filter:_,setRouteFilter:y,clearRouteFilter:v}),o.a.createElement(z.a,{disableSticky:!0},"Mobile library dashboard"),u&&u.length>0?o.a.createElement(X.a,{container:!0,spacing:3},u.filter(function(e){var t=!0;return i.length>0&&-1===i.indexOf(e.organisation_id)&&(t=!1),d.length>0&&-1===d.indexOf(e.id)&&(t=!1),t}).map(function(t,a){return o.a.createElement(X.a,{key:"grd_"+t.name.replace(" ","")+"_"+a,item:!0,xs:12,sm:6,md:4,lg:3,xl:2},o.a.createElement(Oe,{mobile:t,location:m[t.id],organisation:r[t.organisation_id],viewStopsByMobile:e.props.viewStopsByMobile}))})):o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement(Y.a,{color:"secondary"})))}}]),t}(n.Component),ke=Object(v.a)(function(){return{root:{flexGrow:1}}})(Se),je=a(87),Fe=a(644),we=a(367),xe=a.n(we),Ce=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.classes;return o.a.createElement(T.a,{title:"Me"},o.a.createElement(Fe.a,{className:"gps"===this.props.search_type?e.avatarOn:e.avatar},o.a.createElement(xe.a,null)))}}]),t}(o.a.Component),Me=Object(v.a)(function(e){return{avatar:{margin:0},avatarOn:{margin:0,cursor:"pointer",backgroundColor:e.palette.primary.main}}},{withTheme:!0})(Ce),Re=a(785),Ne=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.location;e.mobile;return o.a.createElement(T.a,{title:ve(0,a)},o.a.createElement(Re.a,{size:"small",color:"primary",className:t.fab},o.a.createElement(le.a,null)))}}]),t}(n.Component),Be=Object(v.a)(function(e){return{fab:{margin:e.spacing(1),boxShadow:"none"}}},{withTheme:!0})(Ne),Pe=Object(je.e)({minZoom:5,maxZoom:18,scrollZoom:!0,interactive:!0,dragRotate:!0,attributionControl:!0}),ze=["https://api.mobilelibraries.org/api/stops/{z}/{x}/{y}.mvt"],Ie=["https://api.mobilelibraries.org/api/trips/{z}/{x}/{y}.mvt"],De=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={time_update_interval:null,current_time:null},a.componentDidMount=function(){var e=setInterval(a.setCurrentTime,500);a.setState({time_update_interval:e})},a.setCurrentTime=function(){return a.setState({current_time:_e()()})},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.position,n=t.zoom,r=t.pitch,i=t.bearing,l=t.fit_bounds,s=t.mobile_locations,c=t.mobile_lookup;return o.a.createElement(Pe,{style:"style.json",center:a,zoom:n,maxZoom:17,pitch:r,bearing:i,fitBounds:l,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"}},s&&s.length>0?s.map(function(t){var a=[t.geox,t.geoy];if(e.state.current_time&&t.route_section&&t.route_section.coordinates&&t.updated){var n=_e()(e.state.current_time).diff(t.updated),r=Math.round(n/500),i=t.route_section.coordinates;i.length>r&&r>0&&(a=i[r]),i.length<=r&&r>0&&(a=i[i.length-1])}return o.a.createElement(je.b,{key:"mkr_"+t.id,coordinates:a,anchor:"bottom"},o.a.createElement(Be,{mobile:c[t.mobile_id],location:t}))}):null,o.a.createElement(je.c,{id:"src_stops",tileJsonSource:{type:"vector",tiles:ze}}),o.a.createElement(je.c,{id:"src_trips",tileJsonSource:{type:"vector",tiles:Ie}}),o.a.createElement(je.a,{id:"lyr_trips_lines",type:"line",sourceId:"src_trips",sourceLayer:"trip",minZoom:13,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-dasharray":[2,.5]}}),o.a.createElement(je.a,{id:"lyr_stops_circles",type:"circle",sourceId:"src_stops",sourceLayer:"stop",minZoom:7,layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],5,2,17,10],"circle-color":"#607d8b","circle-stroke-width":["interpolate",["linear"],["zoom"],5,1,14,2],"circle-stroke-color":"#FFFFFF","circle-opacity":.8}}),o.a.createElement(je.a,{id:"lyr_stops_labels",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","name"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,10,17,22],"text-offset":[0,1.7]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"}}),this.props.current_position&&this.props.current_position.length>1?o.a.createElement(je.b,{key:"mk_me",coordinates:[this.props.current_position[0],this.props.current_position[1]]},o.a.createElement(Me,{search_type:this.props.search_type})):null,o.a.createElement(je.d,{position:"bottom-right"}))}}]),t}(n.Component),Te=a(192),Ae=a.n(Te),Ge=a(793),Le=a(788),We=a(787),Ze=a(786),He=a(777),Qe=a(741),Je=a(330),Ue=a(794),qe=a(146),Ve=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a.getStopCalendar=function(){return window.open(qe.api+"/stops/"+a.props.stop.id+"/ics")},a.getStopPdf=function(){return window.open(qe.api+"/stops/"+a.props.stop.id+"/pdf","_blank")},a.close=function(){a.props.close()},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.width,r=t.stop,i=Object(Ue.b)("sm",n),l=_e()(r.arrival,"HH:mm:ssZ"),s=_e()(r.departure,"HH:mm:ssZ"),c=_e.a.duration(s.diff(l)).humanize();return o.a.createElement(Ge.a,{fullScreen:i,disableBackdropClick:!0,open:this.props.open,onClose:this.close,"aria-labelledby":"responsive-dialog-title",BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:a.dialog}},o.a.createElement(Ze.a,{id:"responsive-dialog-title"},r.name),o.a.createElement(We.a,null,o.a.createElement(He.a,{className:a.list},o.a.createElement(z.a,null,"Visiting for "+c),o.a.createElement(Qe.a,null,o.a.createElement(Je.a,{primary:r.address})),o.a.createElement(Qe.a,null,o.a.createElement(Je.a,{primary:l.format("h:mma")+" - "+s.format("h:mma")})))),o.a.createElement(Le.a,null,o.a.createElement(O.a,{onClick:function(){return e.getStopCalendar()},color:"primary"},"Add to calendar"),o.a.createElement(O.a,{onClick:function(){return e.getStopPdf()},color:"primary"},"Get PDF"),o.a.createElement(O.a,{onClick:function(){return e.close()},color:"secondary"},"Close")))}}]),t}(o.a.Component),$e=Ae()(Object(Ue.a)(),Object(v.a)(function(e){return{dialog:{border:"1px solid #e5e5e5"},list:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper}}},{withTheme:!0}))(Ve),Ke=a(790),Xe=a(153),Ye=a(368),et=a.n(Ye),tt=a(381),at=a.n(tt),nt=a(380),ot=a.n(nt),rt=a(379),it=a.n(rt),lt=a(377),st=a.n(lt),ct=a(376),ut=a.n(ct),pt=a(378),mt=a.n(pt),dt=a(146);var gt=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={title:"All stops"},a.tableRef=o.a.createRef(),a.setOrganisationFilter=function(e){a.props.setOrganisationFilter(e),a.tableRef.current.onQueryChange()},a.clearOrganisationFilter=function(){a.props.clearOrganisationFilter(),a.tableRef.current.onQueryChange()},a.setMobileFilter=function(e){a.props.setMobileFilter(e),a.tableRef.current.onQueryChange()},a.clearMobileFilter=function(){a.props.clearMobileFilter(),a.tableRef.current.onQueryChange()},a.setRouteFilter=function(e){a.props.setRouteFilter(e),a.tableRef.current.onQueryChange()},a.clearRouteFilter=function(){a.props.clearRouteFilter(),a.tableRef.current.onQueryChange()},a.displayStopInfo=function(e){return a.props.viewStop(e)},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){this.props.postcode===e.postcode&&this.props.distance===e.distance||this.tableRef.current.onQueryChange()}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.organisations,r=t.organisation_lookup,i=t.organisation_filter,l=t.viewStopsByOrganisation,s=t.mobiles,c=t.mobile_lookup,u=t.mobile_filter,p=t.routes,m=t.route_lookup,d=t.route_filter,g=t.current_position,h=t.distance,f=t.width,b={};Object.keys(r).forEach(function(e){b[e]=r[e].name});var _={};Object.keys(c).forEach(function(e){_[e]=c[e].name});var y={};return Object.keys(m).forEach(function(e){y[e]=m[e].name}),o.a.createElement("div",{style:{maxWidth:"100%"}},o.a.createElement(pe,{displayStopLink:!1,organisations:n,organisation_lookup:r,organisation_filter:i,setOrganisationFilter:this.setOrganisationFilter,clearOrganisationFilter:this.clearOrganisationFilter,viewStopsByOrganisation:l,mobiles:s,mobile_lookup:c,mobile_filter:u,setMobileFilter:this.setMobileFilter,clearMobileFilter:this.clearMobileFilter,routes:p,route_lookup:m,route_filter:d,setRouteFilter:this.setRouteFilter,clearRouteFilter:this.clearRouteFilter}),o.a.createElement(et.a,{tableRef:this.tableRef,components:{Container:function(e){return o.a.createElement(Xe.a,Object.assign({},e,{elevation:0,className:a.table}))}},icons:{Filter:ut.a,FirstPage:st.a,LastPage:mt.a,NextPage:it.a,PreviousPage:ot.a,SortArrow:at.a},options:{padding:Object(Ue.c)("sm",f)?"default":"dense",search:!1,loadingType:"linear",actionsColumnIndex:4,filtering:!1,headerStyle:{backgroundColor:"#2196f3",color:"#ffffff"}},columns:[{title:"Name",field:"name",filtering:!1,render:function(t){return o.a.createElement(o.a.Fragment,null,o.a.createElement(Ke.a,{component:"button",variant:"body2",onClick:function(){return e.displayStopInfo(t)}},t.name))}},{title:"Community",field:"community",filtering:!1},{title:"Time",field:"arrival",filtering:!1,render:function(e){return _e()(e.arrival,"HH:mm:ssZ").format("h:mma")}}],data:function(e){return new Promise(function(t,a){!function(e,t,a,n,o,r,i){var l=dt.api+"/stops?page="+(e.page+1)+"&limit="+e.pageSize;e.orderBy&&e.orderBy.field&&(l=l+"&sort="+e.orderBy.field+"&direction="+e.orderDirection),a.length>0&&(l=l+"&mobile_ids="+a.join("|")),t.length>0&&(l=l+"&organisation_ids="+t.join("|")),n.length>0&&(l=l+"&route_ids="+n.join("|")),o&&o.length>1&&(l=l+"&longitude="+o[0]+"&latitude="+o[1]),r&&""!==r&&(l=l+"&distance="+r),ge.a.get(l).then(function(e){e&&e.data?i({stops:e.data,total:parseInt(e.headers["x-total-count"]),page:parseInt(e.headers["x-page"])}):i({stops:[],total:0,page:1})}).catch(function(e){return i({stops:[],total:0,page:1})})}(e,i,u,d,g,h,function(e){t({data:e.stops,page:e.page-1,totalCount:e.total})})})},title:this.state.title}))}}]),t}(n.Component),ht=Ae()(Object(Ue.a)(),Object(v.a)(function(e){return{formControl:{margin:e.spacing(1),minWidth:200},margin:{margin:e.spacing(1)},root:{flexGrow:1,maxWidth:"100%"},table:{border:"1px solid #F5F5F5"}}},{withTheme:!0}))(gt);function ft(e){navigator.geolocation.getCurrentPosition(function(t){e([t.coords.longitude,t.coords.latitude])},function(t){e([])},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}var bt=a(146);var _t=a(146);function yt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function vt(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?yt(a,!0).forEach(function(t){Object(m.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):yt(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}var Et=Object(_.a)({palette:{primary:h.a,secondary:b.a},overrides:{MuiButton:{text:{textTransform:"inherit"}}}}),Ot=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={page:"mobiles",stop_dialog_open:!1,current_stop:{},organisations:[],organisation_lookup:{},organisation_filter:[],mobiles:[],mobile_lookup:{},mobile_filter:[],mobile_locations:[],mobile_location_lookup:{},location_timer:null,routes:[],route_lookup:{},route_filter:[],fit_bounds:null,position:[-2.1,53.6138],zoom:[7],pitch:[0],bearing:[0],gps_loading:!0,distance:1609,postcode:"",postcode_loading:!0,current_position:[],position_update_interval:"",search_type:"",loading_organisations:!1,loading_mobiles:!1,loading_routes:!1},a.getOrganisations=function(){var e;a.setState({loading_organisations:!0}),e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({organisations:e,organisation_lookup:t,loading_organisations:!1})},ge.a.get(bt.api+"/organisations").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getMobiles=function(){var e;a.setState({loading_mobiles:!0}),e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({mobiles:e,mobile_lookup:t,loading_mobiles:!1})},ge.a.get(ye.api+"/mobiles").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getRoutes=function(){var e;a.setState({loading_routes:!0}),e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({routes:e,route_lookup:t,loading_routes:!1})},ge.a.get(_t.api+"/routes").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getMobileLocations=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.mobile_id]=e}),a.setState({mobile_locations:e,mobile_location_lookup:t})},ge.a.get(ye.api+"/mobiles/locations").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.componentDidMount=function(){a.getOrganisations(),a.getMobiles(),a.getRoutes(),a.getMobileLocations();var e=setInterval(function(){a.getMobileLocations()},15e3);a.setState({location_timer:e})},a.setPage=function(e){return a.setState({page:e})},a.viewStop=function(e){a.setState({current_stop:e,stop_dialog_open:!0})},a.closeStopDialog=function(){a.setState({stop_dialog_open:!1})},a.viewStopsByOrganisation=function(e){return a.setState({page:"stops",organisation_filter:[e],mobile_filter:[],route_filter:[]})},a.viewStopsByMobile=function(e,t){return a.setState({page:"stops",organisation_filter:[e],mobile_filter:[t],route_filter:[]})},a.viewStopsByRoute=function(e,t,n){return a.setState({page:"stops",organisation_filter:[e],mobile_filter:[t],route_filter:[n]})},a.clearMobileFilter=function(){return a.setState({mobile_filter:[],route_filter:[]})},a.clearRouteFilter=function(){return a.setState({route_filter:[]})},a.clearOrganisationFilter=function(){return a.setState({organisation_filter:[],mobile_filter:[],route_filter:[]})},a.logPosition=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.setState({loading:!0,gps_loading:!0}),ft(function(e){a.setState({current_position:e,position:e,zoom:[11],gps_loading:!1})})},a.setDistance=function(e){return a.setState({distance:e})},a.postcodeSearch=function(e){var t={search_type:"postcode",loading:!0,postcode_loading:!0,postcode:e};"gps"===a.state.search_type&&(clearInterval(a.state.position_update_interval),t.position_update_interval=null),function(e,t){ge.a.get("https://api.postcodes.io/postcodes/"+e).then(function(e){e&&e.data&&e.data.result?t([e.data.result.longitude,e.data.result.latitude]):t([])}).catch(function(e){return t([])})}(e,function(e){2===e.length&&(t.search_type="postcode",t.current_position=e,t.position=e,t.zoom=[11],t.loading=!1,a.setState(t))})},a.toggleGPS=function(){if("gps"===a.state.search_type)clearInterval(a.state.position_update_interval),a.setState({search_type:"",postcode:"",position_update_interval:null});else{var e=setInterval(a.logPosition,1e4);a.setState({position_update_interval:e,search_type:"gps",postcode:""}),a.logPosition(!0)}},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return o.a.createElement(y.a,{theme:Et},o.a.createElement("div",{className:t.root},o.a.createElement(d.a,null),o.a.createElement(K,{postcode:this.state.postcode,distance:this.state.distance,page:this.state.page,search_type:this.state.search_type,loading:this.state.loading_mobiles||this.state.loading_organisations||this.state.loading_routes,setPage:this.setPage,setDistance:this.setDistance,toggleGPS:this.toggleGPS,postcodeSearch:this.postcodeSearch}),o.a.createElement("main",{className:t.content},o.a.createElement("div",{className:t.toolbar}),"mobiles"===this.state.page?o.a.createElement(ke,{mobiles:this.state.mobiles,mobile_lookup:this.state.mobile_lookup,mobile_location_lookup:this.state.mobile_location_lookup,organisation_lookup:this.state.organisation_lookup,viewStopsByMobile:this.viewStopsByMobile,viewStopsByOrganisation:this.viewStopsByOrganisation,organisations:this.state.organisations,organisation_filter:this.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:this.clearOrganisationFilter,mobile_filter:this.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:this.clearMobileFilter,routes:this.state.routes,route_lookup:this.state.route_lookup,route_filter:this.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:this.clearRouteFilter}):null,"stops"===this.state.page?o.a.createElement(ht,{organisations:this.state.organisations,organisation_lookup:this.state.organisation_lookup,organisation_filter:this.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:this.clearOrganisationFilter,mobiles:this.state.mobiles,mobile_lookup:this.state.mobile_lookup,mobile_filter:this.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:this.clearMobileFilter,routes:this.state.routes,route_lookup:this.state.route_lookup,route_filter:this.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:this.clearRouteFilter,viewStop:this.viewStop,current_position:this.state.current_position,postcode:this.state.postcode,distance:this.state.distance}):null,"map"===this.state.page?o.a.createElement(De,{bearing:this.state.bearing,fit_bounds:this.state.fit_bounds,pitch:this.state.pitch,position:this.state.position,current_position:this.state.current_position,zoom:this.state.zoom,search_type:this.state.search_type,mobile_lookup:this.state.mobile_lookup,mobile_locations:this.state.mobile_locations.filter(function(e){return null!==e.geox})}):null),o.a.createElement($e,{stop:this.state.current_stop,open:this.state.stop_dialog_open,close:function(){return e.closeStopDialog()}})))}}]),t}(n.Component),St=Object(v.a)(function(e){return{root:{display:"flex"},toolbar:vt({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3)}}})(Ot);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(St,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[408,1,2]]]);
//# sourceMappingURL=main.b22d59c4.chunk.js.map