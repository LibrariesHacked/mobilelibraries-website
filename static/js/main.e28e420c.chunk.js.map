{"version":3,"sources":["context/applicationState.js","context/searchState.js","context/viewState.js","helpers/geo.js","models/mobiles.js","PostcodeSearch.js","AppHeader.js","Filters.js","MobileCard.js","Mobiles.js","MeAvatar.js","MapSettings.js","helpers/utils.js","MobileAvatar.js","MobileMap.js","Notification.js","models/stops.js","Stops.js","StopDetails.js","models/trips.js","TripDetails.js","models/organisations.js","models/routes.js","MobilesApplication.js","App.js","serviceWorker.js","index.js"],"names":["ApplicationStateContext","createContext","ApplicationStateProvider","reducer","initialState","children","Provider","value","useReducer","useApplicationStateValue","useContext","SearchStateContext","SearchStateProvider","useSearchStateValue","ViewStateContext","ViewStateProvider","useViewStateValue","config","require","getPostcode","postcode","a","axios","get","postcodeApi","response","location","data","longitude","latitude","organisation","library_service_name","Mobile","obj","Object","assign","this","json","id","organisationId","organisation_id","name","timetable","numberRoutes","number_routes","numberStops","number_stops","MobileNearestStop","mobileId","mobile_id","stopId","stop_id","stopName","stop_name","stopDistance","stop_distance","MobileLocation","currentStopId","current_stop_id","currentStopDeparture","moment","current_stop_departure","currentStopName","current_stop_name","previousStopId","previous_stop_id","previousStopDeparture","previous_stop_departure","previousStopName","previous_stop_name","nextStopId","next_stop_id","nextStopArrival","next_stop_arrival","nextStopName","next_stop_name","updated","updateType","update_type","geoX","geox","geoY","geoy","routeSection","route_section","now","statuses","isSame","type","textFormat","message","arrival","fromNow","args","stopRemaining","text_format","getAllMobiles","api","length","mobiles","map","m","fromJson","getMobileLocations","locations","ml","getMobilesNearest","distance","useStyles","makeStyles","theme","grow","flexGrow","iconButton","padding","inputInput","paddingTop","spacing","paddingRight","paddingBottom","paddingLeft","fontWeight","search","position","border","borderRadius","shape","backgroundColor","fade","palette","common","white","marginLeft","marginRight","display","maxWidth","PostcodeSearch","dispatchApplication","searchType","searchPostcode","searchDistance","dispatchSearch","dispatchView","useState","tempPostcode","setTempPostcode","anchor","setAnchor","prevProps","ref","useRef","useEffect","current","usePrevious","closeSettingsMenu","setSearchDistance","postcodeSearch","notificationMessage","geoHelper","postcodeData","searchPosition","mapPosition","mobilesModel","mobilesNearest","mobilesNearestLookup","forEach","mobile","classes","className","InputBase","placeholder","input","onChange","e","target","Tooltip","title","IconButton","onClick","color","currentTarget","openSettingsMenu","Menu","anchorEl","keepMounted","open","Boolean","onClose","ListSubheader","disableSticky","MenuItem","appBar","zIndex","drawer","appBarTransparent","iconTitle","progress","margin","tabBar","borderTop","borderBottom","verticalAlign","AppHeader","loadingOrganisations","loadingMobiles","loadingRoutes","loadingMobileLocations","loadingNearestMobiles","loadingPostcode","appsOpen","setAppsOpen","tabValue","setTabValue","loading","useLocation","sites","url","icon","links","short","to","siteUrl","Typography","variant","component","AppBar","elevation","Tabs","v","scrollButtons","indicatorColor","textColor","site","idx","Tab","key","label","pathname","Toolbar","Hidden","smUp","link","Link","replace","disableRipple","disableFocusRipple","xsDown","mdUp","Button","size","smDown","CircularProgress","button","chip","leftIcon","alignContent","textAlign","marginBottom","subtitle","Filters","organisations","organisationLookup","mobileLookup","routeLookup","routes","organisationFilter","mobileFilter","routeFilter","organisationMenuAnchor","setOrganisationMenuAnchor","mobileMenuAnchor","setMobileMenuAnchor","routeMenuAnchor","setRouteMenuAnchor","closeOrganisationMenu","closeMobileMenu","closeRouteMenu","countries","Set","org","country","element","Chip","onDelete","Array","from","sort","b","localeCompare","menuItems","orgList","filter","concat","mob","indexOf","route","routeId","bullet","transform","card","minWidth","fontSize","align","verticalDivider","width","height","MobileCard","props","stopButton","stop","stopDialogOpen","statusMessage","status","getStatus","offRoadMessage","preRouteMessage","atStopMessage","betweenStopsMessage","postRouteMessage","bull","Card","CardContent","gutterBottom","CardActions","Divider","goToWebsite","root","Mobiles","mobileLocationLookup","openTab","setOpenTab","filteredMobiles","activeMobiles","organisationName","mobileName","routeName","Math","round","mobilesView","changeTab","tab","Badge","badgeContent","showZero","Grid","container","item","xs","sm","md","lg","xl","avatar","avatarOn","cursor","primary","main","MeAvatar","Avatar","dialog","MapSettings","mapSettings","mapSettingsDialogOpen","closeDialog","useTheme","fullScreen","useMediaQuery","breakpoints","down","Dialog","disableBackdropClick","BackdropProps","invisible","PaperProps","DialogTitle","DialogContent","FormControlLabel","control","Switch","checked","authorityBoundary","mapSetting","DialogActions","hextoRGBA","hex","alpha","c","test","substring","split","join","Error","fab","boxShadow","MobileAvatar","mapZoom","Fab","style","utilsHelper","colour","settings","bottom","right","Map","ReactMapboxGl","minZoom","maxZoom","customAttribution","stopTiles","tripTiles","libraryAuthorityTiles","MobileMap","mobileLocations","currentTime","setCurrentTime","setMap","setInterval","setTime","clickStop","features","properties","organisationColourMatch","push","code","l","center","zoom","pitch","bearing","fitBounds","containerStyle","top","left","onStyleLoad","locationPoint","coordinates","millisecondsPassed","diff","index","coords","getZoom","tileJsonSource","tiles","sourceId","sourceLayer","layout","paint","tripId","tripDialogOpen","Notification","notificationOpen","handleClose","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","ContentProps","action","aria-label","Stop","routeIds","route_ids","routeNames","route_names","mobileIds","mobile_ids","mobileNames","mobile_names","organisation_name","community","address","arrivalTimes","arrival_times","departureTimes","departure_times","routeStart","route_start","routeEnd","route_end","routeDays","route_days","routeFrequencies","route_frequencies","routeSchedule","route_schedule","s","getQueryStops","query","organisationFilters","mobileFilters","routeFilters","page","pageSize","orderBy","field","orderDirection","stops","total","parseInt","headers","getStopById","formControl","table","Stops","tableRef","React","createRef","onQueryChange","orgText","keys","mobileText","routeText","components","Container","Paper","icons","Filter","FilterList","FirstPage","LastPage","NextPage","ChevronRight","PreviousPage","ChevronLeft","SortArrow","ArrowUpward","options","up","loadingType","actionsColumnIndex","filtering","toolbar","headerStyle","columns","render","rowData","mdDown","window","cellStyle","hidden","format","Promise","resolve","reject","stopsModel","stopData","totalCount","getStops","list","background","paper","StopDetails","setStop","getStop","close","aria-labelledby","startIcon","Trip","originStopId","origin_stop_id","originStopName","origin_stop_name","destinationStopId","destination_stop_id","destinationStopName","destination_stop_name","duration","routeLine","route_line","getTripById","TripDetails","currentTripId","trip","setTrip","tripsModel","getTrip","estimatedDuration","Organisation","website","email","logo","numberMobiles","number_mobiles","getAllOrganisations","o","Route","frequency","start","end","getAllRoutes","r","content","MobilesApplication","dispatchApplicationState","organisationsModel","routesModel","getOrganisations","getMobiles","getRoutes","path","exact","substr","initialApplicationState","trips","applicationReducer","state","initialSearchState","searchPositionUpdateInterval","searchReducer","initialViewState","viewReducer","createMuiTheme","red","secondary","blueGrey","overrides","MuiButton","text","textTransform","MuiTab","MuiTableCell","App","ThemeProvider","CssBaseline","hostname","match","ReactDOM","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.e28e420c.chunk.js","sourcesContent":["import React, { createContext, useContext, useReducer } from 'react'\r\n\r\nexport const ApplicationStateContext = createContext()\r\n\r\nexport const ApplicationStateProvider = ({ reducer, initialState, children }) => (\r\n  <ApplicationStateContext.Provider value={useReducer(reducer, initialState)}>\r\n    {children}\r\n  </ApplicationStateContext.Provider>\r\n)\r\n\r\nexport const useApplicationStateValue = () => useContext(ApplicationStateContext)\r\n","import React, { createContext, useContext, useReducer } from 'react'\r\n\r\nexport const SearchStateContext = createContext()\r\n\r\nexport const SearchStateProvider = ({ reducer, initialState, children }) => (\r\n  <SearchStateContext.Provider value={useReducer(reducer, initialState)}>\r\n    {children}\r\n  </SearchStateContext.Provider>\r\n)\r\n\r\nexport const useSearchStateValue = () => useContext(SearchStateContext)\r\n","import React, { createContext, useContext, useReducer } from 'react'\r\n\r\nexport const ViewStateContext = createContext()\r\n\r\nexport const ViewStateProvider = ({ reducer, initialState, children }) => (\r\n  <ViewStateContext.Provider value={useReducer(reducer, initialState)}>\r\n    {children}\r\n  </ViewStateContext.Provider>\r\n)\r\n\r\nexport const useViewStateValue = () => useContext(ViewStateContext)\r\n","import axios from 'axios'\r\n\r\nconst config = require('./config.json')\r\n\r\nexport function getPosition (options = {}) {\r\n  return new Promise((resolve, reject) => {\r\n    navigator.geolocation.getCurrentPosition(resolve, reject, options)\r\n  })\r\n}\r\n\r\nexport async function getCurrentPosition () {\r\n  var options = {\r\n    enableHighAccuracy: true,\r\n    timeout: 10000,\r\n    maximumAge: 0\r\n  }\r\n\r\n  const position = await getPosition(options)\r\n  return [position.coords.longitude, position.coords.latitude]\r\n}\r\n\r\nexport async function getPostcode (postcode) {\r\n  const response = await axios.get(config.postcodeApi + postcode)\r\n  return {\r\n    location: [response.data.longitude, response.data.latitude],\r\n    organisation: response.data.library_service_name\r\n  }\r\n};\r\n","import axios from 'axios'\r\nimport moment from 'moment'\r\n\r\nconst config = require('../helpers/config.json')\r\n\r\nexport class Mobile {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.id = json.id\r\n    this.organisationId = json.organisation_id\r\n    this.name = json.name\r\n    this.timetable = json.timetable\r\n    this.numberRoutes = json.number_routes\r\n    this.numberStops = json.number_stops\r\n    return this\r\n  }\r\n}\r\n\r\nexport class MobileNearestStop {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.mobileId = json.mobile_id\r\n    this.stopId = json.stop_id\r\n    this.stopName = json.stop_name\r\n    this.stopDistance = json.stop_distance\r\n    return this\r\n  }\r\n}\r\n\r\nexport class MobileLocation {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.mobileId = json.mobile_id\r\n    this.currentStopId = json.current_stop_id\r\n    this.currentStopDeparture = moment(json.current_stop_departure)\r\n    this.currentStopName = json.current_stop_name\r\n    this.previousStopId = json.previous_stop_id\r\n    this.previousStopDeparture = moment(json.previous_stop_departure)\r\n    this.previousStopName = json.previous_stop_name\r\n    this.nextStopId = json.next_stop_id\r\n    this.nextStopArrival = moment(json.next_stop_arrival)\r\n    this.nextStopName = json.next_stop_name\r\n    this.updated = moment(json.updated)\r\n    this.updateType = json.update_type\r\n    this.geoX = json.geox\r\n    this.geoY = json.geoy\r\n    this.routeSection = json.route_section\r\n    return this\r\n  }\r\n\r\n  getStatus () {\r\n    const now = moment()\r\n    const statuses = {\r\n      offRoad: 'Not out today',\r\n      preRoute: 'Arriving at ',\r\n      atStop: 'At ',\r\n      betweenStops: 'Arriving at ',\r\n      postRoute: 'Finished for the day'\r\n    }\r\n    // The mobile is not due out today\r\n    if (!this.currentStopId && !this.previousStopId && this.nextStopId && !this.nextStopArrival.isSame(now, 'day')) {\r\n      return {\r\n        type: 'offRoad',\r\n        textFormat: statuses.offRoad,\r\n        message: statuses.offRoad\r\n      }\r\n    }\r\n    // The mobile is due out today\r\n    if (!this.currentStopId && !this.previousStopId && this.nextStopId && this.nextStopArrival.isSame(now, 'day')) {\r\n      const arrival = this.nextStopArrival.fromNow()\r\n      return {\r\n        type: 'preRoute',\r\n        message: statuses.preRoute,\r\n        textFormat: statuses.preRoute + this.nextStopName + ' ' + arrival,\r\n        args: [\r\n          { stopName: this.nextStopName, stopId: this.nextStopId },\r\n          arrival\r\n        ]\r\n      }\r\n    }\r\n    // The mobile is at a stop, and will be for a certain amount of time\r\n    if (this.currentStopId) {\r\n      const stopRemaining = this.currentStopDeparture.fromNow(true)\r\n      return {\r\n        type: 'atStop',\r\n        message: statuses.atStop,\r\n        textFormat: statuses.atStop + this.currentStopName + ' for ' + stopRemaining,\r\n        args: [\r\n          { stopName: this.currentStopName, stopId: this.currentStopId },\r\n          stopRemaining\r\n        ]\r\n      }\r\n    }\r\n    // The mobile is between stops\r\n    if (!this.currentStopId && this.previousStopId && this.nextStopId && this.previousStopDeparture.isSame(now, 'day') && this.nextStopArrival.isSame(now, 'day')) {\r\n      const arrival = this.nextStopArrival.fromNow()\r\n      return {\r\n        type: 'betweenStops',\r\n        message: statuses.betweenStops,\r\n        textFormat: statuses.betweenStops + this.nextStopName + ' ' + arrival,\r\n        args: [\r\n          { stopName: this.nextStopName, stopId: this.nextStopId },\r\n          arrival\r\n        ]\r\n      }\r\n    }\r\n    // The mobile has finished for the day\r\n    if (this.previousStopId && this.nextStopId && this.previousStopDeparture.isSame(now, 'day') && !this.nextStopArrival.isSame(now, 'day')) {\r\n      return {\r\n        type: 'postRoute',\r\n        message: statuses.postRoute,\r\n        text_format: statuses.postRoute\r\n      }\r\n    }\r\n    return null\r\n  }\r\n}\r\n\r\nexport async function getAllMobiles () {\r\n  const response = await axios.get(config.api + '/mobiles')\r\n  if (response && response.data && response.data.length > 0) {\r\n    const mobiles = response.data.map(m => (new Mobile()).fromJson(m))\r\n    return mobiles\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getMobileLocations () {\r\n  const response = await axios.get(config.api + '/mobiles/locations')\r\n  if (response && response.data && response.data.length > 0) {\r\n    const locations = response.data.map(ml => (new MobileLocation()).fromJson(ml))\r\n    return locations\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getMobilesNearest (location, distance) {\r\n  const response = await axios.get(config.api + '/mobiles/nearest?longitude=' + location[0] + '&latitude=' + location[1] + '&distance=' + distance)\r\n  if (response && response.data && response.data.length > 0) {\r\n    return response.data.map(m => (new MobileNearestStop()).fromJson(m))\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n","import React, { useState, useEffect, useRef } from 'react'\r\n\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport InputBase from '@material-ui/core/InputBase'\r\nimport ListSubheader from '@material-ui/core/ListSubheader'\r\nimport Menu from '@material-ui/core/Menu'\r\nimport MenuItem from '@material-ui/core/MenuItem'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\nimport { fade } from '@material-ui/core/styles/colorManipulator'\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport ClearIcon from '@material-ui/icons/ClearTwoTone'\r\nimport SearchIcon from '@material-ui/icons/SearchTwoTone'\r\nimport SettingsIcon from '@material-ui/icons/SettingsTwoTone'\r\n\r\nimport { useApplicationStateValue } from './context/applicationState'\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport * as geoHelper from './helpers/geo'\r\nimport * as mobilesModel from './models/mobiles'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  grow: {\r\n    flexGrow: 1\r\n  },\r\n  iconButton: {\r\n    padding: 10\r\n  },\r\n  inputInput: {\r\n    paddingTop: theme.spacing(),\r\n    paddingRight: theme.spacing(),\r\n    paddingBottom: theme.spacing(),\r\n    paddingLeft: theme.spacing(2),\r\n    fontWeight: 500\r\n  },\r\n  search: {\r\n    position: 'relative',\r\n    border: '1px solid #E0E0E0',\r\n    borderRadius: theme.shape.borderRadius,\r\n    backgroundColor: fade(theme.palette.common.white, 0.8),\r\n    '&:hover': {\r\n      backgroundColor: fade(theme.palette.common.white, 0.9)\r\n    },\r\n    marginLeft: 0,\r\n    marginRight: theme.spacing(),\r\n    display: 'flex',\r\n    maxWidth: 240\r\n  }\r\n}))\r\n\r\nfunction usePrevious (value) {\r\n  const ref = useRef()\r\n  useEffect(() => {\r\n    ref.current = value\r\n  })\r\n  return ref.current\r\n}\r\n\r\nfunction PostcodeSearch () {\r\n  const [{ }, dispatchApplication] = useApplicationStateValue() //eslint-disable-line\r\n  const [{ searchType, searchPostcode, searchDistance }, dispatchSearch] = useSearchStateValue() //eslint-disable-line\r\n  const [{ }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const [tempPostcode, setTempPostcode] = useState(searchPostcode)\r\n  const [anchor, setAnchor] = useState(null)\r\n\r\n  const prevProps = usePrevious({ searchPostcode })\r\n  useEffect(() => {\r\n    if (prevProps && searchPostcode !== prevProps.searchPostcode) setTempPostcode(searchPostcode)\r\n  }, [searchPostcode]) // eslint-disable-line\r\n\r\n  const openSettingsMenu = (e) => setAnchor(e.currentTarget)\r\n\r\n  const closeSettingsMenu = () => setAnchor(null)\r\n\r\n  const setSearchDistance = (searchDistance) => {\r\n    closeSettingsMenu()\r\n    dispatchSearch({ type: 'SetSearchDistance', searchDistance: searchDistance })\r\n    if (searchType === 'postcode') postcodeSearch()\r\n  }\r\n\r\n  const postcodeSearch = async () => {\r\n    if (tempPostcode === '') {\r\n      dispatchView({ type: 'ShowNotification', notificationMessage: 'You must enter a postcode' })\r\n      return\r\n    }\r\n\r\n    dispatchView({ type: 'LoadingPostcode' })\r\n    const postcodeData = await geoHelper.getPostcode(tempPostcode)\r\n    if (postcodeData.location && postcodeData.location.length === 2) {\r\n      dispatchSearch({ type: 'SetPostcodeSearch', searchPostcode: tempPostcode, searchPosition: postcodeData.location })\r\n      dispatchView({ type: 'SetPostcodeSearch', mapPosition: postcodeData.location })\r\n      const mobilesNearest = await mobilesModel.getMobilesNearest(postcodeData.location, searchDistance)\r\n      const mobilesNearestLookup = {}\r\n      mobilesNearest.forEach(mobile => { mobilesNearestLookup[mobile.mobileId] = mobile })\r\n      dispatchApplication({ type: 'UpdateMobilesNearest', mobilesNearest: mobilesNearest, mobilesNearestLookup: mobilesNearestLookup })\r\n    } else {\r\n      dispatchView({ type: 'ShowNotification', notificationMessage: 'Could not find postcode' })\r\n    }\r\n  }\r\n\r\n  const classes = useStyles()\r\n\r\n  return (\r\n    <div className={classes.search}>\r\n      <InputBase\r\n        placeholder='Postcode'\r\n        classes={{\r\n          input: classes.inputInput\r\n        }}\r\n        value={tempPostcode}\r\n        onChange={(e) => setTempPostcode(e.target.value)}\r\n      />\r\n      <div className={classes.grow} />\r\n      {searchType === 'postcode'\r\n        ? (\r\n          <Tooltip title='Clear search'>\r\n            <IconButton\r\n              className={classes.iconButton}\r\n              onClick={() => dispatchSearch({ type: 'ClearAll' })}\r\n            >\r\n              <ClearIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n        )\r\n        : null}\r\n      <Tooltip title='Search by postcode'>\r\n        <IconButton\r\n          color='primary'\r\n          className={classes.iconButton}\r\n          onClick={() => postcodeSearch()}\r\n        >\r\n          <SearchIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n      <Tooltip title='Change search settings'>\r\n        <IconButton\r\n          className={classes.iconButton}\r\n          color='secondary'\r\n          onClick={(e) => { openSettingsMenu(e) }}\r\n        >\r\n          <SettingsIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n      <Menu\r\n        id='mnu-settings'\r\n        anchorEl={anchor}\r\n        keepMounted\r\n        open={Boolean(anchor)}\r\n        onClose={() => closeSettingsMenu()}\r\n      >\r\n        <ListSubheader disableSticky>Search distance</ListSubheader>\r\n        <MenuItem onClick={() => setSearchDistance(1609)}>1 mile</MenuItem>\r\n        <MenuItem onClick={() => setSearchDistance(4827)}>3 miles</MenuItem>\r\n        <MenuItem onClick={() => setSearchDistance(8045)}>5 miles</MenuItem>\r\n        <MenuItem onClick={() => setSearchDistance(16090)}>10 miles</MenuItem>\r\n        <MenuItem onClick={() => setSearchDistance(32180)}>20 miles</MenuItem>\r\n        <MenuItem onClick={() => setSearchDistance(80450)}>50 miles</MenuItem>\r\n      </Menu>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default PostcodeSearch\r\n","import React, { useState } from 'react'\r\n\r\nimport { Link, useLocation } from 'react-router-dom'\r\n\r\nimport AppBar from '@material-ui/core/AppBar'\r\nimport Button from '@material-ui/core/Button'\r\nimport Container from '@material-ui/core/Container'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Hidden from '@material-ui/core/Hidden'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Tab from '@material-ui/core/Tab'\r\nimport Tabs from '@material-ui/core/Tabs'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nimport WidgetsIcon from '@material-ui/icons/WidgetsTwoTone'\r\nimport DirectionBusIcon from '@material-ui/icons/DirectionsBusTwoTone'\r\nimport HomeIcon from '@material-ui/icons/HomeTwoTone'\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone'\r\nimport MapIcon from '@material-ui/icons/MapTwoTone'\r\nimport LocalLibraryIcon from '@material-ui/icons/LocalLibraryTwoTone'\r\nimport BookIcon from '@material-ui/icons/BookTwoTone'\r\nimport HeadsetIcon from '@material-ui/icons/HeadsetTwoTone'\r\nimport MovieIcon from '@material-ui/icons/MovieTwoTone'\r\nimport SearchIcon from '@material-ui/icons/SearchTwoTone'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport PostcodeSearch from './PostcodeSearch'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  appBar: {\r\n    zIndex: theme.zIndex.drawer + 1\r\n  },\r\n  appBarTransparent: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    backgroundColor: 'rgba(250, 250, 250, 0.8)'\r\n  },\r\n  grow: {\r\n    flexGrow: 1\r\n  },\r\n  iconTitle: {\r\n    marginLeft: theme.spacing(1)\r\n  },\r\n  progress: {\r\n    margin: theme.spacing(1)\r\n  },\r\n  tabBar: {\r\n    borderTop: '1px solid #e8e8e8',\r\n    borderBottom: '1px solid #e8e8e8'\r\n  },\r\n  title: {\r\n    margin: theme.spacing(2),\r\n    display: 'inline-block',\r\n    verticalAlign: 'middle'\r\n  }\r\n}))\r\n\r\nfunction AppHeader () {\r\n  const [{ loadingOrganisations, loadingMobiles, loadingRoutes, loadingMobileLocations, loadingNearestMobiles, loadingPostcode }] = useViewStateValue()\r\n\r\n  const [appsOpen, setAppsOpen] = useState(false)\r\n  const [tabValue, setTabValue] = useState(1)\r\n\r\n  const loading = loadingOrganisations || loadingMobiles || loadingRoutes || loadingMobileLocations || loadingNearestMobiles || loadingPostcode\r\n\r\n  const location = useLocation()\r\n  const classes = useStyles()\r\n\r\n  const sites = [\r\n    {\r\n      title: 'Libraries at home',\r\n      url: 'https://www.librariesathome.co.uk',\r\n      icon: <HomeIcon />,\r\n      links: [\r\n        {\r\n          title: <span className={classes.iconTitle}>Search</span>,\r\n          short: <span className={classes.iconTitle}>Search</span>,\r\n          icon: <SearchIcon />,\r\n          to: 'https://www.librariesathome.co.uk'\r\n        },\r\n        {\r\n          title: <span className={classes.iconTitle}>Watch</span>,\r\n          short: <span className={classes.iconTitle}>Watch</span>,\r\n          icon: <MovieIcon />,\r\n          to: 'https://www.librariesathome.co.uk/watch'\r\n        },\r\n        {\r\n          title: <span className={classes.iconTitle}>Read</span>,\r\n          short: <span className={classes.iconTitle}>Read</span>,\r\n          icon: <BookIcon />,\r\n          to: 'https://www.librariesathome.co.uk/read'\r\n        },\r\n        {\r\n          title: <span className={classes.iconTitle}>Listen</span>,\r\n          short: <span className={classes.iconTitle}>Listen</span>,\r\n          icon: <HeadsetIcon />,\r\n          to: 'https://www.librariesathome.co.uk/listen'\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      title: 'Mobile libraries',\r\n      url: 'https://www.mobilelibraries.org',\r\n      icon: <DirectionBusIcon />,\r\n      links: [\r\n        {\r\n          title: <span className={classes.iconTitle}>Mobile vans</span>,\r\n          short: <span className={classes.iconTitle}>Vans</span>,\r\n          icon: <DirectionBusIcon />,\r\n          to: 'https://www.mobilelibraries.org/'\r\n        },\r\n        {\r\n          title: <span className={classes.iconTitle}>Stop locations</span>,\r\n          short: <span className={classes.iconTitle}>Stops</span>,\r\n          icon: <LocationOnIcon />,\r\n          to: 'https://www.mobilelibraries.org/stops'\r\n        },\r\n        {\r\n          title: <span className={classes.iconTitle}>Map</span>,\r\n          short: <span className={classes.iconTitle}>Map</span>,\r\n          icon: <MapIcon />,\r\n          to: 'https://www.mobilelibraries.org/map'\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      title: 'Library map',\r\n      url: 'https://www.librarymap.co.uk',\r\n      icon: <LocalLibraryIcon />,\r\n      links: [\r\n\r\n      ]\r\n    }\r\n  ]\r\n\r\n  const site = 1\r\n\r\n  const siteUrl = sites[site].url\r\n\r\n  return (\r\n    <>\r\n      <Container maxWidth='lg'>\r\n        <IconButton color='primary' onClick={() => { setAppsOpen(!appsOpen) }}>\r\n          <WidgetsIcon />\r\n        </IconButton>\r\n        <Typography color='secondary' variant='h6' component='h1' className={classes.title}>{sites[site].title}</Typography>\r\n      </Container>\r\n      {appsOpen ? (\r\n        <AppBar position='static' color='default' elevation={0}>\r\n          <Container maxWidth='lg'>\r\n            <Tabs\r\n              className={classes.tabBar}\r\n              value={tabValue}\r\n              onChange={(e, v) => { setTabValue(v) }}\r\n              variant='scrollable'\r\n              scrollButtons='on'\r\n              indicatorColor='primary'\r\n              textColor='primary'\r\n            >\r\n              {sites.map((site, idx) => {\r\n                return (\r\n                  <Tab key={'tb_site_' + idx} label={site.title} icon={site.icon} />\r\n                )\r\n              })}\r\n            </Tabs>\r\n          </Container>\r\n        </AppBar>\r\n      ) : null}\r\n      <AppBar\r\n        position={(location.pathname === '/map' ? 'fixed' : 'static')}\r\n        color='inherit'\r\n        elevation={0}\r\n        className={(location.pathname === '/map' ? classes.appBarTransparent : classes.appBar)}\r\n      >\r\n        <Container maxWidth='lg'>\r\n          <Toolbar>\r\n            <Hidden smUp>\r\n              {sites[tabValue].links.map((link, idx) => {\r\n                return (\r\n                  <Tooltip title={link.title} key={'icnb_menu_md_' + idx}>\r\n                    <IconButton\r\n                      component={Link}\r\n                      to={link.to.replace(siteUrl, '')}\r\n                      disableRipple={location.pathname === link.to.replace(siteUrl, '')}\r\n                      disableFocusRipple={location.pathname === link.to.replace(siteUrl, '')}\r\n                      color={(location.pathname === link.to.replace(siteUrl, '') ? 'secondary' : 'primary')}\r\n                    >\r\n                      {link.icon}\r\n                    </IconButton>\r\n                  </Tooltip>\r\n                )\r\n              })}\r\n            </Hidden>\r\n            <Hidden xsDown mdUp>\r\n              {sites[tabValue].links.map((link, idx) => {\r\n                return (\r\n                  <Tooltip title={link.title} key={'icnb_menu_lg_' + idx}>\r\n                    <Button\r\n                      component={Link}\r\n                      to={link.to.replace(siteUrl, '')}\r\n                      disableRipple={location.pathname === link.to.replace(siteUrl, '')}\r\n                      disableFocusRipple={location.pathname === link.to.replace(siteUrl, '')}\r\n                      color={(location.pathname === link.to.replace(siteUrl, '') ? 'secondary' : 'primary')}\r\n                      size='large'\r\n                    >\r\n                      {link.icon}{link.short}\r\n                    </Button>\r\n                  </Tooltip>\r\n                )\r\n              })}\r\n            </Hidden>\r\n            <Hidden smDown>\r\n              {sites[tabValue].links.map((link, idx) => {\r\n                return (\r\n                  <Tooltip title={link.title} key={'icnb_menu_lg_' + idx}>\r\n                    <Button\r\n                      component={Link}\r\n                      to={link.to.replace(siteUrl, '')}\r\n                      disableRipple={location.pathname === link.to.replace(siteUrl, '')}\r\n                      disableFocusRipple={location.pathname === link.to.replace(siteUrl, '')}\r\n                      color={(location.pathname === link.to.replace(siteUrl, '') ? 'secondary' : 'primary')}\r\n                      size='large'\r\n                    >\r\n                      {link.icon}{link.title}\r\n                    </Button>\r\n                  </Tooltip>\r\n                )\r\n              })}\r\n            </Hidden>\r\n            {loading ? <CircularProgress className={classes.progress} color='primary' size={30} /> : null}\r\n            <span className={classes.grow} />\r\n            {location.pathname === '/map' ? <PostcodeSearch /> : null}\r\n          </Toolbar>\r\n        </Container>\r\n      </AppBar>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default AppHeader\r\n","import React, { useState } from 'react'\r\n\r\nimport Button from '@material-ui/core/Button'\r\nimport Chip from '@material-ui/core/Chip'\r\nimport ListSubheader from '@material-ui/core/ListSubheader'\r\nimport Menu from '@material-ui/core/Menu'\r\nimport MenuItem from '@material-ui/core/MenuItem'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nimport BusinessIcon from '@material-ui/icons/BusinessTwoTone'\r\nimport DirectionBusIcon from '@material-ui/icons/DirectionsBusTwoTone'\r\nimport DirectionsIcon from '@material-ui/icons/DirectionsTwoTone'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useApplicationStateValue } from './context/applicationState'\r\nimport { useSearchStateValue } from './context/searchState'\r\n\r\nimport PostcodeSearch from './PostcodeSearch'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  button: {\r\n    marginRight: theme.spacing(1)\r\n  },\r\n  chip: {\r\n    marginRight: theme.spacing(1)\r\n  },\r\n  leftIcon: {\r\n    marginRight: theme.spacing(1)\r\n  },\r\n  search: {\r\n    alignContent: 'center',\r\n    textAlign: 'center',\r\n    display: 'table',\r\n    marginLeft: 'auto',\r\n    marginRight: 'auto',\r\n    marginBottom: '10px'\r\n  },\r\n  subtitle: {\r\n    textAlign: 'center',\r\n    marginBottom: '5px'\r\n  },\r\n  title: {\r\n    textAlign: 'center'\r\n  }\r\n}))\r\n\r\nfunction Filters () {\r\n  const [{ organisations, organisationLookup, mobiles, mobileLookup, routeLookup, routes }] = useApplicationStateValue()\r\n  const [{ searchDistance, organisationFilter, mobileFilter, routeFilter }, dispatchSearch] = useSearchStateValue()\r\n\r\n  const [organisationMenuAnchor, setOrganisationMenuAnchor] = useState(null)\r\n  const [mobileMenuAnchor, setMobileMenuAnchor] = useState(null)\r\n  const [routeMenuAnchor, setRouteMenuAnchor] = useState(null)\r\n\r\n  const openOrganisationMenu = (element) => setOrganisationMenuAnchor(element)\r\n\r\n  const closeOrganisationMenu = () => setOrganisationMenuAnchor(null)\r\n\r\n  const chooseOrganisation = (organisationId) => {\r\n    dispatchSearch({ type: 'FilterByOrganisation', organisationId: organisationId })\r\n    closeOrganisationMenu()\r\n  }\r\n\r\n  const clearOrganisationFilter = () => {\r\n    dispatchSearch({ type: 'ClearAll' })\r\n  }\r\n\r\n  const openMobileMenu = (element) => setMobileMenuAnchor(element)\r\n\r\n  const closeMobileMenu = () => setMobileMenuAnchor(null)\r\n\r\n  const chooseMobile = (organisationId, mobileId) => {\r\n    dispatchSearch({ type: 'FilterByMobile', organisationId: organisationId, mobileId: mobileId })\r\n    closeMobileMenu()\r\n  }\r\n\r\n  const clearMobileFilter = () => {\r\n    dispatchSearch({ type: 'ClearMobileFilter' })\r\n  }\r\n\r\n  const openRouteMenu = (element) => setRouteMenuAnchor(element)\r\n\r\n  const closeRouteMenu = () => setRouteMenuAnchor(null)\r\n\r\n  const chooseRoute = (routeId) => {\r\n    dispatchSearch({ type: 'FilterByRoute', routeId: routeId })\r\n    closeRouteMenu()\r\n  }\r\n\r\n  const clearRouteFilter = () => {\r\n    dispatchSearch({ type: 'ClearRouteFilter' })\r\n  }\r\n\r\n  const countries = new Set(organisations.map(org => org.country))\r\n\r\n  const classes = useStyles()\r\n\r\n  return (\r\n    <>\r\n      <Typography component='h2' variant='h6' className={classes.title}>Your mobile service</Typography>\r\n      <Typography component='p' variant='body1' className={classes.subtitle}>Find services within {searchDistance / 1609} mile(s)</Typography>\r\n      <div className={classes.search}>\r\n        <PostcodeSearch />\r\n      </div>\r\n      <Typography component='p' variant='body1' className={classes.subtitle}>Or, choose your library service</Typography>\r\n      <div className={classes.search}>\r\n        {organisationFilter.length === 0 ? (\r\n          <Tooltip title='Choose library service'>\r\n            <Button color='primary' className={classes.button} onClick={(e) => openOrganisationMenu(e.currentTarget)}>\r\n              <BusinessIcon className={classes.leftIcon} />Select service\r\n            </Button>\r\n          </Tooltip>\r\n        ) : <Chip className={classes.chip} color='primary' variant='outlined' onDelete={clearOrganisationFilter} label={organisationLookup[organisationFilter[0]].name} />}\r\n        {organisationFilter.length > 0\r\n          ? (mobileFilter.length === 0\r\n            ? (\r\n              <Tooltip title='Choose mobile library'>\r\n                <Button color='primary' className={classes.button} onClick={(e) => openMobileMenu(e.currentTarget)}>\r\n                  <DirectionBusIcon className={classes.leftIcon} />Select mobile\r\n                </Button>\r\n              </Tooltip>\r\n            ) : <Chip className={classes.chip} color='primary' variant='outlined' onDelete={clearMobileFilter} label={mobileLookup[mobileFilter[0]].name} />\r\n          ) : null}\r\n        {mobileFilter.length > 0\r\n          ? (routeFilter.length === 0\r\n            ? (\r\n              <Tooltip title='Choose route'>\r\n                <Button color='primary' className={classes.button} onClick={(e) => openRouteMenu(e.currentTarget)}>\r\n                  <DirectionsIcon className={classes.leftIcon} />Select route\r\n                </Button>\r\n              </Tooltip>\r\n            ) : <Chip className={classes.chip} color='primary' variant='outlined' onDelete={clearRouteFilter} label={routeLookup[routeFilter[0]].name} />\r\n          )\r\n          : null}\r\n      </div>\r\n      <Menu\r\n        id='menu-library-service'\r\n        anchorEl={organisationMenuAnchor}\r\n        keepMounted\r\n        open={Boolean(organisationMenuAnchor)}\r\n        onClose={() => closeOrganisationMenu()}\r\n      >\r\n        {\r\n          Array.from(countries)\r\n            .sort((a, b) => a.localeCompare(b))\r\n            .map((country, idx) => {\r\n              const menuItems = [<ListSubheader key={'lst_' + idx} disableSticky>{country}</ListSubheader>]\r\n              const orgList = organisations\r\n                .sort((a, b) => a.name.localeCompare(b.name))\r\n                .filter(org => org.country === country)\r\n                .map(org => {\r\n                  return <MenuItem key={'mnu_itm_org_' + org.id} onClick={() => chooseOrganisation(org.id)}>{org.name}</MenuItem>\r\n                })\r\n              return menuItems.concat(orgList)\r\n            })\r\n        }\r\n      </Menu>\r\n      <Menu\r\n        id='menu-mobile-library'\r\n        anchorEl={mobileMenuAnchor}\r\n        keepMounted\r\n        open={Boolean(mobileMenuAnchor)}\r\n        onClose={() => closeMobileMenu()}\r\n      >\r\n        {mobiles\r\n          .filter(mob => {\r\n            let display = true\r\n            if (organisationFilter.length > 0 &&\r\n              organisationFilter.indexOf(mob.organisationId) === -1) {\r\n              display = false\r\n            }\r\n            return display\r\n          })\r\n          .sort((a, b) => a.name.localeCompare(b.name))\r\n          .map(mob => {\r\n            return <MenuItem key={'mnu_itm_mob_' + mob.id} onClick={() => chooseMobile(mob.organisationId, mob.id)}>{mob.name}</MenuItem>\r\n          })}\r\n      </Menu>\r\n      <Menu\r\n        id='menu-route'\r\n        anchorEl={routeMenuAnchor}\r\n        keepMounted\r\n        open={Boolean(routeMenuAnchor)}\r\n        onClose={() => closeRouteMenu()}\r\n      >\r\n        {routes\r\n          .filter(route => {\r\n            let display = true\r\n            if (mobileFilter.length > 0 &&\r\n              mobileFilter.indexOf(route.mobileId) === -1) {\r\n              display = false\r\n            }\r\n            return display\r\n          })\r\n          .sort((a, b) => a.name.localeCompare(b.name))\r\n          .map(route => {\r\n            return <MenuItem key={'mnu_itm_route_' + route.id} onClick={() => chooseRoute(route.id)}>{route.name}</MenuItem>\r\n          })}\r\n      </Menu>\r\n    </>\r\n  )\r\n}\r\n\r\nexport default Filters\r\n","import React from 'react'\r\n\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport Button from '@material-ui/core/Button'\r\nimport Card from '@material-ui/core/Card'\r\nimport CardActions from '@material-ui/core/CardActions'\r\nimport CardContent from '@material-ui/core/CardContent'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Divider from '@material-ui/core/Divider'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone'\r\nimport WebIcon from '@material-ui/icons/WebTwoTone'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  bullet: {\r\n    display: 'inline-block',\r\n    margin: '0 2px',\r\n    transform: 'scale(1.2)'\r\n  },\r\n  card: {\r\n    minWidth: 275\r\n  },\r\n  leftIcon: {\r\n    marginRight: theme.spacing(1)\r\n  },\r\n  title: {\r\n    fontSize: 12,\r\n    fontWeight: 500,\r\n    align: 'right'\r\n  },\r\n  verticalDivider: {\r\n    width: 1,\r\n    height: 28,\r\n    margin: 8\r\n  },\r\n  progress: {\r\n    margin: theme.spacing(2)\r\n  }\r\n}))\r\n\r\nfunction MobileCard (props) {\r\n  const { mobile, organisation, location } = props\r\n  const [{ }, dispatchSearch] = useSearchStateValue() // eslint-disable-line\r\n  const [{ }, dispatchView] = useViewStateValue() // eslint-disable-line\r\n\r\n  const viewStopsByMobile = (organisationId, mobileId) => {\r\n    dispatchSearch({ type: 'FilterByMobile', organisationId: organisationId, mobileId: mobileId })\r\n  }\r\n\r\n  const viewStop = (stopId) => {\r\n    dispatchSearch({ type: 'SetCurrentStop', stopId: stopId })\r\n    dispatchView({ type: 'SetStopDialog', stopDialogOpen: true })\r\n  }\r\n\r\n  const stopButton = (stop) => {\r\n    return <Button color='secondary' onClick={() => viewStop(stop.stopId)}>{stop.stopName}</Button>\r\n  }\r\n\r\n  const offRoadMessage = (status) => {\r\n    return (\r\n      <Typography>{status.message}</Typography>\r\n    )\r\n  }\r\n\r\n  const preRouteMessage = (status) => {\r\n    const button = stopButton(status.args[0])\r\n    return (\r\n      <>\r\n        <Typography>\r\n          {status.message}\r\n          {button}\r\n          {status.args[1]}\r\n        </Typography>\r\n      </>\r\n    )\r\n  }\r\n\r\n  const atStopMessage = (status) => {\r\n    const button = stopButton(status.args[0])\r\n    return (\r\n      <>\r\n        <Typography>\r\n          {status.message}\r\n          {button}\r\n          {' for ' + status.args[1]}\r\n        </Typography>\r\n      </>\r\n    )\r\n  }\r\n\r\n  const betweenStopsMessage = (status) => {\r\n    const button = stopButton(status.args[0])\r\n    return (\r\n      <>\r\n        <Typography>\r\n          {status.message}\r\n          {button}\r\n          {status.args[1]}\r\n        </Typography>\r\n      </>\r\n    )\r\n  }\r\n\r\n  const postRouteMessage = (status) => <Typography>{status.message}</Typography>\r\n\r\n  const classes = useStyles()\r\n\r\n  let statusMessage = null\r\n  if (location) {\r\n    const status = location.getStatus()\r\n    if (status && status.type === 'offRoad') statusMessage = offRoadMessage(status)\r\n    if (status && status.type === 'preRoute') statusMessage = preRouteMessage(status)\r\n    if (status && status.type === 'atStop') statusMessage = atStopMessage(status)\r\n    if (status && status.type === 'betweenStops') statusMessage = betweenStopsMessage(status)\r\n    if (status && status.type === 'postRoute') statusMessage = postRouteMessage(status)\r\n  }\r\n\r\n  if (!statusMessage) statusMessage = <CircularProgress className={classes.progress} color='primary' size={30} />\r\n  const bull = <span className={classes.bullet}>•</span>\r\n\r\n  return (\r\n    <Card className={classes.card} elevation={0}>\r\n      <CardContent>\r\n        <Typography className={classes.title} gutterBottom>\r\n          {mobile.numberRoutes + ' route' + (mobile.numberRoutes > 1 ? 's' : '')}\r\n          {bull}\r\n          {mobile.numberStops + ' stop' + (mobile.numberStops > 1 ? 's' : '')}\r\n        </Typography>\r\n        <Typography variant='h6' component='h2'>{(organisation ? organisation.name + ' ' : '') + mobile.name}</Typography>\r\n        {statusMessage}\r\n      </CardContent>\r\n      <CardActions>\r\n        <Tooltip title='Mobile library stops'>\r\n          <Button component={Link} to='/stops' size='small' color='primary' className={classes.button} onClick={() => viewStopsByMobile(organisation.id, mobile.id)}>\r\n            <LocationOnIcon className={classes.leftIcon} />View stops\r\n          </Button>\r\n        </Tooltip>\r\n        <Divider className={classes.verticalDivider} />\r\n        {mobile.timetable ? (\r\n          <Tooltip title='Website timetable'>\r\n            <IconButton className={classes.button} onClick={() => this.goToWebsite()}>\r\n              <WebIcon />\r\n            </IconButton>\r\n          </Tooltip>\r\n        ) : null}\r\n      </CardActions>\r\n    </Card>\r\n  )\r\n}\r\n\r\nexport default MobileCard\r\n","import React, { useState } from 'react'\r\n\r\nimport Badge from '@material-ui/core/Badge'\r\nimport Grid from '@material-ui/core/Grid'\r\nimport ListSubheader from '@material-ui/core/ListSubheader'\r\nimport Tab from '@material-ui/core/Tab'\r\nimport Tabs from '@material-ui/core/Tabs'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useApplicationStateValue } from './context/applicationState'\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport Filters from './Filters'\r\nimport MobileCard from './MobileCard'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  padding: {\r\n    padding: theme.spacing(0, 2)\r\n  },\r\n  root: {\r\n    flexGrow: 1\r\n  }\r\n}))\r\n\r\nfunction Mobiles () {\r\n  const [{ organisationLookup, mobiles, mobileLookup, mobileLocationLookup, mobilesNearestLookup, routes, routeLookup }, dispatchApplication] = useApplicationStateValue() //eslint-disable-line\r\n  const [{ organisationFilter, mobileFilter, routeFilter, searchType, searchDistance, searchPostcode }, dispatchSearch] = useSearchStateValue() //eslint-disable-line\r\n  const [{ loadingMobileLocations }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const [openTab, setOpenTab] = useState(0)\r\n\r\n  const changeTab = (value) => {\r\n    setOpenTab(value)\r\n  }\r\n\r\n  // Get all mobiles that are currently filtered\r\n  const filteredMobiles = mobiles.filter(mob => {\r\n    let display = true\r\n    if (searchType === 'gps' || searchType === 'postcode') {\r\n      display = mobilesNearestLookup[mob.id]\r\n    }\r\n    if (organisationFilter.length > 0 &&\r\n      organisationFilter.indexOf(mob.organisationId) === -1) {\r\n      display = false\r\n    }\r\n    if (mobileFilter.length > 0 &&\r\n      mobileFilter.indexOf(mob.id) === -1) {\r\n      display = false\r\n    }\r\n    return display\r\n  })\r\n\r\n  // Then get those that are currently active\r\n  const activeMobiles = filteredMobiles.filter(mob => {\r\n    if (mobileLocationLookup[mob.id]) {\r\n      const status = mobileLocationLookup[mob.id].getStatus()\r\n      return (status && status.type !== 'offRoad' && status.type !== 'postRoute')\r\n    }\r\n    return null\r\n  })\r\n\r\n  const organisationName = (organisationFilter.length > 0 ? organisationLookup[organisationFilter[0]].name : '')\r\n\r\n  const mobileName = (mobileFilter.length > 0 ? mobileLookup[mobileFilter[0]].name : '')\r\n\r\n  const routeName = (routeFilter.length > 0 ? routeLookup[routeFilter[0]].name : '')\r\n\r\n  let title = 'Mobile library vans'\r\n  if (organisationName !== '') title = 'Mobile library vans serving ' + organisationName\r\n  if (mobileName !== '') title = organisationName + ' ' + mobileName\r\n  if (routeName !== '') title = organisationName + ' ' + routeName\r\n  if (searchPostcode !== '') title = 'Mobile library vans with stops within ' + Math.round(searchDistance / 1609) + ' mile(s) of ' + searchPostcode\r\n  if (searchType === 'gps') title = 'Mobile library vans with stops within ' + Math.round(searchDistance / 1609) + ' mile(s) of your location'\r\n\r\n  const classes = useStyles()\r\n\r\n  const displayMobiles = (openTab === 0 ? activeMobiles : filteredMobiles)\r\n  const mobilesView = displayMobiles\r\n    .filter(mob => {\r\n      let display = true\r\n      if (organisationFilter.length > 0 &&\r\n        organisationFilter.indexOf(mob.organisationId) === -1) {\r\n        display = false\r\n      }\r\n      if (mobileFilter.length > 0 &&\r\n        mobileFilter.indexOf(mob.id) === -1) {\r\n        display = false\r\n      }\r\n      return display\r\n    })\r\n    .filter(mob => {\r\n      if (searchType === 'gps' || searchType === 'postcode') {\r\n        return mobilesNearestLookup[mob.id]\r\n      }\r\n      return true\r\n    })\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Filters />\r\n      <ListSubheader component='span' disableSticky>{title}</ListSubheader>\r\n      <Tabs\r\n        variant='standard'\r\n        scrollButtons='off'\r\n        value={openTab}\r\n        indicatorColor='secondary'\r\n        onChange={(e, value) => changeTab(value)}\r\n      >\r\n        <Tab\r\n          className={classes.tab}\r\n          label={\r\n            <Badge\r\n              className={classes.padding}\r\n              color='secondary'\r\n              badgeContent={activeMobiles.length}\r\n            >\r\n              On the road\r\n            </Badge>\r\n          }\r\n        />\r\n        <Tab\r\n          label={\r\n            <Badge\r\n              showZero\r\n              className={classes.padding}\r\n              color='secondary'\r\n              badgeContent={filteredMobiles.length}\r\n            >\r\n              All vans\r\n            </Badge>\r\n          }\r\n        />\r\n      </Tabs>\r\n      <br />\r\n      {\r\n        mobilesView.length > 0\r\n          ? (\r\n            <Grid container spacing={3}>\r\n              {\r\n                mobilesView.map((mobile, idx) => {\r\n                  return (\r\n                    <Grid\r\n                      key={'grd_' + mobile.name.replace(' ', '') + '_' + idx}\r\n                      item xs={12} sm={6} md={4} lg={3} xl={3}\r\n                    >\r\n                      <MobileCard\r\n                        mobile={mobile}\r\n                        location={mobileLocationLookup[mobile.id]}\r\n                        organisation={organisationLookup[mobile.organisationId]}\r\n                      />\r\n                    </Grid>\r\n                  )\r\n                })\r\n              }\r\n            </Grid>) : (\r\n            !loadingMobileLocations\r\n              ? <Typography component='p' variant='body1'>No mobile libraries currently on the road.</Typography>\r\n              : null\r\n          )\r\n      }\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Mobiles\r\n","import React from 'react'\r\n\r\nimport Avatar from '@material-ui/core/Avatar'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useSearchStateValue } from './context/searchState'\r\n\r\nimport Face from '@material-ui/icons/FaceTwoTone'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  avatar: {\r\n    margin: 0\r\n  },\r\n  avatarOn: {\r\n    margin: 0,\r\n    cursor: 'pointer',\r\n    backgroundColor: theme.palette.primary.main\r\n  }\r\n}))\r\n\r\nfunction MeAvatar () {\r\n  const [{ searchType }] = useSearchStateValue()\r\n\r\n  const classes = useStyles()\r\n\r\n  return (\r\n    <Tooltip title='Me'>\r\n      <Avatar\r\n        className={searchType === 'gps' ? classes.avatarOn : classes.avatar}\r\n      >\r\n        <Face />\r\n      </Avatar>\r\n    </Tooltip>\r\n  )\r\n}\r\n\r\nexport default MeAvatar\r\n","import React from 'react'\r\n\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\r\nimport Switch from '@material-ui/core/Switch'\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\r\n\r\nimport { useTheme, makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  dialog: {\r\n    border: '1px solid #E0E0E0'\r\n  }\r\n}))\r\n\r\nfunction MapSettings () {\r\n  const [{ mapSettings, mapSettingsDialogOpen }, dispatchView] = useViewStateValue()\r\n\r\n  const closeDialog = () => {\r\n    dispatchView({ type: 'SetMapSettingsDialog', mapSettingsDialogOpen: false })\r\n  }\r\n\r\n  const handleAuthorityBoundaryChange = () => {\r\n    dispatchView({ type: 'ToggleMapSetting', mapSetting: 'authorityBoundary' })\r\n  }\r\n\r\n  const classes = useStyles()\r\n  const theme = useTheme()\r\n  const fullScreen = useMediaQuery(theme.breakpoints.down('sm'))\r\n\r\n  return (\r\n    <Dialog\r\n      fullScreen={fullScreen}\r\n      disableBackdropClick\r\n      open={mapSettingsDialogOpen}\r\n      onClose={closeDialog}\r\n      BackdropProps={{\r\n        invisible: true\r\n      }}\r\n      PaperProps={{ elevation: 0, className: classes.dialog }}\r\n    >\r\n      <DialogTitle>Map settings</DialogTitle>\r\n      <DialogContent>\r\n        <FormControlLabel\r\n          control={\r\n            <Switch\r\n              checked={mapSettings.authorityBoundary}\r\n              onChange={handleAuthorityBoundaryChange}\r\n              name='sw_authority_boundary'\r\n              color='primary'\r\n            />\r\n          }\r\n          label='Library service boundaries'\r\n        />\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={closeDialog} color='secondary'>Close</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nexport default MapSettings\r\n","export function hextoRGBA (hex, alpha) {\r\n  var c\r\n  if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\r\n    c = hex.substring(1).split('')\r\n    if (c.length === 3) {\r\n      c = [c[0], c[0], c[1], c[1], c[2], c[2]]\r\n    }\r\n    c = '0x' + c.join('')\r\n    return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ', ' + alpha + ')'\r\n  }\r\n  throw new Error('Bad Hex')\r\n}\r\n","import React from 'react'\r\n\r\nimport Fab from '@material-ui/core/Fab'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\nimport DirectionBusIcon from '@material-ui/icons/DirectionsBusTwoTone'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport * as utilsHelper from './helpers/utils'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  fab: {\r\n    margin: theme.spacing(1),\r\n    boxShadow: 'none'\r\n  }\r\n}))\r\n\r\nfunction MobileAvatar (props) {\r\n  const [{ mapZoom }] = useViewStateValue()\r\n  const { location, organisation } = props\r\n\r\n  const status = location.getStatus()\r\n  const size = (mapZoom[0] < 8 ? 'small' : (mapZoom[0] < 12 ? 'medium' : 'large'))\r\n  const border = (mapZoom[0] < 8 ? 2 : (mapZoom[0] < 12 ? 3 : 4))\r\n  const classes = useStyles()\r\n\r\n  return (\r\n    <Tooltip\r\n      title={(status ? status.textFormat : '')}\r\n    >\r\n      <Fab\r\n        size={size}\r\n        className={classes.fab}\r\n        color='primary'\r\n        style={{\r\n          backgroundColor: utilsHelper.hextoRGBA(organisation.colour, 0.8),\r\n          color: 'white',\r\n          border: (border + 'px solid #FFFFFF')\r\n        }}\r\n      >\r\n        <DirectionBusIcon />\r\n      </Fab>\r\n    </Tooltip>\r\n  )\r\n}\r\n\r\nexport default MobileAvatar\r\n","import React, { useEffect, useState } from 'react'\r\n\r\nimport Fab from '@material-ui/core/Fab'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\nimport ReactMapboxGl, { ZoomControl, Source, Layer, Marker } from 'react-mapbox-gl'\r\n\r\nimport LayersIcon from '@material-ui/icons/LayersTwoTone'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport moment from 'moment'\r\n\r\nimport { useApplicationStateValue } from './context/applicationState'\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport MeAvatar from './MeAvatar'\r\nimport MapSettings from './MapSettings'\r\nimport MobileAvatar from './MobileAvatar'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  settings: {\r\n    position: 'absolute',\r\n    bottom: theme.spacing(4),\r\n    right: theme.spacing(4)\r\n  }\r\n}))\r\n\r\nconst config = require('./helpers/config.json')\r\n\r\nconst Map = ReactMapboxGl({\r\n  minZoom: 5,\r\n  maxZoom: 18,\r\n  customAttribution: 'Contains public sector information licensed under the Open Government Licence'\r\n})\r\n\r\nconst stopTiles = [config.stopTiles]\r\nconst tripTiles = [config.tripTiles]\r\nconst libraryAuthorityTiles = [config.libraryAuthorityTiles]\r\n\r\nfunction MobileMap () {\r\n  const [{ organisations, organisationLookup, mobileLookup, mobileLocations }, dispatchApplication] = useApplicationStateValue() //eslint-disable-line\r\n  const [{ searchType, searchPosition }, dispatchSearch] = useSearchStateValue() //eslint-disable-line\r\n  const [{ mapZoom, mapPosition, mapSettings, mapSettingsDialogOpen }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const [currentTime, setCurrentTime] = useState(null)\r\n  const [map, setMap] = useState(null)\r\n\r\n  useEffect(() => {\r\n    setInterval(setTime, 500)\r\n  }, [])\r\n\r\n  const clickStop = (map) => {\r\n    if (map && map.features && map.features.length > 0 && map.features[0].properties) {\r\n      dispatchSearch({ type: 'SetCurrentStop', stopId: map.features[0].properties.id })\r\n      dispatchView({ type: 'SetStopDialog', stopDialogOpen: true })\r\n    }\r\n  }\r\n\r\n  const clickTrip = (map) => {\r\n    if (map && map.features && map.features.length > 0 && map.features[0].properties) {\r\n      dispatchSearch({ type: 'SetCurrentTrip', tripId: map.features[0].properties.id })\r\n      dispatchView({ type: 'SetTripDialog', tripDialogOpen: true })\r\n    }\r\n  }\r\n\r\n  const setTime = () => setCurrentTime(moment())\r\n\r\n  // Build the colour match\r\n  const organisationColourMatch = ['match', ['get', 'utla19cd']]\r\n  organisations.forEach(org => {\r\n    organisationColourMatch.push(org.code)\r\n    organisationColourMatch.push(org.colour)\r\n  })\r\n  organisationColourMatch.push('#a7a39b')\r\n\r\n  const classes = useStyles()\r\n\r\n  const locations = mobileLocations.filter(l => l.geoX !== null && l.geoY !== null)\r\n\r\n  return (\r\n    <>\r\n      <Map\r\n        style='style.json' // eslint-disable-line\r\n        center={mapPosition}\r\n        zoom={mapZoom}\r\n        maxZoom={17}\r\n        pitch={[0]}\r\n        bearing={[0]}\r\n        fitBounds={null}\r\n        containerStyle={{ top: 0, bottom: 0, right: 0, left: 0, height: '100vh', width: '100vw', position: 'absolute' }}\r\n        onStyleLoad={map => setMap(map)}\r\n      >\r\n        {// The mobile library locations\r\n          locations && locations.length > 0\r\n            ? locations.map(l => {\r\n              let locationPoint = [l.geoX, l.geoY]\r\n              if (currentTime && l.routeSection && l.routeSection.coordinates && l.updated) {\r\n                const millisecondsPassed = moment(currentTime).diff(l.updated)\r\n                const index = Math.round(millisecondsPassed / 500)\r\n                const coords = l.routeSection.coordinates\r\n                if (coords.length > index && index > 0) locationPoint = coords[index]\r\n                if (coords.length <= index && index > 0) locationPoint = coords[coords.length - 1]\r\n              }\r\n              const mobile = mobileLookup[l.mobileId]\r\n              const organisation = (mobile ? organisationLookup[mobile.organisationId] : null)\r\n              return (\r\n                <Marker\r\n                  key={'mkr_' + l.id}\r\n                  coordinates={locationPoint}\r\n                  anchor='bottom'\r\n                >\r\n                  <MobileAvatar\r\n                    organisation={organisation}\r\n                    location={l}\r\n                    zoom={map ? map.getZoom() : 0}\r\n                  />\r\n                </Marker>)\r\n            }) : null\r\n        }\r\n        <Source\r\n          id='src_stops'\r\n          tileJsonSource={{\r\n            type: 'vector',\r\n            tiles: stopTiles\r\n          }}\r\n        />\r\n        <Source\r\n          id='src_trips'\r\n          tileJsonSource={{\r\n            type: 'vector',\r\n            tiles: tripTiles\r\n          }}\r\n        />\r\n        <Source\r\n          id='src_library_authorities'\r\n          tileJsonSource={{\r\n            type: 'vector',\r\n            tiles: libraryAuthorityTiles\r\n          }}\r\n        />\r\n        <Layer\r\n          id='lyr_trips_lines'\r\n          type='line'\r\n          sourceId='src_trips'\r\n          sourceLayer='trip'\r\n          minZoom={13}\r\n          layout={{\r\n            'line-join': 'round',\r\n            'line-cap': 'square'\r\n          }}\r\n          paint={{\r\n            'line-color': '#a7a39b',\r\n            'line-offset': [\r\n              'interpolate',\r\n              [\r\n                'linear'\r\n              ],\r\n              [\r\n                'zoom'\r\n              ],\r\n              13, 0.5,\r\n              14, 1,\r\n              15, 2,\r\n              16, 3,\r\n              18, 10,\r\n              22, 20\r\n            ],\r\n            'line-opacity': 1,\r\n            'line-width': [\r\n              'interpolate',\r\n              [\r\n                'linear'\r\n              ],\r\n              [\r\n                'zoom'\r\n              ],\r\n              13, 0.5,\r\n              14, 1,\r\n              15, 2,\r\n              16, 3,\r\n              18, 10,\r\n              22, 20\r\n            ],\r\n            'line-dasharray': [\r\n              2,\r\n              0.5\r\n            ]\r\n          }}\r\n          onClick={clickTrip}\r\n        />\r\n        <Layer\r\n          id='lyr_stops_circles'\r\n          type='circle'\r\n          sourceId='src_stops'\r\n          sourceLayer='stop'\r\n          minZoom={5}\r\n          layout={{}}\r\n          paint={{\r\n            'circle-radius': [\r\n              'interpolate',\r\n              ['linear'],\r\n              ['zoom'],\r\n              5, 2,\r\n              17, 12\r\n            ],\r\n            'circle-color': ['get', 'organisation_colour'],\r\n            'circle-stroke-width': [\r\n              'interpolate',\r\n              ['linear'],\r\n              ['zoom'],\r\n              5, 1,\r\n              17, 4\r\n            ],\r\n            'circle-stroke-color': '#FFFFFF',\r\n            'circle-opacity': 0.7\r\n          }}\r\n          onClick={clickStop}\r\n        />\r\n        <Layer\r\n          id='lyr_stops_labels'\r\n          type='symbol'\r\n          sourceId='src_stops'\r\n          sourceLayer='stop'\r\n          minZoom={13}\r\n          layout={{\r\n            'text-ignore-placement': false,\r\n            'text-field': ['to-string', ['get', 'name']],\r\n            'text-font': [\r\n              'Source Sans Pro Bold'\r\n            ],\r\n            'text-line-height': 1,\r\n            'text-size': [\r\n              'interpolate',\r\n              [\r\n                'linear'\r\n              ],\r\n              [\r\n                'zoom'\r\n              ],\r\n              13, 12,\r\n              17, 22\r\n            ],\r\n            'text-offset': [0, 2]\r\n          }}\r\n          paint={{\r\n            'text-halo-color': 'hsl(0, 0%, 100%)',\r\n            'text-halo-width': 1,\r\n            'text-halo-blur': 1,\r\n            'text-color': '#6a6f73'\r\n          }}\r\n          onClick={clickStop}\r\n        />\r\n        <Layer\r\n          id='lyr_stops_next_visiting'\r\n          type='symbol'\r\n          sourceId='src_stops'\r\n          sourceLayer='stop'\r\n          minZoom={13}\r\n          layout={{\r\n            'text-ignore-placement': false,\r\n            'text-field': ['to-string', ['get', 'next_visiting']],\r\n            'text-font': [\r\n              'Source Sans Pro Bold'\r\n            ],\r\n            'text-line-height': 1,\r\n            'text-size': [\r\n              'interpolate',\r\n              [\r\n                'linear'\r\n              ],\r\n              [\r\n                'zoom'\r\n              ],\r\n              13, 10,\r\n              17, 16\r\n            ],\r\n            'text-offset': [0, -2.8]\r\n          }}\r\n          paint={{\r\n            'text-halo-color': 'hsl(0, 0%, 100%)',\r\n            'text-halo-width': 1,\r\n            'text-halo-blur': 1,\r\n            'text-color': '#6a6f73'\r\n          }}\r\n          onClick={clickStop}\r\n        />\r\n        {mapSettings.authorityBoundary\r\n          ? (\r\n            <>\r\n              <Layer\r\n                id='lyr_library_authorities_lines'\r\n                type='line'\r\n                sourceId='src_library_authorities'\r\n                sourceLayer='library_authority_boundaries'\r\n                minZoom={6}\r\n                layout={{\r\n                  'line-join': 'round',\r\n                  'line-cap': 'square'\r\n                }}\r\n                paint={{\r\n                  'line-color': '#a7a39b',\r\n                  'line-opacity': 1,\r\n                  'line-width': [\r\n                    'interpolate',\r\n                    [\r\n                      'linear'\r\n                    ],\r\n                    [\r\n                      'zoom'\r\n                    ],\r\n                    6, 1,\r\n                    22, 4\r\n                  ]\r\n                }}\r\n              />\r\n              <Layer\r\n                id='lyr_library_authorities_fill'\r\n                type='fill'\r\n                sourceId='src_library_authorities'\r\n                sourceLayer='library_authority_boundaries'\r\n                minZoom={6}\r\n                paint={{\r\n                  'fill-color': organisationColourMatch,\r\n                  'fill-opacity': 0.1\r\n                }}\r\n              />\r\n            </>\r\n          ) : null}\r\n        {searchPosition && searchPosition.length > 1\r\n          ? (\r\n            <Marker\r\n              key='mk_me'\r\n              coordinates={[searchPosition[0], searchPosition[1]]}\r\n            >\r\n              <MeAvatar searchType={searchType} />\r\n            </Marker>\r\n          )\r\n          : null}\r\n        <ZoomControl position='bottom-left' />\r\n      </Map>\r\n      <Tooltip\r\n        title='Map settings'\r\n      >\r\n        <Fab\r\n          size='small'\r\n          className={classes.settings}\r\n          color='primary'\r\n          style={{\r\n            color: 'white',\r\n            border: '1px solid #FFFFFF'\r\n          }}\r\n          onClick={() => dispatchView({ type: 'SetMapSettingsDialog', mapSettingsDialogOpen: true })}\r\n        >\r\n          <LayersIcon />\r\n        </Fab>\r\n      </Tooltip>\r\n      <MapSettings\r\n        mapSettings={mapSettings}\r\n        mapSettingsDialogOpen={mapSettingsDialogOpen}\r\n      />\r\n    </>\r\n  )\r\n}\r\n\r\nexport default MobileMap\r\n","import React from 'react'\r\n\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Snackbar from '@material-ui/core/Snackbar'\r\n\r\nimport CloseIcon from '@material-ui/icons/CloseTwoTone'\r\n\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nfunction Notification () {\r\n  const [{ notificationOpen, notificationMessage }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const handleClose = () => {\r\n    dispatchView({ type: 'SetNotification', notificationOpen: false })\r\n  }\r\n\r\n  return (\r\n    <Snackbar\r\n      anchorOrigin={{\r\n        vertical: 'bottom',\r\n        horizontal: 'left'\r\n      }}\r\n      open={notificationOpen}\r\n      autoHideDuration={3000}\r\n      onClose={handleClose}\r\n      ContentProps={{\r\n        'aria-describedby': 'message-id'\r\n      }}\r\n      message={<span id='message-id'>{notificationMessage}</span>}\r\n      action={[\r\n        <IconButton\r\n          key='close'\r\n          aria-label='close'\r\n          onClick={handleClose}\r\n        >\r\n          <CloseIcon color='inherit' />\r\n        </IconButton>\r\n      ]}\r\n    />\r\n  )\r\n}\r\n\r\nexport default Notification\r\n","import axios from 'axios'\r\nimport moment from 'moment'\r\n\r\nconst config = require('../helpers/config.json')\r\n\r\nexport class Stop {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.id = json.id\r\n    this.routeIds = json.route_ids\r\n    this.routeNames = json.route_names\r\n    this.mobileIds = json.mobile_ids\r\n    this.mobileNames = json.mobile_names\r\n    this.organisationId = json.organisation_id\r\n    this.organisationName = json.organisation_name\r\n    this.name = json.name\r\n    this.community = json.community\r\n    this.address = json.address\r\n    this.postcode = json.postcode\r\n    this.arrivalTimes = json.arrival_times\r\n    this.departureTimes = json.departure_times\r\n    this.routeStart = moment(json.route_start)\r\n    this.routeEnd = moment(json.route_end)\r\n    this.routeDays = json.route_days\r\n    this.routeFrequencies = json.route_frequencies\r\n    this.routeSchedule = json.route_schedule.map(s => moment(s))\r\n    this.timetable = json.timetable\r\n    this.longitude = json.longitude\r\n    this.latitude = json.latitude\r\n    return this\r\n  }\r\n}\r\n\r\nexport async function getQueryStops (query, organisationFilters, mobileFilters, routeFilters, searchPosition, distance) {\r\n  let url = config.api + '/stops?page=' + (query.page + 1) + '&limit=' + query.pageSize\r\n  if (query.orderBy && query.orderBy.field) url = url + '&sort=' + query.orderBy.field + '&direction=' + query.orderDirection\r\n\r\n  if (mobileFilters.length > 0) url = url + '&mobile_ids=' + mobileFilters.join('|')\r\n  if (organisationFilters.length > 0) url = url + '&organisation_ids=' + organisationFilters.join('|')\r\n  if (routeFilters.length > 0) url = url + '&route_ids=' + routeFilters.join('|')\r\n\r\n  if (searchPosition && searchPosition.length > 1) url = url + '&longitude=' + searchPosition[0] + '&latitude=' + searchPosition[1]\r\n  if (distance && distance !== '') url = url + '&distance=' + distance\r\n\r\n  const response = await axios.get(url)\r\n  if (response && response.data && response.data.length > 0) {\r\n    return {\r\n      stops: response.data.map(s => (new Stop()).fromJson(s)),\r\n      total: parseInt(response.headers['x-total-count']),\r\n      page: parseInt(response.headers['x-page'])\r\n    }\r\n  } else {\r\n    return { stops: [], total: 0, page: 1 }\r\n  }\r\n}\r\n\r\nexport async function getAllStops () {\r\n  const response = await axios.get(config.api + '/stops')\r\n  if (response && response.data && response.data.length > 0) {\r\n    return response.data.map(s => (new Stop()).fromJson(s))\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getStopById (id) {\r\n  const response = await axios.get(config.api + '/stops/' + id)\r\n  if (response && response.data) {\r\n    return (new Stop()).fromJson(response.data)\r\n  } else {\r\n    return {}\r\n  }\r\n}\r\n","import React, { useEffect } from 'react'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport Hidden from '@material-ui/core/Hidden'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport ListSubheader from '@material-ui/core/ListSubheader'\r\nimport Paper from '@material-ui/core/Paper'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\nimport MaterialTable from 'material-table'\r\n\r\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\r\n\r\nimport ArrowUpward from '@material-ui/icons/ArrowUpwardTwoTone'\r\nimport ChevronLeft from '@material-ui/icons/ChevronLeftTwoTone'\r\nimport ChevronRight from '@material-ui/icons/ChevronRightTwoTone'\r\nimport FirstPage from '@material-ui/icons/FirstPageTwoTone'\r\nimport FilterList from '@material-ui/icons/FilterListTwoTone'\r\nimport LastPage from '@material-ui/icons/LastPageTwoTone'\r\nimport MoreVertIcon from '@material-ui/icons/MoreVertTwoTone'\r\nimport EventIcon from '@material-ui/icons/EventTwoTone'\r\nimport PrintIcon from '@material-ui/icons/PrintTwoTone'\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone'\r\n\r\nimport Filters from './Filters'\r\n\r\nimport * as stopsModel from './models/stops'\r\n\r\nimport { useApplicationStateValue } from './context/applicationState'\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nconst config = require('./helpers/config.json')\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  formControl: {\r\n    margin: theme.spacing(1),\r\n    minWidth: 200\r\n  },\r\n  margin: {\r\n    margin: theme.spacing(1)\r\n  },\r\n  root: {\r\n    flexGrow: 1,\r\n    maxWidth: '100%'\r\n  },\r\n  table: {\r\n    backgroundColor: 'rgba(0, 0, 0, 0)',\r\n    border: '1px solid #E0E0E0'\r\n  }\r\n}))\r\n\r\nfunction Stops () {\r\n  const [{ organisations, organisationLookup, mobiles, mobileLookup, routeLookup }, dispatchApplication] = useApplicationStateValue() //eslint-disable-line\r\n  const [{ searchType, searchPostcode, searchDistance, searchPosition, organisationFilter, mobileFilter, routeFilter }, dispatchSearch] = useSearchStateValue() //eslint-disable-line\r\n  const [{ }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const tableRef = React.createRef()\r\n\r\n  const getStopCalendar = (stop) => window.open(config.api + '/stops/' + stop.id + '/ics')\r\n\r\n  const getStopPdf = (stop) => window.open(config.api + '/stops/' + stop.id + '/pdf', '_blank')\r\n\r\n  useEffect(() => {\r\n    tableRef.current.onQueryChange()\r\n  }, [searchPosition, searchDistance, organisationFilter, mobileFilter, routeFilter]) // eslint-disable-line\r\n\r\n  const displayStopInfo = (stop) => {\r\n    dispatchSearch({ type: 'SetCurrentStop', stopId: stop.id })\r\n    dispatchView({ type: 'SetStopDialog', stopDialogOpen: true })\r\n  }\r\n\r\n  const displayMapStop = (longitude, latitude) => {\r\n    dispatchView({ type: 'SetMapPosition', mapPosition: [longitude, latitude], mapZoom: 15 })\r\n  }\r\n\r\n  const classes = useStyles()\r\n  const theme = useTheme()\r\n\r\n  // Calculate title\r\n  const organisationName = (organisationFilter.length > 0 ? organisationLookup[organisationFilter[0]].name : '')\r\n  const mobileName = (mobileFilter.length > 0 ? mobileLookup[mobileFilter[0]].name : '')\r\n  const routeName = (routeFilter.length > 0 ? routeLookup[routeFilter[0]].name : '')\r\n  let title = 'All stops'\r\n  // Filter stops\r\n  if (organisationName !== '') title = 'Stops in ' + organisationName\r\n  if (mobileName !== '') title = 'Stops for ' + organisationName + ' ' + mobileName\r\n  if (routeName !== '') title = 'Stops for ' + organisationName + ' ' + routeName\r\n  // Postcode search stops\r\n  if (searchPostcode !== '') title = 'Stops within ' + Math.round(searchDistance / 1609) + ' mile(s) of ' + searchPostcode\r\n  // GPS search stops\r\n  if (searchType === 'gps') title = 'Stops within ' + Math.round(searchDistance / 1609) + ' mile(s) of your location'\r\n\r\n  const orgText = {}\r\n  Object.keys(organisationLookup).forEach(key => {\r\n    orgText[key] = organisationLookup[key].name\r\n  })\r\n  const mobileText = {}\r\n  Object.keys(mobileLookup).forEach(key => {\r\n    mobileText[key] = mobileLookup[key].name\r\n  })\r\n  const routeText = {}\r\n  Object.keys(routeLookup).forEach(key => {\r\n    routeText[key] = routeLookup[key].name\r\n  })\r\n\r\n  return (\r\n    <div style={{ maxWidth: '100%' }}>\r\n      <Filters />\r\n      <ListSubheader disableSticky>{title}</ListSubheader>\r\n      <MaterialTable\r\n        tableRef={tableRef}\r\n        components={{\r\n          Container: props => <Paper {...props} elevation={0} className={classes.table} />\r\n        }}\r\n        icons={{\r\n          Filter: FilterList,\r\n          FirstPage: FirstPage,\r\n          LastPage: LastPage,\r\n          NextPage: ChevronRight,\r\n          PreviousPage: ChevronLeft,\r\n          SortArrow: ArrowUpward\r\n        }}\r\n        options={{\r\n          padding: useMediaQuery(theme.breakpoints.up('sm')) ? 'default' : 'dense',\r\n          search: false,\r\n          loadingType: 'overlay',\r\n          actionsColumnIndex: 0,\r\n          filtering: false,\r\n          toolbar: false,\r\n          headerStyle: {\r\n            backgroundColor: '#fafafa',\r\n            color: '#737373',\r\n            border: '0px'\r\n          }\r\n        }}\r\n        columns={[\r\n          {\r\n            title: '',\r\n            field: 'name',\r\n            filtering: false,\r\n            render: rowData => {\r\n              return (\r\n                <>\r\n                  <Tooltip title='See more stop details'>\r\n                    <IconButton onClick={() => displayStopInfo(rowData)}>\r\n                      <MoreVertIcon />\r\n                    </IconButton>\r\n                  </Tooltip>\r\n                  <Hidden mdDown>\r\n                    <Tooltip title='Add event to your device calendar'>\r\n                      <IconButton onClick={() => getStopCalendar(rowData)}>\r\n                        <EventIcon />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                  </Hidden>\r\n                  <Hidden mdDown>\r\n                    <Tooltip title='Download a PDF timetable for this stop'>\r\n                      <IconButton onClick={() => getStopPdf(rowData)}>\r\n                        <PrintIcon />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                  </Hidden>\r\n                  <Hidden mdDown>\r\n                    <Tooltip title='See this stop on the map'>\r\n                      <IconButton onClick={() => displayMapStop(rowData.longitude, rowData.latitude)} component={Link} to='/map'>\r\n                        <LocationOnIcon />\r\n                      </IconButton>\r\n                    </Tooltip>\r\n                  </Hidden>\r\n                </>\r\n              )\r\n            },\r\n            cellStyle: {\r\n              borderBottom: '1px solid #f5f5f5',\r\n              backgroundColor: '#ffffff'\r\n            }\r\n          },\r\n          {\r\n            title: 'Name',\r\n            field: 'name',\r\n            filtering: false,\r\n            hidden: false,\r\n            render: rowData => {\r\n              return (\r\n                rowData.name\r\n              )\r\n            },\r\n            cellStyle: {\r\n              borderBottom: '1px solid #f5f5f5',\r\n              backgroundColor: '#ffffff'\r\n            }\r\n          },\r\n          {\r\n            title: 'Community',\r\n            field: 'community',\r\n            filtering: false,\r\n            cellStyle: {\r\n              borderBottom: '1px solid #f5f5f5',\r\n              backgroundColor: '#ffffff'\r\n            }\r\n          },\r\n          {\r\n            title: 'Library service',\r\n            field: 'organisationName',\r\n            filtering: false,\r\n            hidden: useMediaQuery(theme.breakpoints.down('sm')),\r\n            cellStyle: {\r\n              borderBottom: '1px solid #f5f5f5',\r\n              backgroundColor: '#ffffff'\r\n            }\r\n          },\r\n          {\r\n            title: 'Next due',\r\n            field: 'routeSchedule',\r\n            filtering: false,\r\n            hidden: useMediaQuery(theme.breakpoints.down('xs')),\r\n            render: (rowData) => {\r\n              return (\r\n                rowData.routeSchedule.length > 0 ? rowData.routeSchedule[0].format('Do MMMM h:mma') : ''\r\n              )\r\n            },\r\n            cellStyle: {\r\n              borderBottom: '1px solid #f5f5f5',\r\n              backgroundColor: '#ffffff'\r\n            }\r\n          }\r\n        ]}\r\n        data={query =>\r\n          new Promise((resolve, reject) => {\r\n            async function getStops () {\r\n              const stopData = await stopsModel.getQueryStops(query, organisationFilter, mobileFilter, routeFilter, searchPosition, searchDistance)\r\n              resolve({\r\n                data: stopData.stops,\r\n                page: (stopData.page - 1),\r\n                totalCount: stopData.total\r\n              })\r\n            }\r\n            getStops()\r\n          })}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Stops\r\n","import React, { useEffect, useState } from 'react'\r\nimport { Link } from 'react-router-dom'\r\n\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Divider from '@material-ui/core/Divider'\r\nimport ListSubheader from '@material-ui/core/ListSubheader'\r\n\r\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\r\n\r\nimport EventIcon from '@material-ui/icons/EventTwoTone'\r\nimport PrintIcon from '@material-ui/icons/PrintTwoTone'\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone'\r\n\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport * as stopsModel from './models/stops'\r\n\r\nconst config = require('./helpers/config.json')\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  button: {\r\n    margin: theme.spacing(1)\r\n  },\r\n  dialog: {\r\n    border: '1px solid #E0E0E0'\r\n  },\r\n  leftIcon: {\r\n    marginRight: theme.spacing(1)\r\n  },\r\n  list: {\r\n    width: '100%',\r\n    maxWidth: 360,\r\n    backgroundColor: theme.palette.background.paper\r\n  },\r\n  progress: {\r\n    margin: theme.spacing(2)\r\n  }\r\n}))\r\n\r\nfunction StopDetails () {\r\n  const [{ currentStopId }, dispatchSearch] = useSearchStateValue() //eslint-disable-line\r\n  const [{ stopDialogOpen }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const [stop, setStop] = useState({})\r\n\r\n  useEffect(() => {\r\n    async function getStop (stopId) {\r\n      const stopData = await stopsModel.getStopById(stopId)\r\n      setStop(stopData)\r\n    }\r\n    if (currentStopId != null) getStop(currentStopId)\r\n  }, [currentStopId])\r\n\r\n  const getStopCalendar = () => window.open(config.api + '/stops/' + stop.id + '/ics')\r\n\r\n  const getStopPdf = () => window.open(config.api + '/stops/' + stop.id + '/pdf', '_blank')\r\n\r\n  const goToWebsite = () => window.open(stop.timetable, '_blank')\r\n\r\n  const viewMapStop = () => {\r\n    dispatchView({ type: 'SetMapPosition', mapPosition: [stop.longitude, stop.latitude], mapZoom: 14 })\r\n  }\r\n\r\n  const close = () => {\r\n    dispatchView({ type: 'SetStopDialog', stopDialogOpen: false })\r\n  }\r\n\r\n  const theme = useTheme()\r\n  const classes = useStyles()\r\n  const fullScreen = useMediaQuery(theme.breakpoints.down('sm'))\r\n\r\n  return (\r\n    <Dialog\r\n      fullScreen={fullScreen}\r\n      disableBackdropClick\r\n      open={stopDialogOpen}\r\n      onClose={close}\r\n      aria-labelledby='dlg-title'\r\n      BackdropProps={{ invisible: true }}\r\n      PaperProps={{ elevation: 0, className: classes.dialog }}\r\n    >\r\n      {stop && stop.routeDays\r\n        ? (\r\n          <>\r\n            <DialogTitle id='dlg-title'>{stop.name + '. ' + stop.community}</DialogTitle>\r\n            <DialogContent>\r\n              <ListSubheader>{(stop.routeSchedule && stop.routeSchedule.length > 0 ? stop.routeSchedule[0].format('dddd Do MMMM h:mma') : '')}</ListSubheader>\r\n              <br />\r\n              <Divider />\r\n              <br />\r\n              <Button onClick={getStopCalendar} className={classes.button} color='primary' startIcon={<EventIcon />}>Calendar</Button>\r\n              <Button onClick={getStopPdf} className={classes.button} color='primary' startIcon={<PrintIcon />}>Timetable</Button>\r\n              <Button onClick={viewMapStop} className={classes.button} color='primary' startIcon={<LocationOnIcon />} component={Link} to='/map'>Map</Button>\r\n            </DialogContent>\r\n          </>\r\n        ) : <CircularProgress className={classes.progress} color='primary' size={30} />}\r\n      <DialogActions>\r\n        <Button onClick={() => goToWebsite()} color='primary'>Website</Button>\r\n        <Button onClick={() => close()} color='secondary'>Close</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nexport default StopDetails\r\n","import axios from 'axios'\r\n\r\nconst config = require('../helpers/config.json')\r\n\r\nexport class Trip {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.id = json.id\r\n    this.originStopId = json.origin_stop_id\r\n    this.originStopName = json.origin_stop_name\r\n    this.destinationStopId = json.destination_stop_id\r\n    this.destinationStopName = json.destination_stop_name\r\n    this.distance = json.distance\r\n    this.duration = json.duration\r\n    this.routeLine = json.route_line\r\n    return this\r\n  }\r\n}\r\n\r\nexport async function getAllTrips () {\r\n  const response = await axios.get(config.api + '/trips')\r\n  if (response && response.data && response.data.length > 0) {\r\n    return response.data.map(t => (new Trip()).fromJson(t))\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n\r\nexport async function getTripById (id) {\r\n  const response = await axios.get(config.api + '/trips/' + id)\r\n  if (response && response.data) {\r\n    return (new Trip()).fromJson(response.data)\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n","import React, { useEffect, useState } from 'react'\r\n\r\nimport Button from '@material-ui/core/Button'\r\nimport Dialog from '@material-ui/core/Dialog'\r\nimport DialogActions from '@material-ui/core/DialogActions'\r\nimport DialogContent from '@material-ui/core/DialogContent'\r\nimport DialogTitle from '@material-ui/core/DialogTitle'\r\nimport ListSubheader from '@material-ui/core/ListSubheader'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\r\n\r\nimport { useSearchStateValue } from './context/searchState'\r\nimport { useViewStateValue } from './context/viewState'\r\n\r\nimport * as tripsModel from './models/trips'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  dialog: {\r\n    border: '1px solid #E0E0E0'\r\n  }\r\n}))\r\n\r\nfunction TripDetails () {\r\n  const [{ currentTripId }, dispatchSearch] = useSearchStateValue() //eslint-disable-line\r\n  const [{ tripDialogOpen }, dispatchView] = useViewStateValue() //eslint-disable-line\r\n\r\n  const [trip, setTrip] = useState({})\r\n\r\n  useEffect(() => {\r\n    async function getTrip (tripId) {\r\n      const trip = await tripsModel.getTripById(tripId)\r\n      setTrip(trip)\r\n    }\r\n    if (currentTripId != null) getTrip(currentTripId)\r\n  }, [currentTripId])\r\n\r\n  const close = () => {\r\n    dispatchView({ type: 'SetTripDialog', tripDialogOpen: false })\r\n  }\r\n\r\n  const classes = useStyles()\r\n  const theme = useTheme()\r\n\r\n  const fullScreen = useMediaQuery(theme.breakpoints.down('sm'))\r\n  const estimatedDuration = Math.round(trip.duration / 60) + ' mins journey time.'\r\n  const distance = Math.round(trip.distance / 1609, 1) + ' mile(s)'\r\n\r\n  return (\r\n    <Dialog\r\n      fullScreen={fullScreen}\r\n      disableBackdropClick\r\n      open={tripDialogOpen}\r\n      onClose={close}\r\n      BackdropProps={{ invisible: true }}\r\n      PaperProps={{ elevation: 0, className: classes.dialog }}\r\n    >\r\n      <DialogTitle>Trip details</DialogTitle>\r\n      <DialogContent>\r\n        <ListSubheader disableSticky>{'From ' + trip.originStopName + ' to ' + trip.destinationStopName}</ListSubheader>\r\n        <Typography variant='body2' component='p'>{estimatedDuration + ' ' + distance}</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={close} color='secondary'>Close</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nexport default TripDetails\r\n","import axios from 'axios'\r\n\r\nconst config = require('../helpers/config.json')\r\n\r\nexport class Organisation {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.id = json.id\r\n    this.country = json.country\r\n    this.code = json.code\r\n    this.name = json.name\r\n    this.timetable = json.timetable\r\n    this.website = json.website\r\n    this.email = json.email\r\n    this.colour = json.colour\r\n    this.logo = json.logo\r\n    this.numberMobiles = json.number_mobiles\r\n    this.numberRoutes = json.number_routes\r\n    this.numberStops = json.number_stops\r\n    return this\r\n  }\r\n}\r\n\r\nexport async function getAllOrganisations () {\r\n  const response = await axios.get(config.api + '/organisations')\r\n  if (response && response.data && response.data.length > 0) {\r\n    return response.data.map(o => (new Organisation()).fromJson(o))\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n","import axios from 'axios'\r\nimport moment from 'moment'\r\n\r\nconst config = require('../helpers/config.json')\r\n\r\nexport class Route {\r\n  constructor (obj) {\r\n    Object.assign(this, obj)\r\n  }\r\n\r\n  fromJson (json) {\r\n    this.id = json.id\r\n    this.organisationId = json.organisation_id\r\n    this.mobileId = json.mobile_id\r\n    this.name = json.name\r\n    this.frequency = json.frequency\r\n    this.start = moment(json.start)\r\n    this.end = moment(json.end)\r\n    this.timetable = json.timetable\r\n    this.numberStops = json.number_stops\r\n    return this\r\n  }\r\n}\r\n\r\nexport async function getAllRoutes () {\r\n  const response = await axios.get(config.api + '/routes')\r\n  if (response && response.data && response.data.length > 0) {\r\n    return response.data.map(r => (new Route()).fromJson(r))\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n","import React, { useEffect } from 'react'\r\nimport { BrowserRouter, Route } from 'react-router-dom'\r\n\r\nimport Container from '@material-ui/core/Container'\r\n\r\nimport { makeStyles } from '@material-ui/core/styles'\r\n\r\nimport AppHeader from './AppHeader'\r\nimport Mobiles from './Mobiles'\r\nimport MobileMap from './MobileMap'\r\nimport Notification from './Notification'\r\nimport Stops from './Stops'\r\nimport StopDetails from './StopDetails'\r\nimport TripDetails from './TripDetails'\r\n\r\nimport * as mobilesModel from './models/mobiles'\r\nimport * as organisationsModel from './models/organisations'\r\nimport * as routesModel from './models/routes'\r\n\r\nimport { useApplicationStateValue } from './context/applicationState'\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(2)\r\n  },\r\n  root: {\r\n    flexGrow: 1\r\n  }\r\n}))\r\n\r\nfunction MobilesApplication () {\r\n  const [{ }, dispatchApplicationState] = useApplicationStateValue() //eslint-disable-line\r\n\r\n  useEffect(() => {\r\n    async function getOrganisations () {\r\n      const organisations = await organisationsModel.getAllOrganisations()\r\n      const organisationLookup = {}\r\n      organisations.forEach(organisation => { organisationLookup[organisation.id] = organisation })\r\n      dispatchApplicationState({ type: 'AddOrganisations', organisations: organisations, organisationLookup: organisationLookup })\r\n    }\r\n    async function getMobiles () {\r\n      const mobiles = await mobilesModel.getAllMobiles()\r\n      const mobileLookup = {}\r\n      mobiles.forEach(mobile => { mobileLookup[mobile.id] = mobile })\r\n      dispatchApplicationState({ type: 'AddMobiles', mobiles: mobiles, mobileLookup: mobileLookup })\r\n    }\r\n    async function getRoutes () {\r\n      const routes = await routesModel.getAllRoutes()\r\n      const routeLookup = {}\r\n      routes.forEach(route => { routeLookup[route.id] = route })\r\n      dispatchApplicationState({ type: 'AddRoutes', routes: routes, routeLookup: routeLookup })\r\n    }\r\n    async function getMobileLocations (showIndicator = true) {\r\n      const locations = await mobilesModel.getMobileLocations()\r\n      const mobileLocationLookup = {}\r\n      locations.forEach(location => { mobileLocationLookup[location.mobileId] = location })\r\n      dispatchApplicationState({ type: 'AddMobileLocations', mobileLocations: locations, mobileLocationLookup: mobileLocationLookup })\r\n    }\r\n    getOrganisations()\r\n    getMobiles()\r\n    getRoutes()\r\n    getMobileLocations()\r\n\r\n    setInterval(() => {\r\n      getMobileLocations(false)\r\n    }, 15000)\r\n  }, []) //eslint-disable-line\r\n\r\n  const classes = useStyles()\r\n\r\n  return (\r\n    <BrowserRouter>\r\n      <div className={classes.root}>\r\n        <AppHeader />\r\n        <Container maxWidth='lg'>\r\n          <main className={classes.content}>\r\n            <Route path='/' exact render={() => <Mobiles />} />\r\n            <Route path='/stops' render={() => <Stops />} />\r\n            <Route path='/map' render={() => <MobileMap />} />\r\n            <Route path={['/http:', '/https:']} component={props => { window.location.replace(props.location.pathname.substr(1)); return null }} />\r\n          </main>\r\n        </Container>\r\n        <StopDetails />\r\n        <TripDetails />\r\n        <Notification />\r\n      </div>\r\n    </BrowserRouter>\r\n  )\r\n}\r\n\r\nexport default MobilesApplication\r\n","import React from 'react'\r\n\r\nimport CssBaseline from '@material-ui/core/CssBaseline'\r\n\r\nimport blueGrey from '@material-ui/core/colors/blueGrey'\r\nimport red from '@material-ui/core/colors/red'\r\nimport { createMuiTheme, ThemeProvider } from '@material-ui/core/styles'\r\n\r\nimport { ApplicationStateProvider } from './context/applicationState'\r\nimport { SearchStateProvider } from './context/searchState'\r\nimport { ViewStateProvider } from './context/viewState'\r\n\r\nimport MobilesApplication from './MobilesApplication'\r\n\r\nconst initialApplicationState = {\r\n  organisations: [],\r\n  organisationLookup: {},\r\n  mobiles: [],\r\n  mobileLookup: {},\r\n  mobileLocations: [],\r\n  mobileLocationLookup: {},\r\n  mobilesNearest: [],\r\n  mobilesNearestLookup: {},\r\n  routes: [],\r\n  routeLookup: {},\r\n  stops: [],\r\n  trips: []\r\n}\r\n\r\nconst applicationReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'AddOrganisations':\r\n      return {\r\n        ...state,\r\n        organisations: action.organisations,\r\n        organisationLookup: action.organisationLookup\r\n      }\r\n    case 'AddMobileLocations':\r\n      return {\r\n        ...state,\r\n        mobileLocations: action.mobileLocations,\r\n        mobileLocationLookup: action.mobileLocationLookup\r\n      }\r\n    case 'AddRoutes':\r\n      return {\r\n        ...state,\r\n        routes: action.routes,\r\n        routeLookup: action.routeLookup\r\n      }\r\n    case 'AddMobiles':\r\n      return {\r\n        ...state,\r\n        mobiles: action.mobiles,\r\n        mobileLookup: action.mobileLookup\r\n      }\r\n    case 'UpdateMobilesNearest':\r\n      return {\r\n        ...state,\r\n        mobilesNearest: action.mobilesNearest,\r\n        mobilesNearestLookup: action.mobilesNearestLookup\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nconst initialSearchState = {\r\n  searchPostcode: '',\r\n  searchType: '',\r\n  searchDistance: 1609,\r\n  searchPosition: [],\r\n  searchPositionUpdateInterval: null,\r\n  organisationFilter: [],\r\n  mobileFilter: [],\r\n  routeFilter: [],\r\n  currentStopId: null,\r\n  currentTripId: null\r\n}\r\n\r\nconst searchReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'SetCurrentStop':\r\n      return {\r\n        ...state,\r\n        currentStopId: action.stopId\r\n      }\r\n    case 'SetCurrentTrip':\r\n      return {\r\n        ...state,\r\n        currentTripId: action.tripId\r\n      }\r\n    case 'SetSearchDistance':\r\n      return {\r\n        ...state,\r\n        searchDistance: action.searchDistance\r\n      }\r\n    case 'SetPostcodeSearch':\r\n      return {\r\n        ...state,\r\n        searchPostcode: action.searchPostcode,\r\n        searchPosition: action.searchPosition,\r\n        searchType: 'postcode',\r\n        organisationFilter: [],\r\n        mobileFilter: [],\r\n        routeFilter: []\r\n      }\r\n    case 'FilterByOrganisation':\r\n      return {\r\n        ...state,\r\n        organisationFilter: [action.organisationId],\r\n        mobileFilter: [],\r\n        routeFilter: [],\r\n        searchPostcode: '',\r\n        searchPosition: [],\r\n        searchType: ''\r\n      }\r\n    case 'FilterByMobile':\r\n      return {\r\n        ...state,\r\n        organisationFilter: [action.organisationId],\r\n        mobileFilter: [action.mobileId],\r\n        routeFilter: [],\r\n        searchPostcode: '',\r\n        searchPosition: [],\r\n        searchType: ''\r\n      }\r\n    case 'FilterByRoute':\r\n      return {\r\n        ...state,\r\n        routeFilter: [action.routeId],\r\n        searchPostcode: '',\r\n        searchPosition: [],\r\n        searchType: ''\r\n      }\r\n    case 'ClearAll':\r\n      return {\r\n        ...state,\r\n        organisationFilter: [],\r\n        mobileFilter: [],\r\n        routeFilter: [],\r\n        searchPostcode: '',\r\n        searchPosition: [],\r\n        searchType: ''\r\n      }\r\n    case 'ClearMobileFilter':\r\n      return {\r\n        ...state,\r\n        mobileFilter: [],\r\n        routeFilter: [],\r\n        searchPostcode: '',\r\n        searchPosition: [],\r\n        searchType: ''\r\n      }\r\n    case 'ClearRouteFilter':\r\n      return {\r\n        ...state,\r\n        routeFilter: [],\r\n        searchPostcode: '',\r\n        searchPosition: [],\r\n        searchType: ''\r\n      }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nconst initialViewState = {\r\n  stopDialogOpen: false,\r\n  tripDialogOpen: false,\r\n  notificationOpen: false,\r\n  notificationMessage: '',\r\n  mapZoom: [7],\r\n  mapPosition: [-1.155414, 52.691432],\r\n  mapSettings: {\r\n    authorityBoundary: false\r\n  },\r\n  mapSettingsDialogOpen: false,\r\n  loadingOrganisations: false,\r\n  loadingMobiles: false,\r\n  loadingRoutes: false,\r\n  loadingMobileLocations: false,\r\n  loadingNearestMobiles: false,\r\n  loadingPostcode: false\r\n}\r\n\r\nconst viewReducer = (state, action) => {\r\n  switch (action.type) {\r\n    case 'SetNotificationMessage':\r\n      return { ...state, notificationMessage: action.notificationMessage }\r\n    case 'SetNotification':\r\n      return { ...state, notificationOpen: action.notificationOpen }\r\n    case 'ShowNotification':\r\n      return { ...state, notificationOpen: true, notificationMessage: action.notificationMessage }\r\n    case 'SetStopDialog':\r\n      return { ...state, stopDialogOpen: action.stopDialogOpen }\r\n    case 'SetTripDialog':\r\n      return { ...state, tripDialogOpen: action.tripDialogOpen }\r\n    case 'SetMapSettingsDialog':\r\n      return { ...state, mapSettingsDialogOpen: action.mapSettingsDialogOpen }\r\n    case 'ToggleMapSetting': {\r\n      const settings = state.mapSettings\r\n      settings[action.mapSetting] = !settings[action.mapSetting]\r\n      return { ...state, mapSettings: settings }\r\n    }\r\n    case 'LoadingPostcode':\r\n      return { ...state, loadingPostcode: true }\r\n    case 'SetPostcodeSearch':\r\n      return { ...state, loadingPostcode: false, mapPosition: action.mapPosition, mapZoom: [13] }\r\n    case 'SetMapPosition':\r\n      return { ...state, mapPosition: action.mapPosition, mapZoom: [action.mapZoom] }\r\n    default:\r\n      return state\r\n  }\r\n}\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: red[900]\r\n    },\r\n    secondary: {\r\n      main: blueGrey[700]\r\n    }\r\n  },\r\n  overrides: {\r\n    MuiButton: {\r\n      text: {\r\n        textTransform: 'none'\r\n      }\r\n    },\r\n    MuiTab: {\r\n      root: {\r\n        textTransform: 'none'\r\n      }\r\n    },\r\n    MuiTableCell: {\r\n      root: {\r\n        borderBottom: 'none'\r\n      }\r\n    }\r\n  }\r\n})\r\n\r\nfunction App () {\r\n  return (\r\n    <ApplicationStateProvider initialState={initialApplicationState} reducer={applicationReducer}>\r\n      <SearchStateProvider initialState={initialSearchState} reducer={searchReducer}>\r\n        <ViewStateProvider initialState={initialViewState} reducer={viewReducer}>\r\n          <ThemeProvider theme={theme}>\r\n            <CssBaseline />\r\n            <MobilesApplication />\r\n          </ThemeProvider>\r\n        </ViewStateProvider>\r\n      </SearchStateProvider>\r\n    </ApplicationStateProvider>\r\n  )\r\n}\r\n\r\nexport default App\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n)\r\n\r\nexport function register (config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config)\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          )\r\n        })\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction registerValidSW (swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing\r\n        if (installingWorker == null) {\r\n          return\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              )\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration)\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.')\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error)\r\n    })\r\n}\r\n\r\nfunction checkValidServiceWorker (swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  window.fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type')\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload()\r\n          })\r\n        })\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      )\r\n    })\r\n}\r\n\r\nexport function unregister () {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister()\r\n    })\r\n  }\r\n}\r\n","import 'react-app-polyfill/ie11'\r\nimport 'react-app-polyfill/stable'\r\n\r\nimport React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\nimport App from './App'\r\n\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nReactDOM.render(<App />, document.getElementById('root'))\r\n\r\nserviceWorker.unregister()\r\n"],"sourceRoot":""}