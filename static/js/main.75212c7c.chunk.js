(this["webpackJsonpmobilelibraries-website"]=this["webpackJsonpmobilelibraries-website"]||[]).push([[0],{133:function(e){e.exports=JSON.parse('{"api":"https://api.mobilelibraries.org/api","postcodeApi":"https://api-geography.librarydata.uk/rest/postcodes/","stopTiles":"https://api.mobilelibraries.org/api/stops/{z}/{x}/{y}.mvt","tripTiles":"https://api.mobilelibraries.org/api/trips/{z}/{x}/{y}.mvt","libraryAuthorityTiles":"https://api-geography.librarydata.uk/rest/libraryauthorities/{z}/{x}/{y}.mvt"}')},558:function(e,t,a){e.exports=a.p+"static/media/accessibility.d9bc0fa4.md"},559:function(e,t,a){e.exports=a.p+"static/media/data.e9cc0a7b.md"},560:function(e,t,a){e.exports=a.p+"static/media/privacy.a013c74b.md"},570:function(e,t,a){e.exports=a(851)},851:function(e,t,a){"use strict";a.r(t);a(571),a(580);var n=a(0),r=a.n(n),o=a(21),i=a.n(o),c=a(19),l=a(896),s=a(561),u=a.n(s),p=a(367),m=a.n(p),d=a(182),b=a(895),f=Object(n.createContext)(),g=function(e){var t=e.reducer,a=e.initialState,o=e.children;return r.a.createElement(f.Provider,{value:Object(n.useReducer)(t,a)},o)},h=function(){return Object(n.useContext)(f)},y=Object(n.createContext)(),E=function(e){var t=e.reducer,a=e.initialState,o=e.children;return r.a.createElement(y.Provider,{value:Object(n.useReducer)(t,a)},o)},v=function(){return Object(n.useContext)(y)},O=Object(n.createContext)(),S=function(e){var t=e.reducer,a=e.initialState,o=e.children;return r.a.createElement(O.Provider,{value:Object(n.useReducer)(t,a)},o)},j=function(){return Object(n.useContext)(O)},x=a(18),k=a.n(x),w=a(27),C=a(137),_=a(15),N=a(111),I=a(45),F=a(876),P=a(495),M=a(877),L=a(499),T=a(530),D=a(529),B=a(365),R=a(879),A=a(897),z=a(500),W=a(496),Z=a(540),J=a.n(Z),G=a(542),H=a.n(G),q=a(163),Y=a.n(q),U=a(375),X=a.n(U),V=a(541),$=a.n(V),K=a(538),Q=a.n(K),ee=a(302),te=a.n(ee),ae=a(539),ne=a.n(ae),re=a(283),oe=a.n(re),ie=a(301),ce=a.n(ie),le=a(497),se=a(564),ue=a(875),pe=a(273),me=a(498),de=a(159),be=a(534),fe=a.n(be),ge=a(535),he=a.n(ge),ye=a(61),Ee=a.n(ye),ve=a(133);function Oe(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(w.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(ve.postcodeApi+t);case 2:return a=e.sent,e.abrupt("return",{location:[a.data.longitude,a.data.latitude],organisation:a.data.library_service_name});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=a(72),xe=a(73),ke=a(75),we=a.n(ke),Ce=a(133),_e=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.organisationId=e.organisation_id,this.name=e.name,this.timetable=e.timetable,this.numberRoutes=e.number_routes,this.numberStops=e.number_stops,this}}]),e}(),Ne=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.mobileId=e.mobile_id,this.stopId=e.stop_id,this.stopName=e.stop_name,this.stopDistance=e.stop_distance,this}}]),e}(),Ie=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.mobileId=e.mobile_id,this.currentStopId=e.current_stop_id,this.currentStopDeparture=we()(e.current_stop_departure),this.currentStopName=e.current_stop_name,this.previousStopId=e.previous_stop_id,this.previousStopDeparture=we()(e.previous_stop_departure),this.previousStopName=e.previous_stop_name,this.nextStopId=e.next_stop_id,this.nextStopArrival=we()(e.next_stop_arrival),this.nextStopName=e.next_stop_name,this.updated=we()(e.updated),this.updateType=e.update_type,this.geoX=e.geox,this.geoY=e.geoy,this.routeSection=e.route_section,this}},{key:"getStatus",value:function(){var e=we()(),t="Not out today",a="Arriving at ",n="At ",r="Arriving at ",o="Finished for the day";if(!this.currentStopId&&!this.previousStopId&&this.nextStopId&&!this.nextStopArrival.isSame(e,"day"))return{type:"offRoad",textFormat:t,message:t};if(!this.currentStopId&&!this.previousStopId&&this.nextStopId&&this.nextStopArrival.isSame(e,"day")){var i=this.nextStopArrival.fromNow();return{type:"preRoute",message:a,textFormat:a+this.nextStopName+" "+i,args:[{stopName:this.nextStopName,stopId:this.nextStopId},i]}}if(this.currentStopId){var c=this.currentStopDeparture.fromNow(!0);return{type:"atStop",message:n,textFormat:n+this.currentStopName+" for "+c,args:[{stopName:this.currentStopName,stopId:this.currentStopId},c]}}if(!this.currentStopId&&this.previousStopId&&this.nextStopId&&this.previousStopDeparture.isSame(e,"day")&&this.nextStopArrival.isSame(e,"day")){var l=this.nextStopArrival.fromNow();return{type:"betweenStops",message:r,textFormat:r+this.nextStopName+" "+l,args:[{stopName:this.nextStopName,stopId:this.nextStopId},l]}}return this.previousStopId&&this.nextStopId&&this.previousStopDeparture.isSame(e,"day")&&!this.nextStopArrival.isSame(e,"day")?{type:"postRoute",message:o,text_format:o}:null}}]),e}();function Fe(){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(w.a)(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(Ce.api+"/mobiles");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=8;break}return a=t.data.map((function(e){return(new _e).fromJson(e)})),e.abrupt("return",a);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(){return Le.apply(this,arguments)}function Le(){return(Le=Object(w.a)(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(Ce.api+"/mobiles/locations");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=8;break}return a=t.data.map((function(e){return(new Ie).fromJson(e)})),e.abrupt("return",a);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Te(e,t){return De.apply(this,arguments)}function De(){return(De=Object(w.a)(k.a.mark((function e(t,a){var n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(Ce.api+"/mobiles/nearest?longitude="+t[0]+"&latitude="+t[1]+"&distance="+a);case 2:if(!((n=e.sent)&&n.data&&n.data.length>0)){e.next=7;break}return e.abrupt("return",n.data.map((function(e){return(new Ne).fromJson(e)})));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Be=Object(P.a)((function(e){return{grow:{flexGrow:1},iconButton:{padding:e.spacing()},iconProgress:{margin:e.spacing()},inputInput:{paddingTop:e.spacing(),paddingRight:e.spacing(),paddingBottom:e.spacing(),paddingLeft:e.spacing(2),fontWeight:e.typography.fontWeightBold},search:{position:"relative",border:"1px solid #E0E0E0",borderRadius:e.shape.borderRadius,backgroundColor:Object(de.fade)(e.palette.common.white,.8),"&:hover":{backgroundColor:Object(de.fade)(e.palette.common.white,.9)},marginLeft:0,marginRight:e.spacing(),display:"flex",maxWidth:240}}}));var Re=function(e){var t=e.settings,a=h(),o=Object(_.a)(a,2);Object(C.a)(o[0]);var i=o[1],c=v(),l=Object(_.a)(c,2),s=l[0],u=s.searchType,p=s.searchPostcode,m=s.searchDistance,d=l[1],b=j(),f=Object(_.a)(b,2),g=f[0].loadingPostcode,y=f[1],E=Object(n.useState)(p),O=Object(_.a)(E,2),S=O[0],x=O[1],N=Object(n.useState)(null),I=Object(_.a)(N,2),F=I[0],P=I[1],M=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e})),t.current}({searchPostcode:p});Object(n.useEffect)((function(){M&&p!==M.searchPostcode&&x(p)}),[p]);var L=function(){return P(null)},T=function(e){L(),d({type:"SetSearchDistance",searchDistance:e}),"postcode"===u&&D()},D=function(){var e=Object(w.a)(k.a.mark((function e(){var t,a,n,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y({type:"ToggleLoadingPostcode"}),t=function(e){return/^[A-Z]{1,2}\d[A-Z\d]? ?\d[A-Z]{2}$/.test(e)},""===S||!t(S.trim())){e.next=20;break}return e.next=5,Oe(S);case 5:if(!(a=e.sent).location||2!==a.location.length){e.next=17;break}return d({type:"SetPostcodeSearch",searchPostcode:S,searchPosition:a.location}),y({type:"SetPostcodeSearch",mapPosition:a.location}),e.next=11,Te(a.location,m);case 11:n=e.sent,r={},n.forEach((function(e){r[e.mobileId]=e})),i({type:"UpdateMobilesNearest",mobilesNearest:n,mobilesNearestLookup:r}),e.next=18;break;case 17:y({type:"ShowNotification",notificationMessage:"Could not find that postcode"});case 18:e.next=21;break;case 20:y({type:"ShowNotification",notificationMessage:"You must enter a valid postcode"});case 21:y({type:"ToggleLoadingPostcode"});case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=Be();return r.a.createElement("div",{className:R.search},r.a.createElement(se.a,{placeholder:"Postcode",classes:{input:R.inputInput},value:S,onChange:function(e){return x(e.target.value.toUpperCase())},onKeyDown:function(e){13===e.keyCode&&D()}}),r.a.createElement("div",{className:R.grow}),"postcode"===u?r.a.createElement(W.a,{title:"Clear search"},r.a.createElement(B.a,{"aria-label":"Clear search",className:R.iconButton,onClick:function(){return d({type:"ClearAll"})}},r.a.createElement(fe.a,null))):null,r.a.createElement(W.a,{title:"Search by postcode"},g?r.a.createElement(le.a,{size:22,className:R.iconProgress}):r.a.createElement(B.a,{"aria-label":"Search",color:"primary",className:R.iconButton,onClick:function(){return D()}},r.a.createElement(oe.a,null))),t?r.a.createElement(W.a,{title:"Change search settings"},r.a.createElement(B.a,{"aria-label":"Open search settings menu",className:R.iconButton,color:"secondary",onClick:function(e){!function(e){P(e.currentTarget)}(e)}},r.a.createElement(he.a,null))):null,r.a.createElement(pe.a,{id:"mnu-settings",anchorEl:F,keepMounted:!0,open:Boolean(F),onClose:function(){return L()}},r.a.createElement(ue.a,{disableSticky:!0},"Search distance"),r.a.createElement(me.a,{onClick:function(){return T(1609)}},"1 mile"),r.a.createElement(me.a,{onClick:function(){return T(4827)}},"3 miles"),r.a.createElement(me.a,{onClick:function(){return T(8045)}},"5 miles"),r.a.createElement(me.a,{onClick:function(){return T(16090)}},"10 miles"),r.a.createElement(me.a,{onClick:function(){return T(32180)}},"20 miles"),r.a.createElement(me.a,{onClick:function(){return T(80450)}},"50 miles")))},Ae=a(536),ze=a.n(Ae),We=a(537),Ze=a.n(We),Je=Object(P.a)((function(e){return{button:{marginRight:e.spacing(1)},chip:{marginRight:e.spacing(1)},leftIcon:{marginRight:e.spacing(1)},search:{alignContent:"center",textAlign:"center",display:"table",marginLeft:"auto",marginRight:"auto",marginBottom:"10px"},subtitle:{textAlign:"center",marginBottom:"5px"},title:{textAlign:"center"}}}));var Ge=function(){var e=h(),t=Object(_.a)(e,1)[0],a=t.organisations,o=t.organisationLookup,i=t.mobiles,c=t.mobileLookup,l=t.routeLookup,s=t.routes,u=v(),p=Object(_.a)(u,2),m=p[0],d=m.organisationFilter,b=m.mobileFilter,f=m.routeFilter,g=p[1],y=Object(n.useState)(null),E=Object(_.a)(y,2),O=E[0],S=E[1],j=Object(n.useState)(null),x=Object(_.a)(j,2),k=x[0],w=x[1],C=Object(n.useState)(null),N=Object(_.a)(C,2),I=N[0],F=N[1],P=function(){return S(null)},M=function(){return w(null)},D=function(){return F(null)},B=new Set(a.map((function(e){return e.country}))),R=Je();return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:R.search},0===d.length?r.a.createElement(W.a,{title:"Choose library service"},r.a.createElement(L.a,{color:"primary",className:R.button,onClick:function(e){return t=e.currentTarget,S(t);var t}},r.a.createElement(ze.a,{className:R.leftIcon}),"Select service")):r.a.createElement(T.a,{className:R.chip,color:"primary",variant:"outlined",onDelete:function(){g({type:"ClearAll"})},label:o[d[0]].name}),d.length>0?0===b.length?r.a.createElement(W.a,{title:"Choose mobile library"},r.a.createElement(L.a,{color:"primary",className:R.button,onClick:function(e){return t=e.currentTarget,w(t);var t}},r.a.createElement(Y.a,{className:R.leftIcon}),"Select mobile")):r.a.createElement(T.a,{className:R.chip,color:"primary",variant:"outlined",onDelete:function(){g({type:"ClearMobileFilter"})},label:c[b[0]].name}):null,b.length>0?0===f.length?r.a.createElement(W.a,{title:"Choose route"},r.a.createElement(L.a,{color:"primary",className:R.button,onClick:function(e){return t=e.currentTarget,F(t);var t}},r.a.createElement(Ze.a,{className:R.leftIcon}),"Select route")):r.a.createElement(T.a,{className:R.chip,color:"primary",variant:"outlined",onDelete:function(){g({type:"ClearRouteFilter"})},label:l[f[0]].name}):null),r.a.createElement(pe.a,{id:"menu-library-service",anchorEl:O,keepMounted:!0,open:Boolean(O),onClose:function(){return P()}},Array.from(B).sort((function(e,t){return e.localeCompare(t)})).map((function(e,t){var n=[r.a.createElement(ue.a,{key:"lst_"+t,disableSticky:!0},e)],o=a.sort((function(e,t){return e.name.localeCompare(t.name)})).filter((function(t){return t.country===e})).map((function(e){return r.a.createElement(me.a,{key:"mnu_itm_org_"+e.id,onClick:function(){return t=e.id,g({type:"FilterByOrganisation",organisationId:t}),void P();var t}},e.name)}));return n.concat(o)}))),r.a.createElement(pe.a,{id:"menu-mobile-library",anchorEl:k,keepMounted:!0,open:Boolean(k),onClose:function(){return M()}},i.filter((function(e){var t=!0;return d.length>0&&-1===d.indexOf(e.organisationId)&&(t=!1),t})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(me.a,{key:"mnu_itm_mob_"+e.id,onClick:function(){return t=e.organisationId,a=e.id,g({type:"FilterByMobile",organisationId:t,mobileId:a}),void M();var t,a}},e.name)}))),r.a.createElement(pe.a,{id:"menu-route",anchorEl:I,keepMounted:!0,open:Boolean(I),onClose:function(){return D()}},s.filter((function(e){var t=!0;return b.length>0&&-1===b.indexOf(e.mobileId)&&(t=!1),t})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(me.a,{key:"mnu_itm_route_"+e.id,onClick:function(){return t=e.id,g({type:"FilterByRoute",routeId:t}),void D();var t}},e.name)}))))},He=Object(P.a)((function(e){return{appBar:{zIndex:e.zIndex.drawer+1,backgroundColor:"white",position:"relative"},appBarTransparent:{zIndex:e.zIndex.drawer+1,backgroundColor:"rgba(250, 250, 250, 0.8)",position:"relative"},grow:{flexGrow:1},siteTitle:{margin:e.spacing(1),padding:e.spacing(1),display:"inline-block",verticalAlign:"middle",color:e.palette.primary.main,backgroundColor:"rgba(250, 250, 250, 0.8)",border:"1px solid #e5e5e5",borderRadius:26},siteTitleIcon:{verticalAlign:"sub"},title:{margin:e.spacing(2),display:"inline-block",verticalAlign:"middle"},topIcon:{backgroundColor:"rgba(250, 250, 250, 0.8)",border:"1px solid #e5e5e5","&:hover":{backgroundColor:"rgba(250, 250, 250, 0.8)"}},topTitle:{position:"relative",zIndex:e.zIndex.drawer+1}}}));var qe=function(e){var t=e.site,a=v(),o=Object(_.a)(a,2),i=o[0].currentServiceSystemName,c=(o[1],Object(n.useState)(!1)),l=Object(_.a)(c,2),s=l[0],u=l[1],p=Object(n.useState)(t),m=Object(_.a)(p,2),d=m[0],b=m[1],f=Object(I.useLocation)(),g=He(),h=function(e){return i?e+"?service="+i:e},y=[{title:"Library lab",url:"https://www.librarylab.uk",icon:r.a.createElement(ce.a,null),links:[{title:"About library lab",short:"Lab",icon:r.a.createElement(ce.a,null),to:"/"}]},{title:"Libraries at home",url:"https://www.librariesathome.co.uk",icon:r.a.createElement(Q.a,null),links:[{title:"Find service",short:"Find",icon:r.a.createElement(oe.a,null),to:h("/")},{title:"Watch library TV",short:"Watch",icon:r.a.createElement(ne.a,null),to:"/watch"},{title:"Read blogs",short:"Read",icon:r.a.createElement(J.a,null),to:"/read"},{title:"Listen podcasts",short:"Listen",icon:r.a.createElement($.a,null),to:"/listen"}]},{title:"Mobile libraries",url:"https://www.mobilelibraries.org",icon:r.a.createElement(Y.a,null),links:[{title:"Find my stop",short:"Stops",icon:r.a.createElement(X.a,null),to:"/"},{title:"Mobile vans",short:"Vans",icon:r.a.createElement(Y.a,null),to:"/mobiles"},{title:"Map of stops",short:"Map",icon:r.a.createElement(te.a,null),to:"/map"}]},{title:"Library map",url:"https://www.librarymap.co.uk",icon:r.a.createElement(te.a,null),links:[{title:"Find my library",short:"Find",icon:r.a.createElement(X.a,null),to:h("/")},{title:"Map of libraries",short:"Map",icon:r.a.createElement(te.a,null),to:h("/map")}]}],E="/map"===f.pathname?g.appBarTransparent:g.appBar;return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{maxWidth:"lg",className:g.topTitle},r.a.createElement(z.a,null,r.a.createElement(B.a,{"aria-label":"Toggle site menu",className:g.topIcon,color:"primary",onClick:function(){u(!s),b(t)}},s?r.a.createElement(H.a,null):r.a.createElement(ce.a,null)),r.a.createElement("span",{className:g.grow}),"/map"===f.pathname?r.a.createElement(Ge,null):null,r.a.createElement(T.a,{label:y[t].title,color:"secondary"}))),s?r.a.createElement(M.a,{position:"static",color:"default",elevation:0,className:E},r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement(A.a,{centered:!0,value:d,onChange:function(e,t){b(t)},variant:"scrollable",scrollButtons:"on",indicatorColor:"primary",textColor:"secondary"},y.map((function(e,t){return r.a.createElement(R.a,{key:"tb_site_"+t,label:e.title,icon:e.icon})}))))):null,r.a.createElement(M.a,{position:"static",color:"inherit",elevation:0,className:E},r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement(z.a,null,r.a.createElement(D.a,{mdUp:!0},y[d].links.map((function(e,a){return r.a.createElement(W.a,{title:e.title,key:"icnb_menu_lg_"+a},r.a.createElement(L.a,{component:N.b,to:d===t?e.to:y[d].url+e.to,disableRipple:f.pathname===e.to,disableFocusRipple:f.pathname===e.to,color:"secondary",size:"large",startIcon:e.icon},e.short))}))),r.a.createElement(D.a,{smDown:!0},y[d].links.map((function(e,a){return r.a.createElement(W.a,{title:e.title,key:"icnb_menu_lg_"+a},r.a.createElement(L.a,{component:N.b,to:d===t?e.to:y[d].url+e.to,disableRipple:f.pathname===e.to,disableFocusRipple:f.pathname===e.to,color:"secondary",size:"large",startIcon:e.icon},e.title))}))),r.a.createElement("span",{className:g.grow}),"/map"===f.pathname?r.a.createElement(Re,null):null))))},Ye=a(303),Ue=a.n(Ye),Xe=a(880),Ve=a(881),$e=a(882),Ke=a(129),Qe=a(543),et=a.n(Qe),tt=Object(P.a)((function(e){return{root:{paddingTop:e.spacing(5),marginTop:e.spacing(3),marginBottom:e.spacing(5),width:"100%"},grid:{marginTop:e.spacing(2)},loveIcon:{marginLeft:e.spacing(1),marginRight:e.spacing(1)},footerText:{verticalAlign:"middle",display:"inline-flex"},footerRight:{textAlign:"right"},tapTarget:{lineHeight:2.2,fontSize:16}}}));var at=function(){var e=tt();return r.a.createElement("div",{className:e.root},r.a.createElement(Xe.a,null),r.a.createElement(Ve.a,{container:!0,spacing:3,className:e.grid},r.a.createElement(Ve.a,{item:!0,xs:12,sm:6,md:6,lg:6,xl:6},r.a.createElement(Ke.a,{variant:"body1",className:e.footerText},"A library lab project built by Libraries Hacked."),r.a.createElement("br",null),r.a.createElement(Ke.a,{variant:"button"},r.a.createElement($e.a,{component:Ue.a,to:"/accessibility",title:"How we make this site accessible",className:e.tapTarget},"Accessibility"),r.a.createElement("br",null),r.a.createElement($e.a,{component:Ue.a,to:"/privacy",title:"Your privacy on this site",className:e.tapTarget},"Privacy"),r.a.createElement("br",null),r.a.createElement($e.a,{component:Ue.a,to:"/data",title:"Data used on this site and licensing",className:e.tapTarget},"Data"))),r.a.createElement(Ve.a,{className:e.footerRight,item:!0,xs:12,sm:6,md:6,lg:6,xl:6},r.a.createElement(Ke.a,{variant:"button"},r.a.createElement($e.a,{href:"https://github.com/LibrariesHacked/mobilelibraries-website",target:"_blank",title:"Project on GitHub",className:e.tapTarget},"Open Source on GitHub"),r.a.createElement("br",null),r.a.createElement($e.a,{href:"https://www.librarylab.uk/docs/mobile-libraries",target:"_blank",title:"About the library lab projects and documentation for this project",className:e.tapTarget},"About this project"),r.a.createElement("br",null),r.a.createElement(et.a,{color:"error",className:e.loveIcon})))))},nt=a(562),rt=a(544),ot=a(4),it=Object(P.a)((function(e){return{listItem:{marginTop:e.spacing(1)},root:{"& table":{display:"block",wordBreak:"normal",width:"100%",overflowX:"auto",WebkitOverflowScrolling:"touch",borderCollapse:"collapse",marginBottom:"16px",borderSpacing:0,overflow:"hidden","& .prop-name":{fontSize:13,fontFamily:'Consolas, "Liberation Mono", Menlo, monospace'},"& .required":{color:"light"===e.palette.type?"#006500":"#a5ffa5"},"& .prop-type":{fontSize:13,fontFamily:'Consolas, "Liberation Mono", Menlo, monospace',color:"light"===e.palette.type?"#932981":"#ffb6ec"},"& .prop-default":{fontSize:13,fontFamily:'Consolas, "Liberation Mono", Menlo, monospace',borderBottom:"1px dotted ".concat(e.palette.divider)}},"& td":Object(c.a)(Object(c.a)({},e.typography.body2),{},{borderBottom:"1px solid ".concat(e.palette.divider),padding:16,color:e.palette.text.primary}),"& th":{fontSize:14,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium,color:e.palette.text.primary,whiteSpace:"pre",borderBottom:"1px solid ".concat(e.palette.divider),padding:16}}}})),ct={overrides:{h1:{component:Ke.a,props:{gutterBottom:!0,variant:"h4",color:"secondary"}},h2:{component:Ke.a,props:{gutterBottom:!0,variant:"h5",color:"textPrimary"}},h3:{component:Ke.a,props:{gutterBottom:!0,variant:"h6",color:"textPrimary"}},h4:{component:Ke.a,props:{gutterBottom:!0,variant:"h6",paragraph:!0,color:"textPrimary"}},p:{component:Ke.a,props:{paragraph:!0,color:"textPrimary"}},a:{component:$e.a},li:{component:Object(ot.a)(it)((function(e){var t=e.classes,a=Object(nt.a)(e,["classes"]);return r.a.createElement("li",{className:t.listItem},r.a.createElement(Ke.a,Object.assign({component:"span"},a)))}))}}};var lt=r.a.memo((function(e){var t=e.page,a=Object(n.useState)(""),o=Object(_.a)(a,2),i=o[0],c=o[1],l=it();return Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(k.a.mark((function e(){var a,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(t);case 2:return a=e.sent,e.next=5,a.text();case 5:n=e.sent,c(n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[t]),r.a.createElement(rt.a,Object.assign({className:l.root,options:ct},e),i)})),st=a(886),ut=Object(P.a)((function(e){return{search:{alignContent:"center",textAlign:"center",display:"table",marginLeft:"auto",marginRight:"auto",marginBottom:"10px"},subtitle:{textAlign:"center",marginBottom:"5px"},title:{textAlign:"center"}}}));var pt=function(){var e=v(),t=Object(_.a)(e,1)[0].searchDistance,a=ut();return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ke.a,{component:"h2",variant:"h6",className:a.title},"Your mobile service"),r.a.createElement(Ke.a,{component:"p",variant:"body1",className:a.subtitle},"Search by postcode (within ",t/1609," mile/s) or select service"),r.a.createElement("div",{className:a.search},r.a.createElement(Re,{settings:!0})),r.a.createElement(Ge,null))},mt=a(883),dt=a(885),bt=a(884),ft=a(191),gt=a.n(ft),ht=a(545),yt=a.n(ht),Et=Object(P.a)((function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(1.2)"},card:{minWidth:275},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500,align:"right"},verticalDivider:{width:1,height:28,margin:8},progress:{margin:e.spacing(2)}}}));var vt=function(e){var t=this,a=e.mobile,n=e.organisation,o=e.location,i=v(),c=Object(_.a)(i,2);Object(C.a)(c[0]);var l=c[1],s=j(),u=Object(_.a)(s,2);Object(C.a)(u[0]);var p=u[1],m=function(e){return r.a.createElement(L.a,{color:"secondary",onClick:function(){return t=e.stopId,l({type:"SetCurrentStop",stopId:t}),void p({type:"SetStopDialog",stopDialogOpen:!0});var t}},e.stopName)},d=Et(),b=null;if(o){var f=o.getStatus();f&&"offRoad"===f.type&&(b=function(e){return r.a.createElement(Ke.a,null,e.message)}(f)),f&&"preRoute"===f.type&&(b=function(e){var t=m(e.args[0]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ke.a,null,e.message,t,e.args[1]))}(f)),f&&"atStop"===f.type&&(b=function(e){var t=m(e.args[0]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ke.a,null,e.message,t," for "+e.args[1]))}(f)),f&&"betweenStops"===f.type&&(b=function(e){var t=m(e.args[0]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ke.a,null,e.message,t,e.args[1]))}(f)),f&&"postRoute"===f.type&&(b=function(e){return r.a.createElement(Ke.a,null,e.message)}(f))}var g=r.a.createElement("span",{className:d.bullet},"\u2022");return r.a.createElement(mt.a,{className:d.card,elevation:0},r.a.createElement(bt.a,null,r.a.createElement(Ke.a,{className:d.title,gutterBottom:!0},a.numberRoutes+" route"+(a.numberRoutes>1?"s":""),g,a.numberStops+" stop"+(a.numberStops>1?"s":"")),r.a.createElement(Ke.a,{variant:"h6",component:"h2"},(n?n.name+" ":"")+a.name),b),r.a.createElement(dt.a,null,r.a.createElement(W.a,{title:"Mobile library stops"},r.a.createElement(L.a,{component:N.b,to:"/stops",size:"small",color:"primary",className:d.button,onClick:function(){return e=n.id,t=a.id,void l({type:"FilterByMobile",organisationId:e,mobileId:t});var e,t}},r.a.createElement(gt.a,{className:d.leftIcon}),"View stops")),r.a.createElement(Xe.a,{className:d.verticalDivider}),a.timetable?r.a.createElement(W.a,{title:"Website timetable"},r.a.createElement(B.a,{className:d.button,onClick:function(){return t.goToWebsite()}},r.a.createElement(yt.a,null))):null))},Ot=Object(P.a)((function(e){return{padding:{padding:e.spacing(0,2)},root:{flexGrow:1}}}));var St=function(){var e=h(),t=Object(_.a)(e,2),a=t[0],o=a.organisationLookup,i=a.mobiles,c=a.mobileLookup,l=a.mobileLocationLookup,s=a.mobilesNearestLookup,u=(a.routes,a.routeLookup),p=(t[1],v()),m=Object(_.a)(p,2),d=m[0],b=d.organisationFilter,f=d.mobileFilter,g=d.routeFilter,y=d.searchType,E=d.searchDistance,O=d.searchPostcode,S=(m[1],j()),x=Object(_.a)(S,2),k=x[0].loadingMobileLocations,w=(x[1],Object(n.useState)(0)),C=Object(_.a)(w,2),N=C[0],I=C[1],F=i.filter((function(e){var t=!0;return"gps"!==y&&"postcode"!==y||(t=s[e.id]),b.length>0&&-1===b.indexOf(e.organisationId)&&(t=!1),f.length>0&&-1===f.indexOf(e.id)&&(t=!1),t})),P=F.filter((function(e){if(l[e.id]){var t=l[e.id].getStatus();return t&&"offRoad"!==t.type&&"postRoute"!==t.type}return null})),M=b.length>0?o[b[0]].name:"",L=f.length>0?c[f[0]].name:"",T=g.length>0?u[g[0]].name:"",D="Mobile library vans";""!==M&&(D="Mobile library vans serving "+M),""!==L&&(D=M+" "+L),""!==T&&(D=M+" "+T),""!==O&&(D="Mobile library vans with stops within "+Math.round(E/1609)+" mile(s) of "+O),"gps"===y&&(D="Mobile library vans with stops within "+Math.round(E/1609)+" mile(s) of your location");var B=Ot(),z=(0===N?P:F).filter((function(e){var t=!0;return b.length>0&&-1===b.indexOf(e.organisationId)&&(t=!1),f.length>0&&-1===f.indexOf(e.id)&&(t=!1),t})).filter((function(e){return"gps"!==y&&"postcode"!==y||s[e.id]}));return r.a.createElement("div",{className:B.root},r.a.createElement(pt,null),r.a.createElement(ue.a,{component:"span",disableSticky:!0},D),r.a.createElement(A.a,{variant:"standard",scrollButtons:"off",value:N,indicatorColor:"secondary",onChange:function(e,t){return function(e){I(e)}(t)}},r.a.createElement(R.a,{className:B.tab,label:r.a.createElement(st.a,{className:B.padding,color:"secondary",badgeContent:P.length},"On the road")}),r.a.createElement(R.a,{label:r.a.createElement(st.a,{showZero:!0,className:B.padding,color:"secondary",badgeContent:F.length},"All vans")})),r.a.createElement("br",null),z.length>0?r.a.createElement(Ve.a,{container:!0,spacing:3},z.map((function(e,t){return r.a.createElement(Ve.a,{key:"grd_"+e.name.replace(" ","")+"_"+t,item:!0,xs:12,sm:6,md:4,lg:3,xl:3},r.a.createElement(vt,{mobile:e,location:l[e.id],organisation:o[e.organisationId]}))}))):k?null:r.a.createElement(Ke.a,{component:"p",variant:"body1"},"No mobile libraries currently on the road."))},jt=a(892),xt=a(85),kt=a(547),wt=a.n(kt),Ct=a(898),_t=a(546),Nt=a.n(_t),It=Object(P.a)((function(e){return{avatar:{margin:0},avatarOn:{margin:0,cursor:"pointer",backgroundColor:e.palette.primary.main}}}));var Ft=function(){var e=v(),t=Object(_.a)(e,1)[0].searchType,a=It();return r.a.createElement(W.a,{title:"Me"},r.a.createElement(Ct.a,{className:"gps"===t?a.avatarOn:a.avatar},r.a.createElement(Nt.a,null)))},Pt=a(887),Mt=a(891),Lt=a(889),Tt=a(888),Dt=a(501),Bt=a(890),Rt=a(860),At=a(23),zt=Object(P.a)((function(){return{dialog:{border:"1px solid #E0E0E0"}}}));var Wt=function(){var e=j(),t=Object(_.a)(e,2),a=t[0],n=a.mapSettings,o=a.mapSettingsDialogOpen,i=t[1],c=function(){i({type:"SetMapSettingsDialog",mapSettingsDialogOpen:!1})},l=zt(),s=Object(At.a)(),u=Object(Rt.a)(s.breakpoints.down("sm"));return r.a.createElement(Pt.a,{fullScreen:u,disableBackdropClick:!0,open:o,onClose:c,BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:l.dialog}},r.a.createElement(Tt.a,null,"Map settings"),r.a.createElement(Lt.a,null,r.a.createElement(Dt.a,{control:r.a.createElement(Bt.a,{checked:n.authorityBoundary,onChange:function(){i({type:"ToggleMapSetting",mapSetting:"authorityBoundary"})},name:"sw_authority_boundary",color:"primary"}),label:"Library service boundaries"})),r.a.createElement(Mt.a,null,r.a.createElement(L.a,{onClick:c,color:"secondary"},"Close")))};function Zt(e,t){var a;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3===(a=e.substring(1).split("")).length&&(a=[a[0],a[0],a[1],a[1],a[2],a[2]]),"rgba("+[(a="0x"+a.join(""))>>16&255,a>>8&255,255&a].join(",")+", "+t+")";throw new Error("Bad Hex")}var Jt=Object(P.a)((function(e){return{fab:{margin:e.spacing(1),boxShadow:"none"}}}));var Gt=function(e){var t=j(),a=Object(_.a)(t,1)[0].mapZoom,n=e.location,o=e.organisation,i=n.getStatus(),c=a[0]<8?"small":a[0]<12?"medium":"large",l=a[0]<8?2:a[0]<12?3:4,s=Jt();return r.a.createElement(W.a,{title:i?i.textFormat:""},r.a.createElement(jt.a,{size:c,className:s.fab,color:"primary",style:{backgroundColor:Zt(o.colour,.8),color:"white",border:l+"px solid #FFFFFF"}},r.a.createElement(Y.a,null)))},Ht=Object(P.a)((function(e){return{settings:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}})),qt=a(133),Yt=Object(xt.e)({minZoom:5,maxZoom:18,customAttribution:"Contains public sector information licensed under the Open Government Licence"}),Ut=[qt.stopTiles],Xt=[qt.tripTiles],Vt=[qt.libraryAuthorityTiles];var $t=function(){var e=h(),t=Object(_.a)(e,2),a=t[0],o=a.organisations,i=a.organisationLookup,c=a.mobileLookup,l=a.mobileLocations,s=(t[1],v()),u=Object(_.a)(s,2),p=u[0],m=p.searchType,d=p.searchPosition,b=u[1],f=j(),g=Object(_.a)(f,2),y=g[0],E=y.mapZoom,O=y.mapPosition,S=y.mapSettings,x=y.mapSettingsDialogOpen,k=g[1],w=Object(n.useState)(null),C=Object(_.a)(w,2),N=C[0],I=C[1],F=Object(n.useState)(null),P=Object(_.a)(F,2),M=P[0],L=P[1];Object(n.useEffect)((function(){setInterval(D,500)}),[]);var T=function(e){e&&e.features&&e.features.length>0&&e.features[0].properties&&(b({type:"SetCurrentStop",stopId:e.features[0].properties.id}),k({type:"SetStopDialog",stopDialogOpen:!0}))},D=function(){return I(we()())},B=["match",["get","utla19cd"]];o.forEach((function(e){B.push(e.code),B.push(e.colour)})),B.push("#a7a39b");var R=Ht(),A=l.filter((function(e){return null!==e.geoX&&null!==e.geoY}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(Yt,{style:"style.json",center:O,zoom:E,maxZoom:17,pitch:[0],bearing:[0],fitBounds:null,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"},onStyleLoad:function(e){return L(e)}},A&&A.length>0?A.map((function(e){var t=[e.geoX,e.geoY];if(N&&e.routeSection&&e.routeSection.coordinates&&e.updated){var a=we()(N).diff(e.updated),n=Math.round(a/500),o=e.routeSection.coordinates;o.length>n&&n>0&&(t=o[n]),o.length<=n&&n>0&&(t=o[o.length-1])}var l=c[e.mobileId],s=l?i[l.organisationId]:null;return r.a.createElement(xt.b,{key:"mkr_"+e.id,coordinates:t,anchor:"bottom"},r.a.createElement(Gt,{organisation:s,location:e,zoom:M?M.getZoom():0}))})):null,r.a.createElement(xt.c,{id:"src_stops",tileJsonSource:{type:"vector",tiles:Ut}}),r.a.createElement(xt.c,{id:"src_trips",tileJsonSource:{type:"vector",tiles:Xt}}),r.a.createElement(xt.c,{id:"src_library_authorities",tileJsonSource:{type:"vector",tiles:Vt}}),r.a.createElement(xt.a,{id:"lyr_trips_lines",type:"line",sourceId:"src_trips",sourceLayer:"trip",minZoom:13,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-offset":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-dasharray":[2,.5]},onClick:function(e){e&&e.features&&e.features.length>0&&e.features[0].properties&&(b({type:"SetCurrentTrip",tripId:e.features[0].properties.id}),k({type:"SetTripDialog",tripDialogOpen:!0}))}}),r.a.createElement(xt.a,{id:"lyr_stops_circles",type:"circle",sourceId:"src_stops",sourceLayer:"stop",minZoom:5,layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],5,2,17,12],"circle-color":["get","organisation_colour"],"circle-stroke-width":["interpolate",["linear"],["zoom"],5,1,17,4],"circle-stroke-color":"#FFFFFF","circle-opacity":.7},onClick:T}),r.a.createElement(xt.a,{id:"lyr_stops_labels",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","name"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,12,17,22],"text-offset":[0,2]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"},onClick:T}),r.a.createElement(xt.a,{id:"lyr_stops_next_visiting",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","next_visiting"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,10,17,16],"text-offset":[0,-2.8]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"},onClick:T}),S.authorityBoundary?r.a.createElement(r.a.Fragment,null,r.a.createElement(xt.a,{id:"lyr_library_authorities_lines",type:"line",sourceId:"src_library_authorities",sourceLayer:"library_authority_boundaries",minZoom:6,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],6,1,22,4]}}),r.a.createElement(xt.a,{id:"lyr_library_authorities_fill",type:"fill",sourceId:"src_library_authorities",sourceLayer:"library_authority_boundaries",minZoom:6,paint:{"fill-color":B,"fill-opacity":.1}})):null,d&&d.length>1?r.a.createElement(xt.b,{key:"mk_me",coordinates:[d[0],d[1]]},r.a.createElement(Ft,{searchType:m})):null,r.a.createElement(xt.d,{position:"bottom-left"})),r.a.createElement(W.a,{title:"Map settings"},r.a.createElement(jt.a,{size:"small",className:R.settings,color:"primary",style:{color:"white",border:"1px solid #FFFFFF"},onClick:function(){return k({type:"SetMapSettingsDialog",mapSettingsDialogOpen:!0})}},r.a.createElement(wt.a,null))),r.a.createElement(Wt,{mapSettings:S,mapSettingsDialogOpen:x}))},Kt=a(893),Qt=a(548),ea=a.n(Qt);var ta=function(){var e=j(),t=Object(_.a)(e,2),a=t[0],n=a.notificationOpen,o=a.notificationMessage,i=t[1],c=function(){i({type:"SetNotification",notificationOpen:!1})};return r.a.createElement(Kt.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:n,autoHideDuration:3e3,onClose:c,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},o),action:[r.a.createElement(B.a,{key:"close","aria-label":"close",onClick:c},r.a.createElement(ea.a,{color:"inherit"}))]})},aa=a(165),na=a(366),ra=a.n(na),oa=a(556),ia=a.n(oa),ca=a(555),la=a.n(ca),sa=a(554),ua=a.n(sa),pa=a(552),ma=a.n(pa),da=a(551),ba=a.n(da),fa=a(553),ga=a.n(fa),ha=a(557),ya=a.n(ha),Ea=a(293),va=a.n(Ea),Oa=a(294),Sa=a.n(Oa),ja=a(133),xa=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.routeIds=e.route_ids,this.routeNames=e.route_names,this.mobileIds=e.mobile_ids,this.mobileNames=e.mobile_names,this.organisationId=e.organisation_id,this.organisationName=e.organisation_name,this.name=e.name,this.community=e.community,this.address=e.address,this.postcode=e.postcode,this.arrivalTimes=e.arrival_times,this.departureTimes=e.departure_times,this.routeStart=we()(e.route_start),this.routeEnd=we()(e.route_end),this.routeDays=e.route_days,this.routeFrequencies=e.route_frequencies,this.routeSchedule=e.route_schedule.map((function(e){return we()(e)})),this.timetable=e.timetable,this.longitude=e.longitude,this.latitude=e.latitude,this}}]),e}();function ka(e,t,a,n,r,o){return wa.apply(this,arguments)}function wa(){return(wa=Object(w.a)(k.a.mark((function e(t,a,n,r,o,i){var c,l;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=ja.api+"/stops?page="+(t.page+1)+"&limit="+t.pageSize,t.orderBy&&t.orderBy.field&&(c=c+"&sort="+t.orderBy.field+"&direction="+t.orderDirection),n.length>0&&(c=c+"&mobile_ids="+n.join("|")),a.length>0&&(c=c+"&organisation_ids="+a.join("|")),r.length>0&&(c=c+"&route_ids="+r.join("|")),o&&o.length>1&&(c=c+"&longitude="+o[0]+"&latitude="+o[1]),i&&""!==i&&(c=c+"&distance="+i),e.next=9,Ee.a.get(c);case 9:if(!((l=e.sent)&&l.data&&l.data.length>0)){e.next=14;break}return e.abrupt("return",{stops:l.data.map((function(e){return(new xa).fromJson(e)})),total:parseInt(l.headers["x-total-count"]),page:parseInt(l.headers["x-page"])});case 14:return e.abrupt("return",{stops:[],total:0,page:1});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ca(e){return _a.apply(this,arguments)}function _a(){return(_a=Object(w.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(ja.api+"/stops/"+t);case 2:if(!(a=e.sent)||!a.data){e.next=7;break}return e.abrupt("return",(new xa).fromJson(a.data));case 7:return e.abrupt("return",{});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Na=a(133),Ia=Object(P.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:200},margin:{margin:e.spacing(1)},root:{flexGrow:1,maxWidth:"100%"},table:{backgroundColor:"rgba(0, 0, 0, 0)",border:"1px solid #E0E0E0"}}}));var Fa=function(){var e=h(),t=Object(_.a)(e,2),a=t[0],o=(a.organisations,a.organisationLookup),i=(a.mobiles,a.mobileLookup),c=a.routeLookup,l=(t[1],v()),s=Object(_.a)(l,2),u=s[0],p=u.searchType,m=u.searchPostcode,d=u.searchDistance,b=u.searchPosition,f=u.organisationFilter,g=u.mobileFilter,y=u.routeFilter,E=s[1],O=j(),S=Object(_.a)(O,2);Object(C.a)(S[0]);var x=S[1],I=r.a.createRef();Object(n.useEffect)((function(){I.current.onQueryChange()}),[b,d,f,g,y]);var F=Ia(),P=Object(At.a)(),M=f.length>0?o[f[0]].name:"",L=g.length>0?i[g[0]].name:"",T=y.length>0?c[y[0]].name:"",R="All stops";""!==M&&(R="Stops in "+M),""!==L&&(R="Stops for "+M+" "+L),""!==T&&(R="Stops for "+M+" "+T),""!==m&&(R="Stops within "+Math.round(d/1609)+" mile(s) of "+m),"gps"===p&&(R="Stops within "+Math.round(d/1609)+" mile(s) of your location");var A={};Object.keys(o).forEach((function(e){A[e]=o[e].name}));var z={};Object.keys(i).forEach((function(e){z[e]=i[e].name}));var Z={};return Object.keys(c).forEach((function(e){Z[e]=c[e].name})),r.a.createElement("div",{style:{maxWidth:"100%"}},r.a.createElement(pt,null),r.a.createElement(ue.a,{disableSticky:!0},R),r.a.createElement(ra.a,{tableRef:I,components:{Container:function(e){return r.a.createElement(aa.a,Object.assign({},e,{elevation:0,className:F.table}))}},icons:{Filter:ba.a,FirstPage:ma.a,LastPage:ga.a,NextPage:ua.a,PreviousPage:la.a,SortArrow:ia.a},options:{padding:Object(Rt.a)(P.breakpoints.up("sm"))?"default":"dense",search:!1,loadingType:"overlay",actionsColumnIndex:0,filtering:!1,toolbar:!1,headerStyle:{backgroundColor:"#fafafa",color:"#737373",border:"0px"}},columns:[{title:"",field:"name",filtering:!1,render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{title:"See more stop details"},r.a.createElement(B.a,{onClick:function(){return E({type:"SetCurrentStop",stopId:e.id}),void x({type:"SetStopDialog",stopDialogOpen:!0})}},r.a.createElement(ya.a,null))),r.a.createElement(D.a,{mdDown:!0},r.a.createElement(W.a,{title:"Add event to your device calendar"},r.a.createElement(B.a,{onClick:function(){return t=e,window.open(Na.api+"/stops/"+t.id+"/ics");var t}},r.a.createElement(va.a,null)))),r.a.createElement(D.a,{mdDown:!0},r.a.createElement(W.a,{title:"Download a PDF timetable for this stop"},r.a.createElement(B.a,{onClick:function(){return t=e,window.open(Na.api+"/stops/"+t.id+"/pdf","_blank");var t}},r.a.createElement(Sa.a,null)))),r.a.createElement(D.a,{mdDown:!0},r.a.createElement(W.a,{title:"See this stop on the map"},r.a.createElement(B.a,{onClick:function(){return t=e.longitude,a=e.latitude,void x({type:"SetMapPosition",mapPosition:[t,a],mapZoom:15});var t,a},component:N.b,to:"/map"},r.a.createElement(gt.a,null)))))},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Name",field:"name",filtering:!1,hidden:!1,render:function(e){return e.name},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Community",field:"community",filtering:!1,cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Library service",field:"organisationName",filtering:!1,hidden:Object(Rt.a)(P.breakpoints.down("sm")),cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Next due",field:"routeSchedule",filtering:!1,hidden:Object(Rt.a)(P.breakpoints.down("xs")),render:function(e){return e.routeSchedule.length>0?e.routeSchedule[0].format("Do MMMM h:mma"):""},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}}],data:function(e){return new Promise((function(t,a){function n(){return(n=Object(w.a)(k.a.mark((function a(){var n;return k.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,ka(e,f,g,y,b,d);case 2:n=a.sent,t({data:n.stops,page:n.page-1,totalCount:n.total});case 4:case"end":return a.stop()}}),a)})))).apply(this,arguments)}!function(){n.apply(this,arguments)}()}))}}))},Pa=a(133),Ma=Object(P.a)((function(e){return{button:{margin:e.spacing(1)},dialog:{border:"1px solid #E0E0E0"},leftIcon:{marginRight:e.spacing(1)},list:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},progress:{margin:e.spacing(2)}}}));var La=function(){var e=v(),t=Object(_.a)(e,2),a=t[0].currentStopId,o=(t[1],j()),i=Object(_.a)(o,2),c=i[0].stopDialogOpen,l=i[1],s=Object(n.useState)({}),u=Object(_.a)(s,2),p=u[0],m=u[1];Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ca(t);case 2:a=e.sent,m(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}null!=a&&function(t){e.apply(this,arguments)}(a)}),[a]);var d=function(){l({type:"SetStopDialog",stopDialogOpen:!1})},b=Object(At.a)(),f=Ma(),g=Object(Rt.a)(b.breakpoints.down("sm"));return r.a.createElement(Pt.a,{fullScreen:g,disableBackdropClick:!0,open:c,onClose:d,"aria-labelledby":"dlg-title",BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:f.dialog}},p&&p.routeDays?r.a.createElement(r.a.Fragment,null,r.a.createElement(Tt.a,{id:"dlg-title"},p.name+". "+p.community),r.a.createElement(Lt.a,null,r.a.createElement(ue.a,null,p.routeSchedule&&p.routeSchedule.length>0?p.routeSchedule[0].format("dddd Do MMMM h:mma"):""),r.a.createElement("br",null),r.a.createElement(Xe.a,null),r.a.createElement("br",null),r.a.createElement(L.a,{onClick:function(){return window.open(Pa.api+"/stops/"+p.id+"/ics")},className:f.button,color:"primary",startIcon:r.a.createElement(va.a,null)},"Calendar"),r.a.createElement(L.a,{onClick:function(){return window.open(Pa.api+"/stops/"+p.id+"/pdf","_blank")},className:f.button,color:"primary",startIcon:r.a.createElement(Sa.a,null)},"Timetable"),r.a.createElement(L.a,{onClick:function(){l({type:"SetMapPosition",mapPosition:[p.longitude,p.latitude],mapZoom:14})},className:f.button,color:"primary",startIcon:r.a.createElement(gt.a,null),component:N.b,to:"/map"},"Map"))):r.a.createElement(le.a,{className:f.progress,color:"primary",size:30}),r.a.createElement(Mt.a,null,r.a.createElement(L.a,{onClick:function(){return window.open(p.timetable,"_blank")},color:"primary"},"Website"),r.a.createElement(L.a,{onClick:function(){return d()},color:"secondary"},"Close")))},Ta=a(133),Da=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.originStopId=e.origin_stop_id,this.originStopName=e.origin_stop_name,this.destinationStopId=e.destination_stop_id,this.destinationStopName=e.destination_stop_name,this.distance=e.distance,this.duration=e.duration,this.routeLine=e.route_line,this}}]),e}();function Ba(e){return Ra.apply(this,arguments)}function Ra(){return(Ra=Object(w.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(Ta.api+"/trips/"+t);case 2:if(!(a=e.sent)||!a.data){e.next=7;break}return e.abrupt("return",(new Da).fromJson(a.data));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Aa=Object(P.a)((function(e){return{dialog:{border:"1px solid #E0E0E0"}}}));var za=function(){var e=v(),t=Object(_.a)(e,2),a=t[0].currentTripId,o=(t[1],j()),i=Object(_.a)(o,2),c=i[0].tripDialogOpen,l=i[1],s=Object(n.useState)({}),u=Object(_.a)(s,2),p=u[0],m=u[1];Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(k.a.mark((function e(t){var a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ba(t);case 2:a=e.sent,m(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}null!=a&&function(t){e.apply(this,arguments)}(a)}),[a]);var d=function(){l({type:"SetTripDialog",tripDialogOpen:!1})},b=Aa(),f=Object(At.a)(),g=Object(Rt.a)(f.breakpoints.down("sm")),h=Math.round(p.duration/60)+" mins journey time.",y=Math.round(p.distance/1609,1)+" mile(s)";return r.a.createElement(Pt.a,{fullScreen:g,disableBackdropClick:!0,open:c,onClose:d,BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:b.dialog}},r.a.createElement(Tt.a,null,"Trip details"),r.a.createElement(Lt.a,null,r.a.createElement(ue.a,{disableSticky:!0},"From "+p.originStopName+" to "+p.destinationStopName),r.a.createElement(Ke.a,{variant:"body2",component:"p"},h+" "+y)),r.a.createElement(Mt.a,null,r.a.createElement(L.a,{onClick:d,color:"secondary"},"Close")))},Wa=a(558),Za=a.n(Wa),Ja=a(559),Ga=a.n(Ja),Ha=a(560),qa=a.n(Ha),Ya=a(133),Ua=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.country=e.country,this.code=e.code,this.name=e.name,this.timetable=e.timetable,this.website=e.website,this.email=e.email,this.colour=e.colour,this.logo=e.logo,this.numberMobiles=e.number_mobiles,this.numberRoutes=e.number_routes,this.numberStops=e.number_stops,this}}]),e}();function Xa(){return Va.apply(this,arguments)}function Va(){return(Va=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(Ya.api+"/organisations");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=7;break}return e.abrupt("return",t.data.map((function(e){return(new Ua).fromJson(e)})));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var $a=a(133),Ka=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(xe.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.organisationId=e.organisation_id,this.mobileId=e.mobile_id,this.name=e.name,this.frequency=e.frequency,this.start=we()(e.start),this.end=we()(e.end),this.timetable=e.timetable,this.numberStops=e.number_stops,this}}]),e}();function Qa(){return en.apply(this,arguments)}function en(){return(en=Object(w.a)(k.a.mark((function e(){var t;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get($a.api+"/routes");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=7;break}return e.abrupt("return",t.data.map((function(e){return(new Ka).fromJson(e)})));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tn=Object(P.a)((function(e){return{content:{flexGrow:1,padding:e.spacing(2)},root:{flexGrow:1}}}));var an=function(){var e=j(),t=Object(_.a)(e,1)[0],a=t.loadingOrganisations,o=t.loadingMobiles,i=t.loadingRoutes,c=t.loadingMobileLocations,l=t.loadingNearestMobiles,s=t.loadingPostcode,u=h(),p=Object(_.a)(u,2);Object(C.a)(p[0]);var m=p[1];Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xa();case 2:t=e.sent,a={},t.forEach((function(e){a[e.id]=e})),m({type:"AddOrganisations",organisations:t,organisationLookup:a});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(w.a)(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe();case 2:t=e.sent,a={},t.forEach((function(e){a[e.id]=e})),m({type:"AddMobiles",mobiles:t,mobileLookup:a});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function a(){return(a=Object(w.a)(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qa();case 2:t=e.sent,a={},t.forEach((function(e){a[e.id]=e})),m({type:"AddRoutes",routes:t,routeLookup:a});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n(){return r.apply(this,arguments)}function r(){return(r=Object(w.a)(k.a.mark((function e(){var t,a;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me();case 2:t=e.sent,a={},t.forEach((function(e){a[e.mobileId]=e})),m({type:"AddMobileLocations",mobileLocations:t,mobileLocationLookup:a});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),function(){t.apply(this,arguments)}(),function(){a.apply(this,arguments)}(),n(),setInterval((function(){n(!1)}),15e3)}),[]);var d=tn();return r.a.createElement(N.a,null,r.a.createElement("div",{className:d.root},r.a.createElement(qe,{loading:a||o||i||c||l||s,site:2}),r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement("main",{className:d.content},r.a.createElement(I.Route,{path:"/",exact:!0,render:function(){return r.a.createElement(Fa,null)}}),r.a.createElement(I.Route,{path:"/mobiles",render:function(){return r.a.createElement(St,null)}}),r.a.createElement(I.Route,{path:"/map",render:function(){return r.a.createElement($t,null)}}),r.a.createElement(I.Route,{path:"/accessibility",exact:!0,render:function(){return r.a.createElement(lt,{page:Za.a})}}),r.a.createElement(I.Route,{path:"/data",exact:!0,render:function(){return r.a.createElement(lt,{page:Ga.a})}}),r.a.createElement(I.Route,{path:"/privacy",exact:!0,render:function(){return r.a.createElement(lt,{page:qa.a})}}),r.a.createElement(I.Route,{path:["/http:","/https:"],component:function(e){return window.location.replace(e.location.pathname.substr(1)),null}}))),r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement(at,null)),r.a.createElement(La,null),r.a.createElement(za,null),r.a.createElement(ta,null)))},nn={organisations:[],organisationLookup:{},mobiles:[],mobileLookup:{},mobileLocations:[],mobileLocationLookup:{},mobilesNearest:[],mobilesNearestLookup:{},routes:[],routeLookup:{},stops:[],trips:[]},rn=function(e,t){switch(t.type){case"AddOrganisations":return Object(c.a)(Object(c.a)({},e),{},{organisations:t.organisations,organisationLookup:t.organisationLookup});case"AddMobileLocations":return Object(c.a)(Object(c.a)({},e),{},{mobileLocations:t.mobileLocations,mobileLocationLookup:t.mobileLocationLookup});case"AddRoutes":return Object(c.a)(Object(c.a)({},e),{},{routes:t.routes,routeLookup:t.routeLookup});case"AddMobiles":return Object(c.a)(Object(c.a)({},e),{},{mobiles:t.mobiles,mobileLookup:t.mobileLookup});case"UpdateMobilesNearest":return Object(c.a)(Object(c.a)({},e),{},{mobilesNearest:t.mobilesNearest,mobilesNearestLookup:t.mobilesNearestLookup});default:return e}},on={searchPostcode:"",searchType:"",searchDistance:1609,searchPosition:[],searchPositionUpdateInterval:null,organisationFilter:[],mobileFilter:[],routeFilter:[],currentStopId:null,currentTripId:null},cn=function(e,t){switch(t.type){case"SetCurrentStop":return Object(c.a)(Object(c.a)({},e),{},{currentStopId:t.stopId});case"SetCurrentTrip":return Object(c.a)(Object(c.a)({},e),{},{currentTripId:t.tripId});case"SetSearchDistance":return Object(c.a)(Object(c.a)({},e),{},{searchDistance:t.searchDistance});case"SetPostcodeSearch":return Object(c.a)(Object(c.a)({},e),{},{searchPostcode:t.searchPostcode,searchPosition:t.searchPosition,searchType:"postcode",organisationFilter:[],mobileFilter:[],routeFilter:[]});case"FilterByOrganisation":return Object(c.a)(Object(c.a)({},e),{},{organisationFilter:[t.organisationId],mobileFilter:[],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"FilterByMobile":return Object(c.a)(Object(c.a)({},e),{},{organisationFilter:[t.organisationId],mobileFilter:[t.mobileId],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"FilterByRoute":return Object(c.a)(Object(c.a)({},e),{},{routeFilter:[t.routeId],searchPostcode:"",searchPosition:[],searchType:""});case"ClearAll":return Object(c.a)(Object(c.a)({},e),{},{organisationFilter:[],mobileFilter:[],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"ClearMobileFilter":return Object(c.a)(Object(c.a)({},e),{},{mobileFilter:[],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"ClearRouteFilter":return Object(c.a)(Object(c.a)({},e),{},{routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});default:return e}},ln={stopDialogOpen:!1,tripDialogOpen:!1,notificationOpen:!1,notificationMessage:"",mapZoom:[7],mapPosition:[-1.155414,52.691432],mapSettings:{authorityBoundary:!1},mapSettingsDialogOpen:!1,loadingOrganisations:!1,loadingMobiles:!1,loadingRoutes:!1,loadingMobileLocations:!1,loadingNearestMobiles:!1,loadingPostcode:!1},sn=function(e,t){switch(t.type){case"SetNotificationMessage":return Object(c.a)(Object(c.a)({},e),{},{notificationMessage:t.notificationMessage});case"SetNotification":return Object(c.a)(Object(c.a)({},e),{},{notificationOpen:t.notificationOpen});case"ShowNotification":return Object(c.a)(Object(c.a)({},e),{},{notificationOpen:!0,notificationMessage:t.notificationMessage});case"SetStopDialog":return Object(c.a)(Object(c.a)({},e),{},{stopDialogOpen:t.stopDialogOpen});case"SetTripDialog":return Object(c.a)(Object(c.a)({},e),{},{tripDialogOpen:t.tripDialogOpen});case"SetMapSettingsDialog":return Object(c.a)(Object(c.a)({},e),{},{mapSettingsDialogOpen:t.mapSettingsDialogOpen});case"ToggleMapSetting":var a=e.mapSettings;return a[t.mapSetting]=!a[t.mapSetting],Object(c.a)(Object(c.a)({},e),{},{mapSettings:a});case"SetPostcodeSearch":return Object(c.a)(Object(c.a)({},e),{},{mapPosition:t.mapPosition,mapZoom:[13]});case"ToggleLoadingPostcode":return Object(c.a)(Object(c.a)({},e),{},{loadingPostcode:!e.loadingPostcode});case"SetMapPosition":return Object(c.a)(Object(c.a)({},e),{},{mapPosition:t.mapPosition,mapZoom:[t.mapZoom]});default:return e}},un=Object(d.a)({palette:{primary:{main:m.a[900]},secondary:{main:u.a[700]}},overrides:{MuiButton:{text:{textTransform:"none"}},MuiTab:{root:{textTransform:"none"}},MuiTypography:{button:{textTransform:"none"}},MuiTableCell:{root:{borderBottom:"none"}}}});var pn=function(){return r.a.createElement(g,{initialState:nn,reducer:rn},r.a.createElement(E,{initialState:on,reducer:cn},r.a.createElement(S,{initialState:ln,reducer:sn},r.a.createElement(b.a,{theme:un},r.a.createElement(l.a,null),r.a.createElement(an,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(pn,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[570,1,2]]]);
//# sourceMappingURL=main.75212c7c.chunk.js.map