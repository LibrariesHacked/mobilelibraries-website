{"version":3,"sources":["PostcodeSearch.js","AppHeader.js","Filters.js","helpers/mobiles.js","MobileCard.js","Mobiles.js","MeAvatar.js","MapSettings.js","helpers/utils.js","MobileAvatar.js","MobileMap.js","helpers/stops.js","Stops.js","StopDetails.js","TripDetails.js","helpers/geo.js","helpers/organisations.js","helpers/routes.js","helpers/trips.js","App.js","serviceWorker.js","index.js"],"names":["PostcodeSearch","state","postcode","props","anchor","openSettingsMenu","e","setState","currentTarget","closeSettingsMenu","setSearchDistance","distance","setDistance","prevProps","this","classes","search_type","postcodeSearch","clearSearch","className","search","InputBase","placeholder","input","inputInput","value","onChange","target","grow","Tooltip","title","IconButton","iconButton","onClick","color","Menu","id","anchorEl","keepMounted","open","Boolean","onClose","ListSubheader","disableSticky","MenuItem","React","Component","withStyles","theme","flexGrow","padding","paddingTop","spacing","paddingRight","paddingBottom","paddingLeft","fontWeight","position","border","borderRadius","shape","backgroundColor","fade","palette","common","white","marginLeft","marginRight","display","maxWidth","AppHeader","loading","searchType","toggleGPS","location","Typography","variant","component","AppBar","pathname","elevation","appBarTransparent","appBar","Toolbar","Hidden","smDown","Button","Link","to","size","leftIcon","mdUp","CircularProgress","progress","compose","withRouter","zIndex","drawer","margin","withTheme","Filters","organisation_menu_anchor","mobile_menu_anchor","route_menu_anchor","openOrganisationMenu","element","closeOrganisationMenu","chooseOrganisation","organisation_id","setOrganisationFilter","openMobileMenu","closeMobileMenu","chooseMobile","mobile_id","setMobileFilter","openRouteMenu","closeRouteMenu","chooseRoute","route_id","setRouteFilter","organisations","organisation_lookup","organisation_filter","clearOrganisationFilter","mobiles","mobile_lookup","mobile_filter","clearMobileFilter","routes","route_lookup","route_filter","clearRouteFilter","countries","Set","map","org","country","subtitle","length","button","Chip","chip","onDelete","label","name","Array","from","sort","a","b","localeCompare","menu_items","org_list","filter","key","concat","mob","indexOf","route","alignContent","textAlign","marginBottom","config","require","getAllMobiles","callback","axios","get","api","then","response","data","catch","err","getMobileLocations","getMobilesNearest","getMobileStatus","statuses","current_stop_id","previous_stop_id","next_stop_id","moment","next_stop_arrival","isSame","type","text_format","message","arrival","fromNow","next_stop_name","args","stop_name","stop_id","stop_remaining","current_stop_departure","current_stop_name","previous_stop_departure","MobileCard","stopButton","stop","viewStop","offRoadMessage","status","preRouteMessage","stop_button","Fragment","atStopMessage","betweenStopsMessage","postRouteMessage","goToWebsite","window","mobile","timetable","organisation","mobilesHelper","bull","bullet","Card","card","CardContent","gutterBottom","number_routes","number_stops","CardActions","viewStopsByMobile","Divider","verticalDivider","transform","minWidth","fontSize","align","width","height","Mobiles","open_tab","changeTab","viewStopsByOrganisation","mobile_location_lookup","mobiles_nearest_lookup","postcode_district","filtered_mobiles","active_mobiles","display_mobiles","organisation_name","mobile_name","route_name","Math","round","root","displayStopLink","Tabs","scrollButtons","indicatorColor","textColor","Tab","tab","Badge","badgeContent","showZero","Grid","container","idx","replace","item","xs","sm","md","lg","xl","LinearProgress","MeAvatar","Avatar","avatarOn","avatar","cursor","primary","main","MapSettings","handleAuthorityBoundaryChange","toggleMapSetting","close","map_settings","fullScreen","isWidthDown","Dialog","disableBackdropClick","BackdropProps","invisible","PaperProps","dialog","DialogTitle","DialogContent","FormControlLabel","control","Switch","checked","authority_boundary","DialogActions","withWidth","hextoRGBA","hex","alpha","c","test","substring","split","join","Error","MobileAvatar","zoom","Fab","fab","style","utilsHelper","colour","boxShadow","Map","ReactMapboxGl","minZoom","maxZoom","customAttribution","stop_tiles","trip_tiles","library_authority_tiles","MobileMap","time_update_interval","current_time","settings_dialog_open","componentDidMount","setInterval","setCurrentTime","clickStop","features","properties","clickTrip","viewTrip","pitch","bearing","fit_bounds","mobile_locations","organisation_colour_match","forEach","push","code","center","fitBounds","containerStyle","top","bottom","right","left","onStyleLoad","l","location_point","geox","geoy","route_section","coordinates","updated","milliseconds_passed","diff","index","coords","getZoom","tileJsonSource","tiles","sourceId","sourceLayer","layout","paint","current_position","settings","settings_dial_open","getStopById","Stops","tableRef","createRef","getStopCalendar","getStopPdf","viewMapStop","longitude","latitude","current","onQueryChange","displayStopInfo","row","orgText","Object","keys","mobileText","routeText","components","Container","Paper","table","icons","Filter","FilterList","FirstPage","LastPage","NextPage","ChevronRight","PreviousPage","ChevronLeft","SortArrow","ArrowUpward","options","isWidthUp","loadingType","actionsColumnIndex","filtering","toolbar","headerStyle","columns","field","render","rowData","mdDown","cellStyle","borderBottom","hidden","route_schedule","format","query","Promise","resolve","reject","organisation_filters","mobile_filters","route_filters","url","page","pageSize","orderBy","orderDirection","stops","total","parseInt","headers","stopsHelper","stopData","totalCount","formControl","StopDetails","aria-labelledby","route_days","community","startIcon","list","background","paper","TripDetails","trip","estimated_duration","duration","origin_stop_name","destination_stop_name","getCurrentPosition","navigator","geolocation","pos","enableHighAccuracy","timeout","maximumAge","getPostcode","result","admin_district","getAllOrganisations","getAllRoutes","getTripById","createMuiTheme","lightBlue","secondary","blueGrey","overrides","MuiButton","text","textTransform","MuiTab","MuiTableCell","App","stop_dialog_open","current_stop","trip_dialog_open","current_trip","mobiles_nearest","mobile_location_timer","position_update_interval","loading_gps","loading_mobiles","loading_organisations","loading_postcode","loading_routes","snackbar_open","snackbar_message","getOrganisations","organisationsHelper","getMobiles","getRoutes","routesHelper","locations","openStopDialog","closeStopDialog","openTripDialog","tripsHelper","closeTripDialog","viewStopsByRoute","logPosition","geoHelper","clearInterval","new_state","postcode_data","setting","current_setting","closeSnackbar","event","reason","CssBaseline","content","path","exact","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","ContentProps","action","aria-label","hostname","match","ReactDOM","document","getElementById","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.b984deee.chunk.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n// Material UI\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport InputBase from '@material-ui/core/InputBase';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\nimport { fade } from '@material-ui/core/styles/colorManipulator';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// Material icons\r\nimport ClearIcon from '@material-ui/icons/ClearTwoTone';\r\nimport SearchIcon from '@material-ui/icons/SearchTwoTone';\r\nimport SettingsIcon from '@material-ui/icons/SettingsTwoTone';\r\n\r\nconst styles = theme => ({\r\n\tgrow: {\r\n\t\tflexGrow: 1\r\n\t},\r\n\ticonButton: {\r\n\t\tpadding: 10\r\n\t},\r\n\tinputInput: {\r\n\t\tpaddingTop: theme.spacing(),\r\n\t\tpaddingRight: theme.spacing(),\r\n\t\tpaddingBottom: theme.spacing(),\r\n\t\tpaddingLeft: theme.spacing(2),\r\n\t\tfontWeight: 500\r\n\t},\r\n\tsearch: {\r\n\t\tposition: 'relative',\r\n\t\tborder: '1px solid #E0E0E0',\r\n\t\tborderRadius: theme.shape.borderRadius,\r\n\t\tbackgroundColor: fade(theme.palette.common.white, 0.8),\r\n\t\t'&:hover': {\r\n\t\t\tbackgroundColor: fade(theme.palette.common.white, 0.9)\r\n\t\t},\r\n\t\tmarginLeft: 0,\r\n\t\tmarginRight: theme.spacing(),\r\n\t\tdisplay: 'flex',\r\n\t\tmaxWidth: 240\r\n\t}\r\n});\r\n\r\nclass PostcodeSearch extends React.Component {\r\n\tstate = {\r\n\t\tpostcode: this.props.postcode,\r\n\t\tanchor: null\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (this.props.postcode !== prevProps.postcode) this.setState({ postcode: this.props.postcode });\r\n\t}\r\n\r\n\topenSettingsMenu = (e) => this.setState({ anchor: e.currentTarget })\r\n\tcloseSettingsMenu = () => this.setState({ anchor: null })\r\n\r\n\tsetSearchDistance = (distance) => {\r\n\t\tthis.closeSettingsMenu();\r\n\t\tthis.props.setDistance(distance);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { classes, search_type, postcodeSearch, clearSearch } = this.props;\r\n\t\treturn (\r\n\t\t\t<div className={classes.search}>\r\n\t\t\t\t<InputBase\r\n\t\t\t\t\tplaceholder=\"Postcode\"\r\n\t\t\t\t\tclasses={{\r\n\t\t\t\t\t\tinput: classes.inputInput\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tvalue={this.state.postcode}\r\n\t\t\t\t\tonChange={(e) => this.setState({ postcode: e.target.value })}\r\n\t\t\t\t/>\r\n\t\t\t\t<div className={classes.grow} />\r\n\t\t\t\t{search_type === 'postcode' ?\r\n\t\t\t\t\t<Tooltip title={'Clear search'}>\r\n\t\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\t\tclassName={classes.iconButton}\r\n\t\t\t\t\t\t\tonClick={() => clearSearch()}>\r\n\t\t\t\t\t\t\t<ClearIcon />\r\n\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t: null}\r\n\t\t\t\t<Tooltip title={'Search by postcode'}>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\tcolor=\"primary\"\r\n\t\t\t\t\t\tclassName={classes.iconButton}\r\n\t\t\t\t\t\tonClick={() => postcodeSearch(this.state.postcode)}>\r\n\t\t\t\t\t\t<SearchIcon />\r\n\t\t\t\t\t</IconButton>\r\n\t\t\t\t</Tooltip>\r\n\t\t\t\t<Tooltip title={'Change search settings'}>\r\n\t\t\t\t\t<IconButton\r\n\t\t\t\t\t\tclassName={classes.iconButton}\r\n\t\t\t\t\t\tcolor=\"secondary\"\r\n\t\t\t\t\t\tonClick={(e) => { this.openSettingsMenu(e) }}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<SettingsIcon />\r\n\t\t\t\t\t</IconButton>\r\n\t\t\t\t</Tooltip>\r\n\t\t\t\t<Menu\r\n\t\t\t\t\tid=\"mnu-settings\"\r\n\t\t\t\t\tanchorEl={this.state.anchor}\r\n\t\t\t\t\tkeepMounted\r\n\t\t\t\t\topen={Boolean(this.state.anchor)}\r\n\t\t\t\t\tonClose={() => this.closeSettingsMenu()}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ListSubheader disableSticky={true}>Search distance</ListSubheader>\r\n\t\t\t\t\t<MenuItem onClick={() => this.setSearchDistance(1609)}>1 mile</MenuItem>\r\n\t\t\t\t\t<MenuItem onClick={() => this.setSearchDistance(4827)}>3 miles</MenuItem>\r\n\t\t\t\t\t<MenuItem onClick={() => this.setSearchDistance(8045)}>5 miles</MenuItem>\r\n\t\t\t\t\t<MenuItem onClick={() => this.setSearchDistance(16090)}>10 miles</MenuItem>\r\n\t\t\t\t\t<MenuItem onClick={() => this.setSearchDistance(32180)}>20 miles</MenuItem>\r\n\t\t\t\t\t<MenuItem onClick={() => this.setSearchDistance(80450)}>50 miles</MenuItem>\r\n\t\t\t\t</Menu>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nPostcodeSearch.propTypes = {\r\n\tclasses: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default withStyles(styles)(PostcodeSearch);","// React\r\nimport React, { Component } from 'react'\r\n\r\n// Other core stuff\r\nimport compose from 'recompose/compose'\r\nimport PropTypes from 'prop-types'\r\nimport { Link, withRouter } from 'react-router-dom'\r\n\r\n// Material UI\r\nimport AppBar from '@material-ui/core/AppBar'\r\nimport Button from '@material-ui/core/Button'\r\nimport Container from '@material-ui/core/Container'\r\nimport CircularProgress from '@material-ui/core/CircularProgress'\r\nimport Hidden from '@material-ui/core/Hidden'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Toolbar from '@material-ui/core/Toolbar'\r\nimport Typography from '@material-ui/core/Typography'\r\n\r\n// Icons\r\nimport DirectionBusIcon from '@material-ui/icons/DirectionsBusTwoTone'\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone'\r\nimport MapIcon from '@material-ui/icons/MapTwoTone'\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles'\r\n\r\n// Our components\r\nimport PostcodeSearch from './PostcodeSearch'\r\n\r\nconst styles = theme => ({\r\n  appBar: {\r\n    zIndex: theme.zIndex.drawer + 1\r\n  },\r\n  appBarTransparent: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    backgroundColor: 'rgba(250, 250, 250, 0.8)'\r\n  },\r\n  grow: {\r\n    flexGrow: 1\r\n  },\r\n  leftIcon: {\r\n    marginRight: theme.spacing(1)\r\n  },\r\n  progress: {\r\n    margin: theme.spacing(1)\r\n  },\r\n  title: {\r\n    margin: theme.spacing(2)\r\n  }\r\n})\r\n\r\nclass AppHeader extends Component {\r\n  render() {\r\n    const { loading, classes, searchType, postcode, distance, toggleGPS, postcodeSearch, clearSearch, setDistance, location } = this.props\r\n    return (\r\n      <>\r\n        <Container maxWidth='lg'>\r\n          <Typography color='textSecondary' variant='h6' component='h1' className={classes.title}>Mobile libraries</Typography>\r\n        </Container>\r\n        <AppBar\r\n          position={(location.pathname === '/map' ? 'fixed' : 'static')}\r\n          color='inherit'\r\n          elevation={0}\r\n          className={(location.pathname === '/map' ? classes.appBarTransparent : classes.appBar)}\r\n        >\r\n          <Container maxWidth='lg'>\r\n            <Toolbar>\r\n              <Hidden smDown>\r\n                <>\r\n                  <Button\r\n                    component={Link} to='/' color={(location.pathname === '/' ? 'primary' : 'secondary')} size='large'\r\n                    onClick={() => { }}\r\n                  >\r\n                    <DirectionBusIcon className={classes.leftIcon} />Mobile vans\r\n                  </Button>\r\n                  <Button\r\n                    component={Link} to='/stops' color={(location.pathname === '/stops' ? 'primary' : 'secondary')} size='large'\r\n                    onClick={() => { }}\r\n                  >\r\n                    <LocationOnIcon className={classes.leftIcon} />Stop locations\r\n                  </Button>\r\n                  <Button\r\n                    component={Link} to='/map' color={(location.pathname === '/map' ? 'primary' : 'secondary')} size='large'\r\n                    onClick={() => { }}\r\n                  >\r\n                    <MapIcon className={classes.leftIcon} />Map\r\n                  </Button>\r\n                </>\r\n              </Hidden>\r\n              <Hidden mdUp>\r\n                <>\r\n                  <IconButton component={Link} to='/' onClick={() => { }}>\r\n                    <DirectionBusIcon />\r\n                  </IconButton>\r\n                  <IconButton component={Link} to='/stops' onClick={() => { }}>\r\n                    <LocationOnIcon />\r\n                  </IconButton>\r\n                  <IconButton component={Link} to='/map' onClick={() => { }}>\r\n                    <MapIcon />\r\n                  </IconButton>\r\n                </>\r\n              </Hidden>\r\n              {loading ? <CircularProgress className={classes.progress} color='secondary' size={30} /> : null}\r\n              <span className={classes.grow} />\r\n              {location.pathname === '/map' ? (\r\n                <PostcodeSearch\r\n                  postcode={postcode}\r\n                  distance={distance}\r\n                  searchType={searchType}\r\n                  toggleGPS={toggleGPS}\r\n                  setDistance={setDistance}\r\n                  postcodeSearch={postcodeSearch}\r\n                  clearSearch={clearSearch}\r\n                />\r\n              ) : null}\r\n            </Toolbar>\r\n          </Container>\r\n        </AppBar>\r\n      </>\r\n    )\r\n  }\r\n}\r\n\r\nAppHeader.propTypes = {\r\n  classes: PropTypes.object.isRequired\r\n}\r\n\r\nexport default compose(withRouter, withStyles(styles, { withTheme: true }))(AppHeader)\r\n","// React\r\nimport React, { Component } from 'react';\r\n\r\n// Other core stuff\r\nimport PropTypes from 'prop-types';\r\n\r\n// Material UI\r\nimport Button from '@material-ui/core/Button';\r\nimport Chip from '@material-ui/core/Chip';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// MUI Icons\r\nimport BusinessIcon from '@material-ui/icons/BusinessTwoTone';\r\nimport DirectionBusIcon from '@material-ui/icons/DirectionsBusTwoTone';\r\nimport DirectionsIcon from '@material-ui/icons/DirectionsTwoTone';\r\n\r\n// Our components\r\nimport PostcodeSearch from './PostcodeSearch';\r\n\r\nconst styles = (theme) => ({\r\n\tbutton: {\r\n\t\tmarginRight: theme.spacing(1)\r\n\t},\r\n\tchip: {\r\n\t\tmarginRight: theme.spacing(1)\r\n\t},\r\n\tleftIcon: {\r\n\t\tmarginRight: theme.spacing(1)\r\n\t},\r\n\tsearch: {\r\n\t\talignContent: 'center',\r\n\t\ttextAlign: 'center',\r\n\t\tdisplay: 'table',\r\n\t\tmarginLeft: 'auto',\r\n\t\tmarginRight: 'auto',\r\n\t\tmarginBottom: '10px'\r\n\t},\r\n\tsubtitle: {\r\n\t\ttextAlign: 'center',\r\n\t\tmarginBottom: '5px'\r\n\t},\r\n\ttitle: {\r\n\t\ttextAlign: 'center'\r\n\t}\r\n});\r\n\r\nclass Filters extends Component {\r\n\r\n\tstate = {\r\n\t\torganisation_menu_anchor: null,\r\n\t\tmobile_menu_anchor: null,\r\n\t\troute_menu_anchor: null\r\n\t};\r\n\r\n\topenOrganisationMenu = (element) => {\r\n\t\tthis.setState({ organisation_menu_anchor: element });\r\n\t}\r\n\r\n\tcloseOrganisationMenu = () => {\r\n\t\tthis.setState({ organisation_menu_anchor: null });\r\n\t}\r\n\r\n\tchooseOrganisation = (organisation_id) => {\r\n\t\tthis.props.clearSearch();\r\n\t\tthis.props.setOrganisationFilter(organisation_id);\r\n\t\tthis.closeOrganisationMenu();\r\n\t}\r\n\r\n\topenMobileMenu = (element) => {\r\n\t\tthis.setState({ mobile_menu_anchor: element });\r\n\t}\r\n\r\n\tcloseMobileMenu = () => {\r\n\t\tthis.setState({ mobile_menu_anchor: null });\r\n\t}\r\n\r\n\tchooseMobile = (mobile_id) => {\r\n\t\tthis.props.setMobileFilter(mobile_id);\r\n\t\tthis.closeMobileMenu();\r\n\t}\r\n\r\n\topenRouteMenu = (element) => {\r\n\t\tthis.setState({ route_menu_anchor: element });\r\n\t}\r\n\r\n\tcloseRouteMenu = () => {\r\n\t\tthis.setState({ route_menu_anchor: null });\r\n\t}\r\n\r\n\tchooseRoute = (route_id) => {\r\n\t\tthis.props.setRouteFilter(route_id);\r\n\t\tthis.closeRouteMenu();\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tclasses, organisations, organisation_lookup, organisation_filter,\r\n\t\t\tclearOrganisationFilter, mobiles, mobile_lookup, mobile_filter, clearMobileFilter,\r\n\t\t\troutes, route_lookup, route_filter, clearRouteFilter,\r\n\t\t\tsearch_type, postcode, distance, toggleGPS, postcodeSearch, clearSearch, setDistance\r\n\t\t} = this.props;\r\n\r\n\t\tconst countries = new Set(organisations.map(org => org.country));\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<Typography component='h2' variant='h6' color='secondary' className={classes.title}>Your mobile service</Typography>\r\n\t\t\t\t<Typography component='p' variant='body1' color='secondary' className={classes.subtitle}>Find services within {distance / 1609} mile(s)</Typography>\r\n\t\t\t\t<div className={classes.search}>\r\n\t\t\t\t\t<PostcodeSearch\r\n\t\t\t\t\t\tpostcode={postcode}\r\n\t\t\t\t\t\tdistance={distance}\r\n\t\t\t\t\t\tsearch_type={search_type}\r\n\t\t\t\t\t\ttoggleGPS={toggleGPS}\r\n\t\t\t\t\t\tsetDistance={setDistance}\r\n\t\t\t\t\t\tpostcodeSearch={postcodeSearch}\r\n\t\t\t\t\t\tclearSearch={clearSearch}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t\t<Typography component='p' variant='body1' color='secondary' className={classes.subtitle}>Or, choose your library service</Typography>\r\n\t\t\t\t<div className={classes.search}>\r\n\t\t\t\t\t{organisation_filter.length === 0 ? (\r\n\t\t\t\t\t\t<Tooltip title=\"Choose library service\">\r\n\t\t\t\t\t\t\t<Button color=\"secondary\" className={classes.button} onClick={(e) => this.openOrganisationMenu(e.currentTarget)}>\r\n\t\t\t\t\t\t\t\t<BusinessIcon className={classes.leftIcon} />Select service\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t) :\r\n\t\t\t\t\t\t<Chip className={classes.chip} color=\"primary\" variant=\"outlined\" onDelete={clearOrganisationFilter} label={organisation_lookup[organisation_filter[0]].name} />\r\n\t\t\t\t\t}\r\n\t\t\t\t\t{organisation_filter.length > 0 ?\r\n\t\t\t\t\t\t(mobile_filter.length === 0 ?\r\n\t\t\t\t\t\t\t<Tooltip title=\"Choose mobile library\">\r\n\t\t\t\t\t\t\t\t<Button color=\"secondary\" className={classes.button} onClick={(e) => this.openMobileMenu(e.currentTarget)}>\r\n\t\t\t\t\t\t\t\t\t<DirectionBusIcon className={classes.leftIcon} />Select mobile\r\n\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t</Tooltip> :\r\n\t\t\t\t\t\t\t<Chip className={classes.chip} color=\"primary\" variant=\"outlined\" onDelete={(e) => clearMobileFilter()} label={mobile_lookup[mobile_filter[0]].name} />\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: null}\r\n\t\t\t\t\t{mobile_filter.length > 0 ?\r\n\t\t\t\t\t\t(route_filter.length === 0 ?\r\n\t\t\t\t\t\t\t<Tooltip title=\"Choose route\">\r\n\t\t\t\t\t\t\t\t<Button color=\"secondary\" className={classes.button} onClick={(e) => this.openRouteMenu(e.currentTarget)}>\r\n\t\t\t\t\t\t\t\t\t<DirectionsIcon className={classes.leftIcon} />Select route\r\n\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t</Tooltip> :\r\n\t\t\t\t\t\t\t<Chip className={classes.chip} color=\"primary\" variant=\"outlined\" onDelete={(e) => clearRouteFilter()} label={route_lookup[route_filter[0]].name} />\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t: null}\r\n\t\t\t\t</div>\r\n\t\t\t\t<Menu\r\n\t\t\t\t\tid=\"menu-library-service\"\r\n\t\t\t\t\tanchorEl={this.state.organisation_menu_anchor}\r\n\t\t\t\t\tkeepMounted\r\n\t\t\t\t\topen={Boolean(this.state.organisation_menu_anchor)}\r\n\t\t\t\t\tonClose={() => this.closeOrganisationMenu()}\r\n\t\t\t\t>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tArray.from(countries)\r\n\t\t\t\t\t\t\t.sort((a, b) => a.localeCompare(b))\r\n\t\t\t\t\t\t\t.map(country => {\r\n\t\t\t\t\t\t\t\tlet menu_items = [<ListSubheader disableSticky={true}>{country}</ListSubheader>];\r\n\t\t\t\t\t\t\t\tconst org_list = organisations\r\n\t\t\t\t\t\t\t\t\t.sort((a, b) => a.name.localeCompare(b.name))\r\n\t\t\t\t\t\t\t\t\t.filter(org => org.country === country)\r\n\t\t\t\t\t\t\t\t\t.map(org => {\r\n\t\t\t\t\t\t\t\t\t\treturn <MenuItem key={'mnu_itm_org_' + org.id} onClick={() => this.chooseOrganisation(org.id)}>{org.name}</MenuItem>\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\treturn menu_items.concat(org_list);\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t</Menu>\r\n\t\t\t\t<Menu\r\n\t\t\t\t\tid=\"menu-mobile-library\"\r\n\t\t\t\t\tanchorEl={this.state.mobile_menu_anchor}\r\n\t\t\t\t\tkeepMounted\r\n\t\t\t\t\topen={Boolean(this.state.mobile_menu_anchor)}\r\n\t\t\t\t\tonClose={() => this.closeMobileMenu()}\r\n\t\t\t\t>\r\n\t\t\t\t\t{mobiles\r\n\t\t\t\t\t\t.filter(mob => {\r\n\t\t\t\t\t\t\tlet display = true;\r\n\t\t\t\t\t\t\tif (organisation_filter.length > 0 &&\r\n\t\t\t\t\t\t\t\torganisation_filter.indexOf(mob.organisation_id) === -1) {\r\n\t\t\t\t\t\t\t\tdisplay = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn display;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.sort((a, b) => a.name.localeCompare(b.name))\r\n\t\t\t\t\t\t.map(mob => {\r\n\t\t\t\t\t\t\treturn <MenuItem key={'mnu_itm_mob_' + mob.id} onClick={() => this.chooseMobile(mob.id)}>{mob.name}</MenuItem>\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t</Menu>\r\n\t\t\t\t<Menu\r\n\t\t\t\t\tid=\"menu-route\"\r\n\t\t\t\t\tanchorEl={this.state.route_menu_anchor}\r\n\t\t\t\t\tkeepMounted\r\n\t\t\t\t\topen={Boolean(this.state.route_menu_anchor)}\r\n\t\t\t\t\tonClose={() => this.closeRouteMenu()}\r\n\t\t\t\t>\r\n\t\t\t\t\t{routes\r\n\t\t\t\t\t\t.filter(route => {\r\n\t\t\t\t\t\t\tlet display = true;\r\n\t\t\t\t\t\t\tif (mobile_filter.length > 0 &&\r\n\t\t\t\t\t\t\t\tmobile_filter.indexOf(route.mobile_id) === -1) {\r\n\t\t\t\t\t\t\t\tdisplay = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn display;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.sort((a, b) => a.name.localeCompare(b.name))\r\n\t\t\t\t\t\t.map(route => {\r\n\t\t\t\t\t\t\treturn <MenuItem key={'mnu_itm_route_' + route.id} onClick={() => this.chooseRoute(route.id)}>{route.name}</MenuItem>\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t</Menu>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nFilters.propTypes = {\r\n\tclasses: PropTypes.object.isRequired\r\n}\r\n\r\nexport default withStyles(styles, { withTheme: true })(Filters);","// Axios for making requests\r\nimport axios from 'axios'\r\n\r\n// Moment for time calculations\r\nimport moment from 'moment'\r\n\r\nconst config = require('./config.json')\r\n\r\nexport function getAllMobiles (callback) {\r\n  axios.get(config.api + '/mobiles')\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(err => callback([]))\r\n}\r\n\r\nexport function getMobileLocations (callback) {\r\n  axios.get(config.api + '/mobiles/locations')\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(err => callback([]))\r\n}\r\n\r\nexport function getMobilesNearest (location, distance, callback) {\r\n  axios.get(config.api + '/mobiles/nearest?longitude=' + location[0] + '&latitude=' + location[1] + '&distance=' + distance)\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(err => callback([]))\r\n}\r\n\r\nexport function getMobileStatus (location) {\r\n  const statuses = {\r\n    off_road: {\r\n      label: 'Not out today'\r\n    },\r\n    pre_route: {\r\n      label: 'Arriving at '\r\n    },\r\n    at_stop: {\r\n      label: 'At '\r\n    },\r\n    between_stops: {\r\n      label: 'Arriving at '\r\n    },\r\n    post_route: {\r\n      label: 'Finished for the day'\r\n    }\r\n  }\r\n\r\n  // The mobile is not due out today\r\n  if (location && !location.current_stop_id &&\r\n        !location.previous_stop_id && location.next_stop_id &&\r\n        !moment(location.next_stop_arrival).isSame(moment(), 'day')) {\r\n    return {\r\n      type: 'off_road',\r\n      text_format: statuses.off_road.label,\r\n      message: statuses.off_road.label\r\n    }\r\n  }\r\n\r\n  // The mobile is due out today\r\n  if (location && !location.current_stop_id &&\r\n        !location.previous_stop_id && location.next_stop_id &&\r\n        moment(location.next_stop_arrival).isSame(moment(), 'day')) {\r\n    const arrival = moment(location.next_stop_arrival).fromNow()\r\n    return {\r\n      type: 'pre_route',\r\n      message: statuses.pre_route.label,\r\n      text_format: statuses.pre_route.label + location.next_stop_name + ' ' + arrival,\r\n      args: [\r\n        { stop_name: location.next_stop_name, stop_id: location.next_stop_id },\r\n        arrival\r\n      ]\r\n    }\r\n  }\r\n\r\n  // The mobile is at a stop, and will be for a certain amount of time\r\n  if (location && location.current_stop_id) {\r\n    const stop_remaining = moment(location.current_stop_departure).fromNow(true)\r\n    return {\r\n      type: 'at_stop',\r\n      message: statuses.at_stop.label,\r\n      text_format: statuses.at_stop.label + location.current_stop_name + ' for ' + stop_remaining,\r\n      args: [\r\n        { stop_name: location.current_stop_name, stop_id: location.current_stop_id },\r\n        stop_remaining\r\n      ]\r\n    }\r\n  }\r\n\r\n  // The mobile is between stops\r\n  if (location && !location.current_stop_id &&\r\n        location.previous_stop_id && location.next_stop_id &&\r\n        moment(location.previous_stop_departure).isSame(moment(), 'day') &&\r\n        moment(location.next_stop_arrival).isSame(moment(), 'day')) {\r\n    const arrival = moment(location.next_stop_arrival).fromNow()\r\n    return {\r\n      type: 'between_stops',\r\n      message: statuses.between_stops.label,\r\n      text_format: statuses.between_stops.label + location.next_stop_name + ' ' + arrival,\r\n      args: [\r\n        { stop_name: location.next_stop_name, stop_id: location.next_stop_id },\r\n        arrival\r\n      ]\r\n    }\r\n  }\r\n\r\n  // The mobile has finished for the day\r\n  if (location &&\r\n        location.previous_stop_id && location.next_stop_id &&\r\n        moment(location.previous_stop_departure).isSame(moment(), 'day') &&\r\n        !moment(location.next_stop_arrival).isSame(moment(), 'day')) {\r\n    return {\r\n      type: 'post_route',\r\n      message: statuses.post_route.label,\r\n      text_format: statuses.post_route.label\r\n    }\r\n  }\r\n\r\n  return null\r\n}\r\n","// React\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Link } from \"react-router-dom\";\r\n\r\n// Material UI\r\nimport Button from '@material-ui/core/Button';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\n// MUI Icons\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone';\r\nimport WebIcon from '@material-ui/icons/WebTwoTone';\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// Helpers\r\nimport * as mobilesHelper from './helpers/mobiles';\r\n\r\nconst styles = theme => ({\r\n\tbullet: {\r\n\t\tdisplay: 'inline-block',\r\n\t\tmargin: '0 2px',\r\n\t\ttransform: 'scale(1.2)'\r\n\t},\r\n\tcard: {\r\n\t\tminWidth: 275\r\n\t},\r\n\tleftIcon: {\r\n\t\tmarginRight: theme.spacing(1)\r\n\t},\r\n\ttitle: {\r\n\t\tfontSize: 12,\r\n\t\tfontWeight: 500,\r\n\t\talign: 'right'\r\n\t},\r\n\tverticalDivider: {\r\n\t\twidth: 1,\r\n\t\theight: 28,\r\n\t\tmargin: 8\r\n\t},\r\n\tprogress: {\r\n\t\tmargin: theme.spacing(2)\r\n\t}\r\n});\r\n\r\nclass MobileCard extends Component {\r\n\r\n\tstopButton = (stop) => {\r\n\t\treturn <Button color=\"secondary\" onClick={() => this.props.viewStop({ id: stop.stop_id })}>{stop.stop_name}</Button>\r\n\t}\r\n\r\n\toffRoadMessage = (status) => {\r\n\t\treturn (\r\n\t\t\t<Typography>{status.message}</Typography>\r\n\t\t)\r\n\t}\r\n\r\n\tpreRouteMessage = (status) => {\r\n\t\tconst stop_button = this.stopButton(status.args[0]);\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Typography>\r\n\t\t\t\t\t{status.message}\r\n\t\t\t\t\t{stop_button}\r\n\t\t\t\t\t{status.args[1]}\r\n\t\t\t\t</Typography>\r\n\t\t\t</React.Fragment>\r\n\t\t)\r\n\t}\r\n\r\n\tatStopMessage = (status) => {\r\n\t\tconst stop_button = this.stopButton(status.args[0]);\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Typography>\r\n\t\t\t\t\t{status.message}\r\n\t\t\t\t\t{stop_button}\r\n\t\t\t\t\t{' for ' + status.args[1]}\r\n\t\t\t\t</Typography>\r\n\t\t\t</React.Fragment>\r\n\t\t)\r\n\t}\r\n\r\n\tbetweenStopsMessage = (status) => {\r\n\t\tconst stop_button = this.stopButton(status.args[0]);\r\n\t\treturn (\r\n\t\t\t<React.Fragment>\r\n\t\t\t\t<Typography>\r\n\t\t\t\t\t{status.message}\r\n\t\t\t\t\t{stop_button}\r\n\t\t\t\t\t{status.args[1]}\r\n\t\t\t\t</Typography>\r\n\t\t\t</React.Fragment>\r\n\t\t)\r\n\t}\r\n\r\n\tpostRouteMessage = (status) => {\r\n\t\treturn (\r\n\t\t\t<Typography>{status.message}</Typography>\r\n\t\t)\r\n\t}\r\n\r\n\tgoToWebsite = () => window.open(this.props.mobile.timetable, '_blank');\r\n\r\n\trender() {\r\n\t\tconst { classes, mobile, organisation, location } = this.props;\r\n\t\tlet status = mobilesHelper.getMobileStatus(location);\r\n\t\tif (status && status.type === 'off_road') status = this.offRoadMessage(status);\r\n\t\tif (status && status.type === 'pre_route') status = this.preRouteMessage(status);\r\n\t\tif (status && status.type === 'at_stop') status = this.atStopMessage(status);\r\n\t\tif (status && status.type === 'between_stops') status = this.betweenStopsMessage(status);\r\n\t\tif (status && status.type === 'post_route') status = this.postRouteMessage(status);\r\n\t\tif (!status) status = <CircularProgress className={classes.progress} color=\"secondary\" size={30} />\r\n\t\tconst bull = <span className={classes.bullet}></span>;\r\n\t\treturn (\r\n\t\t\t<Card className={classes.card} elevation={0}>\r\n\t\t\t\t<CardContent>\r\n\t\t\t\t\t<Typography className={classes.title} color=\"textSecondary\" gutterBottom>\r\n\t\t\t\t\t\t{mobile.number_routes + ' route' + (mobile.number_routes > 1 ? 's' : '')}\r\n\t\t\t\t\t\t{bull}\r\n\t\t\t\t\t\t{mobile.number_stops + ' stop' + (mobile.number_stops > 1 ? 's' : '')}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<Typography variant=\"h6\" component=\"h2\">{(organisation ? organisation.name + ' ' : '') + mobile.name}</Typography>\r\n\t\t\t\t\t{status}\r\n\t\t\t\t</CardContent>\r\n\t\t\t\t<CardActions>\r\n\t\t\t\t\t<Tooltip title=\"Mobile library stops\">\r\n\t\t\t\t\t\t<Button component={Link} to=\"/stops\" size=\"small\" color=\"primary\" className={classes.button} onClick={() => this.props.viewStopsByMobile(organisation.id, mobile.id)}>\r\n\t\t\t\t\t\t\t<LocationOnIcon className={classes.leftIcon} />View stops\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t<Divider className={classes.verticalDivider} />\r\n\t\t\t\t\t{mobile.timetable ? <Tooltip title=\"Website timetable\">\r\n\t\t\t\t\t\t<IconButton className={classes.button} onClick={() => this.goToWebsite()}>\r\n\t\t\t\t\t\t\t<WebIcon />\r\n\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t</Tooltip> : null}\r\n\t\t\t\t</CardActions>\r\n\t\t\t</Card>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nMobileCard.propTypes = {\r\n\tclasses: PropTypes.object.isRequired\r\n}\r\n\r\nexport default withStyles(styles, { withTheme: true })(MobileCard);","// React\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n// Material UI\r\nimport Badge from '@material-ui/core/Badge';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport Tab from '@material-ui/core/Tab';\r\nimport Tabs from '@material-ui/core/Tabs';\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// Our components\r\nimport Filters from './Filters';\r\nimport MobileCard from './MobileCard';\r\n\r\nimport * as mobilesHelper from './helpers/mobiles';\r\n\r\nconst styles = (theme) => ({\r\n\tchip: {\r\n\t\tmargin: theme.spacing(1),\r\n\t},\r\n\tpadding: {\r\n\t\tpadding: theme.spacing(0, 2)\r\n\t},\r\n\troot: {\r\n\t\tflexGrow: 1\r\n\t}\r\n});\r\n\r\nclass Mobiles extends Component {\r\n\tstate = {\r\n\t\topen_tab: 0\r\n\t};\r\n\r\n\tchangeTab = (value) => {\r\n\t\tthis.setState({ open_tab: value });\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { classes, organisations, organisation_lookup, organisation_filter, setOrganisationFilter, clearOrganisationFilter, viewStopsByOrganisation,\r\n\t\t\tmobiles, mobile_lookup, mobile_location_lookup, mobiles_nearest_lookup, mobile_filter, setMobileFilter, clearMobileFilter,\r\n\t\t\troutes, route_lookup, route_filter, setRouteFilter, clearRouteFilter,\r\n\t\t\tsearch_type, postcode, postcode_district, distance, toggleGPS, postcodeSearch, clearSearch, setDistance } = this.props;\r\n\r\n\t\t// Get all mobiles that are currently filtered\r\n\t\tconst filtered_mobiles = mobiles.filter(mob => {\r\n\t\t\tlet display = true;\r\n\t\t\tif (search_type === 'gps' || search_type === 'postcode') {\r\n\t\t\t\tdisplay = mobiles_nearest_lookup[mob.id];\r\n\t\t\t}\r\n\t\t\tif (organisation_filter.length > 0 &&\r\n\t\t\t\torganisation_filter.indexOf(mob.organisation_id) === -1) {\r\n\t\t\t\tdisplay = false;\r\n\t\t\t}\r\n\t\t\tif (mobile_filter.length > 0 &&\r\n\t\t\t\tmobile_filter.indexOf(mob.id) === -1) {\r\n\t\t\t\tdisplay = false;\r\n\t\t\t}\r\n\t\t\treturn display;\r\n\t\t});\r\n\t\t// Then get those that are currently active\r\n\t\tconst active_mobiles = filtered_mobiles.filter(mob => {\r\n\t\t\tconst status = mobilesHelper.getMobileStatus(mobile_location_lookup[mob.id]);\r\n\t\t\treturn (status && status.type !== 'off_road' && status.type !== 'post_route');\r\n\t\t});\r\n\r\n\t\t// Apply filters\r\n\t\tconst display_mobiles = (this.state.open_tab === 0 ? active_mobiles : filtered_mobiles);\r\n\r\n\t\t// Calculate title\r\n\t\tconst organisation_name = (organisation_filter.length > 0 ? organisation_lookup[organisation_filter[0]].name : '');\r\n\t\tconst mobile_name = (mobile_filter.length > 0 ? mobile_lookup[mobile_filter[0]].name : '');\r\n\t\tconst route_name = (route_filter.length > 0 ? route_lookup[route_filter[0]].name : '');\r\n\t\tlet title = 'Mobile vans';\r\n\t\t// Filter stops\r\n\t\tif (organisation_name !== '') title = 'Mobiles in ' + organisation_name;\r\n\t\tif (mobile_name !== '') title = organisation_name + ' ' + mobile_name;\r\n\t\tif (route_name !== '') title = organisation_name + ' ' + route_name;\r\n\t\t// Postcode search stops\r\n\t\tif (postcode !== '') title = 'Mobiles with stops within ' + Math.round(distance / 1609) + ' mile(s) of ' + postcode;\r\n\t\t// GPS search stops\r\n\t\tif (search_type === 'gps') title = 'Mobiles with stops within ' + Math.round(distance / 1609) + ' mile(s) of your location';\r\n\r\n\t\treturn (\r\n\t\t\t<div className={classes.root}>\r\n\t\t\t\t<Filters\r\n\t\t\t\t\tdisplayStopLink={true}\r\n\t\t\t\t\torganisations={organisations}\r\n\t\t\t\t\torganisation_lookup={organisation_lookup}\r\n\t\t\t\t\torganisation_filter={organisation_filter}\r\n\t\t\t\t\tsetOrganisationFilter={setOrganisationFilter}\r\n\t\t\t\t\tclearOrganisationFilter={clearOrganisationFilter}\r\n\t\t\t\t\tviewStopsByOrganisation={viewStopsByOrganisation}\r\n\t\t\t\t\tmobiles={mobiles}\r\n\t\t\t\t\tmobile_lookup={mobile_lookup}\r\n\t\t\t\t\tmobile_filter={mobile_filter}\r\n\t\t\t\t\tsetMobileFilter={setMobileFilter}\r\n\t\t\t\t\tclearMobileFilter={clearMobileFilter}\r\n\t\t\t\t\troutes={routes}\r\n\t\t\t\t\troute_lookup={route_lookup}\r\n\t\t\t\t\troute_filter={route_filter}\r\n\t\t\t\t\tsetRouteFilter={setRouteFilter}\r\n\t\t\t\t\tclearRouteFilter={clearRouteFilter}\r\n\t\t\t\t\tpostcode={postcode}\r\n\t\t\t\t\tpostcode_district={postcode_district}\r\n\t\t\t\t\tdistance={distance}\r\n\t\t\t\t\tsearch_type={search_type}\r\n\t\t\t\t\tsetDistance={setDistance}\r\n\t\t\t\t\ttoggleGPS={toggleGPS}\r\n\t\t\t\t\tpostcodeSearch={postcodeSearch}\r\n\t\t\t\t\tclearSearch={clearSearch}\r\n\t\t\t\t/>\r\n\t\t\t\t<ListSubheader disableSticky={true}>{title}</ListSubheader>\r\n\t\t\t\t<Tabs\r\n\t\t\t\t\tvariant=\"standard\"\r\n\t\t\t\t\tscrollButtons=\"off\"\r\n\t\t\t\t\tvalue={this.state.open_tab}\r\n\t\t\t\t\tindicatorColor=\"secondary\"\r\n\t\t\t\t\ttextColor=\"secondary\"\r\n\t\t\t\t\tonChange={(e, value) => this.changeTab(value)}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Tab\r\n\t\t\t\t\t\tclassName={classes.tab}\r\n\t\t\t\t\t\tlabel={\r\n\t\t\t\t\t\t\t<Badge\r\n\t\t\t\t\t\t\t\tclassName={classes.padding}\r\n\t\t\t\t\t\t\t\tcolor={\"secondary\"}\r\n\t\t\t\t\t\t\t\tbadgeContent={active_mobiles.length}>\r\n\t\t\t\t\t\t\t\tOut today\r\n\t\t\t\t\t\t\t</Badge>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<Tab\r\n\t\t\t\t\t\tlabel={\r\n\t\t\t\t\t\t\t<Badge\r\n\t\t\t\t\t\t\t\tshowZero\r\n\t\t\t\t\t\t\t\tclassName={classes.padding}\r\n\t\t\t\t\t\t\t\tcolor=\"secondary\"\r\n\t\t\t\t\t\t\t\tbadgeContent={filtered_mobiles.length}>\r\n\t\t\t\t\t\t\t\tAll vans\r\n\t\t\t\t\t\t\t</Badge>\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Tabs>\r\n\t\t\t\t<br />\r\n\t\t\t\t{mobiles ?\r\n\t\t\t\t\t<Grid container spacing={3}>\r\n\t\t\t\t\t\t{display_mobiles\r\n\t\t\t\t\t\t\t.filter(mob => {\r\n\t\t\t\t\t\t\t\tlet display = true;\r\n\t\t\t\t\t\t\t\tif (organisation_filter.length > 0 &&\r\n\t\t\t\t\t\t\t\t\torganisation_filter.indexOf(mob.organisation_id) === -1) {\r\n\t\t\t\t\t\t\t\t\tdisplay = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (mobile_filter.length > 0 &&\r\n\t\t\t\t\t\t\t\t\tmobile_filter.indexOf(mob.id) === -1) {\r\n\t\t\t\t\t\t\t\t\tdisplay = false;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn display;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.filter(mob => {\r\n\t\t\t\t\t\t\t\tif (search_type === 'gps' || search_type === 'postcode') {\r\n\t\t\t\t\t\t\t\t\treturn mobiles_nearest_lookup[mob.id];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t.map((mobile, idx) => {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<Grid\r\n\t\t\t\t\t\t\t\t\t\tkey={'grd_' + mobile.name.replace(' ', '') + '_' + idx}\r\n\t\t\t\t\t\t\t\t\t\titem xs={12} sm={6} md={4} lg={3} xl={3}>\r\n\t\t\t\t\t\t\t\t\t\t<MobileCard\r\n\t\t\t\t\t\t\t\t\t\t\tmobile={mobile}\r\n\t\t\t\t\t\t\t\t\t\t\tlocation={mobile_location_lookup[mobile.id]}\r\n\t\t\t\t\t\t\t\t\t\t\torganisation={organisation_lookup[mobile.organisation_id]}\r\n\t\t\t\t\t\t\t\t\t\t\tviewStop={this.props.viewStop}\r\n\t\t\t\t\t\t\t\t\t\t\tviewStopsByMobile={this.props.viewStopsByMobile}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Grid> :\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t<LinearProgress color=\"secondary\" />\r\n\t\t\t\t\t</div>}\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nMobiles.propTypes = {\r\n\tclasses: PropTypes.object.isRequired\r\n}\r\n\r\nexport default withStyles(styles)(Mobiles);","// React and additional\r\nimport React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n// Material UI\r\nimport Avatar from '@material-ui/core/Avatar';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\n\r\n// Icons\r\nimport Face from '@material-ui/icons/FaceTwoTone';\r\n\r\nconst styles = theme => ({\r\n    avatar: {\r\n        margin: 0\r\n    },\r\n    avatarOn: {\r\n        margin: 0,\r\n        cursor: 'pointer',\r\n        backgroundColor: theme.palette.primary.main\r\n    }\r\n});\r\n\r\nclass MeAvatar extends React.Component {\r\n    state = {\r\n    }\r\n\r\n    render() {\r\n        const { classes } = this.props;\r\n\r\n        return (\r\n            <Tooltip title={'Me'}>\r\n                <Avatar\r\n                    className={this.props.search_type === 'gps' ? classes.avatarOn : classes.avatar}>\r\n                    <Face />\r\n                </Avatar>\r\n            </Tooltip>\r\n        );\r\n    }\r\n}\r\n\r\nMeAvatar.propTypes = {\r\n    classes: PropTypes.object.isRequired\r\n};\r\n\r\nexport default withStyles(styles, { withTheme: true })(MeAvatar);","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport compose from 'recompose/compose';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport Switch from '@material-ui/core/Switch';\r\n\r\nimport withWidth, { isWidthDown } from '@material-ui/core/withWidth';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\nconst styles = theme => ({\r\n    dialog: {\r\n        border: '1px solid #E0E0E0'\r\n    }\r\n});\r\n\r\nclass MapSettings extends React.Component {\r\n    state = {}\r\n\r\n    handleAuthorityBoundaryChange = () => {\r\n        this.props.toggleMapSetting('authority_boundary');\r\n    }\r\n\r\n    close = () => this.props.close()\r\n\r\n    render() {\r\n        const { classes, width, map_settings } = this.props;\r\n        const fullScreen = isWidthDown('sm', width);\r\n        return (\r\n            <Dialog\r\n                fullScreen={fullScreen}\r\n                disableBackdropClick={true}\r\n                open={this.props.open}\r\n                onClose={this.close}\r\n                BackdropProps={{\r\n                    invisible: true\r\n                }}\r\n                PaperProps={\r\n                    {\r\n                        elevation: 0,\r\n                        className: classes.dialog\r\n                    }\r\n                }\r\n            >\r\n                <DialogTitle>Map settings</DialogTitle>\r\n                <DialogContent>\r\n                    <FormControlLabel\r\n                        control={\r\n                            <Switch\r\n                                checked={map_settings.authority_boundary}\r\n                                onChange={this.handleAuthorityBoundaryChange}\r\n                                name=\"sw_authority_boundary\"\r\n                                color=\"primary\"\r\n                            />\r\n                        }\r\n                        label=\"Library service boundaries\"\r\n                    />\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => this.close()} color=\"secondary\">Close</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        );\r\n    }\r\n}\r\n\r\nMapSettings.propTypes = {\r\n    classes: PropTypes.object.isRequired\r\n};\r\n\r\nexport default compose(withWidth(), withStyles(styles, { withTheme: true }))(MapSettings);","export function hextoRGBA (hex, alpha) {\r\n  var c\r\n  if (/^#([A-Fa-f0-9]{3}){1,2}$/.test(hex)) {\r\n    c = hex.substring(1).split('')\r\n    if (c.length === 3) {\r\n      c = [c[0], c[0], c[1], c[1], c[2], c[2]]\r\n    }\r\n    c = '0x' + c.join('')\r\n    return 'rgba(' + [(c >> 16) & 255, (c >> 8) & 255, c & 255].join(',') + ', ' + alpha + ')'\r\n  }\r\n  throw new Error('Bad Hex')\r\n}\r\n","// React\r\nimport React, { Component } from 'react'\r\nimport PropTypes from 'prop-types'\r\n\r\n// Material UI\r\nimport Fab from '@material-ui/core/Fab'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\n// MUI Icons\r\nimport DirectionBusIcon from '@material-ui/icons/DirectionsBusTwoTone'\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles'\r\n\r\n// Helpers\r\nimport * as mobilesHelper from './helpers/mobiles'\r\nimport * as utilsHelper from './helpers/utils'\r\n\r\nconst styles = theme => ({\r\n  fab: {\r\n    margin: theme.spacing(1),\r\n    boxShadow: 'none'\r\n  }\r\n})\r\n\r\nclass MobileAvatar extends Component {\r\n  render () {\r\n    const { classes, location, organisation, zoom } = this.props\r\n    const status = mobilesHelper.getMobileStatus(location)\r\n    const size = (zoom < 8 ? 'small' : (zoom < 12 ? 'medium' : 'large'))\r\n    const border = (zoom < 8 ? 2 : (zoom < 12 ? 3 : 4))\r\n    return (\r\n      <Tooltip\r\n        title={(status ? status.text_format : '')}\r\n      >\r\n        <Fab\r\n          size={size}\r\n          className={classes.fab}\r\n          color='primary'\r\n          style={{\r\n            backgroundColor: utilsHelper.hextoRGBA(organisation.colour, 0.8),\r\n            color: 'white',\r\n            border: (border + 'px solid #FFFFFF')\r\n          }}\r\n        >\r\n          <DirectionBusIcon />\r\n        </Fab>\r\n      </Tooltip>\r\n    )\r\n  }\r\n}\r\n\r\nMobileAvatar.propTypes = {\r\n  classes: PropTypes.object.isRequired\r\n}\r\n\r\nexport default withStyles(styles, { withTheme: true })(MobileAvatar)\r\n","// React\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\n// Material UI\r\nimport Fab from '@material-ui/core/Fab'\r\nimport Tooltip from '@material-ui/core/Tooltip'\r\n\r\n// Mapbox GL\r\nimport ReactMapboxGl, { ZoomControl, Source, Layer, Marker } from \"react-mapbox-gl\";\r\n\r\n// Our components\r\nimport MeAvatar from './MeAvatar';\r\nimport MapSettings from './MapSettings';\r\nimport MobileAvatar from './MobileAvatar';\r\n\r\n// Mui Icons\r\nimport LayersIcon from '@material-ui/icons/LayersTwoTone';\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\nimport moment from 'moment';\r\n\r\nconst styles = theme => ({\r\n  settings: {\r\n    position: 'absolute',\r\n    bottom: theme.spacing(4),\r\n    right: theme.spacing(4),\r\n  }\r\n});\r\n\r\nconst config = require('./helpers/config.json');\r\n\r\nconst Map = ReactMapboxGl({\r\n  minZoom: 5,\r\n  maxZoom: 18,\r\n  customAttribution: 'Contains public sector information licensed under the Open Government Licence'\r\n});\r\n\r\nconst stop_tiles = [config.stop_tiles];\r\nconst trip_tiles = [config.trip_tiles];\r\nconst library_authority_tiles = [config.library_authority_tiles];\r\n\r\nclass MobileMap extends Component {\r\n\r\n  state = {\r\n    time_update_interval: null,\r\n    current_time: null,\r\n    map: null,\r\n    settings_dialog_open: false\r\n  }\r\n\r\n  componentDidMount = () => {\r\n    // Set up interval to provide a date every 500 milliseconds\r\n    let time_update_interval = setInterval(this.setCurrentTime, 500);\r\n    this.setState({ time_update_interval: time_update_interval });\r\n  }\r\n\r\n  clickStop = (map) => {\r\n    if (map && map.features && map.features.length > 0 && map.features[0].properties) {\r\n      this.props.viewStop({ id: map.features[0].properties.id });\r\n    }\r\n  }\r\n\r\n  clickTrip = (map) => {\r\n    if (map && map.features && map.features.length > 0 && map.features[0].properties) {\r\n      this.props.viewTrip(map.features[0].properties);\r\n    }\r\n  }\r\n\r\n  setCurrentTime = () => this.setState({ current_time: moment() });\r\n\r\n  render() {\r\n    const { classes, position, zoom, pitch, bearing, fit_bounds, map_settings, mobile_locations, mobile_lookup, organisations, organisation_lookup, toggleMapSetting } = this.props;\r\n\r\n    // Build the colour match\r\n    let organisation_colour_match = ['match', ['get', 'utla19cd']]\r\n    organisations.forEach(org => {\r\n      organisation_colour_match.push(org.code);\r\n      organisation_colour_match.push(org.colour);\r\n    });\r\n    organisation_colour_match.push('#a7a39b');\r\n\r\n    return (\r\n      <React.Fragment>\r\n        <Map\r\n          style='style.json'  // eslint-disable-line react/style-prop-object\r\n          center={position}\r\n          zoom={zoom}\r\n          maxZoom={17}\r\n          pitch={pitch}\r\n          bearing={bearing}\r\n          fitBounds={fit_bounds}\r\n          containerStyle={{ top: 0, bottom: 0, right: 0, left: 0, height: '100vh', width: '100vw', position: 'absolute' }}\r\n          onStyleLoad={map => this.setState({ map: map })}\r\n        >\r\n          { // The mobile library locations\r\n            mobile_locations && mobile_locations.length > 0 ?\r\n              mobile_locations.map(l => {\r\n                let location_point = [l.geox, l.geoy];\r\n                if (this.state.current_time && l.route_section && l.route_section.coordinates && l.updated) {\r\n                  const milliseconds_passed = moment(this.state.current_time).diff(l.updated);\r\n                  const index = Math.round(milliseconds_passed / 500);\r\n                  const coords = l.route_section.coordinates;\r\n                  if (coords.length > index && index > 0) location_point = coords[index];\r\n                  if (coords.length <= index && index > 0) location_point = coords[coords.length - 1];\r\n                }\r\n                const mobile = mobile_lookup[l.mobile_id];\r\n                const organisation = (mobile ? organisation_lookup[mobile.organisation_id] : null);\r\n                return <Marker\r\n                  key={'mkr_' + l.id}\r\n                  coordinates={location_point}\r\n                  anchor=\"bottom\">\r\n                  <MobileAvatar\r\n                    organisation={organisation}\r\n                    location={l}\r\n                    zoom={this.state.map ? this.state.map.getZoom() : 0}\r\n                  />\r\n                </Marker>\r\n              }) : null\r\n          }\r\n          <Source\r\n            id='src_stops'\r\n            tileJsonSource={{\r\n              type: 'vector',\r\n              tiles: stop_tiles\r\n            }} />\r\n          <Source\r\n            id='src_trips'\r\n            tileJsonSource={{\r\n              type: 'vector',\r\n              tiles: trip_tiles\r\n            }} />\r\n          <Source\r\n            id='src_library_authorities'\r\n            tileJsonSource={{\r\n              type: 'vector',\r\n              tiles: library_authority_tiles\r\n            }} />\r\n          <Layer\r\n            id='lyr_trips_lines'\r\n            type='line'\r\n            sourceId='src_trips'\r\n            sourceLayer='trip'\r\n            minZoom={13}\r\n            layout={{\r\n              \"line-join\": \"round\",\r\n              \"line-cap\": \"square\"\r\n            }}\r\n            paint={{\r\n              \"line-color\": \"#a7a39b\",\r\n              \"line-offset\": [\r\n                \"interpolate\",\r\n                [\r\n                  \"linear\"\r\n                ],\r\n                [\r\n                  \"zoom\"\r\n                ],\r\n                13, 0.5,\r\n                14, 1,\r\n                15, 2,\r\n                16, 3,\r\n                18, 10,\r\n                22, 20\r\n              ],\r\n              \"line-opacity\": 1,\r\n              \"line-width\": [\r\n                \"interpolate\",\r\n                [\r\n                  \"linear\"\r\n                ],\r\n                [\r\n                  \"zoom\"\r\n                ],\r\n                13, 0.5,\r\n                14, 1,\r\n                15, 2,\r\n                16, 3,\r\n                18, 10,\r\n                22, 20\r\n              ],\r\n              \"line-dasharray\": [\r\n                2,\r\n                0.5\r\n              ]\r\n            }}\r\n            onClick={this.clickTrip}\r\n          />\r\n          <Layer\r\n            id='lyr_stops_circles'\r\n            type='circle'\r\n            sourceId='src_stops'\r\n            sourceLayer='stop'\r\n            minZoom={5}\r\n            layout={{}}\r\n            paint={{\r\n              'circle-radius': [\r\n                'interpolate',\r\n                ['linear'],\r\n                ['zoom'],\r\n                5, 2,\r\n                17, 12\r\n              ],\r\n              'circle-color': ['get', 'organisation_colour'],\r\n              'circle-stroke-width': [\r\n                'interpolate',\r\n                ['linear'],\r\n                ['zoom'],\r\n                5, 1,\r\n                17, 4\r\n              ],\r\n              'circle-stroke-color': '#FFFFFF',\r\n              'circle-opacity': 0.7\r\n            }}\r\n            onClick={this.clickStop}\r\n          />\r\n          <Layer\r\n            id='lyr_stops_labels'\r\n            type='symbol'\r\n            sourceId='src_stops'\r\n            sourceLayer='stop'\r\n            minZoom={13}\r\n            layout={{\r\n              'text-ignore-placement': false,\r\n              'text-field': ['to-string', ['get', 'name']],\r\n              \"text-font\": [\r\n                \"Source Sans Pro Bold\"\r\n              ],\r\n              \"text-line-height\": 1,\r\n              \"text-size\": [\r\n                \"interpolate\",\r\n                [\r\n                  \"linear\"\r\n                ],\r\n                [\r\n                  \"zoom\"\r\n                ],\r\n                13, 12,\r\n                17, 22\r\n              ],\r\n              \"text-offset\": [0, 2],\r\n            }}\r\n            paint={{\r\n              \"text-halo-color\": \"hsl(0, 0%, 100%)\",\r\n              \"text-halo-width\": 1,\r\n              \"text-halo-blur\": 1,\r\n              \"text-color\": \"#6a6f73\"\r\n            }}\r\n            onClick={this.clickStop}\r\n          />\r\n          <Layer\r\n            id='lyr_stops_next_visiting'\r\n            type='symbol'\r\n            sourceId='src_stops'\r\n            sourceLayer='stop'\r\n            minZoom={13}\r\n            layout={{\r\n              'text-ignore-placement': false,\r\n              'text-field': ['to-string', ['get', 'next_visiting']],\r\n              \"text-font\": [\r\n                \"Source Sans Pro Bold\"\r\n              ],\r\n              \"text-line-height\": 1,\r\n              \"text-size\": [\r\n                \"interpolate\",\r\n                [\r\n                  \"linear\"\r\n                ],\r\n                [\r\n                  \"zoom\"\r\n                ],\r\n                13, 10,\r\n                17, 16\r\n              ],\r\n              \"text-offset\": [0, -2.8],\r\n            }}\r\n            paint={{\r\n              \"text-halo-color\": \"hsl(0, 0%, 100%)\",\r\n              \"text-halo-width\": 1,\r\n              \"text-halo-blur\": 1,\r\n              \"text-color\": \"#6a6f73\"\r\n            }}\r\n            onClick={this.clickStop}\r\n          />\r\n          {map_settings.authority_boundary ?\r\n            <React.Fragment>\r\n              <Layer\r\n                id='lyr_library_authorities_lines'\r\n                type='line'\r\n                sourceId='src_library_authorities'\r\n                sourceLayer='library_authority_boundaries'\r\n                minZoom={6}\r\n                layout={{\r\n                  \"line-join\": \"round\",\r\n                  \"line-cap\": \"square\"\r\n                }}\r\n                paint={{\r\n                  \"line-color\": \"#a7a39b\",\r\n                  \"line-opacity\": 1,\r\n                  \"line-width\": [\r\n                    \"interpolate\",\r\n                    [\r\n                      \"linear\"\r\n                    ],\r\n                    [\r\n                      \"zoom\"\r\n                    ],\r\n                    6, 1,\r\n                    22, 4\r\n                  ]\r\n                }}\r\n              />\r\n              <Layer\r\n                id='lyr_library_authorities_fill'\r\n                type='fill'\r\n                sourceId='src_library_authorities'\r\n                sourceLayer='library_authority_boundaries'\r\n                minZoom={6}\r\n                paint={{\r\n                  'fill-color': organisation_colour_match,\r\n                  'fill-opacity': 0.1\r\n                }}\r\n              />\r\n            </React.Fragment>\r\n            : null}\r\n          {this.props.current_position && this.props.current_position.length > 1 ?\r\n            <Marker\r\n              key={'mk_me'}\r\n              coordinates={[this.props.current_position[0], this.props.current_position[1]]}>\r\n              <MeAvatar search_type={this.props.search_type} />\r\n            </Marker>\r\n            : null}\r\n          <ZoomControl position=\"bottom-left\" />\r\n        </Map>\r\n        <Tooltip\r\n          title={'Map settings'}\r\n        >\r\n          <Fab\r\n            size=\"small\"\r\n            className={classes.settings}\r\n            color='primary'\r\n            style={{\r\n              color: 'white',\r\n              border: '1px solid #FFFFFF'\r\n            }}\r\n            onClick={() => this.setState({ settings_dialog_open: true })}\r\n          >\r\n            <LayersIcon />\r\n          </Fab>\r\n        </Tooltip>\r\n        <MapSettings\r\n          map_settings={map_settings}\r\n          open={this.state.settings_dialog_open}\r\n          toggleMapSetting={toggleMapSetting}\r\n          close={() => this.setState({ settings_dialog_open: false, settings_dial_open: false })}\r\n        />\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nMobileMap.propTypes = {\r\n  current_position: PropTypes.array\r\n}\r\n\r\nexport default withStyles(styles, { withTheme: true })(MobileMap);","// Axios for making requests\r\nimport axios from 'axios'\r\n\r\nconst config = require('./config.json')\r\n\r\nexport function getQueryStops (query, organisation_filters, mobile_filters, route_filters, current_position, distance, callback) {\r\n  let url = config.api + '/stops?page=' + (query.page + 1) + '&limit=' + query.pageSize\r\n  if (query.orderBy && query.orderBy.field) url = url + '&sort=' + query.orderBy.field + '&direction=' + query.orderDirection\r\n\r\n  if (mobile_filters.length > 0) url = url + '&mobile_ids=' + mobile_filters.join('|')\r\n  if (organisation_filters.length > 0) url = url + '&organisation_ids=' + organisation_filters.join('|')\r\n  if (route_filters.length > 0) url = url + '&route_ids=' + route_filters.join('|')\r\n\r\n  if (current_position && current_position.length > 1) url = url + '&longitude=' + current_position[0] + '&latitude=' + current_position[1]\r\n  if (distance && distance !== '') url = url + '&distance=' + distance\r\n\r\n  axios.get(url)\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback({\r\n          stops: response.data,\r\n          total: parseInt(response.headers['x-total-count']),\r\n          page: parseInt(response.headers['x-page'])\r\n        })\r\n      } else {\r\n        callback({ stops: [], total: 0, page: 1 })\r\n      }\r\n    })\r\n    .catch(() => callback({ stops: [], total: 0, page: 1 }))\r\n}\r\n\r\nexport function getAllStops (callback) {\r\n  axios.get(config.api + '/stops')\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback({})\r\n      }\r\n    })\r\n    .catch(err => callback({}))\r\n}\r\n\r\nexport function getStopById (id, callback) {\r\n  axios.get(config.api + '/stops/' + id)\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback({})\r\n      }\r\n    })\r\n    .catch(() => callback({}))\r\n}\r\n","// React\r\nimport compose from 'recompose/compose';\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Link } from \"react-router-dom\";\r\n\r\n// Material UI\r\nimport Hidden from '@material-ui/core/Hidden';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport withWidth, { isWidthUp, isWidthDown } from '@material-ui/core/withWidth';\r\n\r\n// Material Table\r\nimport MaterialTable from 'material-table';\r\n\r\n// Material UI Styles\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// MUI Icons\r\nimport ArrowUpward from '@material-ui/icons/ArrowUpwardTwoTone';\r\nimport ChevronLeft from '@material-ui/icons/ChevronLeftTwoTone';\r\nimport ChevronRight from '@material-ui/icons/ChevronRightTwoTone';\r\nimport FirstPage from '@material-ui/icons/FirstPageTwoTone';\r\nimport FilterList from '@material-ui/icons/FilterListTwoTone';\r\nimport LastPage from '@material-ui/icons/LastPageTwoTone';\r\nimport MoreVertIcon from '@material-ui/icons/MoreVertTwoTone';\r\nimport EventIcon from '@material-ui/icons/EventTwoTone';\r\nimport PrintIcon from '@material-ui/icons/PrintTwoTone';\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone';\r\n\r\n// Our components\r\nimport Filters from './Filters';\r\n\r\n// Moment\r\nimport moment from 'moment';\r\n\r\n// Our Helpers\r\nimport * as stopsHelper from './helpers/stops';\r\nimport { Tooltip } from '@material-ui/core';\r\n\r\nconst config = require('./helpers/config.json');\r\n\r\nconst styles = (theme) => ({\r\n\tformControl: {\r\n\t\tmargin: theme.spacing(1),\r\n\t\tminWidth: 200\r\n\t},\r\n\tmargin: {\r\n\t\tmargin: theme.spacing(1)\r\n\t},\r\n\troot: {\r\n\t\tflexGrow: 1,\r\n\t\tmaxWidth: '100%'\r\n\t},\r\n\ttable: {\r\n\t\tbackgroundColor: 'rgba(0, 0, 0, 0)',\r\n\t\tborder: '1px solid #E0E0E0'\r\n\t}\r\n});\r\n\r\nclass Stops extends Component {\r\n\r\n\ttableRef = React.createRef();\r\n\r\n\tgetStopCalendar = (stop) => window.open(config.api + '/stops/' + stop.id + '/ics');\r\n\tgetStopPdf = (stop) => window.open(config.api + '/stops/' + stop.id + '/pdf', '_blank');\r\n\tviewMapStop = (stop) => this.props.viewMapStop(stop.longitude, stop.latitude);\r\n\tgoToWebsite = (stop) => window.open(stop.timetable, '_blank');\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (this.props.current_position !== prevProps.current_position || this.props.distance !== prevProps.distance) this.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tsetOrganisationFilter = (organisation_id) => {\r\n\t\tthis.props.setOrganisationFilter(organisation_id);\r\n\t\tthis.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tclearOrganisationFilter = () => {\r\n\t\tthis.props.clearOrganisationFilter();\r\n\t\tthis.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tsetMobileFilter = (mobile_id) => {\r\n\t\tthis.props.setMobileFilter(mobile_id);\r\n\t\tthis.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tclearMobileFilter = () => {\r\n\t\tthis.props.clearMobileFilter();\r\n\t\tthis.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tsetRouteFilter = (route_id) => {\r\n\t\tthis.props.setRouteFilter(route_id);\r\n\t\tthis.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tclearRouteFilter = () => {\r\n\t\tthis.props.clearRouteFilter();\r\n\t\tthis.tableRef.current.onQueryChange();\r\n\t}\r\n\r\n\tdisplayStopInfo = (row) => this.props.viewStop(row);\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tclasses, organisations, organisation_lookup, organisation_filter, viewStopsByOrganisation,\r\n\t\t\tmobiles, mobile_lookup, mobile_filter,\r\n\t\t\troutes, route_lookup, route_filter, current_position, distance, width,\r\n\t\t\tsearch_type, postcode, postcode_district, toggleGPS, postcodeSearch, clearSearch, setDistance } = this.props;\r\n\r\n\t\t// Calculate title\r\n\t\tconst organisation_name = (organisation_filter.length > 0 ? organisation_lookup[organisation_filter[0]].name : '');\r\n\t\tconst mobile_name = (mobile_filter.length > 0 ? mobile_lookup[mobile_filter[0]].name : '');\r\n\t\tconst route_name = (route_filter.length > 0 ? route_lookup[route_filter[0]].name : '');\r\n\t\tlet title = 'All stops';\r\n\t\t// Filter stops\r\n\t\tif (organisation_name !== '') title = 'Stops in ' + organisation_name;\r\n\t\tif (mobile_name !== '') title = 'Stops for ' + organisation_name + ' ' + mobile_name;\r\n\t\tif (route_name !== '') title = 'Stops for ' + organisation_name + ' ' + route_name;\r\n\t\t// Postcode search stops\r\n\t\tif (postcode !== '') title = 'Stops within ' + Math.round(distance / 1609) + ' mile(s) of ' + postcode;\r\n\t\t// GPS search stops\r\n\t\tif (search_type === 'gps') title = 'Stops within ' + Math.round(distance / 1609) + ' mile(s) of your location';\r\n\r\n\t\tlet orgText = {}\r\n\t\tObject.keys(organisation_lookup).forEach(key => {\r\n\t\t\torgText[key] = organisation_lookup[key].name;\r\n\t\t});\r\n\t\tlet mobileText = {}\r\n\t\tObject.keys(mobile_lookup).forEach(key => {\r\n\t\t\tmobileText[key] = mobile_lookup[key].name;\r\n\t\t});\r\n\t\tlet routeText = {}\r\n\t\tObject.keys(route_lookup).forEach(key => {\r\n\t\t\trouteText[key] = route_lookup[key].name;\r\n\t\t});\r\n\t\treturn (\r\n\t\t\t<div style={{ maxWidth: '100%' }}>\r\n\t\t\t\t<Filters\r\n\t\t\t\t\tdisplayStopLink={false}\r\n\t\t\t\t\torganisations={organisations}\r\n\t\t\t\t\torganisation_lookup={organisation_lookup}\r\n\t\t\t\t\torganisation_filter={organisation_filter}\r\n\t\t\t\t\tsetOrganisationFilter={this.setOrganisationFilter}\r\n\t\t\t\t\tclearOrganisationFilter={this.clearOrganisationFilter}\r\n\t\t\t\t\tviewStopsByOrganisation={viewStopsByOrganisation}\r\n\t\t\t\t\tmobiles={mobiles}\r\n\t\t\t\t\tmobile_lookup={mobile_lookup}\r\n\t\t\t\t\tmobile_filter={mobile_filter}\r\n\t\t\t\t\tsetMobileFilter={this.setMobileFilter}\r\n\t\t\t\t\tclearMobileFilter={this.clearMobileFilter}\r\n\t\t\t\t\troutes={routes}\r\n\t\t\t\t\troute_lookup={route_lookup}\r\n\t\t\t\t\troute_filter={route_filter}\r\n\t\t\t\t\tsetRouteFilter={this.setRouteFilter}\r\n\t\t\t\t\tclearRouteFilter={this.clearRouteFilter}\r\n\t\t\t\t\tpostcode={postcode}\r\n\t\t\t\t\tpostcode_district={postcode_district}\r\n\t\t\t\t\tdistance={distance}\r\n\t\t\t\t\tsearch_type={search_type}\r\n\t\t\t\t\tsetDistance={setDistance}\r\n\t\t\t\t\ttoggleGPS={toggleGPS}\r\n\t\t\t\t\tpostcodeSearch={postcodeSearch}\r\n\t\t\t\t\tclearSearch={clearSearch}\r\n\t\t\t\t/>\r\n\t\t\t\t<ListSubheader disableSticky={true}>{title}</ListSubheader>\r\n\t\t\t\t<MaterialTable\r\n\t\t\t\t\ttableRef={this.tableRef}\r\n\t\t\t\t\tcomponents={{\r\n\t\t\t\t\t\tContainer: props => <Paper {...props} elevation={0} className={classes.table} />\r\n\t\t\t\t\t}}\r\n\t\t\t\t\ticons={{\r\n\t\t\t\t\t\tFilter: FilterList,\r\n\t\t\t\t\t\tFirstPage: FirstPage,\r\n\t\t\t\t\t\tLastPage: LastPage,\r\n\t\t\t\t\t\tNextPage: ChevronRight,\r\n\t\t\t\t\t\tPreviousPage: ChevronLeft,\r\n\t\t\t\t\t\tSortArrow: ArrowUpward\r\n\t\t\t\t\t}}\r\n\t\t\t\t\toptions={{\r\n\t\t\t\t\t\tpadding: isWidthUp('sm', width) ? 'default' : 'dense',\r\n\t\t\t\t\t\tsearch: false,\r\n\t\t\t\t\t\tloadingType: 'overlay',\r\n\t\t\t\t\t\tactionsColumnIndex: 0,\r\n\t\t\t\t\t\tfiltering: false,\r\n\t\t\t\t\t\ttoolbar: false,\r\n\t\t\t\t\t\theaderStyle: {\r\n\t\t\t\t\t\t\tbackgroundColor: '#fafafa',\r\n\t\t\t\t\t\t\tcolor: '#737373',\r\n\t\t\t\t\t\t\tborder: '0px'\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tcolumns={[\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttitle: '',\r\n\t\t\t\t\t\t\tfield: 'name',\r\n\t\t\t\t\t\t\tfiltering: false,\r\n\t\t\t\t\t\t\trender: rowData => {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t\t\t\t\t<Tooltip title=\"See more stop details\">\r\n\t\t\t\t\t\t\t\t\t\t\t<IconButton onClick={() => this.displayStopInfo(rowData)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<MoreVertIcon />\r\n\t\t\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t\t<Hidden mdDown>\r\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip title=\"Add event to your device calendar\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<IconButton onClick={() => this.getStopCalendar(rowData)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<EventIcon />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t\t</Hidden>\r\n\t\t\t\t\t\t\t\t\t\t<Hidden mdDown>\r\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip title=\"Download a PDF timetable for this stop\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<IconButton onClick={() => this.getStopPdf(rowData)}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<PrintIcon />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t\t</Hidden>\r\n\t\t\t\t\t\t\t\t\t\t<Hidden mdDown>\r\n\t\t\t\t\t\t\t\t\t\t\t<Tooltip title=\"See this stop on the map\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t<IconButton onClick={() => this.viewMapStop(rowData)} component={Link} to=\"/map\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<LocationOnIcon />\r\n\t\t\t\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t\t\t\t</Tooltip>\r\n\t\t\t\t\t\t\t\t\t\t</Hidden>\r\n\t\t\t\t\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcellStyle: {\r\n\t\t\t\t\t\t\t\tborderBottom: '1px solid #f5f5f5',\r\n\t\t\t\t\t\t\t\tbackgroundColor: '#ffffff'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttitle: 'Name',\r\n\t\t\t\t\t\t\tfield: 'name',\r\n\t\t\t\t\t\t\tfiltering: false,\r\n\t\t\t\t\t\t\thidden: false,\r\n\t\t\t\t\t\t\trender: rowData => {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\trowData.name\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcellStyle: {\r\n\t\t\t\t\t\t\t\tborderBottom: '1px solid #f5f5f5',\r\n\t\t\t\t\t\t\t\tbackgroundColor: '#ffffff'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttitle: 'Community',\r\n\t\t\t\t\t\t\tfield: 'community',\r\n\t\t\t\t\t\t\tfiltering: false,\r\n\t\t\t\t\t\t\tcellStyle: {\r\n\t\t\t\t\t\t\t\tborderBottom: '1px solid #f5f5f5',\r\n\t\t\t\t\t\t\t\tbackgroundColor: '#ffffff'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttitle: 'Library service',\r\n\t\t\t\t\t\t\tfield: 'organisation_name',\r\n\t\t\t\t\t\t\tfiltering: false,\r\n\t\t\t\t\t\t\thidden: isWidthDown('md', width),\r\n\t\t\t\t\t\t\tcellStyle: {\r\n\t\t\t\t\t\t\t\tborderBottom: '1px solid #f5f5f5',\r\n\t\t\t\t\t\t\t\tbackgroundColor: '#ffffff'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\ttitle: 'Next due',\r\n\t\t\t\t\t\t\tfield: 'route_schedule',\r\n\t\t\t\t\t\t\tfiltering: false,\r\n\t\t\t\t\t\t\thidden: isWidthDown('xs', width),\r\n\t\t\t\t\t\t\trender: (rowData) => {\r\n\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\trowData.route_schedule.length > 0 ? moment(rowData.route_schedule[0]).format('Do MMMM h:mma') : ''\r\n\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcellStyle: {\r\n\t\t\t\t\t\t\t\tborderBottom: '1px solid #f5f5f5',\r\n\t\t\t\t\t\t\t\tbackgroundColor: '#ffffff'\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]}\r\n\t\t\t\t\tdata={query =>\r\n\t\t\t\t\t\tnew Promise((resolve, reject) => {\r\n\t\t\t\t\t\t\tstopsHelper.getQueryStops(query, organisation_filter, mobile_filter, route_filter, current_position, distance, stopData => {\r\n\t\t\t\t\t\t\t\tresolve({\r\n\t\t\t\t\t\t\t\t\tdata: stopData.stops,\r\n\t\t\t\t\t\t\t\t\tpage: (stopData.page - 1),\r\n\t\t\t\t\t\t\t\t\ttotalCount: stopData.total,\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nStops.propTypes = {\r\n\tclasses: PropTypes.object.isRequired\r\n}\r\n\r\nexport default compose(withWidth(), withStyles(styles, { withTheme: true }))(Stops);","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport { Link } from \"react-router-dom\";\r\nimport compose from 'recompose/compose';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\n\r\nimport withWidth, { isWidthDown } from '@material-ui/core/withWidth';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\n// MUI Icons\r\nimport EventIcon from '@material-ui/icons/EventTwoTone';\r\nimport PrintIcon from '@material-ui/icons/PrintTwoTone';\r\nimport LocationOnIcon from '@material-ui/icons/LocationOnTwoTone';\r\n\r\n// Moment\r\nimport moment from 'moment';\r\n\r\nconst config = require('./helpers/config.json');\r\n\r\nconst styles = theme => ({\r\n    button: {\r\n        margin: theme.spacing(1)\r\n    },\r\n    dialog: {\r\n        border: '1px solid #E0E0E0'\r\n    },\r\n    leftIcon: {\r\n        marginRight: theme.spacing(1)\r\n    },\r\n    list: {\r\n        width: '100%',\r\n        maxWidth: 360,\r\n        backgroundColor: theme.palette.background.paper\r\n    },\r\n    progress: {\r\n        margin: theme.spacing(2)\r\n    }\r\n});\r\n\r\nclass StopDetails extends React.Component {\r\n    state = {}\r\n\r\n    getStopCalendar = () => window.open(config.api + '/stops/' + this.props.stop.id + '/ics');\r\n    getStopPdf = () => window.open(config.api + '/stops/' + this.props.stop.id + '/pdf', '_blank');\r\n    viewMapStop = () => this.props.viewMapStop(this.props.stop.longitude, this.props.stop.latitude);\r\n    goToWebsite = () => window.open(this.props.stop.timetable, '_blank');\r\n\r\n    close = () => { this.props.close() }\r\n\r\n    render() {\r\n        const { classes, width, stop } = this.props;\r\n        const fullScreen = isWidthDown('sm', width);\r\n        return (\r\n            <Dialog\r\n                fullScreen={fullScreen}\r\n                disableBackdropClick={true}\r\n                open={this.props.open}\r\n                onClose={this.close}\r\n                aria-labelledby=\"dlg-title\"\r\n                BackdropProps={\r\n                    {\r\n                        invisible: true\r\n                    }\r\n                }\r\n                PaperProps={\r\n                    {\r\n                        elevation: 0,\r\n                        className: classes.dialog\r\n                    }\r\n                }\r\n            >\r\n                {stop && stop.route_days ?\r\n                    <React.Fragment>\r\n                        <DialogTitle id=\"dlg-title\">{stop.name + '. ' + stop.community}</DialogTitle>\r\n                        <DialogContent>\r\n                            <ListSubheader>{(stop.route_schedule && stop.route_schedule.length > 0 ? moment(stop.route_schedule[0]).format('dddd Do MMMM h:mma') : '')}</ListSubheader>\r\n                           \r\n                            <br />\r\n                            <Divider />\r\n                            <br />\r\n                            <Button onClick={() => this.getStopCalendar()} className={classes.button} color=\"primary\" startIcon={<EventIcon />}>Calendar</Button>\r\n                            <Button onClick={() => this.getStopPdf()} className={classes.button} color=\"primary\" startIcon={<PrintIcon />}>Timetable</Button>\r\n                            <Button onClick={() => this.viewMapStop()} className={classes.button} color=\"primary\" startIcon={<LocationOnIcon />} component={Link} to=\"/map\">Map</Button>\r\n                        </DialogContent>\r\n                    </React.Fragment> :\r\n                    <CircularProgress className={classes.progress} color=\"secondary\" size={30} />}\r\n                <DialogActions>\r\n                    <Button onClick={() => this.goToWebsite()} color=\"primary\">Website</Button>\r\n                    <Button onClick={() => this.close()} color=\"secondary\">Close</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        );\r\n    }\r\n}\r\n\r\nStopDetails.propTypes = {\r\n    classes: PropTypes.object.isRequired\r\n};\r\n\r\nexport default compose(withWidth(), withStyles(styles, { withTheme: true }))(StopDetails);","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport compose from 'recompose/compose';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport withWidth, { isWidthDown } from '@material-ui/core/withWidth';\r\nimport { withStyles } from '@material-ui/core/styles';\r\n\r\nconst styles = theme => ({\r\n    dialog: {\r\n        border: '1px solid #E0E0E0'\r\n    }\r\n});\r\n\r\nclass TripDetails extends React.Component {\r\n    state = {}\r\n\r\n    close = () => { this.props.close() }\r\n\r\n    render() {\r\n        const { classes, width, trip } = this.props;\r\n        const fullScreen = isWidthDown('sm', width);\r\n        const estimated_duration = Math.round(trip.duration / 60) + ' mins journey time.';\r\n        const distance = Math.round(trip.distance / 1609, 1) + ' mile(s)';\r\n        return (\r\n            <Dialog\r\n                fullScreen={fullScreen}\r\n                disableBackdropClick={true}\r\n                open={this.props.open}\r\n                onClose={this.close}\r\n                BackdropProps={\r\n                    {\r\n                        invisible: true\r\n                    }\r\n                }\r\n                PaperProps={\r\n                    {\r\n                        elevation: 0,\r\n                        className: classes.dialog\r\n                    }\r\n                }\r\n            >\r\n                <DialogTitle>{'Trip details'}</DialogTitle>\r\n                <DialogContent>\r\n                <ListSubheader disableSticky>{'From ' + trip.origin_stop_name + ' to ' + trip.destination_stop_name}</ListSubheader>\r\n                <Typography variant=\"body2\" component=\"p\">{estimated_duration + ' ' + distance}</Typography>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={() => this.close()} color=\"secondary\">Close</Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n        );\r\n    }\r\n}\r\n\r\nTripDetails.propTypes = {\r\n    classes: PropTypes.object.isRequired\r\n};\r\n\r\nexport default compose(withWidth(), withStyles(styles, { withTheme: true }))(TripDetails);","// Axios for making requests\r\nimport axios from 'axios'\r\n\r\n// getCurrentLocation:\r\nexport function getCurrentPosition (callback) {\r\n  var options = {\r\n    enableHighAccuracy: true,\r\n    timeout: 10000,\r\n    maximumAge: 0\r\n  }\r\n  navigator.geolocation.getCurrentPosition((pos) => {\r\n    callback([pos.coords.longitude, pos.coords.latitude])\r\n  }, err => {\r\n    callback([])\r\n  }, options)\r\n};\r\n\r\n// Get postcode data\r\nexport function getPostcode (postcode, callback) {\r\n  axios.get('https://api.postcodes.io/postcodes/' + postcode)\r\n    .then(response => {\r\n      if (response && response.data && response.data.result) {\r\n        callback({\r\n          location: [response.data.result.longitude, response.data.result.latitude],\r\n          admin_district: response.data.result.admin_district\r\n        })\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(err => callback([]))\r\n};\r\n","// Axios for making requests\r\nimport axios from 'axios'\r\n\r\nconst config = require('./config.json')\r\n\r\nexport function getAllOrganisations (callback) {\r\n  axios.get(config.api + '/organisations')\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(err => callback([]))\r\n}\r\n","// Axios for making requests\r\nimport axios from 'axios'\r\n\r\nconst config = require('./config.json')\r\n\r\nexport function getAllRoutes (callback) {\r\n  axios.get(config.api + '/routes')\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(err => callback([]))\r\n}\r\n","// Axios for making requests\r\nimport axios from 'axios'\r\n\r\nconst config = require('./config.json')\r\n\r\nexport function getAllTrips (callback) {\r\n  axios.get(config.api + '/trips')\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback([])\r\n      }\r\n    })\r\n    .catch(() => callback([]))\r\n}\r\n\r\nexport function getTripById (id, callback) {\r\n  axios.get(config.api + '/trips/' + id)\r\n    .then(response => {\r\n      if (response && response.data) {\r\n        callback(response.data)\r\n      } else {\r\n        callback({})\r\n      }\r\n    })\r\n    .catch(() => callback({}))\r\n}\r\n","// React\r\nimport React, { Component } from 'react';\r\n\r\n// Other core stuff\r\nimport PropTypes from 'prop-types';\r\nimport { BrowserRouter, Route } from \"react-router-dom\";\r\n\r\n// Material UI\r\nimport Container from '@material-ui/core/Container';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\n\r\n// Icons\r\nimport CloseIcon from '@material-ui/icons/CloseTwoTone';\r\n\r\n// MUI Style\r\nimport lightBlue from '@material-ui/core/colors/lightBlue';\r\nimport blueGrey from '@material-ui/core/colors/blueGrey';\r\nimport { MuiThemeProvider, createMuiTheme, withStyles } from '@material-ui/core/styles';\r\n\r\n// Our components\r\nimport AppHeader from './AppHeader';\r\nimport Mobiles from './Mobiles';\r\nimport MobileMap from './MobileMap';\r\nimport Stops from './Stops';\r\nimport StopDetails from './StopDetails';\r\nimport TripDetails from './TripDetails';\r\n\r\n// Our helpers\r\nimport * as geoHelper from './helpers/geo';\r\nimport * as mobilesHelper from './helpers/mobiles';\r\nimport * as organisationsHelper from './helpers/organisations';\r\nimport * as routesHelper from './helpers/routes';\r\nimport * as stopsHelper from './helpers/stops';\r\nimport * as tripsHelper from './helpers/trips';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    primary: lightBlue,\r\n    secondary: blueGrey\r\n  },\r\n  overrides: {\r\n    MuiButton: {\r\n      text: {\r\n        textTransform: 'none'\r\n      }\r\n    },\r\n    MuiTab: {\r\n      root: {\r\n        textTransform: 'none'\r\n      }\r\n    },\r\n    MuiTableCell: {\r\n      root: {\r\n        borderBottom: 'none'\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nconst styles = theme => ({\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(2)\r\n  },\r\n  root: {\r\n    flexGrow: 1\r\n  }\r\n});\r\n\r\nclass App extends Component {\r\n  state = {\r\n    // Stop dialog\r\n    stop_dialog_open: false,\r\n    current_stop: {},\r\n    // Trip dialog\r\n    trip_dialog_open: false,\r\n    current_trip: {},\r\n    // Organisation data\r\n    organisations: [],\r\n    organisation_lookup: {},\r\n    organisation_filter: [],\r\n    // Mobile data\r\n    mobiles: [],\r\n    mobile_lookup: {},\r\n    mobile_filter: [],\r\n    mobile_locations: [],\r\n    mobile_location_lookup: {},\r\n    mobiles_nearest: [],\r\n    mobiles_nearest_lookup: {},\r\n    mobile_location_timer: null,\r\n    // Route data\r\n    routes: [],\r\n    route_lookup: {},\r\n    route_filter: [],\r\n    // Map view settings\r\n    fit_bounds: null,\r\n    position: [-2.1000, 53.6138],\r\n    zoom: [7],\r\n    pitch: [0],\r\n    bearing: [0],\r\n    // Search\r\n    search_type: '', // search types can be gps, postcode, service\r\n    distance: 1609,\r\n    postcode: '',\r\n    // GPS\r\n    current_position: [],\r\n    position_update_interval: '',\r\n    map_settings: {\r\n      authority_boundary: false\r\n    },\r\n    // Loading indicators\r\n    loading_gps: true,\r\n    loading_mobiles: false,\r\n    loading_organisations: false,\r\n    loading_postcode: true,\r\n    loading_routes: false,\r\n    // Snackbar\r\n    snackbar_open: false,\r\n    snackbar_message: ''\r\n  };\r\n\r\n  getOrganisations = () => {\r\n    this.setState({ loading_organisations: true });\r\n    organisationsHelper.getAllOrganisations(organisations => {\r\n      let organisation_lookup = {};\r\n      organisations.forEach(organisation => organisation_lookup[organisation.id] = organisation);\r\n      this.setState({ organisations: organisations, organisation_lookup: organisation_lookup, loading_organisations: false })\r\n    });\r\n  }\r\n\r\n  getMobiles = () => {\r\n    this.setState({ loading_mobiles: true });\r\n    mobilesHelper.getAllMobiles(mobiles => {\r\n      let mobile_lookup = {};\r\n      mobiles.forEach(mobile => mobile_lookup[mobile.id] = mobile);\r\n      this.setState({ mobiles: mobiles, mobile_lookup: mobile_lookup, loading_mobiles: false });\r\n    });\r\n  }\r\n\r\n  getRoutes = () => {\r\n    this.setState({ loading_routes: true });\r\n    routesHelper.getAllRoutes(routes => {\r\n      let route_lookup = {};\r\n      routes.forEach(route => route_lookup[route.id] = route);\r\n      this.setState({ routes: routes, route_lookup: route_lookup, loading_routes: false });\r\n    });\r\n  }\r\n\r\n  getMobileLocations = () => {\r\n    mobilesHelper.getMobileLocations(locations => {\r\n      let mobile_location_lookup = {};\r\n      locations.forEach(location => mobile_location_lookup[location.mobile_id] = location);\r\n      this.setState({ mobile_locations: locations, mobile_location_lookup: mobile_location_lookup });\r\n    });\r\n  }\r\n\r\n  getMobilesNearest = () => {\r\n    mobilesHelper.getMobilesNearest(this.state.current_position, this.state.distance, mobiles => {\r\n      let mobiles_nearest_lookup = {};\r\n      mobiles.forEach(mobile => mobiles_nearest_lookup[mobile.mobile_id] = mobile);\r\n      this.setState({ mobiles_nearest: mobiles, mobiles_nearest_lookup: mobiles_nearest_lookup });\r\n    });\r\n  }\r\n\r\n  componentDidMount = () => {\r\n    this.getOrganisations();\r\n    this.getMobiles();\r\n    this.getRoutes();\r\n    this.getMobileLocations();\r\n    // Set up a timer for the mobile locations\r\n    const mobile_location_timer = setInterval(() => {\r\n      this.getMobileLocations();\r\n    }, 15000);\r\n    this.setState({ mobile_location_timer: mobile_location_timer });\r\n  }\r\n\r\n  viewStop = (stop) => {\r\n    // First open the dialog\r\n    this.openStopDialog(stop);\r\n    // We may or may not have a complete stop object.\r\n    // If calling from the stop table we do - if not we don't, all we have is ID\r\n    if (!stop.name) {\r\n      stopsHelper.getStopById(stop.id, stop => {\r\n        this.setState({ current_stop: stop })\r\n      });\r\n    }\r\n  }\r\n  openStopDialog = (stop) => this.setState({ current_stop: stop, stop_dialog_open: true });\r\n  closeStopDialog = () => this.setState({ stop_dialog_open: false });\r\n\r\n  viewTrip = (trip) => {\r\n    // First open the dialog\r\n    this.openTripDialog(trip);\r\n    tripsHelper.getTripById(trip.id, trip => {\r\n      this.setState({ current_trip: trip })\r\n    });\r\n  }\r\n  openTripDialog = (trip) => this.setState({ current_trip: trip, trip_dialog_open: true });\r\n  closeTripDialog = () => this.setState({ trip_dialog_open: false });\r\n\r\n  viewStopsByOrganisation = (organisation_id) => this.setState({ page: 'stops', organisation_filter: [organisation_id], mobile_filter: [], route_filter: [] });\r\n  viewStopsByMobile = (organisation_id, mobile_id) => this.setState({ page: 'stops', organisation_filter: [organisation_id], mobile_filter: [mobile_id], route_filter: [] });\r\n  viewStopsByRoute = (organisation_id, mobile_id, route_id) => this.setState({ page: 'stops', organisation_filter: [organisation_id], mobile_filter: [mobile_id], route_filter: [route_id] });\r\n  clearMobileFilter = () => this.setState({ mobile_filter: [], route_filter: [] });\r\n  clearRouteFilter = () => this.setState({ route_filter: [] });\r\n  clearOrganisationFilter = () => this.setState({ organisation_filter: [], mobile_filter: [], route_filter: [] });\r\n\r\n  viewMapStop = (longitude, latitude) => this.setState({ page: 'map', position: [longitude, latitude], zoom: [15], stop_dialog_open: false });\r\n\r\n  logPosition = (fit = false) => {\r\n    this.setState({ loading_gps: true });\r\n    geoHelper.getCurrentPosition(position => {\r\n      if (position.length === 2) {\r\n        this.getMobilesNearest();\r\n        this.setState({ current_position: position, position: position, zoom: [12], loading_gps: false });\r\n      } else {\r\n        clearInterval(this.state.position_update_interval);\r\n        this.setState({ search_type: '', postcode: '', current_position: [], position_update_interval: null, snackbar_open: true, snackbar_message: 'Could not fetch current location' });\r\n      }\r\n    });\r\n  }\r\n\r\n  setDistance = (distance) => this.setState({ distance: distance });\r\n\r\n  clearSearch = () => {\r\n    this.setState({ postcode: '', current_position: [], search_type: '', organisation_filter: [], mobile_filter: [], route_filter: [] });\r\n  }\r\n\r\n  // postcodeSearch\r\n  postcodeSearch = (postcode) => {\r\n\r\n    if (postcode === '') {\r\n      this.setState({ snackbar_open: true, snackbar_message: 'You must enter a postcode' });\r\n      return;\r\n    }\r\n\r\n    let new_state = { search_type: 'postcode', loading_postcode: true, postcode: postcode, organisation_filter: [], mobile_filter: [], route_filter: [] };\r\n\r\n    // If we're already tracking GPS then turn this off\r\n    if (this.state.search_type === 'gps') {\r\n      clearInterval(this.state.position_update_interval);\r\n      new_state.position_update_interval = null;\r\n    }\r\n\r\n    // Get the postcode\r\n    geoHelper.getPostcode(postcode, postcode_data => {\r\n      if (postcode_data.location && postcode_data.location.length === 2) {\r\n        new_state.search_type = 'postcode';\r\n        new_state.current_position = postcode_data.location;\r\n        new_state.position = postcode_data.location;\r\n        new_state.zoom = [11];\r\n        new_state.loading_postcode = false;\r\n        this.setState(new_state);\r\n        this.getMobilesNearest();\r\n      } else {\r\n        this.setState({ snackbar_open: true, snackbar_message: 'Could not find postcode' });\r\n      }\r\n    });\r\n  }\r\n\r\n  // toggleGPS\r\n  toggleGPS = () => {\r\n    // If we're already tracking GPS then turn this off\r\n    if (this.state.search_type === 'gps') {\r\n      clearInterval(this.state.position_update_interval);\r\n      this.setState({ search_type: '', postcode: '', current_position: [], position_update_interval: null });\r\n    } else {\r\n      let position_update_interval = setInterval(this.logPosition, 10000);\r\n      this.setState({ position_update_interval: position_update_interval, search_type: 'gps', postcode: '', organisation_filter: [], mobile_filter: [], route_filter: [] });\r\n      this.logPosition(true);\r\n    }\r\n  }\r\n\r\n  toggleMapSetting = (setting) => {\r\n    let map_settings = this.state.map_settings;\r\n    const current_setting = this.state.map_settings[setting];\r\n    map_settings[setting] = !current_setting;\r\n    this.setState({ map_settings: map_settings });\r\n  }\r\n\r\n  closeSnackbar = (event, reason) => {\r\n    if (reason === 'clickaway') return;\r\n    this.setState({ snackbar_open: false });\r\n  };\r\n\r\n  render() {\r\n    const { classes } = this.props;\r\n    return (\r\n      <MuiThemeProvider theme={theme}>\r\n        <BrowserRouter>\r\n          <div className={classes.root}>\r\n            <CssBaseline />\r\n            <AppHeader\r\n              loading={this.state.loading_mobiles || this.state.loading_organisations || this.state.loading_routes}\r\n              postcode={this.state.postcode}\r\n              distance={this.state.distance}\r\n              search_type={this.state.search_type}\r\n              setDistance={this.setDistance}\r\n              toggleGPS={this.toggleGPS}\r\n              postcodeSearch={this.postcodeSearch}\r\n              clearSearch={this.clearSearch}\r\n            />\r\n            <Container maxWidth=\"lg\">\r\n              <main className={classes.content}>\r\n                <Route\r\n                  path='/'\r\n                  exact\r\n                  render={() => {\r\n                    return (\r\n                      <Mobiles\r\n                        mobiles={this.state.mobiles}\r\n                        mobile_lookup={this.state.mobile_lookup}\r\n                        mobile_location_lookup={this.state.mobile_location_lookup}\r\n                        mobiles_nearest_lookup={this.state.mobiles_nearest_lookup}\r\n                        organisation_lookup={this.state.organisation_lookup}\r\n                        viewStop={this.viewStop}\r\n                        viewStopsByMobile={this.viewStopsByMobile}\r\n                        viewStopsByOrganisation={this.viewStopsByOrganisation}\r\n                        organisations={this.state.organisations}\r\n                        organisation_filter={this.state.organisation_filter}\r\n                        setOrganisationFilter={(organisation_id) => { this.setState({ organisation_filter: [organisation_id] }) }}\r\n                        clearOrganisationFilter={this.clearOrganisationFilter}\r\n                        mobile_filter={this.state.mobile_filter}\r\n                        setMobileFilter={(mobile_id) => { this.setState({ mobile_filter: [mobile_id] }) }}\r\n                        clearMobileFilter={this.clearMobileFilter}\r\n                        routes={this.state.routes}\r\n                        route_lookup={this.state.route_lookup}\r\n                        route_filter={this.state.route_filter}\r\n                        setRouteFilter={(route_id) => { this.setState({ route_filter: [route_id] }) }}\r\n                        clearRouteFilter={this.clearRouteFilter}\r\n                        postcode={this.state.postcode}\r\n                        distance={this.state.distance}\r\n                        search_type={this.state.search_type}\r\n                        setDistance={this.setDistance}\r\n                        toggleGPS={this.toggleGPS}\r\n                        postcodeSearch={this.postcodeSearch}\r\n                        clearSearch={this.clearSearch}\r\n                      />)\r\n                  }}\r\n                />\r\n                <Route\r\n                  path='/stops'\r\n                  render={() => {\r\n                    return (\r\n                      <Stops\r\n                        organisations={this.state.organisations}\r\n                        organisation_lookup={this.state.organisation_lookup}\r\n                        organisation_filter={this.state.organisation_filter}\r\n                        setOrganisationFilter={(organisation_id) => { this.setState({ organisation_filter: [organisation_id] }) }}\r\n                        clearOrganisationFilter={this.clearOrganisationFilter}\r\n                        mobiles={this.state.mobiles}\r\n                        mobile_lookup={this.state.mobile_lookup}\r\n                        mobile_filter={this.state.mobile_filter}\r\n                        setMobileFilter={(mobile_id) => { this.setState({ mobile_filter: [mobile_id] }) }}\r\n                        clearMobileFilter={this.clearMobileFilter}\r\n                        routes={this.state.routes}\r\n                        route_lookup={this.state.route_lookup}\r\n                        route_filter={this.state.route_filter}\r\n                        setRouteFilter={(route_id) => { this.setState({ route_filter: [route_id] }) }}\r\n                        clearRouteFilter={this.clearRouteFilter}\r\n                        viewStop={this.viewStop}\r\n                        viewMapStop={this.viewMapStop}\r\n                        current_position={this.state.current_position}\r\n                        postcode={this.state.postcode}\r\n                        distance={this.state.distance}\r\n                        search_type={this.state.search_type}\r\n                        setDistance={this.setDistance}\r\n                        toggleGPS={this.toggleGPS}\r\n                        postcodeSearch={this.postcodeSearch}\r\n                        clearSearch={this.clearSearch}\r\n                      />)\r\n                  }}\r\n                />\r\n                <Route\r\n                  path='/map'\r\n                  render={() => {\r\n                    return (\r\n                      <MobileMap\r\n                        bearing={this.state.bearing}\r\n                        fit_bounds={this.state.fit_bounds}\r\n                        pitch={this.state.pitch}\r\n                        position={this.state.position}\r\n                        current_position={this.state.current_position}\r\n                        zoom={this.state.zoom}\r\n                        search_type={this.state.search_type}\r\n                        mobile_lookup={this.state.mobile_lookup}\r\n                        mobile_locations={this.state.mobile_locations.filter(l => l.geox !== null)}\r\n                        organisations={this.state.organisations}\r\n                        organisation_lookup={this.state.organisation_lookup}\r\n                        map_settings={this.state.map_settings}\r\n                        toggleMapSetting={this.toggleMapSetting}\r\n                        viewStop={this.viewStop}\r\n                        viewTrip={this.viewTrip}\r\n                      />)\r\n                  }}\r\n                />\r\n              </main>\r\n            </Container>\r\n            <StopDetails\r\n              stop={this.state.current_stop}\r\n              open={this.state.stop_dialog_open}\r\n              close={() => this.closeStopDialog()}\r\n              viewMapStop={this.viewMapStop}\r\n            />\r\n            <TripDetails\r\n              trip={this.state.current_trip}\r\n              open={this.state.trip_dialog_open}\r\n              close={() => this.closeTripDialog()}\r\n            />\r\n            <Snackbar\r\n              anchorOrigin={{\r\n                vertical: 'bottom',\r\n                horizontal: 'left'\r\n              }}\r\n              open={this.state.snackbar_open}\r\n              autoHideDuration={4000}\r\n              onClose={this.closeSnackbar}\r\n              ContentProps={{\r\n                'aria-describedby': 'message-id',\r\n              }}\r\n              message={<span id=\"message-id\">{this.state.snackbar_message}</span>}\r\n              action={[\r\n                <IconButton\r\n                  key=\"close\"\r\n                  aria-label=\"close\"\r\n                  color=\"inherit\"\r\n                  className={classes.close}\r\n                  onClick={this.closeSnackbar}\r\n                >\r\n                  <CloseIcon />\r\n                </IconButton>\r\n              ]}\r\n            />\r\n          </div>\r\n        </BrowserRouter>\r\n      </MuiThemeProvider>\r\n    );\r\n  }\r\n}\r\n\r\nApp.propTypes = {\r\n  classes: PropTypes.object.isRequired\r\n}\r\n\r\nexport default withStyles(styles)(App);","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n)\r\n\r\nexport function register (config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config)\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          )\r\n        })\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nfunction registerValidSW (swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing\r\n        if (installingWorker == null) {\r\n          return\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              )\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration)\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.')\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error)\r\n    })\r\n}\r\n\r\nfunction checkValidServiceWorker (swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type')\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload()\r\n          })\r\n        })\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config)\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      )\r\n    })\r\n}\r\n\r\nexport function unregister () {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister()\r\n    })\r\n  }\r\n}\r\n","import 'react-app-polyfill/ie11'\r\nimport 'react-app-polyfill/stable'\r\n\r\nimport React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\n// Our app entry point\r\nimport App from './App'\r\n\r\n// Service worker for PWA behaviour\r\nimport * as serviceWorker from './serviceWorker'\r\n\r\nReactDOM.render(<App />, document.getElementById('root'))\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister()\r\n"],"sourceRoot":""}