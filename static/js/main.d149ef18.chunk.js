(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(e){e.exports={api:"https://api.mobilelibraries.org"}},288:function(e,t,a){e.exports=a(388)},388:function(e,t,a){"use strict";a.r(t);var o=a(0),n=a.n(o),i=a(13),r=a.n(i),l=a(27),s=a(28),c=a(30),u=a(29),p=a(31),m=a(258),g=a(234),h=a(283),f=a.n(h),d=a(284),b=a.n(d),_=a(120),v=a(256),y=a(4),E=a(122),O=a(2),k=a(215),S=a(217),j=a(216),F=a(190),x=a(263),M=a.n(x),w=a(133),C=a.n(w),R=a(264),N=a.n(R),B=a(214),P=a(213),z=a(145),I=a(210),T=a(198),A=a(212),D=a(97),L=a(262),W=a.n(L),G=a(261),H=a.n(G),Q=a(260),Z=a.n(Q),J=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={postcode:"",distance:1609},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.gps_available,i=t.search_type,r=t.postcodeSearch,l=t.toggleGPS;return n.a.createElement("div",{className:a.search},n.a.createElement(z.a,{placeholder:"Postcode",classes:{root:a.inputRoot,input:a.inputInput},value:this.state.postcode,onChange:function(t){return e.setState({postcode:t.target.value})}}),n.a.createElement(T.a,{value:this.state.distance,onChange:function(t){e.setState({distance:t.target.value})},input:n.a.createElement(z.a,{name:"sel-miles",id:"sel-miles"})},n.a.createElement(I.a,{value:1609},"1 mi"),n.a.createElement(I.a,{value:3219},"2 mi"),n.a.createElement(I.a,{value:4828},"3 mi"),n.a.createElement(I.a,{value:8047},"5 mi")),n.a.createElement(A.a,{title:"Search by postcode"},n.a.createElement(P.a,{className:a.iconButton,onClick:function(){return r(e.state.postcode,e.state.distance)}},n.a.createElement(Z.a,null))),n.a.createElement(B.a,{className:a.divider}),o?n.a.createElement(A.a,{title:"Track my location"},n.a.createElement(P.a,{className:a.iconButton,color:"secondary",onClick:function(){e.setState({postcode:""}),l()}},o&&"gps"===i?n.a.createElement(H.a,null):n.a.createElement(W.a,null))):null)}}]),t}(n.a.Component),$=Object(y.a)(function(e){return{divider:{width:1,height:28,margin:8},iconButton:{padding:10},inputRoot:{color:"inherit"},inputInput:{paddingTop:e.spacing(),paddingRight:e.spacing(),paddingBottom:e.spacing(),paddingLeft:e.spacing(2),width:100},search:{position:"relative",border:"1px solid #e5e5e5",borderRadius:e.shape.borderRadius,backgroundColor:Object(D.fade)(e.palette.common.white,.8),"&:hover":{backgroundColor:Object(D.fade)(e.palette.common.white,.9)},marginLeft:0,marginRight:e.spacing(),display:"flex"}}})(J),q=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.drawer_open,i=t.search_type,r=t.gps_available,l=t.toggleGPS,s=t.postcodeSearch;return n.a.createElement(k.a,{position:"fixed",color:"inherit",elevation:0,className:Object(O.a)(a.appBar,Object(E.a)({},a.appBarShift,o))},n.a.createElement(j.a,null,n.a.createElement(F.a,{variant:"h6",noWrap:!0},"Mobile Libraries"),n.a.createElement("div",{className:a.grow}),n.a.createElement($,{search_type:i,gps_available:r,toggleGPS:l,postcodeSearch:s}),n.a.createElement(S.a,{color:"secondary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("mobiles")}},n.a.createElement(M.a,{className:a.leftIcon}),"Mobile dashboard"),n.a.createElement(S.a,{color:"secondary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("stops")}},n.a.createElement(C.a,{className:a.leftIcon}),"Find a stop"),n.a.createElement(S.a,{color:"secondary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("map")}},n.a.createElement(N.a,{className:a.leftIcon}),"Map")))}}]),t}(o.Component),K=Object(y.a)(function(e){return{appBar:{zIndex:e.zIndex.drawer+1,backgroundColor:"rgba(255, 255, 255, 0)"},grow:{flexGrow:1},hide:{display:"none"},leftIcon:{marginRight:e.spacing(1)}}},{withTheme:!0})(q),U=a(218),V=a(231),X=a(219),Y=a(221),ee=a(220),te=a(257),ae=a(119),oe=a(265),ne=a.n(oe),ie=a(134),re=a.n(ie),le=a(266),se=a.n(le),ce=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={organisation_menu_anchor:null,mobile_menu_anchor:null,route_menu_anchor:null},a.openOrganisationMenu=function(e){a.setState({organisation_menu_anchor:e})},a.closeOrganisationMenu=function(){a.setState({organisation_menu_anchor:null})},a.chooseOrganisation=function(e){a.props.setOrganisationFilter(e),a.closeOrganisationMenu()},a.openMobileMenu=function(e){a.setState({mobile_menu_anchor:e})},a.closeMobileMenu=function(){a.setState({mobile_menu_anchor:null})},a.chooseMobile=function(e){a.props.setMobileFilter(e),a.closeMobileMenu()},a.openRouteMenu=function(e){a.setState({route_menu_anchor:e})},a.closeRouteMenu=function(){a.setState({route_menu_anchor:null})},a.chooseRoute=function(e){a.props.setRouteFilter(e),a.closeRouteMenu()},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.organisations,i=t.organisation_lookup,r=t.organisation_filter,l=t.clearOrganisationFilter,s=t.mobiles,c=t.mobile_lookup,u=t.mobile_filter,p=t.clearMobileFilter,m=t.routes,g=t.route_lookup,h=t.route_filter,f=t.clearRouteFilter,d=n.a.createElement("span",{className:a.bullet},"\u2022");return n.a.createElement(U.a,{className:a.grid,container:!0,spacing:3},n.a.createElement(U.a,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2},n.a.createElement(X.a,{className:a.card,elevation:0},n.a.createElement(ee.a,null,n.a.createElement(F.a,{className:a.title,color:"textSecondary",gutterBottom:!0},o.length+" library services",d,s.length+" mobile libraries",d,m.length+" routes")),n.a.createElement(Y.a,null,0===r.length?n.a.createElement(A.a,{title:"Choose library service"},n.a.createElement(S.a,{size:"small",color:"secondary",className:a.button,onClick:function(t){return e.openOrganisationMenu(t.currentTarget)}},n.a.createElement(ne.a,{className:a.leftIcon}),"Service")):n.a.createElement(te.a,{size:"small",color:"secondary",onDelete:l,label:i[r[0]].name}),r.length>0?0===u.length?n.a.createElement(A.a,{title:"Choose mobile library"},n.a.createElement(S.a,{size:"small",color:"secondary",className:a.button,onClick:function(t){return e.openMobileMenu(t.currentTarget)}},n.a.createElement(re.a,{className:a.leftIcon}),"Mobile")):n.a.createElement(te.a,{size:"small",color:"secondary",onDelete:function(e){return p()},label:c[u[0]].name}):null,u.length>0?0===h.length?n.a.createElement(A.a,{title:"Choose route"},n.a.createElement(S.a,{size:"small",color:"secondary",className:a.button,onClick:function(t){return e.openRouteMenu(t.currentTarget)}},n.a.createElement(se.a,{className:a.leftIcon}),"Route")):n.a.createElement(te.a,{size:"small",color:"secondary",onDelete:function(e){return f()},label:g[h[0]].name}):null))),n.a.createElement(ae.a,{id:"menu-library-service",anchorEl:this.state.organisation_menu_anchor,keepMounted:!0,open:Boolean(this.state.organisation_menu_anchor),onClose:function(){return e.closeOrganisationMenu()}},o.sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return n.a.createElement(I.a,{key:"mnu_itm_org_"+t.id,onClick:function(){return e.chooseOrganisation(t.id)}},t.name)})),n.a.createElement(ae.a,{id:"menu-mobile-library",anchorEl:this.state.mobile_menu_anchor,keepMounted:!0,open:Boolean(this.state.mobile_menu_anchor),onClose:function(){return e.closeMobileMenu()}},s.filter(function(e){var t=!0;return r.length>0&&-1===r.indexOf(e.organisation_id)&&(t=!1),t}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return n.a.createElement(I.a,{key:"mnu_itm_mob_"+t.id,onClick:function(){return e.chooseMobile(t.id)}},t.name)})),n.a.createElement(ae.a,{id:"menu-route",anchorEl:this.state.route_menu_anchor,keepMounted:!0,open:Boolean(this.state.route_menu_anchor),onClose:function(){return e.closeRouteMenu()}},m.filter(function(e){var t=!0;return u.length>0&&-1===u.indexOf(e.mobile_id)&&(t=!1),t}).sort(function(e,t){return e.name.localeCompare(t.name)}).map(function(t){return n.a.createElement(I.a,{key:"mnu_itm_route_"+t.id,onClick:function(){return e.chooseRoute(t.id)}},t.name)})))}}]),t}(o.Component),ue=Object(y.a)(function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},card:{position:"relative",minWidth:275,border:"1px solid rgba(0, 0, 0, 0.12)"},grid:{marginBottom:10},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500}}},{withTheme:!0})(ce),pe=a(135),me=a.n(pe),ge=a(56),he=a.n(ge),fe=a(33),de=a.n(fe),be=a(149),_e=a.n(be),ve=a(102);function ye(e,t){var a={label:"Not out today"},o={label:"Arriving at %s %s"},n={label:"At %s for %s"},i={label:"Arriving at %s %s"},r={label:"Finished for the day"};if(t&&!t.current_stop_id&&!t.previous_stop_id&&t.next_stop_id&&de()(t.next_stop_arrival).isSame(de()(),"day")){var l=de()(t.next_stop_arrival).fromNow();return _e.a.format(o.label,t.next_stop_name,l)}if(t&&t.current_stop_id){var s=de()(t.current_stop_departure).fromNow(!0);return _e.a.format(n.label,t.current_stop_name,s)}if(t&&!t.current_stop_id&&t.previous_stop_id&&t.next_stop_id&&de()(t.previous_stop_departure).isSame(de()(),"day")&&de()(t.next_stop_arrival).isSame(de()(),"day")){var c=de()(t.next_stop_arrival).fromNow();return _e.a.format(i.label,t.next_stop_name,c)}return t&&t.previous_stop_id&&t.next_stop_id&&de()(t.previous_stop_departure).isSame(de()(),"day")&&!de()(t.next_stop_arrival).isSame(de()(),"day")?r.label:a.label}var Ee=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.mobile,i=t.organisation,r=ye(0,t.location),l=n.a.createElement("span",{className:a.bullet},"\u2022");return n.a.createElement(X.a,{className:a.card,elevation:0},n.a.createElement(ee.a,null,n.a.createElement(F.a,{className:a.title,color:"textSecondary",gutterBottom:!0},i?i.name:"",l,o.number_routes+" route"+(o.number_routes>1?"s":""),l,o.number_stops+" stop"+(o.number_stops>1?"s":"")),n.a.createElement(F.a,{variant:"h6",component:"h2"},o.name),n.a.createElement(te.a,{size:"small",color:"secondary",label:r})),n.a.createElement(B.a,{variant:"middle"}),n.a.createElement(Y.a,null,n.a.createElement(A.a,{title:"Mobile library stops"},n.a.createElement(S.a,{size:"small",color:"secondary",className:a.button,onClick:function(){return e.props.viewStopsByMobile(o.id)}},n.a.createElement(C.a,{className:a.leftIcon}),"Stops")),n.a.createElement(B.a,{className:a.verticalDivider}),n.a.createElement(A.a,{title:"Download PDF timetable for mobile"},n.a.createElement(P.a,null,n.a.createElement(me.a,null))),n.a.createElement(B.a,{className:a.verticalDivider})))}}]),t}(o.Component),Oe=Object(y.a)(function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},card:{minWidth:275,border:"1px solid rgba(0, 0, 0, 0.12)"},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500},verticalDivider:{width:1,height:28,margin:8}}},{withTheme:!0})(Ee),ke=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.organisations,i=t.organisation_lookup,r=t.organisation_filter,l=t.setOrganisationFilter,s=t.clearOrganisationFilter,c=t.viewStopsByOrganisation,u=t.mobiles,p=t.mobile_lookup,m=t.mobile_location_lookup,g=t.mobile_filter,h=t.setMobileFilter,f=t.clearMobileFilter,d=t.routes,b=t.route_lookup,_=t.route_filter,v=t.setRouteFilter,y=t.clearRouteFilter;return n.a.createElement("div",{className:a.root},n.a.createElement(ue,{displayStopLink:!0,organisations:o,organisation_lookup:i,organisation_filter:r,setOrganisationFilter:l,clearOrganisationFilter:s,viewStopsByOrganisation:c,mobiles:u,mobile_lookup:p,mobile_filter:g,setMobileFilter:h,clearMobileFilter:f,routes:d,route_lookup:b,route_filter:_,setRouteFilter:v,clearRouteFilter:y}),n.a.createElement(V.a,{disableSticky:!0},"Library dashboard"),n.a.createElement(U.a,{container:!0,spacing:3},u.filter(function(e){var t=!0;return r.length>0&&-1===r.indexOf(e.organisation_id)&&(t=!1),g.length>0&&-1===g.indexOf(e.id)&&(t=!1),t}).map(function(t,a){return n.a.createElement(U.a,{key:"grd_"+t.name.replace(" ","")+"_"+a,item:!0,xs:12,sm:6,md:4,lg:3,xl:2},n.a.createElement(Oe,{mobile:t,location:m[t.id],organisation:i[t.organisation_id],viewStopsByMobile:e.props.viewStopsByMobile}))})))}}]),t}(o.Component),Se=Object(y.a)(function(){return{root:{flexGrow:1}}})(ke),je=a(72),Fe=a(154),xe=a(268),Me=a.n(xe),we=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.classes;return n.a.createElement(A.a,{title:"Me"},n.a.createElement(Fe.a,{className:"gps"===this.props.search_type?e.avatarOn:e.avatar},n.a.createElement(Me.a,null)))}}]),t}(n.a.Component),Ce=Object(y.a)(function(e){return{avatar:{margin:0},avatarOn:{margin:0,cursor:"pointer",backgroundColor:e.palette.primary.main}}},{withTheme:!0})(we),Re=a(232),Ne=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=(e.tooltips,e.location);e.mobile;return n.a.createElement(A.a,{title:ye(0,a)},n.a.createElement(Re.a,{size:"small",color:"primary",className:t.fab},n.a.createElement(re.a,null)))}}]),t}(o.Component),Be=Object(y.a)(function(e){return{fab:{margin:e.spacing(1),boxShadow:"none"}}},{withTheme:!0})(Ne),Pe=Object(je.e)({minZoom:5,maxZoom:18,scrollZoom:!0,interactive:!0,dragRotate:!0,attributionControl:!0}),ze=["https://api.mobilelibraries.org/api/stops/{z}/{x}/{y}.mvt"],Ie=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={time_update_interval:null,current_time:null},a.componentDidMount=function(){var e=setInterval(a.setCurrentTime,500);a.setState({time_update_interval:e})},a.setCurrentTime=function(){return a.setState({current_time:de()()})},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.position,o=t.zoom,i=t.pitch,r=t.bearing,l=t.fit_bounds,s=t.mobile_locations,c=t.mobile_lookup;return n.a.createElement(Pe,{style:"style.json",center:a,zoom:o,maxZoom:17,pitch:i,bearing:r,fitBounds:l,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"}},s&&s.length>0?s.map(function(t){var a=[t.geox,t.geoy];if(e.state.current_time&&t.route_section&&t.route_section.coordinates&&t.updated){var o=de()(e.state.current_time).diff(t.updated),i=Math.round(o/500),r=t.route_section.coordinates;r.length>i&&i>0&&(a=r[i]),r.length<=i&&i>0&&(a=r[r.length-1])}return n.a.createElement(je.b,{key:"mkr_"+t.id,coordinates:a,anchor:"bottom"},n.a.createElement(Be,{mobile:c[t.mobile_id],location:t}))}):null,n.a.createElement(je.c,{id:"src_stops",tileJsonSource:{type:"vector",tiles:ze}}),n.a.createElement(je.a,{id:"lyr_stops_circles",type:"circle",sourceId:"src_stops",sourceLayer:"stop",layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],5,2,17,10],"circle-color":"#607d8b","circle-stroke-width":["interpolate",["linear"],["zoom"],5,1,14,2],"circle-stroke-color":"#FFFFFF","circle-opacity":.8}}),n.a.createElement(je.a,{id:"lyr_stops_labels",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","name"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,10,17,22],"text-offset":[0,1.7]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"}}),this.props.current_position&&this.props.current_position.length>1?n.a.createElement(je.b,{key:"mk_me",coordinates:[this.props.current_position[0],this.props.current_position[1]]},n.a.createElement(Ce,{search_type:this.props.search_type})):null,n.a.createElement(je.d,{position:"bottom-right"}))}}]),t}(o.Component),Te=a(91),Ae=a(269),De=a.n(Ae),Le=a(282),We=a.n(Le),Ge=a(281),He=a.n(Ge),Qe=a(280),Ze=a.n(Qe),Je=a(278),$e=a.n(Je),qe=a(277),Ke=a.n(qe),Ue=a(279),Ve=a.n(Ue),Xe=a(102);var Ye=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,i=new Array(o),r=0;r<o;r++)i[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={title:"All stops"},a.tableRef=n.a.createRef(),a.setOrganisationFilter=function(e){a.props.setOrganisationFilter(e),a.tableRef.current.onQueryChange()},a.clearOrganisationFilter=function(){a.props.clearOrganisationFilter(),a.tableRef.current.onQueryChange()},a.setMobileFilter=function(e){a.props.setMobileFilter(e),a.tableRef.current.onQueryChange()},a.clearMobileFilter=function(){a.props.clearMobileFilter(),a.tableRef.current.onQueryChange()},a.setRouteFilter=function(e){a.props.setRouteFilter(e),a.tableRef.current.onQueryChange()},a.clearRouteFilter=function(){a.props.clearRouteFilter(),a.tableRef.current.onQueryChange()},a.getStopCalendar=function(e,t){},a.getStopPdf=function(e,t){},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.props.postcode===e.postcode&&this.props.distance===e.distance||this.tableRef.current.onQueryChange()}},{key:"render",value:function(){var e=this.props,t=e.classes,a=e.organisations,o=e.organisation_lookup,i=e.organisation_filter,r=e.viewStopsByOrganisation,l=e.mobiles,s=e.mobile_lookup,c=e.mobile_filter,u=e.routes,p=e.route_lookup,m=e.route_filter,g=e.current_position,h=e.distance,f={};Object.keys(o).forEach(function(e){f[e]=o[e].name});var d={};Object.keys(s).forEach(function(e){d[e]=s[e].name});var b={};return Object.keys(p).forEach(function(e){b[e]=p[e].name}),n.a.createElement("div",{style:{maxWidth:"100%"}},n.a.createElement(ue,{displayStopLink:!1,organisations:a,organisation_lookup:o,organisation_filter:i,setOrganisationFilter:this.setOrganisationFilter,clearOrganisationFilter:this.clearOrganisationFilter,viewStopsByOrganisation:r,mobiles:l,mobile_lookup:s,mobile_filter:c,setMobileFilter:this.setMobileFilter,clearMobileFilter:this.clearMobileFilter,routes:u,route_lookup:p,route_filter:m,setRouteFilter:this.setRouteFilter,clearRouteFilter:this.clearRouteFilter}),n.a.createElement(De.a,{tableRef:this.tableRef,components:{Container:function(e){return n.a.createElement(Te.a,Object.assign({},e,{elevation:0,className:t.table}))}},icons:{Filter:Ke.a,FirstPage:$e.a,LastPage:Ve.a,NextPage:Ze.a,PreviousPage:He.a},options:{search:!1,loadingType:"linear",actionsColumnIndex:4,filtering:!1},columns:[{title:"Name",field:"name",filtering:!1},{title:"Community",field:"community",filtering:!1},{title:"Time",field:"arrival",filtering:!1,render:function(e){return de()(e.arrival,"HH:mm:ssZ").format("HH:mma")+"-"+de()(e.departure,"HH:mm:ssZ").format("HH:mma")}}],actions:[{icon:function(){return n.a.createElement(We.a,{color:"action",fontSize:"small"})},iconProps:{color:"primary"},tooltip:"Download stop calendar",onClick:this.getStopCalendar},{icon:function(){return n.a.createElement(me.a,{color:"action",fontSize:"small"})},iconProps:{color:"primary"},tooltip:"Download stop as PDF",onClick:this.getStopPdf}],data:function(e){return new Promise(function(t,a){!function(e,t,a,o,n,i,r){var l=Xe.api+"/api/stops?page="+(e.page+1)+"&limit="+e.pageSize;e.orderBy&&e.orderBy.field&&(l=l+"&sort="+e.orderBy.field+"&direction="+e.orderDirection),a.length>0&&(l=l+"&mobile_ids="+a.join("|")),t.length>0&&(l=l+"&organisation_ids="+t.join("|")),o.length>0&&(l=l+"&route_ids="+o.join("|")),n&&n.length>1&&(l=l+"&longitude="+n[0]+"&latitude="+n[1]),i&&""!==i&&(l=l+"&distance="+i),he.a.get(l).then(function(e){e&&e.data?r({stops:e.data,total:parseInt(e.headers["x-total-count"]),page:parseInt(e.headers["x-page"])}):r({stops:[],total:0,page:1})}).catch(function(e){return r({stops:[],total:0,page:1})})}(e,i,c,m,g,h,function(e){t({data:e.stops,page:e.page-1,totalCount:e.total})})})},title:this.state.title}))}}]),t}(o.Component),et=Object(y.a)(function(e){return{formControl:{margin:e.spacing(1),minWidth:200},margin:{margin:e.spacing(1)},root:{flexGrow:1,maxWidth:"100%"},table:{border:"1px solid rgba(0, 0, 0, 0.12)"}}},{withTheme:!0})(Ye);var tt=a(102);var at=a(102);var ot=Object(_.a)({palette:{primary:f.a,secondary:b.a},overrides:{MuiButton:{text:{textTransform:"inherit"}}}}),nt=function(e){function t(){var e,a;Object(l.a)(this,t);for(var o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={page:"mobiles",organisations:[],organisation_lookup:{},organisation_filter:[],mobiles:[],mobile_lookup:{},mobile_filter:[],mobile_locations:[],mobile_location_lookup:{},location_timer:null,routes:[],route_lookup:{},route_filter:[],fit_bounds:null,position:[-2.1,53.6138],zoom:[7],pitch:[0],bearing:[0],gps_loading:!0,postcode:"",postcode_loading:!0,current_position:[],gps_available:!1,position_update_interval:"",search_type:""},a.getOrganisations=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({organisations:e,organisation_lookup:t})},he.a.get(tt.api+"/api/organisations").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getMobiles=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({mobiles:e,mobile_lookup:t})},he.a.get(ve.api+"/api/mobiles").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getRoutes=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({routes:e,route_lookup:t})},he.a.get(at.api+"/api/routes").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getMobileLocations=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.mobile_id]=e}),a.setState({mobile_locations:e,mobile_location_lookup:t})},he.a.get(ve.api+"/api/mobiles/locations").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.componentDidMount=function(){a.getOrganisations(),a.getMobiles(),a.getRoutes(),a.getMobileLocations();var e=setInterval(function(){a.getMobileLocations()},15e3);a.setState({location_timer:e})},a.setPage=function(e){return a.setState({page:e})},a.viewStopsByOrganisation=function(e){return a.setState({page:"stops",organisation_filter:[e],mobile_filter:[],route_filter:[]})},a.viewStopsByMobile=function(e){return a.setState({page:"stops",organisation_filter:[],mobile_filter:[e],route_filter:[]})},a.viewStopsByRoute=function(e){return a.setState({page:"stops",organisation_filter:[],mobile_filter:[],route_filter:[e]})},a.clearOrganisationFilter=function(){return a.setState({organisation_filter:[],mobile_filter:[],route_filter:[]})},a.clearMobileFilter=function(){return a.setState({mobile_filter:[],route_filter:[]})},a.clearRouteFilter=function(){return a.setState({route_filter:[]})},a.logPosition=function(){var e;arguments.length>0&&void 0!==arguments[0]&&arguments[0];a.setState({loading:!0,gps_loading:!0}),e=function(e){a.setState({current_position:e,gps_loading:!1,gps_available:e.length>0})},navigator.geolocation.getCurrentPosition(function(t){e([t.coords.longitude,t.coords.latitude])},function(t){e([])},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},a.postcodeSearch=function(e,t){var o={search_type:"postcode",loading:!0,postcode_loading:!0,postcode:e,distance:t};"gps"===a.state.search_type&&(clearInterval(a.state.position_update_interval),o.position_update_interval=null),function(e,t){he.a.get("https://api.postcodes.io/postcodes/"+e).then(function(e){e&&e.data&&e.data.result?t([e.data.result.longitude,e.data.result.latitude]):t([])}).catch(function(e){return t([])})}(e,function(e){2===e.length&&(o.search_type="postcode",o.current_position=e,o.position=e,o.zoom=[11],a.setState(o))})},a.toggleGPS=function(){if("gps"===a.state.search_type)clearInterval(a.state.position_update_interval),a.setState({search_type:"",postcode:"",position_update_interval:null});else{var e=setInterval(a.logPosition,1e4);a.setState({position_update_interval:e,search_type:"gps",postcode:""}),a.logPosition(!0)}},a}return Object(p.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return n.a.createElement(v.a,{theme:ot},n.a.createElement("div",{className:t.root},n.a.createElement(g.a,null),n.a.createElement(K,{page:this.state.page,setPage:this.setPage,search_type:this.state.search_type,gps_available:this.state.gps_available,toggleGPS:this.toggleGPS,postcodeSearch:this.postcodeSearch}),n.a.createElement("main",{className:t.content},n.a.createElement("div",{className:t.toolbar}),"mobiles"===this.state.page?n.a.createElement(Se,{mobiles:this.state.mobiles,mobile_lookup:this.state.mobile_lookup,mobile_location_lookup:this.state.mobile_location_lookup,organisation_lookup:this.state.organisation_lookup,viewStopsByMobile:this.viewStopsByMobile,viewStopsByOrganisation:this.viewStopsByOrganisation,organisations:this.state.organisations,organisation_filter:this.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:this.clearOrganisationFilter,mobile_filter:this.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:this.clearMobileFilter,routes:this.state.routes,route_lookup:this.state.route_lookup,route_filter:this.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:this.clearRouteFilter}):null,"stops"===this.state.page?n.a.createElement(et,{organisations:this.state.organisations,organisation_lookup:this.state.organisation_lookup,organisation_filter:this.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:this.clearOrganisationFilter,mobiles:this.state.mobiles,mobile_lookup:this.state.mobile_lookup,mobile_filter:this.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:this.clearMobileFilter,routes:this.state.routes,route_lookup:this.state.route_lookup,route_filter:this.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:this.clearRouteFilter,current_position:this.state.current_position,postcode:this.state.postcode,distance:this.state.distance}):null,"map"===this.state.page?n.a.createElement(Ie,{bearing:this.state.bearing,fit_bounds:this.state.fit_bounds,pitch:this.state.pitch,position:this.state.position,current_position:this.state.current_position,zoom:this.state.zoom,search_type:this.state.search_type,mobile_lookup:this.state.mobile_lookup,mobile_locations:this.state.mobile_locations.filter(function(e){return null!==e.geox})}):null)))}}]),t}(o.Component),it=Object(y.a)(function(e){return{root:{display:"flex"},toolbar:Object(m.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3)}}})(nt);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(it,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[288,1,2]]]);
//# sourceMappingURL=main.d149ef18.chunk.js.map