(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{119:function(e){e.exports={api:"https://api.mobilelibraries.org"}},283:function(e,t,a){e.exports=a(382)},382:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(13),r=a.n(i),l=a(26),s=a(27),c=a(29),u=a(28),m=a(30),p=a(256),f=a(225),b=a(277),g=a.n(b),h=a(278),d=a.n(h),_=a(279),v=a.n(_),y=a(122),E=a(254),O=a(4),k=a(124),F=a(2),j=a(207),x=a(209),S=a(208),w=a(183),M=a(257),C=a.n(M),R=a(90),N=a.n(R),B=a(258),z=a.n(B),P=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.drawer_open;return o.a.createElement(j.a,{position:"fixed",color:"inherit",elevation:0,className:Object(F.a)(a.appBar,Object(k.a)({},a.appBarShift,n))},o.a.createElement(S.a,null,o.a.createElement(w.a,{variant:"h6",color:"secondary",noWrap:!0},"Mobile Libraries"),o.a.createElement("div",{className:a.grow}),o.a.createElement(x.a,{color:"primary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("mobiles")}},o.a.createElement(C.a,{className:a.leftIcon}),"Mobile dashboard"),o.a.createElement(x.a,{color:"primary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("stops")}},o.a.createElement(N.a,{className:a.leftIcon}),"Find a stop"),o.a.createElement(x.a,{color:"primary",variant:(this.props.page,"text"),onClick:function(){return e.props.setPage("map")}},o.a.createElement(z.a,{className:a.leftIcon}),"Map")))}}]),t}(n.Component),A=Object(O.a)(function(e){return{appBar:{zIndex:e.zIndex.drawer+1,backgroundColor:"rgba(255, 255, 255, 0.5)"},grow:{flexGrow:1},hide:{display:"none"},leftIcon:{marginRight:e.spacing(1)}}},{withTheme:!0})(P),I=a(222),L=a(223),D=a(214),T=a(216),W=a(218),H=a(215),Z=a(120),Q=a(217),G=a(91),J=a.n(G),$=a(92),q=a.n($),K=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={menu_anchor:null},a.openMenu=function(e){return a.setState({menu_anchor:e})},a.closeMenu=function(){return a.setState({menu_anchor:null})},a.chooseMobile=function(e){a.props.setMobileFilter(e),a.closeMenu()},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.mobiles,i=t.mobile_lookup,r=t.mobile_filter,l=t.clearMobileFilter,s=t.organisation_lookup,c=t.organisation_filter,u=o.a.createElement("span",{className:a.bullet},"\u2022");return o.a.createElement(D.a,{className:a.card,elevation:0},c.length>0&&0===r.length?o.a.createElement(H.a,{color:"primary",size:"small","aria-label":"Add",className:a.fab,onClick:function(t){return e.openMenu(t.currentTarget)}},o.a.createElement(J.a,null)):null,r.length>0?o.a.createElement(H.a,{color:"secondary",size:"small","aria-label":"Clear",className:a.fab,onClick:function(){return l()}},o.a.createElement(q.a,null)):null,o.a.createElement(T.a,null,o.a.createElement(w.a,{className:a.title,color:"textSecondary",gutterBottom:!0},c.length>0?s[c[0]].name:"All services",u,n.length+" mobile libraries"),r&&r.length>0?o.a.createElement(w.a,{variant:"h6",component:"h2"},i[r[0]].name):null),o.a.createElement(T.a,null),o.a.createElement(Z.a,{id:"menu-mobile-library",anchorEl:this.state.menu_anchor,keepMounted:!0,open:Boolean(this.state.menu_anchor),onClose:function(){return e.closeMenu()}},n.filter(function(e){var t=!0;return c.length>0&&-1===c.indexOf(e.organisation_id)&&(t=!1),t}).map(function(t){return o.a.createElement(Q.a,{key:"mnu_itm_mob_"+t.id,onClick:function(){return e.chooseMobile(t.id)}},t.name)})),r.length>0?o.a.createElement("div",null,o.a.createElement(W.a,{variant:"middle"})):null)}}]),t}(n.Component),U=Object(O.a)(function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},card:{position:"relative",minWidth:275,border:"1px solid rgba(0, 0, 0, 0.12)"},title:{fontSize:12,fontWeight:500},fab:{position:"absolute",top:e.spacing(2),right:e.spacing(2)}}},{withTheme:!0})(K),V=a(219),X=a(221),Y=a(220),ee=a(93),te=a.n(ee),ae=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={menu_anchor:null},a.openMenu=function(e){return a.setState({menu_anchor:e})},a.closeMenu=function(){return a.setState({menu_anchor:null})},a.chooseOrganisation=function(e){a.props.setOrganisationFilter(e),a.closeMenu()},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.displayStopLink,i=t.organisations,r=t.organisation_lookup,l=t.organisation_filter,s=t.clearOrganisationFilter;return o.a.createElement(D.a,{className:a.card,elevation:0},0===l.length?o.a.createElement(H.a,{color:"primary",size:"small","aria-label":"Add",className:a.fab,onClick:function(t){return e.openMenu(t.currentTarget)}},o.a.createElement(J.a,null)):o.a.createElement(H.a,{color:"secondary",size:"small","aria-label":"Clear",className:a.fab,onClick:function(){return s()}},o.a.createElement(q.a,null)),o.a.createElement(T.a,null,o.a.createElement(w.a,{className:a.title,color:"textSecondary",gutterBottom:!0},i.length+" library services"),l&&l.length>0?o.a.createElement(w.a,{variant:"h6",component:"h2"},r[l[0]].name):null),l&&l.length>0?o.a.createElement(o.a.Fragment,null,o.a.createElement(W.a,{variant:"middle"}),o.a.createElement(V.a,null,n?o.a.createElement(Y.a,{title:"Library service stops"},o.a.createElement(x.a,{size:"small",color:"primary",className:a.button,onClick:function(){return e.props.viewStopsByOrganisation(r[l[0]].id)}},o.a.createElement(N.a,{className:a.leftIcon}),"Stops")):null,o.a.createElement(W.a,{className:a.verticalDivider}),o.a.createElement(Y.a,{title:"Download PDF timetable for library service"},o.a.createElement(X.a,null,o.a.createElement(te.a,null))))):o.a.createElement(T.a,null),o.a.createElement(Z.a,{id:"menu-library-service",anchorEl:this.state.menu_anchor,keepMounted:!0,open:Boolean(this.state.menu_anchor),onClose:function(){return e.closeMenu()}},i.map(function(t){return o.a.createElement(Q.a,{key:"mnu_itm_org_"+t.id,onClick:function(){return e.chooseOrganisation(t.id)}},t.name)})))}}]),t}(n.Component),ne=Object(O.a)(function(e){return{card:{position:"relative",minWidth:275,border:"1px solid rgba(0, 0, 0, 0.12)"},title:{fontSize:12,fontWeight:500},fab:{position:"absolute",top:e.spacing(2),right:e.spacing(2)},verticalDivider:{width:1,height:28,margin:8}}},{withTheme:!0})(ae),oe=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={menu_anchor:null},a.openMenu=function(e){a.setState({menu_anchor:e})},a.closeMenu=function(){a.setState({menu_anchor:null})},a.chooseRoute=function(e){a.props.setRouteFilter(e),a.closeMenu()},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.routes,i=t.route_lookup,r=t.route_filter,l=t.clearRouteFilter,s=t.organisation_filter,c=t.organisation_lookup,u=t.mobile_filter,m=t.mobile_lookup,p=o.a.createElement("span",{className:a.bullet},"\u2022");return o.a.createElement(D.a,{className:a.card,elevation:0},0===r.length?o.a.createElement(H.a,{color:"primary",size:"small","aria-label":"Add",className:a.fab,onClick:function(t){return e.openMenu(t.currentTarget)}},o.a.createElement(J.a,null)):o.a.createElement(H.a,{color:"secondary",size:"small","aria-label":"Clear",className:a.fab,onClick:function(){return l()}},o.a.createElement(q.a,null)),o.a.createElement(T.a,null,o.a.createElement(w.a,{className:a.title,color:"textSecondary",gutterBottom:!0},s.length>0?c[s[0]].name:"All services",p,u.length>0?m[u[0]].name:"All mobiles",p,n.length+" routes"),r&&r.length>0?o.a.createElement(w.a,{variant:"h6",component:"h2"},i[r[0]].name):null),o.a.createElement(T.a,null,o.a.createElement(Z.a,{id:"menu-route",anchorEl:this.state.menu_anchor,keepMounted:!0,open:Boolean(this.state.menu_anchor),onClose:function(){return e.closeMenu()}},n.map(function(t){return o.a.createElement(Q.a,{key:"mnu_itm_route_"+t.id,onClick:function(){return e.chooseRoute(t.id)}},t.name)}))),r.length>0?o.a.createElement("div",null,o.a.createElement(W.a,{variant:"middle"})):null)}}]),t}(n.Component),ie=Object(O.a)(function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},card:{position:"relative",minWidth:275,border:"1px solid rgba(0, 0, 0, 0.12)"},title:{fontSize:12,fontWeight:500},fab:{position:"absolute",top:e.spacing(2),right:e.spacing(2)}}},{withTheme:!0})(oe),re=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.displayStopLink,n=e.organisations,i=e.organisation_lookup,r=e.organisation_filter,l=e.setOrganisationFilter,s=e.clearOrganisationFilter,c=e.viewStopsByOrganisation,u=e.mobiles,m=e.mobile_lookup,p=e.mobile_filter,f=e.setMobileFilter,b=e.clearMobileFilter,g=e.routes,h=e.route_lookup,d=e.route_filter,_=e.setRouteFilter,v=e.clearRouteFilter;return o.a.createElement(I.a,{className:t.grid,container:!0,spacing:3},o.a.createElement(I.a,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2},o.a.createElement(ne,{displayStopLink:a,organisations:n,organisation_lookup:i,organisation_filter:r,setOrganisationFilter:l,clearOrganisationFilter:s,viewStopsByOrganisation:c})),o.a.createElement(I.a,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2},o.a.createElement(U,{displayStopLink:a,organisation_filter:r,organisation_lookup:i,mobiles:u.filter(function(e){var t=!0;return r.length>0&&-1===r.indexOf(e.organisation_id)&&(t=!1),t}),mobile_lookup:m,mobile_filter:p,setMobileFilter:f,clearMobileFilter:b})),o.a.createElement(I.a,{item:!0,xs:12,sm:6,md:4,lg:3,xl:2},p.length>0?o.a.createElement(ie,{displayStopLink:a,organisation_filter:r,organisation_lookup:i,mobile_lookup:m,mobile_filter:p,routes:g.filter(function(e){var t=!0;return p.length>0&&-1===p.indexOf(e.mobile_id)&&(t=!1),t}),route_lookup:h,route_filter:d,setRouteFilter:_,clearRouteFilter:v}):null))}}]),t}(n.Component),le=Object(O.a)(function(e){return{grid:{marginBottom:10}}},{withTheme:!0})(re),se=a(253),ce=a(252),ue=a(102),me=a.n(ue),pe=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.mobile,i=t.organisation,r=t.location,l=o.a.createElement("span",{className:a.bullet},"\u2022");return o.a.createElement(D.a,{className:a.card,elevation:0},o.a.createElement(T.a,null,o.a.createElement(w.a,{className:a.title,color:"textSecondary",gutterBottom:!0},i?i.name:"",l,n.number_routes+" route"+(n.number_routes>1?"s":""),l,n.number_stops+" stop"+(n.number_stops>1?"s":"")),o.a.createElement(w.a,{variant:"h6",component:"h2"},n.name),o.a.createElement(ce.a,{separator:"\u203a"},r&&r.previous_stop_id?o.a.createElement(se.a,{size:"small",label:r.previous_stop_name}):null,r&&!r.current_stop_id&&!r.previous_stop_id&!r.geox?o.a.createElement(se.a,{size:"small",color:"primary",label:"Off Road"}):null,r&&!r.current_stop_id&&r.previous_stop_id&&r.next_stop_id&&r.geox?o.a.createElement(se.a,{size:"small",color:"primary",label:"Travelling"}):null,r&&r.current_stop_id?o.a.createElement(se.a,{size:"small",color:"primary",label:r.current_stop_name}):null,r&&r.next_stop_id?o.a.createElement(se.a,{size:"small",label:me()(r.next_stop_arrival).format("HH:mma")+" "+r.next_stop_name}):null)),o.a.createElement(W.a,{variant:"middle"}),o.a.createElement(V.a,null,o.a.createElement(Y.a,{title:"Mobile library stops"},o.a.createElement(x.a,{size:"small",color:"primary",className:a.button,onClick:function(){return e.props.viewStopsByMobile(n.id)}},o.a.createElement(N.a,{className:a.leftIcon}),"Stops")),o.a.createElement(W.a,{className:a.verticalDivider}),o.a.createElement(Y.a,{title:"Download PDF timetable for mobile"},o.a.createElement(X.a,null,o.a.createElement(te.a,null)))))}}]),t}(n.Component),fe=Object(O.a)(function(e){return{card:{minWidth:275,border:"1px solid rgba(0, 0, 0, 0.12)"},bullet:{display:"inline-block",margin:"0 2px",transform:"scale(0.8)"},margin:{margin:e.spacing(2)},verticalDivider:{width:1,height:28,margin:8},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500}}},{withTheme:!0})(pe),be=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.organisations,i=t.organisation_lookup,r=t.organisation_filter,l=t.setOrganisationFilter,s=t.clearOrganisationFilter,c=t.viewStopsByOrganisation,u=t.mobiles,m=t.mobile_lookup,p=t.mobile_location_lookup,f=t.mobile_filter,b=t.setMobileFilter,g=t.clearMobileFilter,h=t.routes,d=t.route_lookup,_=t.route_filter,v=t.setRouteFilter,y=t.clearRouteFilter;return o.a.createElement("div",{className:a.root},o.a.createElement(le,{displayStopLink:!0,organisations:n,organisation_lookup:i,organisation_filter:r,setOrganisationFilter:l,clearOrganisationFilter:s,viewStopsByOrganisation:c,mobiles:u,mobile_lookup:m,mobile_filter:f,setMobileFilter:b,clearMobileFilter:g,routes:h,route_lookup:d,route_filter:_,setRouteFilter:v,clearRouteFilter:y}),o.a.createElement(L.a,{disableSticky:!0},"Library dashboard"),o.a.createElement(I.a,{container:!0,spacing:3},u.filter(function(e){var t=!0;return r.length>0&&-1===r.indexOf(e.organisation_id)&&(t=!1),f.length>0&&-1===f.indexOf(e.id)&&(t=!1),t}).map(function(t,a){return o.a.createElement(I.a,{key:"grd_"+t.name.replace(" ","")+"_"+a,item:!0,xs:12,sm:6,md:4,lg:3,xl:2},o.a.createElement(fe,{mobile:t,location:p[t.id],organisation:i[t.organisation_id],viewStopsByMobile:e.props.viewStopsByMobile}))})))}}]),t}(n.Component),ge=Object(O.a)(function(){return{root:{flexGrow:1}}})(be),he=a(72),de=a(261),_e=a.n(de),ve=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.classes;return o.a.createElement(H.a,{size:"small",color:"primary",className:e.fab},o.a.createElement(_e.a,null))}}]),t}(n.Component),ye=Object(O.a)(function(e){return{fab:{margin:e.spacing(1),boxShadow:"none"}}},{withTheme:!0})(ve),Ee=Object(he.e)({minZoom:5,maxZoom:18,scrollZoom:!0,interactive:!0,dragRotate:!0,attributionControl:!0}),Oe=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.position,a=e.zoom,n=e.pitch,i=e.bearing,r=e.fit_bounds,l=e.mobile_locations,s=e.mobile_lookup;return o.a.createElement(Ee,{style:"style.json",center:t,zoom:a,maxZoom:17,pitch:n,bearing:i,fitBounds:r,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"}},l&&l.length>0?l.map(function(e){return o.a.createElement(he.b,{coordinates:[e.geox,e.geoy],anchor:"bottom"},o.a.createElement(ye,{mobile:s[e.mobile_id]}))}):null,o.a.createElement(he.c,{id:"src_stops",tileJsonSource:{type:"vector",tiles:["https://api.mobilelibraries.org/api/stops/{z}/{x}/{y}.mvt"]}}),o.a.createElement(he.a,{id:"lyr_stops_circles",type:"circle",sourceId:"src_stops",sourceLayer:"stop",layout:{},paint:{"circle-radius":{base:1.75,stops:[[9,5],[22,180]]},"circle-color":"#36A2EB","circle-stroke-width":{base:1,stops:[[9,2],[22,10]]},"circle-stroke-color":"#FFFFFF","circle-opacity":.8}}),o.a.createElement(he.a,{id:"lyr_stops_labels",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:12,layout:{"text-ignore-placement":!0,"text-field":["to-string",["get","name"]],"text-font":["Source Sans Pro Regular"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],10,8,15,10,22,25],"text-offset":[0,1.8]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"}}),o.a.createElement(he.d,{position:"bottom-right"}))}}]),t}(n.Component),ke=a(95),Fe=a(262),je=a.n(Fe),xe=a(276),Se=a.n(xe),we=a(275),Me=a.n(we),Ce=a(274),Re=a.n(Ce),Ne=a(272),Be=a.n(Ne),ze=a(271),Pe=a.n(ze),Ae=a(273),Ie=a.n(Ae),Le=a(58),De=a.n(Le),Te=a(119);var We=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(i)))).state={title:"All stops"},a.tableRef=o.a.createRef(),a.setOrganisationFilter=function(e){a.props.setOrganisationFilter(e),a.tableRef.current.onQueryChange()},a.clearOrganisationFilter=function(){a.props.clearOrganisationFilter(),a.tableRef.current.onQueryChange()},a.setMobileFilter=function(e){a.props.setMobileFilter(e),a.tableRef.current.onQueryChange()},a.clearMobileFilter=function(){a.props.clearMobileFilter(),a.tableRef.current.onQueryChange()},a.setRouteFilter=function(e){a.props.setRouteFilter(e),a.tableRef.current.onQueryChange()},a.clearRouteFilter=function(){a.props.clearRouteFilter(),a.tableRef.current.onQueryChange()},a.getStopCalendar=function(e,t){},a.getStopPdf=function(e,t){},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,n=t.organisations,i=t.organisation_lookup,r=t.organisation_filter,l=t.viewStopsByOrganisation,s=t.mobiles,c=t.mobile_lookup,u=t.mobile_filter,m=t.routes,p=t.route_lookup,f=t.route_filter,b={};Object.keys(i).forEach(function(e){b[e]=i[e].name});var g={};Object.keys(c).forEach(function(e){g[e]=c[e].name});var h={};return Object.keys(p).forEach(function(e){h[e]=p[e].name}),o.a.createElement("div",{style:{maxWidth:"100%"}},o.a.createElement(le,{displayStopLink:!1,organisations:n,organisation_lookup:i,organisation_filter:r,setOrganisationFilter:this.setOrganisationFilter,clearOrganisationFilter:this.clearOrganisationFilter,viewStopsByOrganisation:l,mobiles:s,mobile_lookup:c,mobile_filter:u,setMobileFilter:this.setMobileFilter,clearMobileFilter:this.clearMobileFilter,routes:m,route_lookup:p,route_filter:f,setRouteFilter:this.setRouteFilter,clearRouteFilter:this.clearRouteFilter}),o.a.createElement(je.a,{tableRef:this.tableRef,components:{Container:function(e){return o.a.createElement(ke.a,Object.assign({},e,{elevation:0,className:a.table}))}},icons:{Filter:Pe.a,FirstPage:Be.a,LastPage:Ie.a,NextPage:Re.a,PreviousPage:Me.a},options:{search:!1,loadingType:"linear",actionsColumnIndex:4,filtering:!1},columns:[{title:"Name",field:"name",filtering:!1},{title:"Community",field:"community",filtering:!1},{title:"Arrival",field:"arrival",filtering:!1,render:function(e){return me()(e.arrival,"HH:mm:ssZ").format("HH:mma")}},{title:"Departure",field:"departure",filtering:!1,render:function(e){return me()(e.departure,"HH:mm:ssZ").format("HH:mma")}}],actions:[{icon:function(){return o.a.createElement(Se.a,{color:"action",fontSize:"small"})},iconProps:{color:"primary"},tooltip:"Download stop calendar",onClick:this.getStopCalendar},{icon:function(){return o.a.createElement(te.a,{color:"action",fontSize:"small"})},iconProps:{color:"primary"},tooltip:"Download stop as PDF",onClick:this.getStopPdf}],data:function(t){return new Promise(function(a,n){!function(e,t,a,n,o){var i=Te.api+"/api/stops?page="+(e.page+1)+"&limit="+e.pageSize;e.orderBy&&e.orderBy.field&&(i=i+"&sort="+e.orderBy.field+"&direction="+e.orderDirection),a.length>0&&(i=i+"&mobile_ids="+a.join("|")),t.length>0&&(i=i+"&organisation_ids="+t.join("|")),n.length>0&&(i=i+"&route_ids="+n.join("|")),De.a.get(i).then(function(e){e&&e.data?o({stops:e.data,total:parseInt(e.headers["x-total-count"]),page:parseInt(e.headers["x-page"])}):o({stops:[],total:0,page:1})}).catch(function(e){return o({stops:[],total:0,page:1})})}(t,e.props.organisation_filter,e.props.mobile_filter,e.props.route_filter,function(e){a({data:e.stops,page:e.page-1,totalCount:e.total})})})},title:this.state.title}))}}]),t}(n.Component),He=Object(O.a)(function(e){return{formControl:{margin:e.spacing(1),minWidth:200},margin:{margin:e.spacing(1)},root:{flexGrow:1,maxWidth:"100%"},table:{border:"1px solid rgba(0, 0, 0, 0.12)"}}},{withTheme:!0})(We),Ze=a(119);var Qe=a(119);var Ge=a(119);var Je=Object(y.a)({palette:{primary:g.a,secondary:d.a,error:v.a},overrides:{MuiButton:{text:{textTransform:"inherit"}}}}),$e=function(e){function t(){var e,a;Object(l.a)(this,t);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(a=Object(c.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={page:"mobiles",organisations:[],organisation_lookup:{},organisation_filter:[],mobiles:[],mobile_lookup:{},mobile_filter:[],mobile_locations:[],mobile_location_lookup:{},location_timer:null,routes:[],route_lookup:{},route_filter:[],fit_bounds:null,position:[-2.1,53.6138],zoom:[6],pitch:[0],bearing:[0]},a.getOrganisations=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({organisations:e,organisation_lookup:t})},De.a.get(Qe.api+"/api/organisations").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getMobiles=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({mobiles:e,mobile_lookup:t})},De.a.get(Ze.api+"/api/mobiles").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getRoutes=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.id]=e}),a.setState({routes:e,route_lookup:t})},De.a.get(Ge.api+"/api/routes").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.getMobileLocations=function(){var e;e=function(e){var t={};e.forEach(function(e){return t[e.mobile_id]=e}),a.setState({mobile_locations:e,mobile_location_lookup:t})},De.a.get(Ze.api+"/api/mobiles/locations").then(function(t){t&&t.data?e(t.data):e([])}).catch(function(t){return e([])})},a.componentDidMount=function(){a.getOrganisations(),a.getMobiles(),a.getRoutes(),a.getMobileLocations();var e=setInterval(function(){a.getMobileLocations()},15e3);a.setState({location_timer:e})},a.setPage=function(e){return a.setState({page:e})},a.viewStopsByOrganisation=function(e){return a.setState({page:"stops",organisation_filter:[e],mobile_filter:[],route_filter:[]})},a.viewStopsByMobile=function(e){return a.setState({page:"stops",organisation_filter:[],mobile_filter:[e],route_filter:[]})},a.viewStopsByRoute=function(e){return a.setState({page:"stops",organisation_filter:[],mobile_filter:[],route_filter:[e]})},a.clearOrganisationFilter=function(){return a.setState({organisation_filter:[],mobile_filter:[],route_filter:[]})},a.clearMobileFilter=function(){return a.setState({mobile_filter:[],route_filter:[]})},a.clearRouteFilter=function(){return a.setState({route_filter:[]})},a}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this,t=this.props.classes;return o.a.createElement(E.a,{theme:Je},o.a.createElement("div",{className:t.root},o.a.createElement(f.a,null),o.a.createElement(A,{page:this.state.page,setPage:this.setPage}),o.a.createElement("main",{className:t.content},o.a.createElement("div",{className:t.toolbar}),"mobiles"===this.state.page?o.a.createElement(ge,{mobiles:this.state.mobiles,mobile_lookup:this.state.mobile_lookup,mobile_location_lookup:this.state.mobile_location_lookup,organisation_lookup:this.state.organisation_lookup,viewStopsByMobile:this.viewStopsByMobile,viewStopsByOrganisation:this.viewStopsByOrganisation,organisations:this.state.organisations,organisation_filter:this.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:this.clearOrganisationFilter,mobile_filter:this.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:this.clearMobileFilter,routes:this.state.routes,route_lookup:this.state.route_lookup,route_filter:this.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:this.clearRouteFilter}):null,"stops"===this.state.page?o.a.createElement(He,{organisations:this.state.organisations,organisation_lookup:this.state.organisation_lookup,organisation_filter:this.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:this.clearOrganisationFilter,mobiles:this.state.mobiles,mobile_lookup:this.state.mobile_lookup,mobile_filter:this.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:this.clearMobileFilter,routes:this.state.routes,route_lookup:this.state.route_lookup,route_filter:this.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:this.clearRouteFilter}):null,"map"===this.state.page?o.a.createElement(Oe,{bearing:this.state.bearing,fit_bounds:this.state.fit_bounds,pitch:this.state.pitch,position:this.state.position,zoom:this.state.zoom,mobile_lookup:this.state.mobile_lookup,mobile_locations:this.state.mobile_locations.filter(function(e){return null!==e.geox})}):null)))}}]),t}(n.Component),qe=Object(O.a)(function(e){return{root:{display:"flex"},toolbar:Object(p.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 8px"},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3)}}})($e);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(qe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[283,1,2]]]);
//# sourceMappingURL=main.1e12919f.chunk.js.map