(this["webpackJsonpmobilelibraries-website"]=this["webpackJsonpmobilelibraries-website"]||[]).push([[0],{147:function(e){e.exports=JSON.parse('{"api":"https://api.mobilelibraries.org/api","stop_tiles":"https://api.mobilelibraries.org/api/stops/{z}/{x}/{y}.mvt","trip_tiles":"https://api.mobilelibraries.org/api/trips/{z}/{x}/{y}.mvt","library_authority_tiles":"https://api-geography.librarydata.uk/rest/libraryauthorities/{z}/{x}/{y}.mvt"}')},567:function(e,t,a){e.exports=a(879)},879:function(e,t,a){"use strict";a.r(t);a(568),a(577);var o=a(0),n=a.n(o),r=a(20),i=a.n(r),l=a(29),s=a(30),c=a(38),u=a(37),p=a(75),m=a(48),d=a(905),g=a(925),f=a(371),_=a(926),h=a(559),b=a.n(h),y=a(557),E=a.n(y),S=a(558),v=a.n(S),k=a(181),w=a(924),O=a(4),C=a(123),M=a.n(C),x=a(906),j=a(488),F=a(489),B=a(531),N=a(487),R=a(128),D=a(161),T=a.n(D),P=a(137),z=a.n(P),I=a(378),A=a.n(I),G=a(560),W=a(904),L=a(277),Z=a(486),Q=a(370),J=a(178),H=a(536),U=a.n(H),q=a(539),$=a.n(q),Y=a(538),K=a.n(Y),V=a(537),X=a.n(V),ee=a(287),te=a.n(ee),ae=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={postcode:e.props.postcode,anchor:null},e.openSettingsMenu=function(t){return e.setState({anchor:t.currentTarget})},e.closeSettingsMenu=function(){return e.setState({anchor:null})},e.setSearchDistance=function(t){e.closeSettingsMenu(),e.props.setDistance(t)},e}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(e){this.props.postcode!==e.postcode&&this.setState({postcode:this.props.postcode})}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.search_type,r=t.postcodeSearch,i=t.clearSearch,l=t.toggleGPS;return n.a.createElement("div",{className:a.search},n.a.createElement(G.a,{placeholder:"Postcode",classes:{root:a.inputRoot,input:a.inputInput},value:this.state.postcode,onChange:function(t){return e.setState({postcode:t.target.value})}}),n.a.createElement("div",{className:a.grow}),"postcode"===o?n.a.createElement(Q.a,{title:"Clear search"},n.a.createElement(f.a,{color:"secondary",className:a.iconButton,onClick:function(){return i()}},n.a.createElement(U.a,null))):null,n.a.createElement(Q.a,{title:"Search by postcode"},n.a.createElement(f.a,{color:"primary",className:a.iconButton,onClick:function(){return r(e.state.postcode)}},n.a.createElement(X.a,null))),n.a.createElement(Q.a,{title:"Track my location"},n.a.createElement(f.a,{className:a.iconButton,color:"gps"===o?"primary":"secondary",onClick:function(){l()}},"gps"===o?n.a.createElement(K.a,null):n.a.createElement($.a,null))),n.a.createElement(Q.a,{title:"Change search settings"},n.a.createElement(f.a,{className:a.iconButton,color:"secondary",onClick:function(t){e.openSettingsMenu(t)}},n.a.createElement(te.a,null))),n.a.createElement(L.a,{id:"mnu-settings",anchorEl:this.state.anchor,keepMounted:!0,open:Boolean(this.state.anchor),onClose:function(){return e.closeSettingsMenu()}},n.a.createElement(W.a,{disableSticky:!0},"Search distance"),n.a.createElement(Z.a,{onClick:function(){return e.setSearchDistance(1609)}},"1 mile"),n.a.createElement(Z.a,{onClick:function(){return e.setSearchDistance(4827)}},"3 miles"),n.a.createElement(Z.a,{onClick:function(){return e.setSearchDistance(8045)}},"5 miles"),n.a.createElement(Z.a,{onClick:function(){return e.setSearchDistance(16090)}},"10 miles"),n.a.createElement(Z.a,{onClick:function(){return e.setSearchDistance(32180)}},"20 miles"),n.a.createElement(Z.a,{onClick:function(){return e.setSearchDistance(80450)}},"50 miles")))}}]),a}(n.a.Component),oe=Object(O.a)((function(e){return{grow:{flexGrow:1},iconButton:{padding:10},inputRoot:{color:"inherit"},inputInput:{paddingTop:e.spacing(),paddingRight:e.spacing(),paddingBottom:e.spacing(),paddingLeft:e.spacing(2)},search:{position:"relative",border:"1px solid #E0E0E0",borderRadius:e.shape.borderRadius,backgroundColor:Object(J.fade)(e.palette.common.white,.8),"&:hover":{backgroundColor:Object(J.fade)(e.palette.common.white,.9)},marginLeft:0,marginRight:e.spacing(),display:"flex",maxWidth:300}}}))(ae),ne=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.loading,a=e.classes,o=e.searchType,r=e.postcode,i=e.distance,l=e.toggleGPS,s=e.postcodeSearch,c=e.clearSearch,u=e.setDistance,m=e.location;return n.a.createElement(n.a.Fragment,null,n.a.createElement(d.a,{maxWidth:"lg"},n.a.createElement(R.a,{color:"textSecondary",variant:"h6",component:"h1",className:a.title},"Mobile libraries")),n.a.createElement(x.a,{position:"/map"===m.pathname?"fixed":"static",color:"inherit",elevation:0,className:"/map"===m.pathname?a.appBarTransparent:a.appBar},n.a.createElement(d.a,{maxWidth:"lg"},n.a.createElement(N.a,null,n.a.createElement(B.a,{smDown:!0},n.a.createElement(n.a.Fragment,null,n.a.createElement(j.a,{component:p.b,to:"/",color:"/"===m.pathname?"primary":"secondary",size:"large",onClick:function(){}},n.a.createElement(T.a,{className:a.leftIcon}),"Mobile vans"),n.a.createElement(j.a,{component:p.b,to:"/stops",color:"/stops"===m.pathname?"primary":"secondary",size:"large",onClick:function(){}},n.a.createElement(z.a,{className:a.leftIcon}),"Stop locations"),n.a.createElement(j.a,{component:p.b,to:"/map",color:"/map"===m.pathname?"primary":"secondary",size:"large",onClick:function(){}},n.a.createElement(A.a,{className:a.leftIcon}),"Map"))),n.a.createElement(B.a,{mdUp:!0},n.a.createElement(n.a.Fragment,null,n.a.createElement(f.a,{component:p.b,to:"/",onClick:function(){}},n.a.createElement(T.a,null)),n.a.createElement(f.a,{component:p.b,to:"/stops",onClick:function(){}},n.a.createElement(z.a,null)),n.a.createElement(f.a,{component:p.b,to:"/map",onClick:function(){}},n.a.createElement(A.a,null)))),"/map"===m.pathname?n.a.createElement(oe,{postcode:r,distance:i,searchType:o,toggleGPS:l,setDistance:u,postcodeSearch:s,clearSearch:c}):null,t?n.a.createElement(F.a,{className:a.progress,color:"secondary",size:30}):null))))}}]),a}(o.Component),re=M()(m.e,Object(O.a)((function(e){return{appBar:{zIndex:e.zIndex.drawer+1},appBarTransparent:{zIndex:e.zIndex.drawer+1,backgroundColor:"rgba(250, 250, 250, 0.8)"},grow:{flexGrow:1},hide:{display:"none"},leftIcon:{marginRight:e.spacing(1)},progress:{margin:e.spacing(1)},title:{margin:e.spacing(2)}}}),{withTheme:!0}))(ne),ie=a(915),le=a(907),se=a(498),ce=a(914),ue=a(928),pe=a(927),me=a(908),de=a(909),ge=a(911),fe=a(910),_e=a(532),he=a(540),be=a.n(he),ye=a(541),Ee=a.n(ye),Se=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={organisation_menu_anchor:null,mobile_menu_anchor:null,route_menu_anchor:null},e.openOrganisationMenu=function(t){e.setState({organisation_menu_anchor:t})},e.closeOrganisationMenu=function(){e.setState({organisation_menu_anchor:null})},e.chooseOrganisation=function(t){e.props.clearSearch(),e.props.setOrganisationFilter(t),e.closeOrganisationMenu()},e.openMobileMenu=function(t){e.setState({mobile_menu_anchor:t})},e.closeMobileMenu=function(){e.setState({mobile_menu_anchor:null})},e.chooseMobile=function(t){e.props.setMobileFilter(t),e.closeMobileMenu()},e.openRouteMenu=function(t){e.setState({route_menu_anchor:t})},e.closeRouteMenu=function(){e.setState({route_menu_anchor:null})},e.chooseRoute=function(t){e.props.setRouteFilter(t),e.closeRouteMenu()},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.organisations,r=t.organisation_lookup,i=t.organisation_filter,l=t.clearOrganisationFilter,s=t.mobiles,c=t.mobile_lookup,u=t.mobile_filter,p=t.clearMobileFilter,m=t.routes,d=t.route_lookup,g=t.route_filter,f=t.clearRouteFilter,_=t.search_type,h=t.postcode,b=t.postcode_district,y=t.distance,E=t.toggleGPS,S=t.postcodeSearch,v=t.clearSearch,k=t.setDistance,w=n.a.createElement("span",{className:a.bullet},"\u2022"),O=new Set(o.map((function(e){return e.country})));return n.a.createElement(le.a,{className:a.grid,container:!0,spacing:3},n.a.createElement(le.a,{item:!0,xs:12,sm:6,md:4,lg:4,xl:2},n.a.createElement(pe.a,{severity:"warning"},n.a.createElement(me.a,null,"Work in progress"),"While this site is being developed you may see unexpected behaviour.")),n.a.createElement(le.a,{item:!0,xs:12,sm:6,md:4,lg:4,xl:2},n.a.createElement(de.a,{className:a.card,elevation:0},n.a.createElement(fe.a,null,n.a.createElement(R.a,{className:a.title,color:"textSecondary",gutterBottom:!0},"Search radius: "+Math.round(y/1609)+" mile",w,"GPS tracking "+("gps"===_?"on":"off")),n.a.createElement(R.a,{variant:"h6",component:"h2",gutterBottom:!0},"Search by location"),n.a.createElement(oe,{postcode:h,distance:y,search_type:_,toggleGPS:E,setDistance:k,postcodeSearch:S,clearSearch:v}),""!==b?n.a.createElement(R.a,{variant:"caption",display:"block"},"Searching around "+b+"."):null))),n.a.createElement(le.a,{item:!0,xs:12,sm:6,md:4,lg:4,xl:2},n.a.createElement(de.a,{className:a.card,elevation:0},n.a.createElement(fe.a,null,n.a.createElement(R.a,{className:a.title,color:"textSecondary",gutterBottom:!0},o.length+" library services",w,s.length+" mobile libraries",w,m.length+" routes"),n.a.createElement(R.a,{variant:"h6",component:"h2"},"Search by service")),n.a.createElement(ge.a,null,0===i.length?n.a.createElement(Q.a,{title:"Choose library service"},n.a.createElement(j.a,{size:"small",color:"primary",className:a.button,onClick:function(t){return e.openOrganisationMenu(t.currentTarget)}},n.a.createElement(be.a,{className:a.leftIcon}),"Service")):n.a.createElement(_e.a,{size:"small",color:"secondary",onDelete:l,label:r[i[0]].name}),i.length>0?0===u.length?n.a.createElement(Q.a,{title:"Choose mobile library"},n.a.createElement(j.a,{size:"small",color:"primary",className:a.button,onClick:function(t){return e.openMobileMenu(t.currentTarget)}},n.a.createElement(T.a,{className:a.leftIcon}),"Mobile")):n.a.createElement(_e.a,{size:"small",color:"secondary",onDelete:function(e){return p()},label:c[u[0]].name}):null,u.length>0?0===g.length?n.a.createElement(Q.a,{title:"Choose route"},n.a.createElement(j.a,{size:"small",color:"primary",className:a.button,onClick:function(t){return e.openRouteMenu(t.currentTarget)}},n.a.createElement(Ee.a,{className:a.leftIcon}),"Route")):n.a.createElement(_e.a,{size:"small",color:"secondary",onDelete:function(e){return f()},label:d[g[0]].name}):null))),n.a.createElement(L.a,{id:"menu-library-service",anchorEl:this.state.organisation_menu_anchor,keepMounted:!0,open:Boolean(this.state.organisation_menu_anchor),onClose:function(){return e.closeOrganisationMenu()}},Array.from(O).sort((function(e,t){return e.localeCompare(t)})).map((function(t){var a=[n.a.createElement(W.a,{disableSticky:!0},t)],r=o.sort((function(e,t){return e.name.localeCompare(t.name)})).filter((function(e){return e.country===t})).map((function(t){return n.a.createElement(Z.a,{key:"mnu_itm_org_"+t.id,onClick:function(){return e.chooseOrganisation(t.id)}},t.name)}));return a.concat(r)}))),n.a.createElement(L.a,{id:"menu-mobile-library",anchorEl:this.state.mobile_menu_anchor,keepMounted:!0,open:Boolean(this.state.mobile_menu_anchor),onClose:function(){return e.closeMobileMenu()}},s.filter((function(e){var t=!0;return i.length>0&&-1===i.indexOf(e.organisation_id)&&(t=!1),t})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(t){return n.a.createElement(Z.a,{key:"mnu_itm_mob_"+t.id,onClick:function(){return e.chooseMobile(t.id)}},t.name)}))),n.a.createElement(L.a,{id:"menu-route",anchorEl:this.state.route_menu_anchor,keepMounted:!0,open:Boolean(this.state.route_menu_anchor),onClose:function(){return e.closeRouteMenu()}},m.filter((function(e){var t=!0;return u.length>0&&-1===u.indexOf(e.mobile_id)&&(t=!1),t})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(t){return n.a.createElement(Z.a,{key:"mnu_itm_route_"+t.id,onClick:function(){return e.chooseRoute(t.id)}},t.name)}))))}}]),a}(o.Component),ve=Object(O.a)((function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(1.2)"},card:{position:"relative",minWidth:275},grid:{marginBottom:10},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500}}}),{withTheme:!0})(Se),ke=a(912),we=a(542),Oe=a.n(we),Ce=a(59),Me=a.n(Ce),xe=a(45),je=a.n(xe),Fe=a(147);function Be(e){Me.a.get(Fe.api+"/mobiles").then((function(t){t&&t.data?e(t.data):e([])})).catch((function(t){return e([])}))}function Ne(e){Me.a.get(Fe.api+"/mobiles/locations").then((function(t){t&&t.data?e(t.data):e([])})).catch((function(t){return e([])}))}function Re(e,t,a){Me.a.get(Fe.api+"/mobiles/nearest?longitude="+e[0]+"&latitude="+e[1]+"&distance="+t).then((function(e){e&&e.data?a(e.data):a([])})).catch((function(e){return a([])}))}function De(e){var t={label:"Not out today"},a={label:"Arriving at "},o={label:"At "},n={label:"Arriving at "},r={label:"Finished for the day"};if(e&&!e.current_stop_id&&!e.previous_stop_id&&e.next_stop_id&&!je()(e.next_stop_arrival).isSame(je()(),"day"))return{type:"off_road",text_format:t.label,message:t.label};if(e&&!e.current_stop_id&&!e.previous_stop_id&&e.next_stop_id&&je()(e.next_stop_arrival).isSame(je()(),"day")){var i=je()(e.next_stop_arrival).fromNow();return{type:"pre_route",message:a.label,text_format:a.label+e.next_stop_name+" "+i,args:[{stop_name:e.next_stop_name,stop_id:e.next_stop_id},i]}}if(e&&e.current_stop_id){var l=je()(e.current_stop_departure).fromNow(!0);return{type:"at_stop",message:o.label,text_format:o.label+e.current_stop_name+" for "+l,args:[{stop_name:e.current_stop_name,stop_id:e.current_stop_id},l]}}if(e&&!e.current_stop_id&&e.previous_stop_id&&e.next_stop_id&&je()(e.previous_stop_departure).isSame(je()(),"day")&&je()(e.next_stop_arrival).isSame(je()(),"day")){var s=je()(e.next_stop_arrival).fromNow();return{type:"between_stops",message:n.label,text_format:n.label+e.next_stop_name+" "+s,args:[{stop_name:e.next_stop_name,stop_id:e.next_stop_id},s]}}return e&&e.previous_stop_id&&e.next_stop_id&&je()(e.previous_stop_departure).isSame(je()(),"day")&&!je()(e.next_stop_arrival).isSame(je()(),"day")?{type:"post_route",message:r.label,text_format:r.label}:null}var Te=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).stopButton=function(t){return n.a.createElement(j.a,{color:"secondary",onClick:function(){return e.props.viewStop({id:t.stop_id})}},t.stop_name)},e.offRoadMessage=function(e){return n.a.createElement(R.a,null,e.message)},e.preRouteMessage=function(t){var a=e.stopButton(t.args[0]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(R.a,null,t.message,a,t.args[1]))},e.atStopMessage=function(t){var a=e.stopButton(t.args[0]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(R.a,null,t.message,a," for "+t.args[1]))},e.betweenStopsMessage=function(t){var a=e.stopButton(t.args[0]);return n.a.createElement(n.a.Fragment,null,n.a.createElement(R.a,null,t.message,a,t.args[1]))},e.postRouteMessage=function(e){return n.a.createElement(R.a,null,e.message)},e.goToWebsite=function(){return window.open(e.props.mobile.timetable,"_blank")},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.mobile,r=t.organisation,i=De(t.location);i&&"off_road"===i.type&&(i=this.offRoadMessage(i)),i&&"pre_route"===i.type&&(i=this.preRouteMessage(i)),i&&"at_stop"===i.type&&(i=this.atStopMessage(i)),i&&"between_stops"===i.type&&(i=this.betweenStopsMessage(i)),i&&"post_route"===i.type&&(i=this.postRouteMessage(i)),i||(i=n.a.createElement(F.a,{className:a.progress,color:"secondary",size:30}));var l=n.a.createElement("span",{className:a.bullet},"\u2022");return n.a.createElement(de.a,{className:a.card,elevation:0},n.a.createElement(fe.a,null,n.a.createElement(R.a,{className:a.title,color:"textSecondary",gutterBottom:!0},o.number_routes+" route"+(o.number_routes>1?"s":""),l,o.number_stops+" stop"+(o.number_stops>1?"s":"")),n.a.createElement(R.a,{variant:"h6",component:"h2"},(r?r.name+" ":"")+o.name),i),n.a.createElement(ge.a,null,n.a.createElement(Q.a,{title:"Mobile library stops"},n.a.createElement(j.a,{component:p.b,to:"/stops",size:"small",color:"primary",className:a.button,onClick:function(){return e.props.viewStopsByMobile(r.id,o.id)}},n.a.createElement(z.a,{className:a.leftIcon}),"Stops")),n.a.createElement(ke.a,{className:a.verticalDivider}),o.timetable?n.a.createElement(Q.a,{title:"Website timetable"},n.a.createElement(f.a,{className:a.button,onClick:function(){return e.goToWebsite()}},n.a.createElement(Oe.a,null))):null))}}]),a}(o.Component),Pe=Object(O.a)((function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(1.2)"},card:{minWidth:275},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500,align:"right"},verticalDivider:{width:1,height:28,margin:8},progress:{margin:e.spacing(2)}}}),{withTheme:!0})(Te),ze=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={open_tab:0},e.changeTab=function(t){e.setState({open_tab:t})},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.organisations,r=t.organisation_lookup,i=t.organisation_filter,l=t.setOrganisationFilter,s=t.clearOrganisationFilter,c=t.viewStopsByOrganisation,u=t.mobiles,p=t.mobile_lookup,m=t.mobile_location_lookup,d=t.mobiles_nearest_lookup,g=t.mobile_filter,f=t.setMobileFilter,_=t.clearMobileFilter,h=t.routes,b=t.route_lookup,y=t.route_filter,E=t.setRouteFilter,S=t.clearRouteFilter,v=t.search_type,k=t.postcode,w=t.postcode_district,O=t.distance,C=t.toggleGPS,M=t.postcodeSearch,x=t.clearSearch,j=t.setDistance,F=u.filter((function(e){var t=!0;return"gps"!==v&&"postcode"!==v||(t=d[e.id]),i.length>0&&-1===i.indexOf(e.organisation_id)&&(t=!1),g.length>0&&-1===g.indexOf(e.id)&&(t=!1),t})),B=F.filter((function(e){var t=De(m[e.id]);return t&&"off_road"!==t.type&&"post_route"!==t.type})),N=0===this.state.open_tab?B:F,R=i.length>0?r[i[0]].name:"",D=g.length>0?p[g[0]].name:"",T=y.length>0?b[y[0]].name:"",P="Mobile vans";return""!==R&&(P="Mobiles in "+R),""!==D&&(P=R+" "+D),""!==T&&(P=R+" "+T),""!==k&&(P="Mobiles with stops within "+Math.round(O/1609)+" mile(s) of "+k),"gps"===v&&(P="Mobiles with stops within "+Math.round(O/1609)+" mile(s) of your location"),n.a.createElement("div",{className:a.root},n.a.createElement(ve,{displayStopLink:!0,organisations:o,organisation_lookup:r,organisation_filter:i,setOrganisationFilter:l,clearOrganisationFilter:s,viewStopsByOrganisation:c,mobiles:u,mobile_lookup:p,mobile_filter:g,setMobileFilter:f,clearMobileFilter:_,routes:h,route_lookup:b,route_filter:y,setRouteFilter:E,clearRouteFilter:S,postcode:k,postcode_district:w,distance:O,search_type:v,setDistance:j,toggleGPS:C,postcodeSearch:M,clearSearch:x}),n.a.createElement(W.a,{disableSticky:!0},P),n.a.createElement(ue.a,{variant:"standard",scrollButtons:"off",value:this.state.open_tab,indicatorColor:"secondary",textColor:"secondary",onChange:function(t,a){return e.changeTab(a)}},n.a.createElement(ce.a,{className:a.tab,label:n.a.createElement(ie.a,{className:a.padding,color:"secondary",badgeContent:B.length},"Out today")}),n.a.createElement(ce.a,{label:n.a.createElement(ie.a,{showZero:!0,className:a.padding,color:"secondary",badgeContent:F.length},"All vans")})),n.a.createElement("br",null),u?n.a.createElement(le.a,{container:!0,spacing:3},N.filter((function(e){var t=!0;return i.length>0&&-1===i.indexOf(e.organisation_id)&&(t=!1),g.length>0&&-1===g.indexOf(e.id)&&(t=!1),t})).filter((function(e){return"gps"!==v&&"postcode"!==v||d[e.id]})).map((function(t,a){return n.a.createElement(le.a,{key:"grd_"+t.name.replace(" ","")+"_"+a,item:!0,xs:12,sm:6,md:4,lg:3,xl:2},n.a.createElement(Pe,{mobile:t,location:m[t.id],organisation:r[t.organisation_id],viewStop:e.props.viewStop,viewStopsByMobile:e.props.viewStopsByMobile}))}))):n.a.createElement("div",null,n.a.createElement("br",null),n.a.createElement(se.a,{color:"secondary"})))}}]),a}(o.Component),Ie=Object(O.a)((function(e){return{chip:{margin:e.spacing(1)},padding:{padding:e.spacing(0,2)},root:{flexGrow:1}}}))(ze),Ae=a(82),Ge=a(929),We=a(543),Le=a.n(We),Ze=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props.classes;return n.a.createElement(Q.a,{title:"Me"},n.a.createElement(Ge.a,{className:"gps"===this.props.search_type?e.avatarOn:e.avatar},n.a.createElement(Le.a,null)))}}]),a}(n.a.Component),Qe=Object(O.a)((function(e){return{avatar:{margin:0},avatarOn:{margin:0,cursor:"pointer",backgroundColor:e.palette.primary.main}}}),{withTheme:!0})(Ze),Je=a(916),He=a(920),Ue=a(918),qe=a(917),$e=a(499),Ye=a(919),Ke=a(255),Ve=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={},e.handleAuthorityBoundaryChange=function(){e.props.toggleMapSetting("authority_boundary")},e.close=function(){return e.props.close()},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.width,r=t.map_settings,i=Object(Ke.b)("sm",o);return n.a.createElement(Je.a,{fullScreen:i,disableBackdropClick:!0,open:this.props.open,onClose:this.close,BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:a.dialog}},n.a.createElement(qe.a,null,"Map settings"),n.a.createElement(Ue.a,null,n.a.createElement($e.a,{control:n.a.createElement(Ye.a,{checked:r.authority_boundary,onChange:this.handleAuthorityBoundaryChange,name:"sw_authority_boundary",color:"primary"}),label:"Authority boundaries"})),n.a.createElement(He.a,null,n.a.createElement(j.a,{onClick:function(){return e.close()},color:"secondary"},"Close")))}}]),a}(n.a.Component),Xe=M()(Object(Ke.a)(),Object(O.a)((function(e){return{dialog:{border:"1px solid #E0E0E0"}}}),{withTheme:!0}))(Ve),et=a(563);function tt(e,t){var a;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3===(a=e.substring(1).split("")).length&&(a=[a[0],a[0],a[1],a[1],a[2],a[2]]),"rgba("+[(a="0x"+a.join(""))>>16&255,a>>8&255,255&a].join(",")+", "+t+")";throw new Error("Bad Hex")}var at=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=this.props,t=e.classes,a=e.location,o=e.organisation,r=e.zoom,i=De(a),l=r<8?"small":r<12?"medium":"large",s=r<8?2:r<12?3:4;return n.a.createElement(Q.a,{title:i?i.text_format:""},n.a.createElement(et.a,{size:l,className:t.fab,color:"primary",style:{backgroundColor:tt(o.colour,.8),border:s+"px solid #FFFFFF"}},n.a.createElement(T.a,null)))}}]),a}(o.Component),ot=Object(O.a)((function(e){return{fab:{margin:e.spacing(1),boxShadow:"none"}}}),{withTheme:!0})(at),nt=a(289),rt=a.n(nt),it=a(921),lt=a(922),st=a(147),ct=Object(Ae.e)({minZoom:5,maxZoom:18,customAttribution:"Contains public sector information licensed under the Open Government Licence"}),ut=[st.stop_tiles],pt=[st.trip_tiles],mt=[st.library_authority_tiles],dt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={time_update_interval:null,current_time:null,map:null,settings_dial_open:!1,settings_dialog_open:!1},e.componentDidMount=function(){var t=setInterval(e.setCurrentTime,500);e.setState({time_update_interval:t})},e.clickStop=function(t){t&&t.features&&t.features.length>0&&t.features[0].properties&&e.props.viewStop({id:t.features[0].properties.id})},e.clickTrip=function(t){t&&t.features&&t.features.length>0&&t.features[0].properties&&e.props.viewTrip(t.features[0].properties)},e.setCurrentTime=function(){return e.setState({current_time:je()()})},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.position,r=t.zoom,i=t.pitch,l=t.bearing,s=t.fit_bounds,c=t.map_settings,u=t.mobile_locations,p=t.mobile_lookup,m=t.organisations,d=t.organisation_lookup,g=t.toggleMapSetting,f=["match",["get","utla19cd"]];return m.forEach((function(e){f.push(e.code),f.push(e.colour)})),f.push("#a7a39b"),n.a.createElement(n.a.Fragment,null,n.a.createElement(ct,{style:"style.json",center:o,zoom:r,maxZoom:17,pitch:i,bearing:l,fitBounds:s,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"},onStyleLoad:function(t){return e.setState({map:t})}},u&&u.length>0?u.map((function(t){var a=[t.geox,t.geoy];if(e.state.current_time&&t.route_section&&t.route_section.coordinates&&t.updated){var o=je()(e.state.current_time).diff(t.updated),r=Math.round(o/500),i=t.route_section.coordinates;i.length>r&&r>0&&(a=i[r]),i.length<=r&&r>0&&(a=i[i.length-1])}var l=p[t.mobile_id],s=l?d[l.organisation_id]:null;return n.a.createElement(Ae.b,{key:"mkr_"+t.id,coordinates:a,anchor:"bottom"},n.a.createElement(ot,{organisation:s,location:t,zoom:e.state.map?e.state.map.getZoom():0}))})):null,n.a.createElement(Ae.c,{id:"src_stops",tileJsonSource:{type:"vector",tiles:ut}}),n.a.createElement(Ae.c,{id:"src_trips",tileJsonSource:{type:"vector",tiles:pt}}),n.a.createElement(Ae.c,{id:"src_library_authorities",tileJsonSource:{type:"vector",tiles:mt}}),n.a.createElement(Ae.a,{id:"lyr_trips_lines",type:"line",sourceId:"src_trips",sourceLayer:"trip",minZoom:13,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-offset":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-dasharray":[2,.5]},onClick:this.clickTrip}),n.a.createElement(Ae.a,{id:"lyr_stops_circles",type:"circle",sourceId:"src_stops",sourceLayer:"stop",minZoom:5,layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],5,2,17,12],"circle-color":["get","organisation_colour"],"circle-stroke-width":["interpolate",["linear"],["zoom"],5,1,17,4],"circle-stroke-color":"#FFFFFF","circle-opacity":.7},onClick:this.clickStop}),n.a.createElement(Ae.a,{id:"lyr_stops_labels",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","name"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,12,17,22],"text-offset":[0,2]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"},onClick:this.clickStop}),n.a.createElement(Ae.a,{id:"lyr_stops_next_visiting",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","next_visiting"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,10,17,16],"text-offset":[0,-2.8]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"},onClick:this.clickStop}),c.authority_boundary?n.a.createElement(n.a.Fragment,null,n.a.createElement(Ae.a,{id:"lyr_library_authorities_lines",type:"line",sourceId:"src_library_authorities",sourceLayer:"library_authority_boundaries",minZoom:6,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],6,1,22,4]}}),n.a.createElement(Ae.a,{id:"lyr_library_authorities_fill",type:"fill",sourceId:"src_library_authorities",sourceLayer:"library_authority_boundaries",minZoom:6,paint:{"fill-color":f,"fill-opacity":.1}})):null,this.props.current_position&&this.props.current_position.length>1?n.a.createElement(Ae.b,{key:"mk_me",coordinates:[this.props.current_position[0],this.props.current_position[1]]},n.a.createElement(Qe,{search_type:this.props.search_type})):null,n.a.createElement(Ae.d,{position:"bottom-left"})),n.a.createElement(it.a,{ariaLabel:"Settings",FabProps:{size:"small"},className:a.settingsDial,icon:n.a.createElement(te.a,null),onClose:function(){return e.setState({settings_dial_open:!1})},onOpen:function(){return e.setState({settings_dial_open:!0})},open:this.state.settings_dial_open,direction:"left"},n.a.createElement(lt.a,{key:"act_more",icon:n.a.createElement(rt.a,null),tooltipTitle:"More settings",onClick:function(){return e.setState({settings_dialog_open:!0,settings_dial_open:!1})}})),n.a.createElement(Xe,{map_settings:c,open:this.state.settings_dialog_open,toggleMapSetting:g,close:function(){return e.setState({settings_dialog_open:!1,settings_dial_open:!1})}}))}}]),a}(o.Component),gt=Object(O.a)((function(e){return{settingsDial:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}}),{withTheme:!0})(dt),ft=a(163),_t=a(544),ht=a.n(_t),bt=a(555),yt=a.n(bt),Et=a(554),St=a.n(Et),vt=a(553),kt=a.n(vt),wt=a(551),Ot=a.n(wt),Ct=a(550),Mt=a.n(Ct),xt=a(552),jt=a.n(xt),Ft=a(556),Bt=a.n(Ft),Nt=a(299),Rt=a.n(Nt),Dt=a(300),Tt=a.n(Dt),Pt=a(147);function zt(e,t){Me.a.get(Pt.api+"/stops/"+e).then((function(e){e&&e.data?t(e.data):t({})})).catch((function(){return t({})}))}var It=a(147),At=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,r=new Array(o),i=0;i<o;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).tableRef=n.a.createRef(),e.getStopCalendar=function(e){return window.open(It.api+"/stops/"+e.id+"/ics")},e.getStopPdf=function(e){return window.open(It.api+"/stops/"+e.id+"/pdf","_blank")},e.viewMapStop=function(t){return e.props.viewMapStop(t.longitude,t.latitude)},e.goToWebsite=function(e){return window.open(e.timetable,"_blank")},e.setOrganisationFilter=function(t){e.props.setOrganisationFilter(t),e.tableRef.current.onQueryChange()},e.clearOrganisationFilter=function(){e.props.clearOrganisationFilter(),e.tableRef.current.onQueryChange()},e.setMobileFilter=function(t){e.props.setMobileFilter(t),e.tableRef.current.onQueryChange()},e.clearMobileFilter=function(){e.props.clearMobileFilter(),e.tableRef.current.onQueryChange()},e.setRouteFilter=function(t){e.props.setRouteFilter(t),e.tableRef.current.onQueryChange()},e.clearRouteFilter=function(){e.props.clearRouteFilter(),e.tableRef.current.onQueryChange()},e.displayStopInfo=function(t){return e.props.viewStop(t)},e}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(e){this.props.current_position===e.current_position&&this.props.distance===e.distance||this.tableRef.current.onQueryChange()}},{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.organisations,r=t.organisation_lookup,i=t.organisation_filter,l=t.viewStopsByOrganisation,s=t.mobiles,c=t.mobile_lookup,u=t.mobile_filter,m=t.routes,d=t.route_lookup,g=t.route_filter,_=t.current_position,h=t.distance,b=t.width,y=t.search_type,E=t.postcode,S=t.postcode_district,v=t.toggleGPS,k=t.postcodeSearch,w=t.clearSearch,O=t.setDistance,C=i.length>0?r[i[0]].name:"",M=u.length>0?c[u[0]].name:"",x=g.length>0?d[g[0]].name:"",j="All stops";""!==C&&(j="Stops in "+C),""!==M&&(j="Stops for "+C+" "+M),""!==x&&(j="Stops for "+C+" "+x),""!==E&&(j="Stops within "+Math.round(h/1609)+" mile(s) of "+E),"gps"===y&&(j="Stops within "+Math.round(h/1609)+" mile(s) of your location");var F={};Object.keys(r).forEach((function(e){F[e]=r[e].name}));var N={};Object.keys(c).forEach((function(e){N[e]=c[e].name}));var R={};return Object.keys(d).forEach((function(e){R[e]=d[e].name})),n.a.createElement("div",{style:{maxWidth:"100%"}},n.a.createElement(ve,{displayStopLink:!1,organisations:o,organisation_lookup:r,organisation_filter:i,setOrganisationFilter:this.setOrganisationFilter,clearOrganisationFilter:this.clearOrganisationFilter,viewStopsByOrganisation:l,mobiles:s,mobile_lookup:c,mobile_filter:u,setMobileFilter:this.setMobileFilter,clearMobileFilter:this.clearMobileFilter,routes:m,route_lookup:d,route_filter:g,setRouteFilter:this.setRouteFilter,clearRouteFilter:this.clearRouteFilter,postcode:E,postcode_district:S,distance:h,search_type:y,setDistance:O,toggleGPS:v,postcodeSearch:k,clearSearch:w}),n.a.createElement(W.a,{disableSticky:!0},j),n.a.createElement(ht.a,{tableRef:this.tableRef,components:{Container:function(e){return n.a.createElement(ft.a,Object.assign({},e,{elevation:0,className:a.table}))}},icons:{Filter:Mt.a,FirstPage:Ot.a,LastPage:jt.a,NextPage:kt.a,PreviousPage:St.a,SortArrow:yt.a},options:{padding:Object(Ke.c)("sm",b)?"default":"dense",search:!1,loadingType:"overlay",actionsColumnIndex:0,filtering:!1,toolbar:!1,headerStyle:{backgroundColor:"#fafafa",color:"#737373",border:"0px"}},columns:[{title:"",field:"name",filtering:!1,render:function(t){return n.a.createElement(n.a.Fragment,null,n.a.createElement(Q.a,{title:"See more stop details"},n.a.createElement(f.a,{onClick:function(){return e.displayStopInfo(t)}},n.a.createElement(rt.a,null))),n.a.createElement(B.a,{mdDown:!0},n.a.createElement(Q.a,{title:"Add event to your device calendar"},n.a.createElement(f.a,{onClick:function(){return e.getStopCalendar(t)}},n.a.createElement(Rt.a,null)))),n.a.createElement(B.a,{mdDown:!0},n.a.createElement(Q.a,{title:"Download a PDF timetable for this stop"},n.a.createElement(f.a,{onClick:function(){return e.getStopPdf(t)}},n.a.createElement(Tt.a,null)))),n.a.createElement(B.a,{mdDown:!0},n.a.createElement(Q.a,{title:"See this stop on the map"},n.a.createElement(f.a,{onClick:function(){return e.viewMapStop(t)},component:p.b,to:"/map"},n.a.createElement(z.a,null)))),n.a.createElement(B.a,{mdDown:!0},n.a.createElement(Q.a,{title:"Go to the website for this stop"},n.a.createElement(f.a,{onClick:function(){return e.goToWebsite(t)}},n.a.createElement(Bt.a,null)))))},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Name",field:"name",filtering:!1,hidden:!1,render:function(e){return e.name},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Community",field:"community",filtering:!1,cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Authority",field:"organisation_name",filtering:!1,hidden:Object(Ke.b)("md",b),cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Next due",field:"route_schedule",filtering:!1,hidden:Object(Ke.b)("xs",b),render:function(e){return e.route_schedule.length>0?je()(e.route_schedule[0]).format("Do MMMM h:mma"):""},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}}],data:function(e){return new Promise((function(t,a){!function(e,t,a,o,n,r,i){var l=Pt.api+"/stops?page="+(e.page+1)+"&limit="+e.pageSize;e.orderBy&&e.orderBy.field&&(l=l+"&sort="+e.orderBy.field+"&direction="+e.orderDirection),a.length>0&&(l=l+"&mobile_ids="+a.join("|")),t.length>0&&(l=l+"&organisation_ids="+t.join("|")),o.length>0&&(l=l+"&route_ids="+o.join("|")),n&&n.length>1&&(l=l+"&longitude="+n[0]+"&latitude="+n[1]),r&&""!==r&&(l=l+"&distance="+r),Me.a.get(l).then((function(e){e&&e.data?i({stops:e.data,total:parseInt(e.headers["x-total-count"]),page:parseInt(e.headers["x-page"])}):i({stops:[],total:0,page:1})})).catch((function(){return i({stops:[],total:0,page:1})}))}(e,i,u,g,_,h,(function(e){t({data:e.stops,page:e.page-1,totalCount:e.total})}))}))}}))}}]),a}(o.Component),Gt=M()(Object(Ke.a)(),Object(O.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:200},margin:{margin:e.spacing(1)},root:{flexGrow:1,maxWidth:"100%"},table:{backgroundColor:"rgba(0, 0, 0, 0)",border:"1px solid #E0E0E0"}}}),{withTheme:!0}))(At),Wt=a(147),Lt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={},e.getStopCalendar=function(){return window.open(Wt.api+"/stops/"+e.props.stop.id+"/ics")},e.getStopPdf=function(){return window.open(Wt.api+"/stops/"+e.props.stop.id+"/pdf","_blank")},e.viewMapStop=function(){return e.props.viewMapStop(e.props.stop.longitude,e.props.stop.latitude)},e.goToWebsite=function(){return window.open(e.props.stop.timetable,"_blank")},e.close=function(){e.props.close()},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.width,r=t.stop,i=Object(Ke.b)("sm",o);return n.a.createElement(Je.a,{fullScreen:i,disableBackdropClick:!0,open:this.props.open,onClose:this.close,"aria-labelledby":"dlg-title",BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:a.dialog}},r&&r.route_days?n.a.createElement(n.a.Fragment,null,n.a.createElement(qe.a,{id:"dlg-title"},r.name+". "+r.community),n.a.createElement(Ue.a,null,n.a.createElement(W.a,null,r.route_schedule&&r.route_schedule.length>0?je()(r.route_schedule[0]).format("dddd Do MMMM h:mma"):""),n.a.createElement("br",null),n.a.createElement(ke.a,null),n.a.createElement("br",null),n.a.createElement(j.a,{onClick:function(){return e.getStopCalendar()},className:a.button,color:"primary",startIcon:n.a.createElement(Rt.a,null)},"Calendar"),n.a.createElement(j.a,{onClick:function(){return e.getStopPdf()},className:a.button,color:"primary",startIcon:n.a.createElement(Tt.a,null)},"Timetable"),n.a.createElement(j.a,{onClick:function(){return e.viewMapStop()},className:a.button,color:"primary",startIcon:n.a.createElement(z.a,null),component:p.b,to:"/map"},"Map"))):n.a.createElement(F.a,{className:a.progress,color:"secondary",size:30}),n.a.createElement(He.a,null,n.a.createElement(j.a,{onClick:function(){return e.goToWebsite()},color:"primary"},"Website"),n.a.createElement(j.a,{onClick:function(){return e.close()},color:"secondary"},"Close")))}}]),a}(n.a.Component),Zt=M()(Object(Ke.a)(),Object(O.a)((function(e){return{button:{margin:e.spacing(1)},dialog:{border:"1px solid #E0E0E0"},leftIcon:{marginRight:e.spacing(1)},list:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},progress:{margin:e.spacing(2)}}}),{withTheme:!0}))(Lt),Qt=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={},e.close=function(){e.props.close()},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.classes,o=t.width,r=t.trip,i=Object(Ke.b)("sm",o),l=Math.round(r.duration/60)+" mins journey time.",s=Math.round(r.distance/1609,1)+" mile(s)";return n.a.createElement(Je.a,{fullScreen:i,disableBackdropClick:!0,open:this.props.open,onClose:this.close,BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:a.dialog}},n.a.createElement(qe.a,null,"Trip details"),n.a.createElement(Ue.a,null,n.a.createElement(W.a,{disableSticky:!0},"From "+r.origin_stop_name+" to "+r.destination_stop_name),n.a.createElement(R.a,{variant:"body2",component:"p"},l+" "+s)),n.a.createElement(He.a,null,n.a.createElement(j.a,{onClick:function(){return e.close()},color:"secondary"},"Close")))}}]),a}(n.a.Component),Jt=M()(Object(Ke.a)(),Object(O.a)((function(e){return{dialog:{border:"1px solid #E0E0E0"}}}),{withTheme:!0}))(Qt);function Ht(e){navigator.geolocation.getCurrentPosition((function(t){e([t.coords.longitude,t.coords.latitude])}),(function(t){e([])}),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})}function Ut(e,t){Me.a.get("https://api.postcodes.io/postcodes/"+e).then((function(e){e&&e.data&&e.data.result?t({location:[e.data.result.longitude,e.data.result.latitude],admin_district:e.data.result.admin_district}):t([])})).catch((function(e){return t([])}))}var qt=a(147);function $t(e){Me.a.get(qt.api+"/organisations").then((function(t){t&&t.data?e(t.data):e([])})).catch((function(t){return e([])}))}var Yt=a(147);function Kt(e){Me.a.get(Yt.api+"/routes").then((function(t){t&&t.data?e(t.data):e([])})).catch((function(t){return e([])}))}var Vt=a(147);function Xt(e,t){Me.a.get(Vt.api+"/trips/"+e).then((function(e){e&&e.data?t(e.data):t({})})).catch((function(){return t({})}))}var ea=Object(k.a)({palette:{primary:E.a,secondary:v.a},overrides:{MuiButton:{text:{textTransform:"none"}},MuiTab:{root:{textTransform:"none"}},MuiTableCell:{root:{borderBottom:"none"}}}}),ta=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var o=arguments.length,n=new Array(o),r=0;r<o;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))).state={stop_dialog_open:!1,current_stop:{},trip_dialog_open:!1,current_trip:{},organisations:[],organisation_lookup:{},organisation_filter:[],mobiles:[],mobile_lookup:{},mobile_filter:[],mobile_locations:[],mobile_location_lookup:{},mobiles_nearest:[],mobiles_nearest_lookup:{},mobile_location_timer:null,routes:[],route_lookup:{},route_filter:[],fit_bounds:null,position:[-2.1,53.6138],zoom:[7],pitch:[0],bearing:[0],search_type:"",distance:1609,postcode:"",postcode_district:"",current_position:[],position_update_interval:"",map_settings:{authority_boundary:!1},loading_gps:!0,loading_mobiles:!1,loading_organisations:!1,loading_postcode:!0,loading_routes:!1,snackbar_open:!1,snackbar_message:""},e.getOrganisations=function(){e.setState({loading_organisations:!0}),$t((function(t){var a={};t.forEach((function(e){return a[e.id]=e})),e.setState({organisations:t,organisation_lookup:a,loading_organisations:!1})}))},e.getMobiles=function(){e.setState({loading_mobiles:!0}),Be((function(t){var a={};t.forEach((function(e){return a[e.id]=e})),e.setState({mobiles:t,mobile_lookup:a,loading_mobiles:!1})}))},e.getRoutes=function(){e.setState({loading_routes:!0}),Kt((function(t){var a={};t.forEach((function(e){return a[e.id]=e})),e.setState({routes:t,route_lookup:a,loading_routes:!1})}))},e.getMobileLocations=function(){Ne((function(t){var a={};t.forEach((function(e){return a[e.mobile_id]=e})),e.setState({mobile_locations:t,mobile_location_lookup:a})}))},e.getMobilesNearest=function(){Re(e.state.current_position,e.state.distance,(function(t){var a={};t.forEach((function(e){return a[e.mobile_id]=e})),e.setState({mobiles_nearest:t,mobiles_nearest_lookup:a})}))},e.componentDidMount=function(){e.getOrganisations(),e.getMobiles(),e.getRoutes(),e.getMobileLocations();var t=setInterval((function(){e.getMobileLocations()}),15e3);e.setState({mobile_location_timer:t})},e.viewStop=function(t){e.openStopDialog(t),t.name||zt(t.id,(function(t){e.setState({current_stop:t})}))},e.openStopDialog=function(t){return e.setState({current_stop:t,stop_dialog_open:!0})},e.closeStopDialog=function(){return e.setState({stop_dialog_open:!1})},e.viewTrip=function(t){e.openTripDialog(t),Xt(t.id,(function(t){e.setState({current_trip:t})}))},e.openTripDialog=function(t){return e.setState({current_trip:t,trip_dialog_open:!0})},e.closeTripDialog=function(){return e.setState({trip_dialog_open:!1})},e.viewStopsByOrganisation=function(t){return e.setState({page:"stops",organisation_filter:[t],mobile_filter:[],route_filter:[]})},e.viewStopsByMobile=function(t,a){return e.setState({page:"stops",organisation_filter:[t],mobile_filter:[a],route_filter:[]})},e.viewStopsByRoute=function(t,a,o){return e.setState({page:"stops",organisation_filter:[t],mobile_filter:[a],route_filter:[o]})},e.clearMobileFilter=function(){return e.setState({mobile_filter:[],route_filter:[]})},e.clearRouteFilter=function(){return e.setState({route_filter:[]})},e.clearOrganisationFilter=function(){return e.setState({organisation_filter:[],mobile_filter:[],route_filter:[]})},e.viewMapStop=function(t,a){return e.setState({page:"map",position:[t,a],zoom:[15],stop_dialog_open:!1})},e.logPosition=function(){e.setState({loading_gps:!0}),Ht((function(t){2===t.length?(e.getMobilesNearest(),e.setState({current_position:t,position:t,zoom:[12],loading_gps:!1})):(clearInterval(e.state.position_update_interval),e.setState({search_type:"",postcode:"",current_position:[],position_update_interval:null,snackbar_open:!0,snackbar_message:"Could not fetch current location"}))}))},e.setDistance=function(t){return e.setState({distance:t})},e.clearSearch=function(){e.setState({postcode:"",postcode_district:"",current_position:[],search_type:"",organisation_filter:[],mobile_filter:[],route_filter:[]})},e.postcodeSearch=function(t){if(""!==t){var a={search_type:"postcode",loading_postcode:!0,postcode:t,organisation_filter:[],mobile_filter:[],route_filter:[]};"gps"===e.state.search_type&&(clearInterval(e.state.position_update_interval),a.position_update_interval=null),Ut(t,(function(t){t.location&&2===t.location.length?(a.search_type="postcode",a.current_position=t.location,a.position=t.location,a.zoom=[11],a.loading_postcode=!1,a.postcode_district=t.admin_district,e.setState(a),e.getMobilesNearest()):e.setState({snackbar_open:!0,snackbar_message:"Could not find postcode",postcode_district:""})}))}else e.setState({snackbar_open:!0,snackbar_message:"You must enter a postcode",postcode_district:""})},e.toggleGPS=function(){if("gps"===e.state.search_type)clearInterval(e.state.position_update_interval),e.setState({search_type:"",postcode:"",current_position:[],position_update_interval:null});else{var t=setInterval(e.logPosition,1e4);e.setState({position_update_interval:t,search_type:"gps",postcode:"",organisation_filter:[],mobile_filter:[],route_filter:[]}),e.logPosition(!0)}},e.toggleMapSetting=function(t){var a=e.state.map_settings,o=e.state.map_settings[t];a[t]=!o,e.setState({map_settings:a})},e.closeSnackbar=function(t,a){"clickaway"!==a&&e.setState({snackbar_open:!1})},e}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props.classes;return n.a.createElement(w.a,{theme:ea},n.a.createElement(p.a,null,n.a.createElement("div",{className:t.root},n.a.createElement(g.a,null),n.a.createElement(re,{loading:this.state.loading_mobiles||this.state.loading_organisations||this.state.loading_routes,postcode:this.state.postcode,distance:this.state.distance,search_type:this.state.search_type,setDistance:this.setDistance,toggleGPS:this.toggleGPS,postcodeSearch:this.postcodeSearch,clearSearch:this.clearSearch}),n.a.createElement(d.a,{maxWidth:"lg"},n.a.createElement("main",{className:t.content},n.a.createElement(m.a,{path:"/",exact:!0,render:function(){return n.a.createElement(Ie,{mobiles:e.state.mobiles,mobile_lookup:e.state.mobile_lookup,mobile_location_lookup:e.state.mobile_location_lookup,mobiles_nearest_lookup:e.state.mobiles_nearest_lookup,organisation_lookup:e.state.organisation_lookup,viewStop:e.viewStop,viewStopsByMobile:e.viewStopsByMobile,viewStopsByOrganisation:e.viewStopsByOrganisation,organisations:e.state.organisations,organisation_filter:e.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:e.clearOrganisationFilter,mobile_filter:e.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:e.clearMobileFilter,routes:e.state.routes,route_lookup:e.state.route_lookup,route_filter:e.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:e.clearRouteFilter,postcode:e.state.postcode,postcode_district:e.state.postcode_district,distance:e.state.distance,search_type:e.state.search_type,setDistance:e.setDistance,toggleGPS:e.toggleGPS,postcodeSearch:e.postcodeSearch,clearSearch:e.clearSearch})}}),n.a.createElement(m.a,{path:"/stops",render:function(){return n.a.createElement(Gt,{organisations:e.state.organisations,organisation_lookup:e.state.organisation_lookup,organisation_filter:e.state.organisation_filter,setOrganisationFilter:function(t){e.setState({organisation_filter:[t]})},clearOrganisationFilter:e.clearOrganisationFilter,mobiles:e.state.mobiles,mobile_lookup:e.state.mobile_lookup,mobile_filter:e.state.mobile_filter,setMobileFilter:function(t){e.setState({mobile_filter:[t]})},clearMobileFilter:e.clearMobileFilter,routes:e.state.routes,route_lookup:e.state.route_lookup,route_filter:e.state.route_filter,setRouteFilter:function(t){e.setState({route_filter:[t]})},clearRouteFilter:e.clearRouteFilter,viewStop:e.viewStop,viewMapStop:e.viewMapStop,current_position:e.state.current_position,postcode:e.state.postcode,postcode_district:e.state.postcode_district,distance:e.state.distance,search_type:e.state.search_type,setDistance:e.setDistance,toggleGPS:e.toggleGPS,postcodeSearch:e.postcodeSearch,clearSearch:e.clearSearch})}}),n.a.createElement(m.a,{path:"/map",render:function(){return n.a.createElement(gt,{bearing:e.state.bearing,fit_bounds:e.state.fit_bounds,pitch:e.state.pitch,position:e.state.position,current_position:e.state.current_position,zoom:e.state.zoom,search_type:e.state.search_type,mobile_lookup:e.state.mobile_lookup,mobile_locations:e.state.mobile_locations.filter((function(e){return null!==e.geox})),organisations:e.state.organisations,organisation_lookup:e.state.organisation_lookup,map_settings:e.state.map_settings,toggleMapSetting:e.toggleMapSetting,viewStop:e.viewStop,viewTrip:e.viewTrip})}}))),n.a.createElement(Zt,{stop:this.state.current_stop,open:this.state.stop_dialog_open,close:function(){return e.closeStopDialog()},viewMapStop:this.viewMapStop}),n.a.createElement(Jt,{trip:this.state.current_trip,open:this.state.trip_dialog_open,close:function(){return e.closeTripDialog()}}),n.a.createElement(_.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:this.state.snackbar_open,autoHideDuration:4e3,onClose:this.closeSnackbar,ContentProps:{"aria-describedby":"message-id"},message:n.a.createElement("span",{id:"message-id"},this.state.snackbar_message),action:[n.a.createElement(f.a,{key:"close","aria-label":"close",color:"inherit",className:t.close,onClick:this.closeSnackbar},n.a.createElement(b.a,null))]}))))}}]),a}(o.Component),aa=Object(O.a)((function(e){return{root:{flexGrow:1},content:{flexGrow:1,padding:e.spacing(3)}}}))(ta);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(n.a.createElement(aa,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[567,1,2]]]);
//# sourceMappingURL=main.2b514bd2.chunk.js.map