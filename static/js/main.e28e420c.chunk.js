(this["webpackJsonpmobilelibraries-website"]=this["webpackJsonpmobilelibraries-website"]||[]).push([[0],{132:function(e){e.exports=JSON.parse('{"api":"https://api.mobilelibraries.org/api","postcodeApi":"https://api-geography.librarydata.uk/rest/postcodes/","stopTiles":"https://api.mobilelibraries.org/api/stops/{z}/{x}/{y}.mvt","tripTiles":"https://api.mobilelibraries.org/api/trips/{z}/{x}/{y}.mvt","libraryAuthorityTiles":"https://api-geography.librarydata.uk/rest/libraryauthorities/{z}/{x}/{y}.mvt"}')},576:function(e,t,a){e.exports=a(888)},888:function(e,t,a){"use strict";a.r(t);a(577),a(586);var n=a(0),r=a.n(n),o=a(23),i=a.n(o),c=a(21),l=a(930),s=a(569),u=a.n(s),p=a(374),m=a.n(p),d=a(182),b=a(929),f=Object(n.createContext)(),h=function(e){var t=e.reducer,a=e.initialState,o=e.children;return r.a.createElement(f.Provider,{value:Object(n.useReducer)(t,a)},o)},g=function(){return Object(n.useContext)(f)},y=Object(n.createContext)(),E=function(e){var t=e.reducer,a=e.initialState,o=e.children;return r.a.createElement(y.Provider,{value:Object(n.useReducer)(t,a)},o)},v=function(){return Object(n.useContext)(y)},O=Object(n.createContext)(),S=function(e){var t=e.reducer,a=e.initialState,o=e.children;return r.a.createElement(O.Provider,{value:Object(n.useReducer)(t,a)},o)},j=function(){return Object(n.useContext)(O)},k=a(20),x=a.n(k),w=a(30),_=a(126),N=a(18),C=a(103),I=a(47),F=a(911),P=a(496),M=a(912),L=a(500),D=a(501),T=a(536),B=a(371),R=a(914),A=a(931),z=a(499),J=a(497),W=a(138),Z=a(549),G=a.n(Z),q=a(163),U=a.n(q),Y=a(543),X=a.n(Y),H=a(151),V=a.n(H),$=a(547),Q=a.n($),K=a(548),ee=a.n(K),te=a(545),ae=a.n(te),ne=a(546),re=a.n(ne),oe=a(544),ie=a.n(oe),ce=a(285),le=a.n(ce),se=a(571),ue=a(910),pe=a(275),me=a(498),de=a(181),be=a(541),fe=a.n(be),he=a(542),ge=a.n(he),ye=a(58),Ee=a.n(ye),ve=a(132);function Oe(e){return Se.apply(this,arguments)}function Se(){return(Se=Object(w.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(ve.postcodeApi+t);case 2:return a=e.sent,e.abrupt("return",{location:[a.data.longitude,a.data.latitude],organisation:a.data.library_service_name});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var je=a(66),ke=a(67),xe=a(68),we=a.n(xe),_e=a(132),Ne=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.organisationId=e.organisation_id,this.name=e.name,this.timetable=e.timetable,this.numberRoutes=e.number_routes,this.numberStops=e.number_stops,this}}]),e}(),Ce=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.mobileId=e.mobile_id,this.stopId=e.stop_id,this.stopName=e.stop_name,this.stopDistance=e.stop_distance,this}}]),e}(),Ie=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.mobileId=e.mobile_id,this.currentStopId=e.current_stop_id,this.currentStopDeparture=we()(e.current_stop_departure),this.currentStopName=e.current_stop_name,this.previousStopId=e.previous_stop_id,this.previousStopDeparture=we()(e.previous_stop_departure),this.previousStopName=e.previous_stop_name,this.nextStopId=e.next_stop_id,this.nextStopArrival=we()(e.next_stop_arrival),this.nextStopName=e.next_stop_name,this.updated=we()(e.updated),this.updateType=e.update_type,this.geoX=e.geox,this.geoY=e.geoy,this.routeSection=e.route_section,this}},{key:"getStatus",value:function(){var e=we()(),t="Not out today",a="Arriving at ",n="At ",r="Arriving at ",o="Finished for the day";if(!this.currentStopId&&!this.previousStopId&&this.nextStopId&&!this.nextStopArrival.isSame(e,"day"))return{type:"offRoad",textFormat:t,message:t};if(!this.currentStopId&&!this.previousStopId&&this.nextStopId&&this.nextStopArrival.isSame(e,"day")){var i=this.nextStopArrival.fromNow();return{type:"preRoute",message:a,textFormat:a+this.nextStopName+" "+i,args:[{stopName:this.nextStopName,stopId:this.nextStopId},i]}}if(this.currentStopId){var c=this.currentStopDeparture.fromNow(!0);return{type:"atStop",message:n,textFormat:n+this.currentStopName+" for "+c,args:[{stopName:this.currentStopName,stopId:this.currentStopId},c]}}if(!this.currentStopId&&this.previousStopId&&this.nextStopId&&this.previousStopDeparture.isSame(e,"day")&&this.nextStopArrival.isSame(e,"day")){var l=this.nextStopArrival.fromNow();return{type:"betweenStops",message:r,textFormat:r+this.nextStopName+" "+l,args:[{stopName:this.nextStopName,stopId:this.nextStopId},l]}}return this.previousStopId&&this.nextStopId&&this.previousStopDeparture.isSame(e,"day")&&!this.nextStopArrival.isSame(e,"day")?{type:"postRoute",message:o,text_format:o}:null}}]),e}();function Fe(){return Pe.apply(this,arguments)}function Pe(){return(Pe=Object(w.a)(x.a.mark((function e(){var t,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(_e.api+"/mobiles");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=8;break}return a=t.data.map((function(e){return(new Ne).fromJson(e)})),e.abrupt("return",a);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(){return Le.apply(this,arguments)}function Le(){return(Le=Object(w.a)(x.a.mark((function e(){var t,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(_e.api+"/mobiles/locations");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=8;break}return a=t.data.map((function(e){return(new Ie).fromJson(e)})),e.abrupt("return",a);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function De(e,t){return Te.apply(this,arguments)}function Te(){return(Te=Object(w.a)(x.a.mark((function e(t,a){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(_e.api+"/mobiles/nearest?longitude="+t[0]+"&latitude="+t[1]+"&distance="+a);case 2:if(!((n=e.sent)&&n.data&&n.data.length>0)){e.next=7;break}return e.abrupt("return",n.data.map((function(e){return(new Ce).fromJson(e)})));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Be=Object(P.a)((function(e){return{grow:{flexGrow:1},iconButton:{padding:10},inputInput:{paddingTop:e.spacing(),paddingRight:e.spacing(),paddingBottom:e.spacing(),paddingLeft:e.spacing(2),fontWeight:500},search:{position:"relative",border:"1px solid #E0E0E0",borderRadius:e.shape.borderRadius,backgroundColor:Object(de.fade)(e.palette.common.white,.8),"&:hover":{backgroundColor:Object(de.fade)(e.palette.common.white,.9)},marginLeft:0,marginRight:e.spacing(),display:"flex",maxWidth:240}}}));var Re=function(){var e=g(),t=Object(N.a)(e,2);Object(_.a)(t[0]);var a=t[1],o=v(),i=Object(N.a)(o,2),c=i[0],l=c.searchType,s=c.searchPostcode,u=c.searchDistance,p=i[1],m=j(),d=Object(N.a)(m,2);Object(_.a)(d[0]);var b=d[1],f=Object(n.useState)(s),h=Object(N.a)(f,2),y=h[0],E=h[1],O=Object(n.useState)(null),S=Object(N.a)(O,2),k=S[0],C=S[1],I=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e})),t.current}({searchPostcode:s});Object(n.useEffect)((function(){I&&s!==I.searchPostcode&&E(s)}),[s]);var F=function(){return C(null)},P=function(e){F(),p({type:"SetSearchDistance",searchDistance:e}),"postcode"===l&&M()},M=function(){var e=Object(w.a)(x.a.mark((function e(){var t,n,r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==y){e.next=3;break}return b({type:"ShowNotification",notificationMessage:"You must enter a postcode"}),e.abrupt("return");case 3:return b({type:"LoadingPostcode"}),e.next=6,Oe(y);case 6:if(!(t=e.sent).location||2!==t.location.length){e.next=18;break}return p({type:"SetPostcodeSearch",searchPostcode:y,searchPosition:t.location}),b({type:"SetPostcodeSearch",mapPosition:t.location}),e.next=12,De(t.location,u);case 12:n=e.sent,r={},n.forEach((function(e){r[e.mobileId]=e})),a({type:"UpdateMobilesNearest",mobilesNearest:n,mobilesNearestLookup:r}),e.next=19;break;case 18:b({type:"ShowNotification",notificationMessage:"Could not find postcode"});case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=Be();return r.a.createElement("div",{className:L.search},r.a.createElement(se.a,{placeholder:"Postcode",classes:{input:L.inputInput},value:y,onChange:function(e){return E(e.target.value)}}),r.a.createElement("div",{className:L.grow}),"postcode"===l?r.a.createElement(J.a,{title:"Clear search"},r.a.createElement(B.a,{className:L.iconButton,onClick:function(){return p({type:"ClearAll"})}},r.a.createElement(fe.a,null))):null,r.a.createElement(J.a,{title:"Search by postcode"},r.a.createElement(B.a,{color:"primary",className:L.iconButton,onClick:function(){return M()}},r.a.createElement(le.a,null))),r.a.createElement(J.a,{title:"Change search settings"},r.a.createElement(B.a,{className:L.iconButton,color:"secondary",onClick:function(e){!function(e){C(e.currentTarget)}(e)}},r.a.createElement(ge.a,null))),r.a.createElement(pe.a,{id:"mnu-settings",anchorEl:k,keepMounted:!0,open:Boolean(k),onClose:function(){return F()}},r.a.createElement(ue.a,{disableSticky:!0},"Search distance"),r.a.createElement(me.a,{onClick:function(){return P(1609)}},"1 mile"),r.a.createElement(me.a,{onClick:function(){return P(4827)}},"3 miles"),r.a.createElement(me.a,{onClick:function(){return P(8045)}},"5 miles"),r.a.createElement(me.a,{onClick:function(){return P(16090)}},"10 miles"),r.a.createElement(me.a,{onClick:function(){return P(32180)}},"20 miles"),r.a.createElement(me.a,{onClick:function(){return P(80450)}},"50 miles")))},Ae=Object(P.a)((function(e){return{appBar:{zIndex:e.zIndex.drawer+1},appBarTransparent:{zIndex:e.zIndex.drawer+1,backgroundColor:"rgba(250, 250, 250, 0.8)"},grow:{flexGrow:1},iconTitle:{marginLeft:e.spacing(1)},progress:{margin:e.spacing(1)},tabBar:{borderTop:"1px solid #e8e8e8",borderBottom:"1px solid #e8e8e8"},title:{margin:e.spacing(2),display:"inline-block",verticalAlign:"middle"}}}));var ze=function(){var e=j(),t=Object(N.a)(e,1)[0],a=t.loadingOrganisations,o=t.loadingMobiles,i=t.loadingRoutes,c=t.loadingMobileLocations,l=t.loadingNearestMobiles,s=t.loadingPostcode,u=Object(n.useState)(!1),p=Object(N.a)(u,2),m=p[0],d=p[1],b=Object(n.useState)(1),f=Object(N.a)(b,2),h=f[0],g=f[1],y=a||o||i||c||l||s,E=Object(I.e)(),v=Ae(),O=[{title:"Libraries at home",url:"https://www.librariesathome.co.uk",icon:r.a.createElement(X.a,null),links:[{title:r.a.createElement("span",{className:v.iconTitle},"Search"),short:r.a.createElement("span",{className:v.iconTitle},"Search"),icon:r.a.createElement(le.a,null),to:"https://www.librariesathome.co.uk"},{title:r.a.createElement("span",{className:v.iconTitle},"Watch"),short:r.a.createElement("span",{className:v.iconTitle},"Watch"),icon:r.a.createElement(ie.a,null),to:"https://www.librariesathome.co.uk/watch"},{title:r.a.createElement("span",{className:v.iconTitle},"Read"),short:r.a.createElement("span",{className:v.iconTitle},"Read"),icon:r.a.createElement(ae.a,null),to:"https://www.librariesathome.co.uk/read"},{title:r.a.createElement("span",{className:v.iconTitle},"Listen"),short:r.a.createElement("span",{className:v.iconTitle},"Listen"),icon:r.a.createElement(re.a,null),to:"https://www.librariesathome.co.uk/listen"}]},{title:"Mobile libraries",url:"https://www.mobilelibraries.org",icon:r.a.createElement(U.a,null),links:[{title:r.a.createElement("span",{className:v.iconTitle},"Mobile vans"),short:r.a.createElement("span",{className:v.iconTitle},"Vans"),icon:r.a.createElement(U.a,null),to:"https://www.mobilelibraries.org/"},{title:r.a.createElement("span",{className:v.iconTitle},"Stop locations"),short:r.a.createElement("span",{className:v.iconTitle},"Stops"),icon:r.a.createElement(V.a,null),to:"https://www.mobilelibraries.org/stops"},{title:r.a.createElement("span",{className:v.iconTitle},"Map"),short:r.a.createElement("span",{className:v.iconTitle},"Map"),icon:r.a.createElement(Q.a,null),to:"https://www.mobilelibraries.org/map"}]},{title:"Library map",url:"https://www.librarymap.co.uk",icon:r.a.createElement(ee.a,null),links:[]}],S=O[1].url;return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement(B.a,{color:"primary",onClick:function(){d(!m)}},r.a.createElement(G.a,null)),r.a.createElement(W.a,{color:"secondary",variant:"h6",component:"h1",className:v.title},O[1].title)),m?r.a.createElement(M.a,{position:"static",color:"default",elevation:0},r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement(A.a,{className:v.tabBar,value:h,onChange:function(e,t){g(t)},variant:"scrollable",scrollButtons:"on",indicatorColor:"primary",textColor:"primary"},O.map((function(e,t){return r.a.createElement(R.a,{key:"tb_site_"+t,label:e.title,icon:e.icon})}))))):null,r.a.createElement(M.a,{position:"/map"===E.pathname?"fixed":"static",color:"inherit",elevation:0,className:"/map"===E.pathname?v.appBarTransparent:v.appBar},r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement(z.a,null,r.a.createElement(T.a,{smUp:!0},O[h].links.map((function(e,t){return r.a.createElement(J.a,{title:e.title,key:"icnb_menu_md_"+t},r.a.createElement(B.a,{component:C.b,to:e.to.replace(S,""),disableRipple:E.pathname===e.to.replace(S,""),disableFocusRipple:E.pathname===e.to.replace(S,""),color:E.pathname===e.to.replace(S,"")?"secondary":"primary"},e.icon))}))),r.a.createElement(T.a,{xsDown:!0,mdUp:!0},O[h].links.map((function(e,t){return r.a.createElement(J.a,{title:e.title,key:"icnb_menu_lg_"+t},r.a.createElement(L.a,{component:C.b,to:e.to.replace(S,""),disableRipple:E.pathname===e.to.replace(S,""),disableFocusRipple:E.pathname===e.to.replace(S,""),color:E.pathname===e.to.replace(S,"")?"secondary":"primary",size:"large"},e.icon,e.short))}))),r.a.createElement(T.a,{smDown:!0},O[h].links.map((function(e,t){return r.a.createElement(J.a,{title:e.title,key:"icnb_menu_lg_"+t},r.a.createElement(L.a,{component:C.b,to:e.to.replace(S,""),disableRipple:E.pathname===e.to.replace(S,""),disableFocusRipple:E.pathname===e.to.replace(S,""),color:E.pathname===e.to.replace(S,"")?"secondary":"primary",size:"large"},e.icon,e.title))}))),y?r.a.createElement(D.a,{className:v.progress,color:"primary",size:30}):null,r.a.createElement("span",{className:v.grow}),"/map"===E.pathname?r.a.createElement(Re,null):null))))},Je=a(919),We=a(920),Ze=a(537),Ge=a(550),qe=a.n(Ge),Ue=a(551),Ye=a.n(Ue),Xe=Object(P.a)((function(e){return{button:{marginRight:e.spacing(1)},chip:{marginRight:e.spacing(1)},leftIcon:{marginRight:e.spacing(1)},search:{alignContent:"center",textAlign:"center",display:"table",marginLeft:"auto",marginRight:"auto",marginBottom:"10px"},subtitle:{textAlign:"center",marginBottom:"5px"},title:{textAlign:"center"}}}));var He=function(){var e=g(),t=Object(N.a)(e,1)[0],a=t.organisations,o=t.organisationLookup,i=t.mobiles,c=t.mobileLookup,l=t.routeLookup,s=t.routes,u=v(),p=Object(N.a)(u,2),m=p[0],d=m.searchDistance,b=m.organisationFilter,f=m.mobileFilter,h=m.routeFilter,y=p[1],E=Object(n.useState)(null),O=Object(N.a)(E,2),S=O[0],j=O[1],k=Object(n.useState)(null),x=Object(N.a)(k,2),w=x[0],_=x[1],C=Object(n.useState)(null),I=Object(N.a)(C,2),F=I[0],P=I[1],M=function(){return j(null)},D=function(){return _(null)},T=function(){return P(null)},B=new Set(a.map((function(e){return e.country}))),R=Xe();return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{component:"h2",variant:"h6",className:R.title},"Your mobile service"),r.a.createElement(W.a,{component:"p",variant:"body1",className:R.subtitle},"Find services within ",d/1609," mile(s)"),r.a.createElement("div",{className:R.search},r.a.createElement(Re,null)),r.a.createElement(W.a,{component:"p",variant:"body1",className:R.subtitle},"Or, choose your library service"),r.a.createElement("div",{className:R.search},0===b.length?r.a.createElement(J.a,{title:"Choose library service"},r.a.createElement(L.a,{color:"primary",className:R.button,onClick:function(e){return t=e.currentTarget,j(t);var t}},r.a.createElement(qe.a,{className:R.leftIcon}),"Select service")):r.a.createElement(Ze.a,{className:R.chip,color:"primary",variant:"outlined",onDelete:function(){y({type:"ClearAll"})},label:o[b[0]].name}),b.length>0?0===f.length?r.a.createElement(J.a,{title:"Choose mobile library"},r.a.createElement(L.a,{color:"primary",className:R.button,onClick:function(e){return t=e.currentTarget,_(t);var t}},r.a.createElement(U.a,{className:R.leftIcon}),"Select mobile")):r.a.createElement(Ze.a,{className:R.chip,color:"primary",variant:"outlined",onDelete:function(){y({type:"ClearMobileFilter"})},label:c[f[0]].name}):null,f.length>0?0===h.length?r.a.createElement(J.a,{title:"Choose route"},r.a.createElement(L.a,{color:"primary",className:R.button,onClick:function(e){return t=e.currentTarget,P(t);var t}},r.a.createElement(Ye.a,{className:R.leftIcon}),"Select route")):r.a.createElement(Ze.a,{className:R.chip,color:"primary",variant:"outlined",onDelete:function(){y({type:"ClearRouteFilter"})},label:l[h[0]].name}):null),r.a.createElement(pe.a,{id:"menu-library-service",anchorEl:S,keepMounted:!0,open:Boolean(S),onClose:function(){return M()}},Array.from(B).sort((function(e,t){return e.localeCompare(t)})).map((function(e,t){var n=[r.a.createElement(ue.a,{key:"lst_"+t,disableSticky:!0},e)],o=a.sort((function(e,t){return e.name.localeCompare(t.name)})).filter((function(t){return t.country===e})).map((function(e){return r.a.createElement(me.a,{key:"mnu_itm_org_"+e.id,onClick:function(){return t=e.id,y({type:"FilterByOrganisation",organisationId:t}),void M();var t}},e.name)}));return n.concat(o)}))),r.a.createElement(pe.a,{id:"menu-mobile-library",anchorEl:w,keepMounted:!0,open:Boolean(w),onClose:function(){return D()}},i.filter((function(e){var t=!0;return b.length>0&&-1===b.indexOf(e.organisationId)&&(t=!1),t})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(me.a,{key:"mnu_itm_mob_"+e.id,onClick:function(){return t=e.organisationId,a=e.id,y({type:"FilterByMobile",organisationId:t,mobileId:a}),void D();var t,a}},e.name)}))),r.a.createElement(pe.a,{id:"menu-route",anchorEl:F,keepMounted:!0,open:Boolean(F),onClose:function(){return T()}},s.filter((function(e){var t=!0;return f.length>0&&-1===f.indexOf(e.mobileId)&&(t=!1),t})).sort((function(e,t){return e.name.localeCompare(t.name)})).map((function(e){return r.a.createElement(me.a,{key:"mnu_itm_route_"+e.id,onClick:function(){return t=e.id,y({type:"FilterByRoute",routeId:t}),void T();var t}},e.name)}))))},Ve=a(915),$e=a(917),Qe=a(916),Ke=a(918),et=a(552),tt=a.n(et),at=Object(P.a)((function(e){return{bullet:{display:"inline-block",margin:"0 2px",transform:"scale(1.2)"},card:{minWidth:275},leftIcon:{marginRight:e.spacing(1)},title:{fontSize:12,fontWeight:500,align:"right"},verticalDivider:{width:1,height:28,margin:8},progress:{margin:e.spacing(2)}}}));var nt=function(e){var t=this,a=e.mobile,n=e.organisation,o=e.location,i=v(),c=Object(N.a)(i,2);Object(_.a)(c[0]);var l=c[1],s=j(),u=Object(N.a)(s,2);Object(_.a)(u[0]);var p=u[1],m=function(e){return r.a.createElement(L.a,{color:"secondary",onClick:function(){return t=e.stopId,l({type:"SetCurrentStop",stopId:t}),void p({type:"SetStopDialog",stopDialogOpen:!0});var t}},e.stopName)},d=at(),b=null;if(o){var f=o.getStatus();f&&"offRoad"===f.type&&(b=function(e){return r.a.createElement(W.a,null,e.message)}(f)),f&&"preRoute"===f.type&&(b=function(e){var t=m(e.args[0]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,null,e.message,t,e.args[1]))}(f)),f&&"atStop"===f.type&&(b=function(e){var t=m(e.args[0]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,null,e.message,t," for "+e.args[1]))}(f)),f&&"betweenStops"===f.type&&(b=function(e){var t=m(e.args[0]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,null,e.message,t,e.args[1]))}(f)),f&&"postRoute"===f.type&&(b=function(e){return r.a.createElement(W.a,null,e.message)}(f))}b||(b=r.a.createElement(D.a,{className:d.progress,color:"primary",size:30}));var h=r.a.createElement("span",{className:d.bullet},"\u2022");return r.a.createElement(Ve.a,{className:d.card,elevation:0},r.a.createElement(Qe.a,null,r.a.createElement(W.a,{className:d.title,gutterBottom:!0},a.numberRoutes+" route"+(a.numberRoutes>1?"s":""),h,a.numberStops+" stop"+(a.numberStops>1?"s":"")),r.a.createElement(W.a,{variant:"h6",component:"h2"},(n?n.name+" ":"")+a.name),b),r.a.createElement($e.a,null,r.a.createElement(J.a,{title:"Mobile library stops"},r.a.createElement(L.a,{component:C.b,to:"/stops",size:"small",color:"primary",className:d.button,onClick:function(){return e=n.id,t=a.id,void l({type:"FilterByMobile",organisationId:e,mobileId:t});var e,t}},r.a.createElement(V.a,{className:d.leftIcon}),"View stops")),r.a.createElement(Ke.a,{className:d.verticalDivider}),a.timetable?r.a.createElement(J.a,{title:"Website timetable"},r.a.createElement(B.a,{className:d.button,onClick:function(){return t.goToWebsite()}},r.a.createElement(tt.a,null))):null))},rt=Object(P.a)((function(e){return{padding:{padding:e.spacing(0,2)},root:{flexGrow:1}}}));var ot=function(){var e=g(),t=Object(N.a)(e,2),a=t[0],o=a.organisationLookup,i=a.mobiles,c=a.mobileLookup,l=a.mobileLocationLookup,s=a.mobilesNearestLookup,u=(a.routes,a.routeLookup),p=(t[1],v()),m=Object(N.a)(p,2),d=m[0],b=d.organisationFilter,f=d.mobileFilter,h=d.routeFilter,y=d.searchType,E=d.searchDistance,O=d.searchPostcode,S=(m[1],j()),k=Object(N.a)(S,2),x=k[0].loadingMobileLocations,w=(k[1],Object(n.useState)(0)),_=Object(N.a)(w,2),C=_[0],I=_[1],F=i.filter((function(e){var t=!0;return"gps"!==y&&"postcode"!==y||(t=s[e.id]),b.length>0&&-1===b.indexOf(e.organisationId)&&(t=!1),f.length>0&&-1===f.indexOf(e.id)&&(t=!1),t})),P=F.filter((function(e){if(l[e.id]){var t=l[e.id].getStatus();return t&&"offRoad"!==t.type&&"postRoute"!==t.type}return null})),M=b.length>0?o[b[0]].name:"",L=f.length>0?c[f[0]].name:"",D=h.length>0?u[h[0]].name:"",T="Mobile library vans";""!==M&&(T="Mobile library vans serving "+M),""!==L&&(T=M+" "+L),""!==D&&(T=M+" "+D),""!==O&&(T="Mobile library vans with stops within "+Math.round(E/1609)+" mile(s) of "+O),"gps"===y&&(T="Mobile library vans with stops within "+Math.round(E/1609)+" mile(s) of your location");var B=rt(),z=(0===C?P:F).filter((function(e){var t=!0;return b.length>0&&-1===b.indexOf(e.organisationId)&&(t=!1),f.length>0&&-1===f.indexOf(e.id)&&(t=!1),t})).filter((function(e){return"gps"!==y&&"postcode"!==y||s[e.id]}));return r.a.createElement("div",{className:B.root},r.a.createElement(He,null),r.a.createElement(ue.a,{component:"span",disableSticky:!0},T),r.a.createElement(A.a,{variant:"standard",scrollButtons:"off",value:C,indicatorColor:"secondary",onChange:function(e,t){return function(e){I(e)}(t)}},r.a.createElement(R.a,{className:B.tab,label:r.a.createElement(Je.a,{className:B.padding,color:"secondary",badgeContent:P.length},"On the road")}),r.a.createElement(R.a,{label:r.a.createElement(Je.a,{showZero:!0,className:B.padding,color:"secondary",badgeContent:F.length},"All vans")})),r.a.createElement("br",null),z.length>0?r.a.createElement(We.a,{container:!0,spacing:3},z.map((function(e,t){return r.a.createElement(We.a,{key:"grd_"+e.name.replace(" ","")+"_"+t,item:!0,xs:12,sm:6,md:4,lg:3,xl:3},r.a.createElement(nt,{mobile:e,location:l[e.id],organisation:o[e.organisationId]}))}))):x?null:r.a.createElement(W.a,{component:"p",variant:"body1"},"No mobile libraries currently on the road."))},it=a(926),ct=a(85),lt=a(554),st=a.n(lt),ut=a(932),pt=a(553),mt=a.n(pt),dt=Object(P.a)((function(e){return{avatar:{margin:0},avatarOn:{margin:0,cursor:"pointer",backgroundColor:e.palette.primary.main}}}));var bt=function(){var e=v(),t=Object(N.a)(e,1)[0].searchType,a=dt();return r.a.createElement(J.a,{title:"Me"},r.a.createElement(ut.a,{className:"gps"===t?a.avatarOn:a.avatar},r.a.createElement(mt.a,null)))},ft=a(921),ht=a(925),gt=a(923),yt=a(922),Et=a(502),vt=a(924),Ot=a(897),St=a(24),jt=Object(P.a)((function(){return{dialog:{border:"1px solid #E0E0E0"}}}));var kt=function(){var e=j(),t=Object(N.a)(e,2),a=t[0],n=a.mapSettings,o=a.mapSettingsDialogOpen,i=t[1],c=function(){i({type:"SetMapSettingsDialog",mapSettingsDialogOpen:!1})},l=jt(),s=Object(St.a)(),u=Object(Ot.a)(s.breakpoints.down("sm"));return r.a.createElement(ft.a,{fullScreen:u,disableBackdropClick:!0,open:o,onClose:c,BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:l.dialog}},r.a.createElement(yt.a,null,"Map settings"),r.a.createElement(gt.a,null,r.a.createElement(Et.a,{control:r.a.createElement(vt.a,{checked:n.authorityBoundary,onChange:function(){i({type:"ToggleMapSetting",mapSetting:"authorityBoundary"})},name:"sw_authority_boundary",color:"primary"}),label:"Library service boundaries"})),r.a.createElement(ht.a,null,r.a.createElement(L.a,{onClick:c,color:"secondary"},"Close")))};function xt(e,t){var a;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3===(a=e.substring(1).split("")).length&&(a=[a[0],a[0],a[1],a[1],a[2],a[2]]),"rgba("+[(a="0x"+a.join(""))>>16&255,a>>8&255,255&a].join(",")+", "+t+")";throw new Error("Bad Hex")}var wt=Object(P.a)((function(e){return{fab:{margin:e.spacing(1),boxShadow:"none"}}}));var _t=function(e){var t=j(),a=Object(N.a)(t,1)[0].mapZoom,n=e.location,o=e.organisation,i=n.getStatus(),c=a[0]<8?"small":a[0]<12?"medium":"large",l=a[0]<8?2:a[0]<12?3:4,s=wt();return r.a.createElement(J.a,{title:i?i.textFormat:""},r.a.createElement(it.a,{size:c,className:s.fab,color:"primary",style:{backgroundColor:xt(o.colour,.8),color:"white",border:l+"px solid #FFFFFF"}},r.a.createElement(U.a,null)))},Nt=Object(P.a)((function(e){return{settings:{position:"absolute",bottom:e.spacing(4),right:e.spacing(4)}}})),Ct=a(132),It=Object(ct.e)({minZoom:5,maxZoom:18,customAttribution:"Contains public sector information licensed under the Open Government Licence"}),Ft=[Ct.stopTiles],Pt=[Ct.tripTiles],Mt=[Ct.libraryAuthorityTiles];var Lt=function(){var e=g(),t=Object(N.a)(e,2),a=t[0],o=a.organisations,i=a.organisationLookup,c=a.mobileLookup,l=a.mobileLocations,s=(t[1],v()),u=Object(N.a)(s,2),p=u[0],m=p.searchType,d=p.searchPosition,b=u[1],f=j(),h=Object(N.a)(f,2),y=h[0],E=y.mapZoom,O=y.mapPosition,S=y.mapSettings,k=y.mapSettingsDialogOpen,x=h[1],w=Object(n.useState)(null),_=Object(N.a)(w,2),C=_[0],I=_[1],F=Object(n.useState)(null),P=Object(N.a)(F,2),M=P[0],L=P[1];Object(n.useEffect)((function(){setInterval(T,500)}),[]);var D=function(e){e&&e.features&&e.features.length>0&&e.features[0].properties&&(b({type:"SetCurrentStop",stopId:e.features[0].properties.id}),x({type:"SetStopDialog",stopDialogOpen:!0}))},T=function(){return I(we()())},B=["match",["get","utla19cd"]];o.forEach((function(e){B.push(e.code),B.push(e.colour)})),B.push("#a7a39b");var R=Nt(),A=l.filter((function(e){return null!==e.geoX&&null!==e.geoY}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(It,{style:"style.json",center:O,zoom:E,maxZoom:17,pitch:[0],bearing:[0],fitBounds:null,containerStyle:{top:0,bottom:0,right:0,left:0,height:"100vh",width:"100vw",position:"absolute"},onStyleLoad:function(e){return L(e)}},A&&A.length>0?A.map((function(e){var t=[e.geoX,e.geoY];if(C&&e.routeSection&&e.routeSection.coordinates&&e.updated){var a=we()(C).diff(e.updated),n=Math.round(a/500),o=e.routeSection.coordinates;o.length>n&&n>0&&(t=o[n]),o.length<=n&&n>0&&(t=o[o.length-1])}var l=c[e.mobileId],s=l?i[l.organisationId]:null;return r.a.createElement(ct.b,{key:"mkr_"+e.id,coordinates:t,anchor:"bottom"},r.a.createElement(_t,{organisation:s,location:e,zoom:M?M.getZoom():0}))})):null,r.a.createElement(ct.c,{id:"src_stops",tileJsonSource:{type:"vector",tiles:Ft}}),r.a.createElement(ct.c,{id:"src_trips",tileJsonSource:{type:"vector",tiles:Pt}}),r.a.createElement(ct.c,{id:"src_library_authorities",tileJsonSource:{type:"vector",tiles:Mt}}),r.a.createElement(ct.a,{id:"lyr_trips_lines",type:"line",sourceId:"src_trips",sourceLayer:"trip",minZoom:13,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-offset":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],13,.5,14,1,15,2,16,3,18,10,22,20],"line-dasharray":[2,.5]},onClick:function(e){e&&e.features&&e.features.length>0&&e.features[0].properties&&(b({type:"SetCurrentTrip",tripId:e.features[0].properties.id}),x({type:"SetTripDialog",tripDialogOpen:!0}))}}),r.a.createElement(ct.a,{id:"lyr_stops_circles",type:"circle",sourceId:"src_stops",sourceLayer:"stop",minZoom:5,layout:{},paint:{"circle-radius":["interpolate",["linear"],["zoom"],5,2,17,12],"circle-color":["get","organisation_colour"],"circle-stroke-width":["interpolate",["linear"],["zoom"],5,1,17,4],"circle-stroke-color":"#FFFFFF","circle-opacity":.7},onClick:D}),r.a.createElement(ct.a,{id:"lyr_stops_labels",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","name"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,12,17,22],"text-offset":[0,2]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"},onClick:D}),r.a.createElement(ct.a,{id:"lyr_stops_next_visiting",type:"symbol",sourceId:"src_stops",sourceLayer:"stop",minZoom:13,layout:{"text-ignore-placement":!1,"text-field":["to-string",["get","next_visiting"]],"text-font":["Source Sans Pro Bold"],"text-line-height":1,"text-size":["interpolate",["linear"],["zoom"],13,10,17,16],"text-offset":[0,-2.8]},paint:{"text-halo-color":"hsl(0, 0%, 100%)","text-halo-width":1,"text-halo-blur":1,"text-color":"#6a6f73"},onClick:D}),S.authorityBoundary?r.a.createElement(r.a.Fragment,null,r.a.createElement(ct.a,{id:"lyr_library_authorities_lines",type:"line",sourceId:"src_library_authorities",sourceLayer:"library_authority_boundaries",minZoom:6,layout:{"line-join":"round","line-cap":"square"},paint:{"line-color":"#a7a39b","line-opacity":1,"line-width":["interpolate",["linear"],["zoom"],6,1,22,4]}}),r.a.createElement(ct.a,{id:"lyr_library_authorities_fill",type:"fill",sourceId:"src_library_authorities",sourceLayer:"library_authority_boundaries",minZoom:6,paint:{"fill-color":B,"fill-opacity":.1}})):null,d&&d.length>1?r.a.createElement(ct.b,{key:"mk_me",coordinates:[d[0],d[1]]},r.a.createElement(bt,{searchType:m})):null,r.a.createElement(ct.d,{position:"bottom-left"})),r.a.createElement(J.a,{title:"Map settings"},r.a.createElement(it.a,{size:"small",className:R.settings,color:"primary",style:{color:"white",border:"1px solid #FFFFFF"},onClick:function(){return x({type:"SetMapSettingsDialog",mapSettingsDialogOpen:!0})}},r.a.createElement(st.a,null))),r.a.createElement(kt,{mapSettings:S,mapSettingsDialogOpen:k}))},Dt=a(927),Tt=a(555),Bt=a.n(Tt);var Rt=function(){var e=j(),t=Object(N.a)(e,2),a=t[0],n=a.notificationOpen,o=a.notificationMessage,i=t[1],c=function(){i({type:"SetNotification",notificationOpen:!1})};return r.a.createElement(Dt.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:n,autoHideDuration:3e3,onClose:c,ContentProps:{"aria-describedby":"message-id"},message:r.a.createElement("span",{id:"message-id"},o),action:[r.a.createElement(B.a,{key:"close","aria-label":"close",onClick:c},r.a.createElement(Bt.a,{color:"inherit"}))]})},At=a(165),zt=a(556),Jt=a.n(zt),Wt=a(567),Zt=a.n(Wt),Gt=a(566),qt=a.n(Gt),Ut=a(565),Yt=a.n(Ut),Xt=a(563),Ht=a.n(Xt),Vt=a(562),$t=a.n(Vt),Qt=a(564),Kt=a.n(Qt),ea=a(568),ta=a.n(ea),aa=a(296),na=a.n(aa),ra=a(297),oa=a.n(ra),ia=a(132),ca=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.routeIds=e.route_ids,this.routeNames=e.route_names,this.mobileIds=e.mobile_ids,this.mobileNames=e.mobile_names,this.organisationId=e.organisation_id,this.organisationName=e.organisation_name,this.name=e.name,this.community=e.community,this.address=e.address,this.postcode=e.postcode,this.arrivalTimes=e.arrival_times,this.departureTimes=e.departure_times,this.routeStart=we()(e.route_start),this.routeEnd=we()(e.route_end),this.routeDays=e.route_days,this.routeFrequencies=e.route_frequencies,this.routeSchedule=e.route_schedule.map((function(e){return we()(e)})),this.timetable=e.timetable,this.longitude=e.longitude,this.latitude=e.latitude,this}}]),e}();function la(e,t,a,n,r,o){return sa.apply(this,arguments)}function sa(){return(sa=Object(w.a)(x.a.mark((function e(t,a,n,r,o,i){var c,l;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=ia.api+"/stops?page="+(t.page+1)+"&limit="+t.pageSize,t.orderBy&&t.orderBy.field&&(c=c+"&sort="+t.orderBy.field+"&direction="+t.orderDirection),n.length>0&&(c=c+"&mobile_ids="+n.join("|")),a.length>0&&(c=c+"&organisation_ids="+a.join("|")),r.length>0&&(c=c+"&route_ids="+r.join("|")),o&&o.length>1&&(c=c+"&longitude="+o[0]+"&latitude="+o[1]),i&&""!==i&&(c=c+"&distance="+i),e.next=9,Ee.a.get(c);case 9:if(!((l=e.sent)&&l.data&&l.data.length>0)){e.next=14;break}return e.abrupt("return",{stops:l.data.map((function(e){return(new ca).fromJson(e)})),total:parseInt(l.headers["x-total-count"]),page:parseInt(l.headers["x-page"])});case 14:return e.abrupt("return",{stops:[],total:0,page:1});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ua(e){return pa.apply(this,arguments)}function pa(){return(pa=Object(w.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(ia.api+"/stops/"+t);case 2:if(!(a=e.sent)||!a.data){e.next=7;break}return e.abrupt("return",(new ca).fromJson(a.data));case 7:return e.abrupt("return",{});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ma=a(132),da=Object(P.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:200},margin:{margin:e.spacing(1)},root:{flexGrow:1,maxWidth:"100%"},table:{backgroundColor:"rgba(0, 0, 0, 0)",border:"1px solid #E0E0E0"}}}));var ba=function(){var e=g(),t=Object(N.a)(e,2),a=t[0],o=(a.organisations,a.organisationLookup),i=(a.mobiles,a.mobileLookup),c=a.routeLookup,l=(t[1],v()),s=Object(N.a)(l,2),u=s[0],p=u.searchType,m=u.searchPostcode,d=u.searchDistance,b=u.searchPosition,f=u.organisationFilter,h=u.mobileFilter,y=u.routeFilter,E=s[1],O=j(),S=Object(N.a)(O,2);Object(_.a)(S[0]);var k=S[1],I=r.a.createRef();Object(n.useEffect)((function(){I.current.onQueryChange()}),[b,d,f,h,y]);var F=da(),P=Object(St.a)(),M=f.length>0?o[f[0]].name:"",L=h.length>0?i[h[0]].name:"",D=y.length>0?c[y[0]].name:"",R="All stops";""!==M&&(R="Stops in "+M),""!==L&&(R="Stops for "+M+" "+L),""!==D&&(R="Stops for "+M+" "+D),""!==m&&(R="Stops within "+Math.round(d/1609)+" mile(s) of "+m),"gps"===p&&(R="Stops within "+Math.round(d/1609)+" mile(s) of your location");var A={};Object.keys(o).forEach((function(e){A[e]=o[e].name}));var z={};Object.keys(i).forEach((function(e){z[e]=i[e].name}));var W={};return Object.keys(c).forEach((function(e){W[e]=c[e].name})),r.a.createElement("div",{style:{maxWidth:"100%"}},r.a.createElement(He,null),r.a.createElement(ue.a,{disableSticky:!0},R),r.a.createElement(Jt.a,{tableRef:I,components:{Container:function(e){return r.a.createElement(At.a,Object.assign({},e,{elevation:0,className:F.table}))}},icons:{Filter:$t.a,FirstPage:Ht.a,LastPage:Kt.a,NextPage:Yt.a,PreviousPage:qt.a,SortArrow:Zt.a},options:{padding:Object(Ot.a)(P.breakpoints.up("sm"))?"default":"dense",search:!1,loadingType:"overlay",actionsColumnIndex:0,filtering:!1,toolbar:!1,headerStyle:{backgroundColor:"#fafafa",color:"#737373",border:"0px"}},columns:[{title:"",field:"name",filtering:!1,render:function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(J.a,{title:"See more stop details"},r.a.createElement(B.a,{onClick:function(){return E({type:"SetCurrentStop",stopId:e.id}),void k({type:"SetStopDialog",stopDialogOpen:!0})}},r.a.createElement(ta.a,null))),r.a.createElement(T.a,{mdDown:!0},r.a.createElement(J.a,{title:"Add event to your device calendar"},r.a.createElement(B.a,{onClick:function(){return t=e,window.open(ma.api+"/stops/"+t.id+"/ics");var t}},r.a.createElement(na.a,null)))),r.a.createElement(T.a,{mdDown:!0},r.a.createElement(J.a,{title:"Download a PDF timetable for this stop"},r.a.createElement(B.a,{onClick:function(){return t=e,window.open(ma.api+"/stops/"+t.id+"/pdf","_blank");var t}},r.a.createElement(oa.a,null)))),r.a.createElement(T.a,{mdDown:!0},r.a.createElement(J.a,{title:"See this stop on the map"},r.a.createElement(B.a,{onClick:function(){return t=e.longitude,a=e.latitude,void k({type:"SetMapPosition",mapPosition:[t,a],mapZoom:15});var t,a},component:C.b,to:"/map"},r.a.createElement(V.a,null)))))},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Name",field:"name",filtering:!1,hidden:!1,render:function(e){return e.name},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Community",field:"community",filtering:!1,cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Library service",field:"organisationName",filtering:!1,hidden:Object(Ot.a)(P.breakpoints.down("sm")),cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}},{title:"Next due",field:"routeSchedule",filtering:!1,hidden:Object(Ot.a)(P.breakpoints.down("xs")),render:function(e){return e.routeSchedule.length>0?e.routeSchedule[0].format("Do MMMM h:mma"):""},cellStyle:{borderBottom:"1px solid #f5f5f5",backgroundColor:"#ffffff"}}],data:function(e){return new Promise((function(t,a){function n(){return(n=Object(w.a)(x.a.mark((function a(){var n;return x.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,la(e,f,h,y,b,d);case 2:n=a.sent,t({data:n.stops,page:n.page-1,totalCount:n.total});case 4:case"end":return a.stop()}}),a)})))).apply(this,arguments)}!function(){n.apply(this,arguments)}()}))}}))},fa=a(132),ha=Object(P.a)((function(e){return{button:{margin:e.spacing(1)},dialog:{border:"1px solid #E0E0E0"},leftIcon:{marginRight:e.spacing(1)},list:{width:"100%",maxWidth:360,backgroundColor:e.palette.background.paper},progress:{margin:e.spacing(2)}}}));var ga=function(){var e=v(),t=Object(N.a)(e,2),a=t[0].currentStopId,o=(t[1],j()),i=Object(N.a)(o,2),c=i[0].stopDialogOpen,l=i[1],s=Object(n.useState)({}),u=Object(N.a)(s,2),p=u[0],m=u[1];Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ua(t);case 2:a=e.sent,m(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}null!=a&&function(t){e.apply(this,arguments)}(a)}),[a]);var d=function(){l({type:"SetStopDialog",stopDialogOpen:!1})},b=Object(St.a)(),f=ha(),h=Object(Ot.a)(b.breakpoints.down("sm"));return r.a.createElement(ft.a,{fullScreen:h,disableBackdropClick:!0,open:c,onClose:d,"aria-labelledby":"dlg-title",BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:f.dialog}},p&&p.routeDays?r.a.createElement(r.a.Fragment,null,r.a.createElement(yt.a,{id:"dlg-title"},p.name+". "+p.community),r.a.createElement(gt.a,null,r.a.createElement(ue.a,null,p.routeSchedule&&p.routeSchedule.length>0?p.routeSchedule[0].format("dddd Do MMMM h:mma"):""),r.a.createElement("br",null),r.a.createElement(Ke.a,null),r.a.createElement("br",null),r.a.createElement(L.a,{onClick:function(){return window.open(fa.api+"/stops/"+p.id+"/ics")},className:f.button,color:"primary",startIcon:r.a.createElement(na.a,null)},"Calendar"),r.a.createElement(L.a,{onClick:function(){return window.open(fa.api+"/stops/"+p.id+"/pdf","_blank")},className:f.button,color:"primary",startIcon:r.a.createElement(oa.a,null)},"Timetable"),r.a.createElement(L.a,{onClick:function(){l({type:"SetMapPosition",mapPosition:[p.longitude,p.latitude],mapZoom:14})},className:f.button,color:"primary",startIcon:r.a.createElement(V.a,null),component:C.b,to:"/map"},"Map"))):r.a.createElement(D.a,{className:f.progress,color:"primary",size:30}),r.a.createElement(ht.a,null,r.a.createElement(L.a,{onClick:function(){return window.open(p.timetable,"_blank")},color:"primary"},"Website"),r.a.createElement(L.a,{onClick:function(){return d()},color:"secondary"},"Close")))},ya=a(132),Ea=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.originStopId=e.origin_stop_id,this.originStopName=e.origin_stop_name,this.destinationStopId=e.destination_stop_id,this.destinationStopName=e.destination_stop_name,this.distance=e.distance,this.duration=e.duration,this.routeLine=e.route_line,this}}]),e}();function va(e){return Oa.apply(this,arguments)}function Oa(){return(Oa=Object(w.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(ya.api+"/trips/"+t);case 2:if(!(a=e.sent)||!a.data){e.next=7;break}return e.abrupt("return",(new Ea).fromJson(a.data));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Sa=Object(P.a)((function(e){return{dialog:{border:"1px solid #E0E0E0"}}}));var ja=function(){var e=v(),t=Object(N.a)(e,2),a=t[0].currentTripId,o=(t[1],j()),i=Object(N.a)(o,2),c=i[0].tripDialogOpen,l=i[1],s=Object(n.useState)({}),u=Object(N.a)(s,2),p=u[0],m=u[1];Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(x.a.mark((function e(t){var a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,va(t);case 2:a=e.sent,m(a);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}null!=a&&function(t){e.apply(this,arguments)}(a)}),[a]);var d=function(){l({type:"SetTripDialog",tripDialogOpen:!1})},b=Sa(),f=Object(St.a)(),h=Object(Ot.a)(f.breakpoints.down("sm")),g=Math.round(p.duration/60)+" mins journey time.",y=Math.round(p.distance/1609,1)+" mile(s)";return r.a.createElement(ft.a,{fullScreen:h,disableBackdropClick:!0,open:c,onClose:d,BackdropProps:{invisible:!0},PaperProps:{elevation:0,className:b.dialog}},r.a.createElement(yt.a,null,"Trip details"),r.a.createElement(gt.a,null,r.a.createElement(ue.a,{disableSticky:!0},"From "+p.originStopName+" to "+p.destinationStopName),r.a.createElement(W.a,{variant:"body2",component:"p"},g+" "+y)),r.a.createElement(ht.a,null,r.a.createElement(L.a,{onClick:d,color:"secondary"},"Close")))},ka=a(132),xa=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.country=e.country,this.code=e.code,this.name=e.name,this.timetable=e.timetable,this.website=e.website,this.email=e.email,this.colour=e.colour,this.logo=e.logo,this.numberMobiles=e.number_mobiles,this.numberRoutes=e.number_routes,this.numberStops=e.number_stops,this}}]),e}();function wa(){return _a.apply(this,arguments)}function _a(){return(_a=Object(w.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(ka.api+"/organisations");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=7;break}return e.abrupt("return",t.data.map((function(e){return(new xa).fromJson(e)})));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Na=a(132),Ca=function(){function e(t){Object(je.a)(this,e),Object.assign(this,t)}return Object(ke.a)(e,[{key:"fromJson",value:function(e){return this.id=e.id,this.organisationId=e.organisation_id,this.mobileId=e.mobile_id,this.name=e.name,this.frequency=e.frequency,this.start=we()(e.start),this.end=we()(e.end),this.timetable=e.timetable,this.numberStops=e.number_stops,this}}]),e}();function Ia(){return Fa.apply(this,arguments)}function Fa(){return(Fa=Object(w.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.a.get(Na.api+"/routes");case 2:if(!((t=e.sent)&&t.data&&t.data.length>0)){e.next=7;break}return e.abrupt("return",t.data.map((function(e){return(new Ca).fromJson(e)})));case 7:return e.abrupt("return",[]);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pa=Object(P.a)((function(e){return{content:{flexGrow:1,padding:e.spacing(2)},root:{flexGrow:1}}}));var Ma=function(){var e=g(),t=Object(N.a)(e,2);Object(_.a)(t[0]);var a=t[1];Object(n.useEffect)((function(){function e(){return(e=Object(w.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wa();case 2:t=e.sent,n={},t.forEach((function(e){n[e.id]=e})),a({type:"AddOrganisations",organisations:t,organisationLookup:n});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t(){return(t=Object(w.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fe();case 2:t=e.sent,n={},t.forEach((function(e){n[e.id]=e})),a({type:"AddMobiles",mobiles:t,mobileLookup:n});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n(){return(n=Object(w.a)(x.a.mark((function e(){var t,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ia();case 2:t=e.sent,n={},t.forEach((function(e){n[e.id]=e})),a({type:"AddRoutes",routes:t,routeLookup:n});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function r(){return o.apply(this,arguments)}function o(){return(o=Object(w.a)(x.a.mark((function e(){var t,n,r=arguments;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!(r.length>0&&void 0!==r[0])||r[0],e.next=3,Me();case 3:t=e.sent,n={},t.forEach((function(e){n[e.mobileId]=e})),a({type:"AddMobileLocations",mobileLocations:t,mobileLocationLookup:n});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}(),function(){t.apply(this,arguments)}(),function(){n.apply(this,arguments)}(),r(),setInterval((function(){r(!1)}),15e3)}),[]);var o=Pa();return r.a.createElement(C.a,null,r.a.createElement("div",{className:o.root},r.a.createElement(ze,null),r.a.createElement(F.a,{maxWidth:"lg"},r.a.createElement("main",{className:o.content},r.a.createElement(I.a,{path:"/",exact:!0,render:function(){return r.a.createElement(ot,null)}}),r.a.createElement(I.a,{path:"/stops",render:function(){return r.a.createElement(ba,null)}}),r.a.createElement(I.a,{path:"/map",render:function(){return r.a.createElement(Lt,null)}}),r.a.createElement(I.a,{path:["/http:","/https:"],component:function(e){return window.location.replace(e.location.pathname.substr(1)),null}}))),r.a.createElement(ga,null),r.a.createElement(ja,null),r.a.createElement(Rt,null)))},La={organisations:[],organisationLookup:{},mobiles:[],mobileLookup:{},mobileLocations:[],mobileLocationLookup:{},mobilesNearest:[],mobilesNearestLookup:{},routes:[],routeLookup:{},stops:[],trips:[]},Da=function(e,t){switch(t.type){case"AddOrganisations":return Object(c.a)(Object(c.a)({},e),{},{organisations:t.organisations,organisationLookup:t.organisationLookup});case"AddMobileLocations":return Object(c.a)(Object(c.a)({},e),{},{mobileLocations:t.mobileLocations,mobileLocationLookup:t.mobileLocationLookup});case"AddRoutes":return Object(c.a)(Object(c.a)({},e),{},{routes:t.routes,routeLookup:t.routeLookup});case"AddMobiles":return Object(c.a)(Object(c.a)({},e),{},{mobiles:t.mobiles,mobileLookup:t.mobileLookup});case"UpdateMobilesNearest":return Object(c.a)(Object(c.a)({},e),{},{mobilesNearest:t.mobilesNearest,mobilesNearestLookup:t.mobilesNearestLookup});default:return e}},Ta={searchPostcode:"",searchType:"",searchDistance:1609,searchPosition:[],searchPositionUpdateInterval:null,organisationFilter:[],mobileFilter:[],routeFilter:[],currentStopId:null,currentTripId:null},Ba=function(e,t){switch(t.type){case"SetCurrentStop":return Object(c.a)(Object(c.a)({},e),{},{currentStopId:t.stopId});case"SetCurrentTrip":return Object(c.a)(Object(c.a)({},e),{},{currentTripId:t.tripId});case"SetSearchDistance":return Object(c.a)(Object(c.a)({},e),{},{searchDistance:t.searchDistance});case"SetPostcodeSearch":return Object(c.a)(Object(c.a)({},e),{},{searchPostcode:t.searchPostcode,searchPosition:t.searchPosition,searchType:"postcode",organisationFilter:[],mobileFilter:[],routeFilter:[]});case"FilterByOrganisation":return Object(c.a)(Object(c.a)({},e),{},{organisationFilter:[t.organisationId],mobileFilter:[],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"FilterByMobile":return Object(c.a)(Object(c.a)({},e),{},{organisationFilter:[t.organisationId],mobileFilter:[t.mobileId],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"FilterByRoute":return Object(c.a)(Object(c.a)({},e),{},{routeFilter:[t.routeId],searchPostcode:"",searchPosition:[],searchType:""});case"ClearAll":return Object(c.a)(Object(c.a)({},e),{},{organisationFilter:[],mobileFilter:[],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"ClearMobileFilter":return Object(c.a)(Object(c.a)({},e),{},{mobileFilter:[],routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});case"ClearRouteFilter":return Object(c.a)(Object(c.a)({},e),{},{routeFilter:[],searchPostcode:"",searchPosition:[],searchType:""});default:return e}},Ra={stopDialogOpen:!1,tripDialogOpen:!1,notificationOpen:!1,notificationMessage:"",mapZoom:[7],mapPosition:[-1.155414,52.691432],mapSettings:{authorityBoundary:!1},mapSettingsDialogOpen:!1,loadingOrganisations:!1,loadingMobiles:!1,loadingRoutes:!1,loadingMobileLocations:!1,loadingNearestMobiles:!1,loadingPostcode:!1},Aa=function(e,t){switch(t.type){case"SetNotificationMessage":return Object(c.a)(Object(c.a)({},e),{},{notificationMessage:t.notificationMessage});case"SetNotification":return Object(c.a)(Object(c.a)({},e),{},{notificationOpen:t.notificationOpen});case"ShowNotification":return Object(c.a)(Object(c.a)({},e),{},{notificationOpen:!0,notificationMessage:t.notificationMessage});case"SetStopDialog":return Object(c.a)(Object(c.a)({},e),{},{stopDialogOpen:t.stopDialogOpen});case"SetTripDialog":return Object(c.a)(Object(c.a)({},e),{},{tripDialogOpen:t.tripDialogOpen});case"SetMapSettingsDialog":return Object(c.a)(Object(c.a)({},e),{},{mapSettingsDialogOpen:t.mapSettingsDialogOpen});case"ToggleMapSetting":var a=e.mapSettings;return a[t.mapSetting]=!a[t.mapSetting],Object(c.a)(Object(c.a)({},e),{},{mapSettings:a});case"LoadingPostcode":return Object(c.a)(Object(c.a)({},e),{},{loadingPostcode:!0});case"SetPostcodeSearch":return Object(c.a)(Object(c.a)({},e),{},{loadingPostcode:!1,mapPosition:t.mapPosition,mapZoom:[13]});case"SetMapPosition":return Object(c.a)(Object(c.a)({},e),{},{mapPosition:t.mapPosition,mapZoom:[t.mapZoom]});default:return e}},za=Object(d.a)({palette:{primary:{main:m.a[900]},secondary:{main:u.a[700]}},overrides:{MuiButton:{text:{textTransform:"none"}},MuiTab:{root:{textTransform:"none"}},MuiTableCell:{root:{borderBottom:"none"}}}});var Ja=function(){return r.a.createElement(h,{initialState:La,reducer:Da},r.a.createElement(E,{initialState:Ta,reducer:Ba},r.a.createElement(S,{initialState:Ra,reducer:Aa},r.a.createElement(b.a,{theme:za},r.a.createElement(l.a,null),r.a.createElement(Ma,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Ja,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[576,1,2]]]);
//# sourceMappingURL=main.e28e420c.chunk.js.map